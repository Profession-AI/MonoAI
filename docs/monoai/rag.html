<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 15.0.4"/>
    <title>monoai.rag API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note{color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.tip{color:#0a3622;background-color:#d1e7dd;border-color:#a3cfbb;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%230a3622%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%206a6%206%200%201%201%2010.174%204.31c-.203.196-.359.4-.453.619l-.762%201.769A.5.5%200%200%201%2010.5%2013a.5.5%200%200%201%200%201%20.5.5%200%200%201%200%201l-.224.447a1%201%200%200%201-.894.553H6.618a1%201%200%200%201-.894-.553L5.5%2015a.5.5%200%200%201%200-1%20.5.5%200%200%201%200-1%20.5.5%200%200%201-.46-.302l-.761-1.77a2%202%200%200%200-.453-.618A5.98%205.98%200%200%201%202%206m6-5a5%205%200%200%200-3.479%208.592c.263.254.514.564.676.941L5.83%2012h4.342l.632-1.467c.162-.377.413-.687.676-.941A5%205%200%200%200%208%201%22/%3E%3C/svg%3E");}.pdoc .alert.important{color:#055160;background-color:#cff4fc;border-color:#9eeaf9;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23055160%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%200a2%202%200%200%200-2%202v12a2%202%200%200%200%202%202h12a2%202%200%200%200%202-2V2a2%202%200%200%200-2-2zm6%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.caution{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M11.46.146A.5.5%200%200%200%2011.107%200H4.893a.5.5%200%200%200-.353.146L.146%204.54A.5.5%200%200%200%200%204.893v6.214a.5.5%200%200%200%20.146.353l4.394%204.394a.5.5%200%200%200%20.353.146h6.214a.5.5%200%200%200%20.353-.146l4.394-4.394a.5.5%200%200%200%20.146-.353V4.893a.5.5%200%200%200-.146-.353zM8%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../monoai.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;monoai</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#RAG">RAG</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#RAG.__init__">RAG</a>
                        </li>
                        <li>
                                <a class="function" href="#RAG.query">query</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#ChromaVectorDB">ChromaVectorDB</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#ChromaVectorDB.__init__">ChromaVectorDB</a>
                        </li>
                        <li>
                                <a class="function" href="#ChromaVectorDB.add">add</a>
                        </li>
                        <li>
                                <a class="function" href="#ChromaVectorDB.query">query</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#DocumentsBuilder">DocumentsBuilder</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#DocumentsBuilder.__init__">DocumentsBuilder</a>
                        </li>
                        <li>
                                <a class="function" href="#DocumentsBuilder.from_file">from_file</a>
                        </li>
                        <li>
                                <a class="function" href="#DocumentsBuilder.from_str">from_str</a>
                        </li>
                        <li>
                                <a class="function" href="#DocumentsBuilder.from_doc">from_doc</a>
                        </li>
                        <li>
                                <a class="function" href="#DocumentsBuilder.from_pdf">from_pdf</a>
                        </li>
                        <li>
                                <a class="function" href="#DocumentsBuilder.from_url">from_url</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../monoai.html">monoai</a><wbr>.rag    </h1>

                        <div class="docstring"><p>RAG is a module that provides a high-level interface for performing semantic search queries
against a vector database. It supports multiple vector database backends and
embedding providers for flexible deployment scenarios.</p>
</div>

                        <input id="mod-rag-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-rag-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos"> 1</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos"> 2</span></a><span class="sd">RAG is a module that provides a high-level interface for performing semantic search queries</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos"> 3</span></a><span class="sd">against a vector database. It supports multiple vector database backends and</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos"> 4</span></a><span class="sd">embedding providers for flexible deployment scenarios.</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos"> 5</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos"> 6</span></a>
</span><span id="L-7"><a href="#L-7"><span class="linenos"> 7</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.rag</span><span class="w"> </span><span class="kn">import</span> <span class="n">RAG</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos"> 8</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.vectordb</span><span class="w"> </span><span class="kn">import</span> <span class="n">ChromaVectorDB</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos"> 9</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.documents_builder</span><span class="w"> </span><span class="kn">import</span> <span class="n">DocumentsBuilder</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">10</span></a>
</span><span id="L-11"><a href="#L-11"><span class="linenos">11</span></a><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;RAG&#39;</span><span class="p">,</span> <span class="s1">&#39;ChromaVectorDB&#39;</span><span class="p">,</span> <span class="s1">&#39;DocumentsBuilder&#39;</span><span class="p">]</span> 
</span></pre></div>


            </section>
                <section id="RAG">
                            <input id="RAG-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">RAG</span>:

                <label class="view-source-button" for="RAG-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RAG"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RAG-7"><a href="#RAG-7"><span class="linenos">  7</span></a><span class="k">class</span><span class="w"> </span><span class="nc">RAG</span><span class="p">:</span>
</span><span id="RAG-8"><a href="#RAG-8"><span class="linenos">  8</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RAG-9"><a href="#RAG-9"><span class="linenos">  9</span></a><span class="sd">    Retrieval-Augmented Generation (RAG) system for semantic search and document retrieval.</span>
</span><span id="RAG-10"><a href="#RAG-10"><span class="linenos"> 10</span></a><span class="sd">    </span>
</span><span id="RAG-11"><a href="#RAG-11"><span class="linenos"> 11</span></a><span class="sd">    This class provides a high-level interface for performing semantic search queries</span>
</span><span id="RAG-12"><a href="#RAG-12"><span class="linenos"> 12</span></a><span class="sd">    against a vector database. It supports multiple vector database backends and</span>
</span><span id="RAG-13"><a href="#RAG-13"><span class="linenos"> 13</span></a><span class="sd">    embedding providers for flexible deployment scenarios.</span>
</span><span id="RAG-14"><a href="#RAG-14"><span class="linenos"> 14</span></a><span class="sd">    </span>
</span><span id="RAG-15"><a href="#RAG-15"><span class="linenos"> 15</span></a><span class="sd">    The RAG system works by:</span>
</span><span id="RAG-16"><a href="#RAG-16"><span class="linenos"> 16</span></a><span class="sd">    1. Converting text queries into vector embeddings</span>
</span><span id="RAG-17"><a href="#RAG-17"><span class="linenos"> 17</span></a><span class="sd">    2. Searching the vector database for similar document embeddings</span>
</span><span id="RAG-18"><a href="#RAG-18"><span class="linenos"> 18</span></a><span class="sd">    3. Returning the most relevant documents based on semantic similarity</span>
</span><span id="RAG-19"><a href="#RAG-19"><span class="linenos"> 19</span></a><span class="sd">    </span>
</span><span id="RAG-20"><a href="#RAG-20"><span class="linenos"> 20</span></a><span class="sd">    Attributes:</span>
</span><span id="RAG-21"><a href="#RAG-21"><span class="linenos"> 21</span></a><span class="sd">        _vectorizer (str): The embedding model used for vectorization</span>
</span><span id="RAG-22"><a href="#RAG-22"><span class="linenos"> 22</span></a><span class="sd">        _db (str): Name of the vector database</span>
</span><span id="RAG-23"><a href="#RAG-23"><span class="linenos"> 23</span></a><span class="sd">        _vector_db (ChromaVectorDB): The vector database backend</span>
</span><span id="RAG-24"><a href="#RAG-24"><span class="linenos"> 24</span></a><span class="sd">    </span>
</span><span id="RAG-25"><a href="#RAG-25"><span class="linenos"> 25</span></a><span class="sd">    Examples:</span>
</span><span id="RAG-26"><a href="#RAG-26"><span class="linenos"> 26</span></a><span class="sd">    --------</span>
</span><span id="RAG-27"><a href="#RAG-27"><span class="linenos"> 27</span></a><span class="sd">     Basic usage with default settings:</span>
</span><span id="RAG-28"><a href="#RAG-28"><span class="linenos"> 28</span></a><span class="sd">        </span>
</span><span id="RAG-29"><a href="#RAG-29"><span class="linenos"> 29</span></a><span class="sd">    ```python</span>
</span><span id="RAG-30"><a href="#RAG-30"><span class="linenos"> 30</span></a><span class="sd">    # Initialize RAG with a database name</span>
</span><span id="RAG-31"><a href="#RAG-31"><span class="linenos"> 31</span></a><span class="sd">    rag = RAG(database=&quot;my_documents&quot;)</span>
</span><span id="RAG-32"><a href="#RAG-32"><span class="linenos"> 32</span></a><span class="sd">        </span>
</span><span id="RAG-33"><a href="#RAG-33"><span class="linenos"> 33</span></a><span class="sd">    # Perform a semantic search</span>
</span><span id="RAG-34"><a href="#RAG-34"><span class="linenos"> 34</span></a><span class="sd">    results = rag.query(&quot;What is machine learning?&quot;, k=5)</span>
</span><span id="RAG-35"><a href="#RAG-35"><span class="linenos"> 35</span></a><span class="sd">    ```</span>
</span><span id="RAG-36"><a href="#RAG-36"><span class="linenos"> 36</span></a><span class="sd">        </span>
</span><span id="RAG-37"><a href="#RAG-37"><span class="linenos"> 37</span></a><span class="sd">    Using with specific embedding provider:</span>
</span><span id="RAG-38"><a href="#RAG-38"><span class="linenos"> 38</span></a><span class="sd">        </span>
</span><span id="RAG-39"><a href="#RAG-39"><span class="linenos"> 39</span></a><span class="sd">    ```python</span>
</span><span id="RAG-40"><a href="#RAG-40"><span class="linenos"> 40</span></a><span class="sd">    # Initialize with OpenAI embeddings</span>
</span><span id="RAG-41"><a href="#RAG-41"><span class="linenos"> 41</span></a><span class="sd">    rag = RAG(</span>
</span><span id="RAG-42"><a href="#RAG-42"><span class="linenos"> 42</span></a><span class="sd">        database=&quot;my_documents&quot;,</span>
</span><span id="RAG-43"><a href="#RAG-43"><span class="linenos"> 43</span></a><span class="sd">        provider=&quot;openai&quot;,</span>
</span><span id="RAG-44"><a href="#RAG-44"><span class="linenos"> 44</span></a><span class="sd">        vectorizer=&quot;text-embedding-ada-002&quot;</span>
</span><span id="RAG-45"><a href="#RAG-45"><span class="linenos"> 45</span></a><span class="sd">    )</span>
</span><span id="RAG-46"><a href="#RAG-46"><span class="linenos"> 46</span></a><span class="sd">        </span>
</span><span id="RAG-47"><a href="#RAG-47"><span class="linenos"> 47</span></a><span class="sd">    # Search for relevant documents</span>
</span><span id="RAG-48"><a href="#RAG-48"><span class="linenos"> 48</span></a><span class="sd">    results = rag.query(&quot;Explain neural networks&quot;, k=10)</span>
</span><span id="RAG-49"><a href="#RAG-49"><span class="linenos"> 49</span></a><span class="sd">    ```</span>
</span><span id="RAG-50"><a href="#RAG-50"><span class="linenos"> 50</span></a><span class="sd">        </span>
</span><span id="RAG-51"><a href="#RAG-51"><span class="linenos"> 51</span></a><span class="sd">    Working with different vector databases:</span>
</span><span id="RAG-52"><a href="#RAG-52"><span class="linenos"> 52</span></a><span class="sd">        </span>
</span><span id="RAG-53"><a href="#RAG-53"><span class="linenos"> 53</span></a><span class="sd">    ```python</span>
</span><span id="RAG-54"><a href="#RAG-54"><span class="linenos"> 54</span></a><span class="sd">    # Currently supports ChromaDB</span>
</span><span id="RAG-55"><a href="#RAG-55"><span class="linenos"> 55</span></a><span class="sd">    rag = RAG(</span>
</span><span id="RAG-56"><a href="#RAG-56"><span class="linenos"> 56</span></a><span class="sd">        database=&quot;my_collection&quot;,</span>
</span><span id="RAG-57"><a href="#RAG-57"><span class="linenos"> 57</span></a><span class="sd">        vector_db=&quot;chroma&quot;,</span>
</span><span id="RAG-58"><a href="#RAG-58"><span class="linenos"> 58</span></a><span class="sd">        provider=&quot;openai&quot;,</span>
</span><span id="RAG-59"><a href="#RAG-59"><span class="linenos"> 59</span></a><span class="sd">        vectorizer=&quot;text-embedding-ada-002&quot;</span>
</span><span id="RAG-60"><a href="#RAG-60"><span class="linenos"> 60</span></a><span class="sd">    )</span>
</span><span id="RAG-61"><a href="#RAG-61"><span class="linenos"> 61</span></a><span class="sd">    ```</span>
</span><span id="RAG-62"><a href="#RAG-62"><span class="linenos"> 62</span></a>
</span><span id="RAG-63"><a href="#RAG-63"><span class="linenos"> 63</span></a><span class="sd">    Add RAG to a model, so that the model can use the RAG automatically to answer questions:</span>
</span><span id="RAG-64"><a href="#RAG-64"><span class="linenos"> 64</span></a><span class="sd">    ```python</span>
</span><span id="RAG-65"><a href="#RAG-65"><span class="linenos"> 65</span></a><span class="sd">    model = Model(provider=&quot;openai&quot;, model=&quot;gpt-4o-mini&quot;)</span>
</span><span id="RAG-66"><a href="#RAG-66"><span class="linenos"> 66</span></a><span class="sd">    model._add_rag(RAG(database=&quot;my_documents&quot;, vector_db=&quot;chroma&quot;))</span>
</span><span id="RAG-67"><a href="#RAG-67"><span class="linenos"> 67</span></a><span class="sd">    ```</span>
</span><span id="RAG-68"><a href="#RAG-68"><span class="linenos"> 68</span></a>
</span><span id="RAG-69"><a href="#RAG-69"><span class="linenos"> 69</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="RAG-70"><a href="#RAG-70"><span class="linenos"> 70</span></a>
</span><span id="RAG-71"><a href="#RAG-71"><span class="linenos"> 71</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
</span><span id="RAG-72"><a href="#RAG-72"><span class="linenos"> 72</span></a>                <span class="n">database</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="RAG-73"><a href="#RAG-73"><span class="linenos"> 73</span></a>                 <span class="n">provider</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="RAG-74"><a href="#RAG-74"><span class="linenos"> 74</span></a>                 <span class="n">vectorizer</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
</span><span id="RAG-75"><a href="#RAG-75"><span class="linenos"> 75</span></a>                 <span class="n">vector_db</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;chroma&quot;</span><span class="p">):</span>
</span><span id="RAG-76"><a href="#RAG-76"><span class="linenos"> 76</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RAG-77"><a href="#RAG-77"><span class="linenos"> 77</span></a><span class="sd">        Initialize the RAG system.</span>
</span><span id="RAG-78"><a href="#RAG-78"><span class="linenos"> 78</span></a><span class="sd">        </span>
</span><span id="RAG-79"><a href="#RAG-79"><span class="linenos"> 79</span></a><span class="sd">        Parameters:</span>
</span><span id="RAG-80"><a href="#RAG-80"><span class="linenos"> 80</span></a><span class="sd">        -----------</span>
</span><span id="RAG-81"><a href="#RAG-81"><span class="linenos"> 81</span></a><span class="sd">        database : str</span>
</span><span id="RAG-82"><a href="#RAG-82"><span class="linenos"> 82</span></a><span class="sd">            Name of the vector database/collection to use for storage and retrieval.</span>
</span><span id="RAG-83"><a href="#RAG-83"><span class="linenos"> 83</span></a><span class="sd">            This will be created if it doesn&#39;t exist.</span>
</span><span id="RAG-84"><a href="#RAG-84"><span class="linenos"> 84</span></a><span class="sd">            </span>
</span><span id="RAG-85"><a href="#RAG-85"><span class="linenos"> 85</span></a><span class="sd">        provider : str, optional</span>
</span><span id="RAG-86"><a href="#RAG-86"><span class="linenos"> 86</span></a><span class="sd">            The embedding provider to use (e.g., &quot;openai&quot;, &quot;anthropic&quot;, &quot;cohere&quot;).</span>
</span><span id="RAG-87"><a href="#RAG-87"><span class="linenos"> 87</span></a><span class="sd">            If provided, the corresponding API key will be loaded automatically.</span>
</span><span id="RAG-88"><a href="#RAG-88"><span class="linenos"> 88</span></a><span class="sd">            If None, the system will use default embedding settings.</span>
</span><span id="RAG-89"><a href="#RAG-89"><span class="linenos"> 89</span></a><span class="sd">            </span>
</span><span id="RAG-90"><a href="#RAG-90"><span class="linenos"> 90</span></a><span class="sd">        vectorizer : str, optional</span>
</span><span id="RAG-91"><a href="#RAG-91"><span class="linenos"> 91</span></a><span class="sd">            The specific embedding model to use for vectorization.</span>
</span><span id="RAG-92"><a href="#RAG-92"><span class="linenos"> 92</span></a><span class="sd">            Examples: &quot;text-embedding-ada-002&quot;, &quot;text-embedding-3-small&quot;, &quot;embed-english-v3.0&quot;</span>
</span><span id="RAG-93"><a href="#RAG-93"><span class="linenos"> 93</span></a><span class="sd">            If None, the provider&#39;s default model will be used.</span>
</span><span id="RAG-94"><a href="#RAG-94"><span class="linenos"> 94</span></a><span class="sd">            </span>
</span><span id="RAG-95"><a href="#RAG-95"><span class="linenos"> 95</span></a><span class="sd">        vector_db : str, default=&quot;chroma&quot;</span>
</span><span id="RAG-96"><a href="#RAG-96"><span class="linenos"> 96</span></a><span class="sd">            The vector database backend to use. Currently supports:</span>
</span><span id="RAG-97"><a href="#RAG-97"><span class="linenos"> 97</span></a><span class="sd">            - &quot;chroma&quot;: ChromaDB (default, recommended for most use cases)</span>
</span><span id="RAG-98"><a href="#RAG-98"><span class="linenos"> 98</span></a><span class="sd">            </span>
</span><span id="RAG-99"><a href="#RAG-99"><span class="linenos"> 99</span></a><span class="sd">        Raises:</span>
</span><span id="RAG-100"><a href="#RAG-100"><span class="linenos">100</span></a><span class="sd">        -------</span>
</span><span id="RAG-101"><a href="#RAG-101"><span class="linenos">101</span></a><span class="sd">        ValueError</span>
</span><span id="RAG-102"><a href="#RAG-102"><span class="linenos">102</span></a><span class="sd">            If an unsupported vector database is specified.</span>
</span><span id="RAG-103"><a href="#RAG-103"><span class="linenos">103</span></a><span class="sd">            </span>
</span><span id="RAG-104"><a href="#RAG-104"><span class="linenos">104</span></a><span class="sd">        Examples:</span>
</span><span id="RAG-105"><a href="#RAG-105"><span class="linenos">105</span></a><span class="sd">        ---------</span>
</span><span id="RAG-106"><a href="#RAG-106"><span class="linenos">106</span></a><span class="sd">        ```python</span>
</span><span id="RAG-107"><a href="#RAG-107"><span class="linenos">107</span></a><span class="sd">        # Minimal initialization</span>
</span><span id="RAG-108"><a href="#RAG-108"><span class="linenos">108</span></a><span class="sd">        rag = RAG(&quot;my_documents&quot;)</span>
</span><span id="RAG-109"><a href="#RAG-109"><span class="linenos">109</span></a><span class="sd">        </span>
</span><span id="RAG-110"><a href="#RAG-110"><span class="linenos">110</span></a><span class="sd">        # With OpenAI embeddings</span>
</span><span id="RAG-111"><a href="#RAG-111"><span class="linenos">111</span></a><span class="sd">        rag = RAG(</span>
</span><span id="RAG-112"><a href="#RAG-112"><span class="linenos">112</span></a><span class="sd">            database=&quot;research_papers&quot;,</span>
</span><span id="RAG-113"><a href="#RAG-113"><span class="linenos">113</span></a><span class="sd">            provider=&quot;openai&quot;,</span>
</span><span id="RAG-114"><a href="#RAG-114"><span class="linenos">114</span></a><span class="sd">            vectorizer=&quot;text-embedding-ada-002&quot;</span>
</span><span id="RAG-115"><a href="#RAG-115"><span class="linenos">115</span></a><span class="sd">        )</span>
</span><span id="RAG-116"><a href="#RAG-116"><span class="linenos">116</span></a><span class="sd">        </span>
</span><span id="RAG-117"><a href="#RAG-117"><span class="linenos">117</span></a><span class="sd">        # With Anthropic embeddings</span>
</span><span id="RAG-118"><a href="#RAG-118"><span class="linenos">118</span></a><span class="sd">        rag = RAG(</span>
</span><span id="RAG-119"><a href="#RAG-119"><span class="linenos">119</span></a><span class="sd">            database=&quot;articles&quot;,</span>
</span><span id="RAG-120"><a href="#RAG-120"><span class="linenos">120</span></a><span class="sd">            provider=&quot;anthropic&quot;,</span>
</span><span id="RAG-121"><a href="#RAG-121"><span class="linenos">121</span></a><span class="sd">            vectorizer=&quot;text-embedding-3-small&quot;</span>
</span><span id="RAG-122"><a href="#RAG-122"><span class="linenos">122</span></a><span class="sd">        )</span>
</span><span id="RAG-123"><a href="#RAG-123"><span class="linenos">123</span></a><span class="sd">        ```</span>
</span><span id="RAG-124"><a href="#RAG-124"><span class="linenos">124</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RAG-125"><a href="#RAG-125"><span class="linenos">125</span></a>        <span class="k">if</span> <span class="n">provider</span><span class="p">:</span>
</span><span id="RAG-126"><a href="#RAG-126"><span class="linenos">126</span></a>            <span class="n">load_key</span><span class="p">(</span><span class="n">provider</span><span class="p">)</span>
</span><span id="RAG-127"><a href="#RAG-127"><span class="linenos">127</span></a>            
</span><span id="RAG-128"><a href="#RAG-128"><span class="linenos">128</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vectorizer</span> <span class="o">=</span> <span class="n">vectorizer</span>
</span><span id="RAG-129"><a href="#RAG-129"><span class="linenos">129</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_db</span> <span class="o">=</span> <span class="n">database</span>
</span><span id="RAG-130"><a href="#RAG-130"><span class="linenos">130</span></a>        
</span><span id="RAG-131"><a href="#RAG-131"><span class="linenos">131</span></a>        <span class="k">if</span> <span class="n">vector_db</span> <span class="o">==</span> <span class="s2">&quot;chroma&quot;</span><span class="p">:</span>
</span><span id="RAG-132"><a href="#RAG-132"><span class="linenos">132</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_vector_db</span> <span class="o">=</span> <span class="n">ChromaVectorDB</span><span class="p">(</span>
</span><span id="RAG-133"><a href="#RAG-133"><span class="linenos">133</span></a>                <span class="n">name</span><span class="o">=</span><span class="n">database</span><span class="p">,</span> 
</span><span id="RAG-134"><a href="#RAG-134"><span class="linenos">134</span></a>                <span class="n">vectorizer_provider</span><span class="o">=</span><span class="n">provider</span><span class="p">,</span> 
</span><span id="RAG-135"><a href="#RAG-135"><span class="linenos">135</span></a>                <span class="n">vectorizer_model</span><span class="o">=</span><span class="n">vectorizer</span>
</span><span id="RAG-136"><a href="#RAG-136"><span class="linenos">136</span></a>            <span class="p">)</span>
</span><span id="RAG-137"><a href="#RAG-137"><span class="linenos">137</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="RAG-138"><a href="#RAG-138"><span class="linenos">138</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Vector database &#39;</span><span class="si">{</span><span class="n">vector_db</span><span class="si">}</span><span class="s2">&#39; not supported. Currently only &#39;chroma&#39; is supported.&quot;</span><span class="p">)</span>
</span><span id="RAG-139"><a href="#RAG-139"><span class="linenos">139</span></a>        
</span><span id="RAG-140"><a href="#RAG-140"><span class="linenos">140</span></a>
</span><span id="RAG-141"><a href="#RAG-141"><span class="linenos">141</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="RAG-142"><a href="#RAG-142"><span class="linenos">142</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RAG-143"><a href="#RAG-143"><span class="linenos">143</span></a><span class="sd">        Perform a semantic search query against the vector database.</span>
</span><span id="RAG-144"><a href="#RAG-144"><span class="linenos">144</span></a><span class="sd">        </span>
</span><span id="RAG-145"><a href="#RAG-145"><span class="linenos">145</span></a><span class="sd">        This method converts the input query into a vector embedding and searches</span>
</span><span id="RAG-146"><a href="#RAG-146"><span class="linenos">146</span></a><span class="sd">        the database for the most semantically similar documents.</span>
</span><span id="RAG-147"><a href="#RAG-147"><span class="linenos">147</span></a><span class="sd">        </span>
</span><span id="RAG-148"><a href="#RAG-148"><span class="linenos">148</span></a><span class="sd">        Parameters:</span>
</span><span id="RAG-149"><a href="#RAG-149"><span class="linenos">149</span></a><span class="sd">        -----------</span>
</span><span id="RAG-150"><a href="#RAG-150"><span class="linenos">150</span></a><span class="sd">        query : str</span>
</span><span id="RAG-151"><a href="#RAG-151"><span class="linenos">151</span></a><span class="sd">            The text query to search for. This will be converted to a vector</span>
</span><span id="RAG-152"><a href="#RAG-152"><span class="linenos">152</span></a><span class="sd">            embedding and used to find similar documents.</span>
</span><span id="RAG-153"><a href="#RAG-153"><span class="linenos">153</span></a><span class="sd">            </span>
</span><span id="RAG-154"><a href="#RAG-154"><span class="linenos">154</span></a><span class="sd">        k : int, default=10</span>
</span><span id="RAG-155"><a href="#RAG-155"><span class="linenos">155</span></a><span class="sd">            The number of most relevant documents to return. Higher values</span>
</span><span id="RAG-156"><a href="#RAG-156"><span class="linenos">156</span></a><span class="sd">            return more results but may include less relevant documents.</span>
</span><span id="RAG-157"><a href="#RAG-157"><span class="linenos">157</span></a><span class="sd">            </span>
</span><span id="RAG-158"><a href="#RAG-158"><span class="linenos">158</span></a><span class="sd">        Returns:</span>
</span><span id="RAG-159"><a href="#RAG-159"><span class="linenos">159</span></a><span class="sd">        --------</span>
</span><span id="RAG-160"><a href="#RAG-160"><span class="linenos">160</span></a><span class="sd">        Dict[str, Any]</span>
</span><span id="RAG-161"><a href="#RAG-161"><span class="linenos">161</span></a><span class="sd">            A dictionary containing the search results with the following structure:</span>
</span><span id="RAG-162"><a href="#RAG-162"><span class="linenos">162</span></a><span class="sd">            {</span>
</span><span id="RAG-163"><a href="#RAG-163"><span class="linenos">163</span></a><span class="sd">                &#39;ids&#39;: List[List[str]] - Document IDs of the retrieved documents,</span>
</span><span id="RAG-164"><a href="#RAG-164"><span class="linenos">164</span></a><span class="sd">                &#39;documents&#39;: List[List[str]] - The actual document content,</span>
</span><span id="RAG-165"><a href="#RAG-165"><span class="linenos">165</span></a><span class="sd">                &#39;metadatas&#39;: List[List[Dict]] - Metadata for each document,</span>
</span><span id="RAG-166"><a href="#RAG-166"><span class="linenos">166</span></a><span class="sd">                &#39;distances&#39;: List[List[float]] - Similarity scores (lower = more similar)</span>
</span><span id="RAG-167"><a href="#RAG-167"><span class="linenos">167</span></a><span class="sd">            }</span>
</span><span id="RAG-168"><a href="#RAG-168"><span class="linenos">168</span></a><span class="sd">            </span>
</span><span id="RAG-169"><a href="#RAG-169"><span class="linenos">169</span></a><span class="sd">        Examples:</span>
</span><span id="RAG-170"><a href="#RAG-170"><span class="linenos">170</span></a><span class="sd">        ---------</span>
</span><span id="RAG-171"><a href="#RAG-171"><span class="linenos">171</span></a><span class="sd">        ```python</span>
</span><span id="RAG-172"><a href="#RAG-172"><span class="linenos">172</span></a><span class="sd">        # Basic query</span>
</span><span id="RAG-173"><a href="#RAG-173"><span class="linenos">173</span></a><span class="sd">        results = rag.query(&quot;What is artificial intelligence?&quot;)</span>
</span><span id="RAG-174"><a href="#RAG-174"><span class="linenos">174</span></a><span class="sd">        </span>
</span><span id="RAG-175"><a href="#RAG-175"><span class="linenos">175</span></a><span class="sd">        # Query with more results</span>
</span><span id="RAG-176"><a href="#RAG-176"><span class="linenos">176</span></a><span class="sd">        results = rag.query(&quot;Machine learning algorithms&quot;, k=20)</span>
</span><span id="RAG-177"><a href="#RAG-177"><span class="linenos">177</span></a><span class="sd">        </span>
</span><span id="RAG-178"><a href="#RAG-178"><span class="linenos">178</span></a><span class="sd">        # Accessing results</span>
</span><span id="RAG-179"><a href="#RAG-179"><span class="linenos">179</span></a><span class="sd">        for i, (doc_id, document, metadata, distance) in enumerate(zip(</span>
</span><span id="RAG-180"><a href="#RAG-180"><span class="linenos">180</span></a><span class="sd">            results[&#39;ids&#39;][0], </span>
</span><span id="RAG-181"><a href="#RAG-181"><span class="linenos">181</span></a><span class="sd">            results[&#39;documents&#39;][0], </span>
</span><span id="RAG-182"><a href="#RAG-182"><span class="linenos">182</span></a><span class="sd">            results[&#39;metadatas&#39;][0], </span>
</span><span id="RAG-183"><a href="#RAG-183"><span class="linenos">183</span></a><span class="sd">            results[&#39;distances&#39;][0]</span>
</span><span id="RAG-184"><a href="#RAG-184"><span class="linenos">184</span></a><span class="sd">        )):</span>
</span><span id="RAG-185"><a href="#RAG-185"><span class="linenos">185</span></a><span class="sd">            print(f&quot;Result {i+1}:&quot;)</span>
</span><span id="RAG-186"><a href="#RAG-186"><span class="linenos">186</span></a><span class="sd">            print(f&quot;  ID: {doc_id}&quot;)</span>
</span><span id="RAG-187"><a href="#RAG-187"><span class="linenos">187</span></a><span class="sd">            print(f&quot;  Content: {document[:100]}...&quot;)</span>
</span><span id="RAG-188"><a href="#RAG-188"><span class="linenos">188</span></a><span class="sd">            print(f&quot;  Similarity: {1 - distance:.3f}&quot;)</span>
</span><span id="RAG-189"><a href="#RAG-189"><span class="linenos">189</span></a><span class="sd">            print(f&quot;  Metadata: {metadata}&quot;)</span>
</span><span id="RAG-190"><a href="#RAG-190"><span class="linenos">190</span></a><span class="sd">            print()</span>
</span><span id="RAG-191"><a href="#RAG-191"><span class="linenos">191</span></a><span class="sd">        ```</span>
</span><span id="RAG-192"><a href="#RAG-192"><span class="linenos">192</span></a><span class="sd">        </span>
</span><span id="RAG-193"><a href="#RAG-193"><span class="linenos">193</span></a><span class="sd">        Notes:</span>
</span><span id="RAG-194"><a href="#RAG-194"><span class="linenos">194</span></a><span class="sd">        ------</span>
</span><span id="RAG-195"><a href="#RAG-195"><span class="linenos">195</span></a><span class="sd">        - The query is automatically converted to lowercase and processed</span>
</span><span id="RAG-196"><a href="#RAG-196"><span class="linenos">196</span></a><span class="sd">        - Results are returned in order of relevance (most similar first)</span>
</span><span id="RAG-197"><a href="#RAG-197"><span class="linenos">197</span></a><span class="sd">        - Distance scores are cosine distances (0 = identical, 2 = completely opposite)</span>
</span><span id="RAG-198"><a href="#RAG-198"><span class="linenos">198</span></a><span class="sd">        - If fewer than k documents exist in the database, all available documents are returned</span>
</span><span id="RAG-199"><a href="#RAG-199"><span class="linenos">199</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RAG-200"><a href="#RAG-200"><span class="linenos">200</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vector_db</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Retrieval-Augmented Generation (RAG) system for semantic search and document retrieval.</p>

<p>This class provides a high-level interface for performing semantic search queries
against a vector database. It supports multiple vector database backends and
embedding providers for flexible deployment scenarios.</p>

<p>The RAG system works by:</p>

<ol>
<li>Converting text queries into vector embeddings</li>
<li>Searching the vector database for similar document embeddings</li>
<li>Returning the most relevant documents based on semantic similarity</li>
</ol>

<p>Attributes:
    _vectorizer (str): The embedding model used for vectorization
    _db (str): Name of the vector database
    _vector_db (ChromaVectorDB): The vector database backend</p>

<h2 id="examples">Examples:</h2>

<p>Basic usage with default settings:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="c1"># Initialize RAG with a database name</span>
<span class="n">rag</span> <span class="o">=</span> <span class="n">RAG</span><span class="p">(</span><span class="n">database</span><span class="o">=</span><span class="s2">&quot;my_documents&quot;</span><span class="p">)</span>

<span class="c1"># Perform a semantic search</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">rag</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;What is machine learning?&quot;</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</code></pre>
</div>

<p>Using with specific embedding provider:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="c1"># Initialize with OpenAI embeddings</span>
<span class="n">rag</span> <span class="o">=</span> <span class="n">RAG</span><span class="p">(</span>
    <span class="n">database</span><span class="o">=</span><span class="s2">&quot;my_documents&quot;</span><span class="p">,</span>
    <span class="n">provider</span><span class="o">=</span><span class="s2">&quot;openai&quot;</span><span class="p">,</span>
    <span class="n">vectorizer</span><span class="o">=</span><span class="s2">&quot;text-embedding-ada-002&quot;</span>
<span class="p">)</span>

<span class="c1"># Search for relevant documents</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">rag</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;Explain neural networks&quot;</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</code></pre>
</div>

<p>Working with different vector databases:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="c1"># Currently supports ChromaDB</span>
<span class="n">rag</span> <span class="o">=</span> <span class="n">RAG</span><span class="p">(</span>
    <span class="n">database</span><span class="o">=</span><span class="s2">&quot;my_collection&quot;</span><span class="p">,</span>
    <span class="n">vector_db</span><span class="o">=</span><span class="s2">&quot;chroma&quot;</span><span class="p">,</span>
    <span class="n">provider</span><span class="o">=</span><span class="s2">&quot;openai&quot;</span><span class="p">,</span>
    <span class="n">vectorizer</span><span class="o">=</span><span class="s2">&quot;text-embedding-ada-002&quot;</span>
<span class="p">)</span>
</code></pre>
</div>

<p>Add RAG to a model, so that the model can use the RAG automatically to answer questions:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">provider</span><span class="o">=</span><span class="s2">&quot;openai&quot;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s2">&quot;gpt-4o-mini&quot;</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">_add_rag</span><span class="p">(</span><span class="n">RAG</span><span class="p">(</span><span class="n">database</span><span class="o">=</span><span class="s2">&quot;my_documents&quot;</span><span class="p">,</span> <span class="n">vector_db</span><span class="o">=</span><span class="s2">&quot;chroma&quot;</span><span class="p">))</span>
</code></pre>
</div>
</div>


                            <div id="RAG.__init__" class="classattr">
                                        <input id="RAG.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">RAG</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">database</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">provider</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">vectorizer</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">vector_db</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;chroma&#39;</span></span>)</span>

                <label class="view-source-button" for="RAG.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RAG.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RAG.__init__-71"><a href="#RAG.__init__-71"><span class="linenos"> 71</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
</span><span id="RAG.__init__-72"><a href="#RAG.__init__-72"><span class="linenos"> 72</span></a>                <span class="n">database</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="RAG.__init__-73"><a href="#RAG.__init__-73"><span class="linenos"> 73</span></a>                 <span class="n">provider</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="RAG.__init__-74"><a href="#RAG.__init__-74"><span class="linenos"> 74</span></a>                 <span class="n">vectorizer</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
</span><span id="RAG.__init__-75"><a href="#RAG.__init__-75"><span class="linenos"> 75</span></a>                 <span class="n">vector_db</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;chroma&quot;</span><span class="p">):</span>
</span><span id="RAG.__init__-76"><a href="#RAG.__init__-76"><span class="linenos"> 76</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RAG.__init__-77"><a href="#RAG.__init__-77"><span class="linenos"> 77</span></a><span class="sd">        Initialize the RAG system.</span>
</span><span id="RAG.__init__-78"><a href="#RAG.__init__-78"><span class="linenos"> 78</span></a><span class="sd">        </span>
</span><span id="RAG.__init__-79"><a href="#RAG.__init__-79"><span class="linenos"> 79</span></a><span class="sd">        Parameters:</span>
</span><span id="RAG.__init__-80"><a href="#RAG.__init__-80"><span class="linenos"> 80</span></a><span class="sd">        -----------</span>
</span><span id="RAG.__init__-81"><a href="#RAG.__init__-81"><span class="linenos"> 81</span></a><span class="sd">        database : str</span>
</span><span id="RAG.__init__-82"><a href="#RAG.__init__-82"><span class="linenos"> 82</span></a><span class="sd">            Name of the vector database/collection to use for storage and retrieval.</span>
</span><span id="RAG.__init__-83"><a href="#RAG.__init__-83"><span class="linenos"> 83</span></a><span class="sd">            This will be created if it doesn&#39;t exist.</span>
</span><span id="RAG.__init__-84"><a href="#RAG.__init__-84"><span class="linenos"> 84</span></a><span class="sd">            </span>
</span><span id="RAG.__init__-85"><a href="#RAG.__init__-85"><span class="linenos"> 85</span></a><span class="sd">        provider : str, optional</span>
</span><span id="RAG.__init__-86"><a href="#RAG.__init__-86"><span class="linenos"> 86</span></a><span class="sd">            The embedding provider to use (e.g., &quot;openai&quot;, &quot;anthropic&quot;, &quot;cohere&quot;).</span>
</span><span id="RAG.__init__-87"><a href="#RAG.__init__-87"><span class="linenos"> 87</span></a><span class="sd">            If provided, the corresponding API key will be loaded automatically.</span>
</span><span id="RAG.__init__-88"><a href="#RAG.__init__-88"><span class="linenos"> 88</span></a><span class="sd">            If None, the system will use default embedding settings.</span>
</span><span id="RAG.__init__-89"><a href="#RAG.__init__-89"><span class="linenos"> 89</span></a><span class="sd">            </span>
</span><span id="RAG.__init__-90"><a href="#RAG.__init__-90"><span class="linenos"> 90</span></a><span class="sd">        vectorizer : str, optional</span>
</span><span id="RAG.__init__-91"><a href="#RAG.__init__-91"><span class="linenos"> 91</span></a><span class="sd">            The specific embedding model to use for vectorization.</span>
</span><span id="RAG.__init__-92"><a href="#RAG.__init__-92"><span class="linenos"> 92</span></a><span class="sd">            Examples: &quot;text-embedding-ada-002&quot;, &quot;text-embedding-3-small&quot;, &quot;embed-english-v3.0&quot;</span>
</span><span id="RAG.__init__-93"><a href="#RAG.__init__-93"><span class="linenos"> 93</span></a><span class="sd">            If None, the provider&#39;s default model will be used.</span>
</span><span id="RAG.__init__-94"><a href="#RAG.__init__-94"><span class="linenos"> 94</span></a><span class="sd">            </span>
</span><span id="RAG.__init__-95"><a href="#RAG.__init__-95"><span class="linenos"> 95</span></a><span class="sd">        vector_db : str, default=&quot;chroma&quot;</span>
</span><span id="RAG.__init__-96"><a href="#RAG.__init__-96"><span class="linenos"> 96</span></a><span class="sd">            The vector database backend to use. Currently supports:</span>
</span><span id="RAG.__init__-97"><a href="#RAG.__init__-97"><span class="linenos"> 97</span></a><span class="sd">            - &quot;chroma&quot;: ChromaDB (default, recommended for most use cases)</span>
</span><span id="RAG.__init__-98"><a href="#RAG.__init__-98"><span class="linenos"> 98</span></a><span class="sd">            </span>
</span><span id="RAG.__init__-99"><a href="#RAG.__init__-99"><span class="linenos"> 99</span></a><span class="sd">        Raises:</span>
</span><span id="RAG.__init__-100"><a href="#RAG.__init__-100"><span class="linenos">100</span></a><span class="sd">        -------</span>
</span><span id="RAG.__init__-101"><a href="#RAG.__init__-101"><span class="linenos">101</span></a><span class="sd">        ValueError</span>
</span><span id="RAG.__init__-102"><a href="#RAG.__init__-102"><span class="linenos">102</span></a><span class="sd">            If an unsupported vector database is specified.</span>
</span><span id="RAG.__init__-103"><a href="#RAG.__init__-103"><span class="linenos">103</span></a><span class="sd">            </span>
</span><span id="RAG.__init__-104"><a href="#RAG.__init__-104"><span class="linenos">104</span></a><span class="sd">        Examples:</span>
</span><span id="RAG.__init__-105"><a href="#RAG.__init__-105"><span class="linenos">105</span></a><span class="sd">        ---------</span>
</span><span id="RAG.__init__-106"><a href="#RAG.__init__-106"><span class="linenos">106</span></a><span class="sd">        ```python</span>
</span><span id="RAG.__init__-107"><a href="#RAG.__init__-107"><span class="linenos">107</span></a><span class="sd">        # Minimal initialization</span>
</span><span id="RAG.__init__-108"><a href="#RAG.__init__-108"><span class="linenos">108</span></a><span class="sd">        rag = RAG(&quot;my_documents&quot;)</span>
</span><span id="RAG.__init__-109"><a href="#RAG.__init__-109"><span class="linenos">109</span></a><span class="sd">        </span>
</span><span id="RAG.__init__-110"><a href="#RAG.__init__-110"><span class="linenos">110</span></a><span class="sd">        # With OpenAI embeddings</span>
</span><span id="RAG.__init__-111"><a href="#RAG.__init__-111"><span class="linenos">111</span></a><span class="sd">        rag = RAG(</span>
</span><span id="RAG.__init__-112"><a href="#RAG.__init__-112"><span class="linenos">112</span></a><span class="sd">            database=&quot;research_papers&quot;,</span>
</span><span id="RAG.__init__-113"><a href="#RAG.__init__-113"><span class="linenos">113</span></a><span class="sd">            provider=&quot;openai&quot;,</span>
</span><span id="RAG.__init__-114"><a href="#RAG.__init__-114"><span class="linenos">114</span></a><span class="sd">            vectorizer=&quot;text-embedding-ada-002&quot;</span>
</span><span id="RAG.__init__-115"><a href="#RAG.__init__-115"><span class="linenos">115</span></a><span class="sd">        )</span>
</span><span id="RAG.__init__-116"><a href="#RAG.__init__-116"><span class="linenos">116</span></a><span class="sd">        </span>
</span><span id="RAG.__init__-117"><a href="#RAG.__init__-117"><span class="linenos">117</span></a><span class="sd">        # With Anthropic embeddings</span>
</span><span id="RAG.__init__-118"><a href="#RAG.__init__-118"><span class="linenos">118</span></a><span class="sd">        rag = RAG(</span>
</span><span id="RAG.__init__-119"><a href="#RAG.__init__-119"><span class="linenos">119</span></a><span class="sd">            database=&quot;articles&quot;,</span>
</span><span id="RAG.__init__-120"><a href="#RAG.__init__-120"><span class="linenos">120</span></a><span class="sd">            provider=&quot;anthropic&quot;,</span>
</span><span id="RAG.__init__-121"><a href="#RAG.__init__-121"><span class="linenos">121</span></a><span class="sd">            vectorizer=&quot;text-embedding-3-small&quot;</span>
</span><span id="RAG.__init__-122"><a href="#RAG.__init__-122"><span class="linenos">122</span></a><span class="sd">        )</span>
</span><span id="RAG.__init__-123"><a href="#RAG.__init__-123"><span class="linenos">123</span></a><span class="sd">        ```</span>
</span><span id="RAG.__init__-124"><a href="#RAG.__init__-124"><span class="linenos">124</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RAG.__init__-125"><a href="#RAG.__init__-125"><span class="linenos">125</span></a>        <span class="k">if</span> <span class="n">provider</span><span class="p">:</span>
</span><span id="RAG.__init__-126"><a href="#RAG.__init__-126"><span class="linenos">126</span></a>            <span class="n">load_key</span><span class="p">(</span><span class="n">provider</span><span class="p">)</span>
</span><span id="RAG.__init__-127"><a href="#RAG.__init__-127"><span class="linenos">127</span></a>            
</span><span id="RAG.__init__-128"><a href="#RAG.__init__-128"><span class="linenos">128</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vectorizer</span> <span class="o">=</span> <span class="n">vectorizer</span>
</span><span id="RAG.__init__-129"><a href="#RAG.__init__-129"><span class="linenos">129</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_db</span> <span class="o">=</span> <span class="n">database</span>
</span><span id="RAG.__init__-130"><a href="#RAG.__init__-130"><span class="linenos">130</span></a>        
</span><span id="RAG.__init__-131"><a href="#RAG.__init__-131"><span class="linenos">131</span></a>        <span class="k">if</span> <span class="n">vector_db</span> <span class="o">==</span> <span class="s2">&quot;chroma&quot;</span><span class="p">:</span>
</span><span id="RAG.__init__-132"><a href="#RAG.__init__-132"><span class="linenos">132</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_vector_db</span> <span class="o">=</span> <span class="n">ChromaVectorDB</span><span class="p">(</span>
</span><span id="RAG.__init__-133"><a href="#RAG.__init__-133"><span class="linenos">133</span></a>                <span class="n">name</span><span class="o">=</span><span class="n">database</span><span class="p">,</span> 
</span><span id="RAG.__init__-134"><a href="#RAG.__init__-134"><span class="linenos">134</span></a>                <span class="n">vectorizer_provider</span><span class="o">=</span><span class="n">provider</span><span class="p">,</span> 
</span><span id="RAG.__init__-135"><a href="#RAG.__init__-135"><span class="linenos">135</span></a>                <span class="n">vectorizer_model</span><span class="o">=</span><span class="n">vectorizer</span>
</span><span id="RAG.__init__-136"><a href="#RAG.__init__-136"><span class="linenos">136</span></a>            <span class="p">)</span>
</span><span id="RAG.__init__-137"><a href="#RAG.__init__-137"><span class="linenos">137</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="RAG.__init__-138"><a href="#RAG.__init__-138"><span class="linenos">138</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Vector database &#39;</span><span class="si">{</span><span class="n">vector_db</span><span class="si">}</span><span class="s2">&#39; not supported. Currently only &#39;chroma&#39; is supported.&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the RAG system.</p>

<h2 id="parameters">Parameters:</h2>

<p>database : str
    Name of the vector database/collection to use for storage and retrieval.
    This will be created if it doesn't exist.</p>

<p>provider : str, optional
    The embedding provider to use (e.g., "openai", "anthropic", "cohere").
    If provided, the corresponding API key will be loaded automatically.
    If None, the system will use default embedding settings.</p>

<p>vectorizer : str, optional
    The specific embedding model to use for vectorization.
    Examples: "text-embedding-ada-002", "text-embedding-3-small", "embed-english-v3.0"
    If None, the provider's default model will be used.</p>

<p>vector_db : str, default="chroma"
    The vector database backend to use. Currently supports:
    - "chroma": ChromaDB (default, recommended for most use cases)</p>

<h2 id="raises">Raises:</h2>

<p>ValueError
    If an unsupported vector database is specified.</p>

<h2 id="examples">Examples:</h2>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="c1"># Minimal initialization</span>
<span class="n">rag</span> <span class="o">=</span> <span class="n">RAG</span><span class="p">(</span><span class="s2">&quot;my_documents&quot;</span><span class="p">)</span>

<span class="c1"># With OpenAI embeddings</span>
<span class="n">rag</span> <span class="o">=</span> <span class="n">RAG</span><span class="p">(</span>
    <span class="n">database</span><span class="o">=</span><span class="s2">&quot;research_papers&quot;</span><span class="p">,</span>
    <span class="n">provider</span><span class="o">=</span><span class="s2">&quot;openai&quot;</span><span class="p">,</span>
    <span class="n">vectorizer</span><span class="o">=</span><span class="s2">&quot;text-embedding-ada-002&quot;</span>
<span class="p">)</span>

<span class="c1"># With Anthropic embeddings</span>
<span class="n">rag</span> <span class="o">=</span> <span class="n">RAG</span><span class="p">(</span>
    <span class="n">database</span><span class="o">=</span><span class="s2">&quot;articles&quot;</span><span class="p">,</span>
    <span class="n">provider</span><span class="o">=</span><span class="s2">&quot;anthropic&quot;</span><span class="p">,</span>
    <span class="n">vectorizer</span><span class="o">=</span><span class="s2">&quot;text-embedding-3-small&quot;</span>
<span class="p">)</span>
</code></pre>
</div>
</div>


                            </div>
                            <div id="RAG.query" class="classattr">
                                        <input id="RAG.query-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">query</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">query</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">k</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span></span><span class="return-annotation">) -> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="RAG.query-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RAG.query"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RAG.query-141"><a href="#RAG.query-141"><span class="linenos">141</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="RAG.query-142"><a href="#RAG.query-142"><span class="linenos">142</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RAG.query-143"><a href="#RAG.query-143"><span class="linenos">143</span></a><span class="sd">        Perform a semantic search query against the vector database.</span>
</span><span id="RAG.query-144"><a href="#RAG.query-144"><span class="linenos">144</span></a><span class="sd">        </span>
</span><span id="RAG.query-145"><a href="#RAG.query-145"><span class="linenos">145</span></a><span class="sd">        This method converts the input query into a vector embedding and searches</span>
</span><span id="RAG.query-146"><a href="#RAG.query-146"><span class="linenos">146</span></a><span class="sd">        the database for the most semantically similar documents.</span>
</span><span id="RAG.query-147"><a href="#RAG.query-147"><span class="linenos">147</span></a><span class="sd">        </span>
</span><span id="RAG.query-148"><a href="#RAG.query-148"><span class="linenos">148</span></a><span class="sd">        Parameters:</span>
</span><span id="RAG.query-149"><a href="#RAG.query-149"><span class="linenos">149</span></a><span class="sd">        -----------</span>
</span><span id="RAG.query-150"><a href="#RAG.query-150"><span class="linenos">150</span></a><span class="sd">        query : str</span>
</span><span id="RAG.query-151"><a href="#RAG.query-151"><span class="linenos">151</span></a><span class="sd">            The text query to search for. This will be converted to a vector</span>
</span><span id="RAG.query-152"><a href="#RAG.query-152"><span class="linenos">152</span></a><span class="sd">            embedding and used to find similar documents.</span>
</span><span id="RAG.query-153"><a href="#RAG.query-153"><span class="linenos">153</span></a><span class="sd">            </span>
</span><span id="RAG.query-154"><a href="#RAG.query-154"><span class="linenos">154</span></a><span class="sd">        k : int, default=10</span>
</span><span id="RAG.query-155"><a href="#RAG.query-155"><span class="linenos">155</span></a><span class="sd">            The number of most relevant documents to return. Higher values</span>
</span><span id="RAG.query-156"><a href="#RAG.query-156"><span class="linenos">156</span></a><span class="sd">            return more results but may include less relevant documents.</span>
</span><span id="RAG.query-157"><a href="#RAG.query-157"><span class="linenos">157</span></a><span class="sd">            </span>
</span><span id="RAG.query-158"><a href="#RAG.query-158"><span class="linenos">158</span></a><span class="sd">        Returns:</span>
</span><span id="RAG.query-159"><a href="#RAG.query-159"><span class="linenos">159</span></a><span class="sd">        --------</span>
</span><span id="RAG.query-160"><a href="#RAG.query-160"><span class="linenos">160</span></a><span class="sd">        Dict[str, Any]</span>
</span><span id="RAG.query-161"><a href="#RAG.query-161"><span class="linenos">161</span></a><span class="sd">            A dictionary containing the search results with the following structure:</span>
</span><span id="RAG.query-162"><a href="#RAG.query-162"><span class="linenos">162</span></a><span class="sd">            {</span>
</span><span id="RAG.query-163"><a href="#RAG.query-163"><span class="linenos">163</span></a><span class="sd">                &#39;ids&#39;: List[List[str]] - Document IDs of the retrieved documents,</span>
</span><span id="RAG.query-164"><a href="#RAG.query-164"><span class="linenos">164</span></a><span class="sd">                &#39;documents&#39;: List[List[str]] - The actual document content,</span>
</span><span id="RAG.query-165"><a href="#RAG.query-165"><span class="linenos">165</span></a><span class="sd">                &#39;metadatas&#39;: List[List[Dict]] - Metadata for each document,</span>
</span><span id="RAG.query-166"><a href="#RAG.query-166"><span class="linenos">166</span></a><span class="sd">                &#39;distances&#39;: List[List[float]] - Similarity scores (lower = more similar)</span>
</span><span id="RAG.query-167"><a href="#RAG.query-167"><span class="linenos">167</span></a><span class="sd">            }</span>
</span><span id="RAG.query-168"><a href="#RAG.query-168"><span class="linenos">168</span></a><span class="sd">            </span>
</span><span id="RAG.query-169"><a href="#RAG.query-169"><span class="linenos">169</span></a><span class="sd">        Examples:</span>
</span><span id="RAG.query-170"><a href="#RAG.query-170"><span class="linenos">170</span></a><span class="sd">        ---------</span>
</span><span id="RAG.query-171"><a href="#RAG.query-171"><span class="linenos">171</span></a><span class="sd">        ```python</span>
</span><span id="RAG.query-172"><a href="#RAG.query-172"><span class="linenos">172</span></a><span class="sd">        # Basic query</span>
</span><span id="RAG.query-173"><a href="#RAG.query-173"><span class="linenos">173</span></a><span class="sd">        results = rag.query(&quot;What is artificial intelligence?&quot;)</span>
</span><span id="RAG.query-174"><a href="#RAG.query-174"><span class="linenos">174</span></a><span class="sd">        </span>
</span><span id="RAG.query-175"><a href="#RAG.query-175"><span class="linenos">175</span></a><span class="sd">        # Query with more results</span>
</span><span id="RAG.query-176"><a href="#RAG.query-176"><span class="linenos">176</span></a><span class="sd">        results = rag.query(&quot;Machine learning algorithms&quot;, k=20)</span>
</span><span id="RAG.query-177"><a href="#RAG.query-177"><span class="linenos">177</span></a><span class="sd">        </span>
</span><span id="RAG.query-178"><a href="#RAG.query-178"><span class="linenos">178</span></a><span class="sd">        # Accessing results</span>
</span><span id="RAG.query-179"><a href="#RAG.query-179"><span class="linenos">179</span></a><span class="sd">        for i, (doc_id, document, metadata, distance) in enumerate(zip(</span>
</span><span id="RAG.query-180"><a href="#RAG.query-180"><span class="linenos">180</span></a><span class="sd">            results[&#39;ids&#39;][0], </span>
</span><span id="RAG.query-181"><a href="#RAG.query-181"><span class="linenos">181</span></a><span class="sd">            results[&#39;documents&#39;][0], </span>
</span><span id="RAG.query-182"><a href="#RAG.query-182"><span class="linenos">182</span></a><span class="sd">            results[&#39;metadatas&#39;][0], </span>
</span><span id="RAG.query-183"><a href="#RAG.query-183"><span class="linenos">183</span></a><span class="sd">            results[&#39;distances&#39;][0]</span>
</span><span id="RAG.query-184"><a href="#RAG.query-184"><span class="linenos">184</span></a><span class="sd">        )):</span>
</span><span id="RAG.query-185"><a href="#RAG.query-185"><span class="linenos">185</span></a><span class="sd">            print(f&quot;Result {i+1}:&quot;)</span>
</span><span id="RAG.query-186"><a href="#RAG.query-186"><span class="linenos">186</span></a><span class="sd">            print(f&quot;  ID: {doc_id}&quot;)</span>
</span><span id="RAG.query-187"><a href="#RAG.query-187"><span class="linenos">187</span></a><span class="sd">            print(f&quot;  Content: {document[:100]}...&quot;)</span>
</span><span id="RAG.query-188"><a href="#RAG.query-188"><span class="linenos">188</span></a><span class="sd">            print(f&quot;  Similarity: {1 - distance:.3f}&quot;)</span>
</span><span id="RAG.query-189"><a href="#RAG.query-189"><span class="linenos">189</span></a><span class="sd">            print(f&quot;  Metadata: {metadata}&quot;)</span>
</span><span id="RAG.query-190"><a href="#RAG.query-190"><span class="linenos">190</span></a><span class="sd">            print()</span>
</span><span id="RAG.query-191"><a href="#RAG.query-191"><span class="linenos">191</span></a><span class="sd">        ```</span>
</span><span id="RAG.query-192"><a href="#RAG.query-192"><span class="linenos">192</span></a><span class="sd">        </span>
</span><span id="RAG.query-193"><a href="#RAG.query-193"><span class="linenos">193</span></a><span class="sd">        Notes:</span>
</span><span id="RAG.query-194"><a href="#RAG.query-194"><span class="linenos">194</span></a><span class="sd">        ------</span>
</span><span id="RAG.query-195"><a href="#RAG.query-195"><span class="linenos">195</span></a><span class="sd">        - The query is automatically converted to lowercase and processed</span>
</span><span id="RAG.query-196"><a href="#RAG.query-196"><span class="linenos">196</span></a><span class="sd">        - Results are returned in order of relevance (most similar first)</span>
</span><span id="RAG.query-197"><a href="#RAG.query-197"><span class="linenos">197</span></a><span class="sd">        - Distance scores are cosine distances (0 = identical, 2 = completely opposite)</span>
</span><span id="RAG.query-198"><a href="#RAG.query-198"><span class="linenos">198</span></a><span class="sd">        - If fewer than k documents exist in the database, all available documents are returned</span>
</span><span id="RAG.query-199"><a href="#RAG.query-199"><span class="linenos">199</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RAG.query-200"><a href="#RAG.query-200"><span class="linenos">200</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vector_db</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Perform a semantic search query against the vector database.</p>

<p>This method converts the input query into a vector embedding and searches
the database for the most semantically similar documents.</p>

<h2 id="parameters">Parameters:</h2>

<p>query : str
    The text query to search for. This will be converted to a vector
    embedding and used to find similar documents.</p>

<p>k : int, default=10
    The number of most relevant documents to return. Higher values
    return more results but may include less relevant documents.</p>

<h2 id="returns">Returns:</h2>

<p>Dict[str, Any]
    A dictionary containing the search results with the following structure:
    {
        'ids': List[List[str]] - Document IDs of the retrieved documents,
        'documents': List[List[str]] - The actual document content,
        'metadatas': List[List[Dict]] - Metadata for each document,
        'distances': List[List[float]] - Similarity scores (lower = more similar)
    }</p>

<h2 id="examples">Examples:</h2>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="c1"># Basic query</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">rag</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;What is artificial intelligence?&quot;</span><span class="p">)</span>

<span class="c1"># Query with more results</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">rag</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;Machine learning algorithms&quot;</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

<span class="c1"># Accessing results</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">doc_id</span><span class="p">,</span> <span class="n">document</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">distance</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> 
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;documents&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> 
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;metadatas&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> 
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;distances&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="p">)):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Result </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  ID: </span><span class="si">{</span><span class="n">doc_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Content: </span><span class="si">{</span><span class="n">document</span><span class="p">[:</span><span class="mi">100</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Similarity: </span><span class="si">{</span><span class="mi">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">distance</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Metadata: </span><span class="si">{</span><span class="n">metadata</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>
</code></pre>
</div>

<h2 id="notes">Notes:</h2>

<ul>
<li>The query is automatically converted to lowercase and processed</li>
<li>Results are returned in order of relevance (most similar first)</li>
<li>Distance scores are cosine distances (0 = identical, 2 = completely opposite)</li>
<li>If fewer than k documents exist in the database, all available documents are returned</li>
</ul>
</div>


                            </div>
                </section>
                <section id="ChromaVectorDB">
                            <input id="ChromaVectorDB-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ChromaVectorDB</span><wbr>(<span class="base">monoai.rag.vectordb._BaseVectorDB</span>):

                <label class="view-source-button" for="ChromaVectorDB-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ChromaVectorDB"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ChromaVectorDB-172"><a href="#ChromaVectorDB-172"><span class="linenos">172</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ChromaVectorDB</span><span class="p">(</span><span class="n">_BaseVectorDB</span><span class="p">):</span>
</span><span id="ChromaVectorDB-173"><a href="#ChromaVectorDB-173"><span class="linenos">173</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ChromaVectorDB-174"><a href="#ChromaVectorDB-174"><span class="linenos">174</span></a><span class="sd">    ChromaDB implementation of the vector database interface.</span>
</span><span id="ChromaVectorDB-175"><a href="#ChromaVectorDB-175"><span class="linenos">175</span></a><span class="sd">    </span>
</span><span id="ChromaVectorDB-176"><a href="#ChromaVectorDB-176"><span class="linenos">176</span></a><span class="sd">    This class provides a concrete implementation of the vector database</span>
</span><span id="ChromaVectorDB-177"><a href="#ChromaVectorDB-177"><span class="linenos">177</span></a><span class="sd">    using ChromaDB as the backend. ChromaDB is an open-source embedding</span>
</span><span id="ChromaVectorDB-178"><a href="#ChromaVectorDB-178"><span class="linenos">178</span></a><span class="sd">    database that supports persistent storage and efficient similarity search.</span>
</span><span id="ChromaVectorDB-179"><a href="#ChromaVectorDB-179"><span class="linenos">179</span></a><span class="sd">    </span>
</span><span id="ChromaVectorDB-180"><a href="#ChromaVectorDB-180"><span class="linenos">180</span></a><span class="sd">    Features:</span>
</span><span id="ChromaVectorDB-181"><a href="#ChromaVectorDB-181"><span class="linenos">181</span></a><span class="sd">    - Persistent storage of document embeddings</span>
</span><span id="ChromaVectorDB-182"><a href="#ChromaVectorDB-182"><span class="linenos">182</span></a><span class="sd">    - Efficient similarity search with configurable result count</span>
</span><span id="ChromaVectorDB-183"><a href="#ChromaVectorDB-183"><span class="linenos">183</span></a><span class="sd">    - Metadata storage for each document</span>
</span><span id="ChromaVectorDB-184"><a href="#ChromaVectorDB-184"><span class="linenos">184</span></a><span class="sd">    - Automatic collection creation if it doesn&#39;t exist</span>
</span><span id="ChromaVectorDB-185"><a href="#ChromaVectorDB-185"><span class="linenos">185</span></a><span class="sd">    - Support for custom embedding models via LiteLLM</span>
</span><span id="ChromaVectorDB-186"><a href="#ChromaVectorDB-186"><span class="linenos">186</span></a><span class="sd">    </span>
</span><span id="ChromaVectorDB-187"><a href="#ChromaVectorDB-187"><span class="linenos">187</span></a><span class="sd">    Attributes:</span>
</span><span id="ChromaVectorDB-188"><a href="#ChromaVectorDB-188"><span class="linenos">188</span></a><span class="sd">        _client (chromadb.PersistentClient): ChromaDB client instance</span>
</span><span id="ChromaVectorDB-189"><a href="#ChromaVectorDB-189"><span class="linenos">189</span></a><span class="sd">        _collection (chromadb.Collection): Active collection for operations</span>
</span><span id="ChromaVectorDB-190"><a href="#ChromaVectorDB-190"><span class="linenos">190</span></a><span class="sd">    </span>
</span><span id="ChromaVectorDB-191"><a href="#ChromaVectorDB-191"><span class="linenos">191</span></a><span class="sd">    Examples:</span>
</span><span id="ChromaVectorDB-192"><a href="#ChromaVectorDB-192"><span class="linenos">192</span></a><span class="sd">    --------</span>
</span><span id="ChromaVectorDB-193"><a href="#ChromaVectorDB-193"><span class="linenos">193</span></a><span class="sd">    Basic usage:</span>
</span><span id="ChromaVectorDB-194"><a href="#ChromaVectorDB-194"><span class="linenos">194</span></a><span class="sd">    </span>
</span><span id="ChromaVectorDB-195"><a href="#ChromaVectorDB-195"><span class="linenos">195</span></a><span class="sd">    ```python</span>
</span><span id="ChromaVectorDB-196"><a href="#ChromaVectorDB-196"><span class="linenos">196</span></a><span class="sd">    # Initialize with a new collection</span>
</span><span id="ChromaVectorDB-197"><a href="#ChromaVectorDB-197"><span class="linenos">197</span></a><span class="sd">    vector_db = ChromaVectorDB(name=&quot;my_documents&quot;)</span>
</span><span id="ChromaVectorDB-198"><a href="#ChromaVectorDB-198"><span class="linenos">198</span></a><span class="sd">    </span>
</span><span id="ChromaVectorDB-199"><a href="#ChromaVectorDB-199"><span class="linenos">199</span></a><span class="sd">    # Add documents</span>
</span><span id="ChromaVectorDB-200"><a href="#ChromaVectorDB-200"><span class="linenos">200</span></a><span class="sd">    documents = [&quot;Document 1 content&quot;, &quot;Document 2 content&quot;]</span>
</span><span id="ChromaVectorDB-201"><a href="#ChromaVectorDB-201"><span class="linenos">201</span></a><span class="sd">    metadatas = [{&quot;source&quot;: &quot;file1.txt&quot;}, {&quot;source&quot;: &quot;file2.txt&quot;}]</span>
</span><span id="ChromaVectorDB-202"><a href="#ChromaVectorDB-202"><span class="linenos">202</span></a><span class="sd">    ids = [&quot;doc1&quot;, &quot;doc2&quot;]</span>
</span><span id="ChromaVectorDB-203"><a href="#ChromaVectorDB-203"><span class="linenos">203</span></a><span class="sd">    </span>
</span><span id="ChromaVectorDB-204"><a href="#ChromaVectorDB-204"><span class="linenos">204</span></a><span class="sd">    vector_db.add(documents, metadatas, ids)</span>
</span><span id="ChromaVectorDB-205"><a href="#ChromaVectorDB-205"><span class="linenos">205</span></a><span class="sd">    </span>
</span><span id="ChromaVectorDB-206"><a href="#ChromaVectorDB-206"><span class="linenos">206</span></a><span class="sd">    # Search for similar documents</span>
</span><span id="ChromaVectorDB-207"><a href="#ChromaVectorDB-207"><span class="linenos">207</span></a><span class="sd">    results = vector_db.query(&quot;search query&quot;, k=5)</span>
</span><span id="ChromaVectorDB-208"><a href="#ChromaVectorDB-208"><span class="linenos">208</span></a><span class="sd">    ```</span>
</span><span id="ChromaVectorDB-209"><a href="#ChromaVectorDB-209"><span class="linenos">209</span></a><span class="sd">    </span>
</span><span id="ChromaVectorDB-210"><a href="#ChromaVectorDB-210"><span class="linenos">210</span></a><span class="sd">    Using with specific embedding model:</span>
</span><span id="ChromaVectorDB-211"><a href="#ChromaVectorDB-211"><span class="linenos">211</span></a><span class="sd">    </span>
</span><span id="ChromaVectorDB-212"><a href="#ChromaVectorDB-212"><span class="linenos">212</span></a><span class="sd">    ```python</span>
</span><span id="ChromaVectorDB-213"><a href="#ChromaVectorDB-213"><span class="linenos">213</span></a><span class="sd">    # Initialize with OpenAI embeddings</span>
</span><span id="ChromaVectorDB-214"><a href="#ChromaVectorDB-214"><span class="linenos">214</span></a><span class="sd">    vector_db = ChromaVectorDB(</span>
</span><span id="ChromaVectorDB-215"><a href="#ChromaVectorDB-215"><span class="linenos">215</span></a><span class="sd">        name=&quot;research_papers&quot;,</span>
</span><span id="ChromaVectorDB-216"><a href="#ChromaVectorDB-216"><span class="linenos">216</span></a><span class="sd">        vectorizer_provider=&quot;openai&quot;,</span>
</span><span id="ChromaVectorDB-217"><a href="#ChromaVectorDB-217"><span class="linenos">217</span></a><span class="sd">        vectorizer_model=&quot;text-embedding-ada-002&quot;</span>
</span><span id="ChromaVectorDB-218"><a href="#ChromaVectorDB-218"><span class="linenos">218</span></a><span class="sd">    )</span>
</span><span id="ChromaVectorDB-219"><a href="#ChromaVectorDB-219"><span class="linenos">219</span></a><span class="sd">    ```</span>
</span><span id="ChromaVectorDB-220"><a href="#ChromaVectorDB-220"><span class="linenos">220</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="ChromaVectorDB-221"><a href="#ChromaVectorDB-221"><span class="linenos">221</span></a>
</span><span id="ChromaVectorDB-222"><a href="#ChromaVectorDB-222"><span class="linenos">222</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
</span><span id="ChromaVectorDB-223"><a href="#ChromaVectorDB-223"><span class="linenos">223</span></a>                 <span class="n">vectorizer_provider</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
</span><span id="ChromaVectorDB-224"><a href="#ChromaVectorDB-224"><span class="linenos">224</span></a>                 <span class="n">vectorizer_model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="ChromaVectorDB-225"><a href="#ChromaVectorDB-225"><span class="linenos">225</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ChromaVectorDB-226"><a href="#ChromaVectorDB-226"><span class="linenos">226</span></a><span class="sd">        Initialize the ChromaDB vector database.</span>
</span><span id="ChromaVectorDB-227"><a href="#ChromaVectorDB-227"><span class="linenos">227</span></a><span class="sd">        </span>
</span><span id="ChromaVectorDB-228"><a href="#ChromaVectorDB-228"><span class="linenos">228</span></a><span class="sd">        Parameters:</span>
</span><span id="ChromaVectorDB-229"><a href="#ChromaVectorDB-229"><span class="linenos">229</span></a><span class="sd">        -----------</span>
</span><span id="ChromaVectorDB-230"><a href="#ChromaVectorDB-230"><span class="linenos">230</span></a><span class="sd">        name : str, optional</span>
</span><span id="ChromaVectorDB-231"><a href="#ChromaVectorDB-231"><span class="linenos">231</span></a><span class="sd">            Name of the ChromaDB collection. If provided, the collection</span>
</span><span id="ChromaVectorDB-232"><a href="#ChromaVectorDB-232"><span class="linenos">232</span></a><span class="sd">            will be created if it doesn&#39;t exist, or connected to if it does.</span>
</span><span id="ChromaVectorDB-233"><a href="#ChromaVectorDB-233"><span class="linenos">233</span></a><span class="sd">            </span>
</span><span id="ChromaVectorDB-234"><a href="#ChromaVectorDB-234"><span class="linenos">234</span></a><span class="sd">        vectorizer_provider : str, optional</span>
</span><span id="ChromaVectorDB-235"><a href="#ChromaVectorDB-235"><span class="linenos">235</span></a><span class="sd">            The embedding provider to use for vectorization.</span>
</span><span id="ChromaVectorDB-236"><a href="#ChromaVectorDB-236"><span class="linenos">236</span></a><span class="sd">            Examples: &quot;openai&quot;, &quot;anthropic&quot;, &quot;cohere&quot;</span>
</span><span id="ChromaVectorDB-237"><a href="#ChromaVectorDB-237"><span class="linenos">237</span></a><span class="sd">            </span>
</span><span id="ChromaVectorDB-238"><a href="#ChromaVectorDB-238"><span class="linenos">238</span></a><span class="sd">        vectorizer_model : str, optional</span>
</span><span id="ChromaVectorDB-239"><a href="#ChromaVectorDB-239"><span class="linenos">239</span></a><span class="sd">            The specific embedding model to use.</span>
</span><span id="ChromaVectorDB-240"><a href="#ChromaVectorDB-240"><span class="linenos">240</span></a><span class="sd">            Examples: &quot;text-embedding-ada-002&quot;, &quot;text-embedding-3-small&quot;</span>
</span><span id="ChromaVectorDB-241"><a href="#ChromaVectorDB-241"><span class="linenos">241</span></a><span class="sd">            </span>
</span><span id="ChromaVectorDB-242"><a href="#ChromaVectorDB-242"><span class="linenos">242</span></a><span class="sd">        Examples:</span>
</span><span id="ChromaVectorDB-243"><a href="#ChromaVectorDB-243"><span class="linenos">243</span></a><span class="sd">        ---------</span>
</span><span id="ChromaVectorDB-244"><a href="#ChromaVectorDB-244"><span class="linenos">244</span></a><span class="sd">        ```python</span>
</span><span id="ChromaVectorDB-245"><a href="#ChromaVectorDB-245"><span class="linenos">245</span></a><span class="sd">        # Create new collection</span>
</span><span id="ChromaVectorDB-246"><a href="#ChromaVectorDB-246"><span class="linenos">246</span></a><span class="sd">        vector_db = ChromaVectorDB(&quot;my_documents&quot;)</span>
</span><span id="ChromaVectorDB-247"><a href="#ChromaVectorDB-247"><span class="linenos">247</span></a><span class="sd">        </span>
</span><span id="ChromaVectorDB-248"><a href="#ChromaVectorDB-248"><span class="linenos">248</span></a><span class="sd">        # Connect to existing collection with custom embeddings</span>
</span><span id="ChromaVectorDB-249"><a href="#ChromaVectorDB-249"><span class="linenos">249</span></a><span class="sd">        vector_db = ChromaVectorDB(</span>
</span><span id="ChromaVectorDB-250"><a href="#ChromaVectorDB-250"><span class="linenos">250</span></a><span class="sd">            name=&quot;existing_collection&quot;,</span>
</span><span id="ChromaVectorDB-251"><a href="#ChromaVectorDB-251"><span class="linenos">251</span></a><span class="sd">            vectorizer_provider=&quot;openai&quot;,</span>
</span><span id="ChromaVectorDB-252"><a href="#ChromaVectorDB-252"><span class="linenos">252</span></a><span class="sd">            vectorizer_model=&quot;text-embedding-ada-002&quot;</span>
</span><span id="ChromaVectorDB-253"><a href="#ChromaVectorDB-253"><span class="linenos">253</span></a><span class="sd">        )</span>
</span><span id="ChromaVectorDB-254"><a href="#ChromaVectorDB-254"><span class="linenos">254</span></a><span class="sd">        ```</span>
</span><span id="ChromaVectorDB-255"><a href="#ChromaVectorDB-255"><span class="linenos">255</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ChromaVectorDB-256"><a href="#ChromaVectorDB-256"><span class="linenos">256</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">vectorizer_provider</span><span class="p">,</span> <span class="n">vectorizer_model</span><span class="p">)</span>
</span><span id="ChromaVectorDB-257"><a href="#ChromaVectorDB-257"><span class="linenos">257</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="ChromaVectorDB-258"><a href="#ChromaVectorDB-258"><span class="linenos">258</span></a>            <span class="kn">import</span><span class="w"> </span><span class="nn">chromadb</span>
</span><span id="ChromaVectorDB-259"><a href="#ChromaVectorDB-259"><span class="linenos">259</span></a>        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
</span><span id="ChromaVectorDB-260"><a href="#ChromaVectorDB-260"><span class="linenos">260</span></a>            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;chromadb is not installed. Please install it with &#39;pip install chromadb&#39;&quot;</span><span class="p">)</span>
</span><span id="ChromaVectorDB-261"><a href="#ChromaVectorDB-261"><span class="linenos">261</span></a>
</span><span id="ChromaVectorDB-262"><a href="#ChromaVectorDB-262"><span class="linenos">262</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_client</span> <span class="o">=</span> <span class="n">chromadb</span><span class="o">.</span><span class="n">PersistentClient</span><span class="p">()</span>
</span><span id="ChromaVectorDB-263"><a href="#ChromaVectorDB-263"><span class="linenos">263</span></a>        <span class="k">if</span> <span class="n">name</span><span class="p">:</span>
</span><span id="ChromaVectorDB-264"><a href="#ChromaVectorDB-264"><span class="linenos">264</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="ChromaVectorDB-265"><a href="#ChromaVectorDB-265"><span class="linenos">265</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_collection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get_collection</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span><span id="ChromaVectorDB-266"><a href="#ChromaVectorDB-266"><span class="linenos">266</span></a>            <span class="k">except</span> <span class="n">chromadb</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">NotFoundError</span><span class="p">:</span>
</span><span id="ChromaVectorDB-267"><a href="#ChromaVectorDB-267"><span class="linenos">267</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_collection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">create_collection</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span><span id="ChromaVectorDB-268"><a href="#ChromaVectorDB-268"><span class="linenos">268</span></a>
</span><span id="ChromaVectorDB-269"><a href="#ChromaVectorDB-269"><span class="linenos">269</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">documents</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">metadatas</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">],</span> <span class="n">ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ChromaVectorDB-270"><a href="#ChromaVectorDB-270"><span class="linenos">270</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ChromaVectorDB-271"><a href="#ChromaVectorDB-271"><span class="linenos">271</span></a><span class="sd">        Add documents to the ChromaDB collection.</span>
</span><span id="ChromaVectorDB-272"><a href="#ChromaVectorDB-272"><span class="linenos">272</span></a><span class="sd">        </span>
</span><span id="ChromaVectorDB-273"><a href="#ChromaVectorDB-273"><span class="linenos">273</span></a><span class="sd">        This method adds documents along with their metadata and IDs to the</span>
</span><span id="ChromaVectorDB-274"><a href="#ChromaVectorDB-274"><span class="linenos">274</span></a><span class="sd">        ChromaDB collection. The documents are automatically converted to</span>
</span><span id="ChromaVectorDB-275"><a href="#ChromaVectorDB-275"><span class="linenos">275</span></a><span class="sd">        embeddings using the configured embedding model.</span>
</span><span id="ChromaVectorDB-276"><a href="#ChromaVectorDB-276"><span class="linenos">276</span></a><span class="sd">        </span>
</span><span id="ChromaVectorDB-277"><a href="#ChromaVectorDB-277"><span class="linenos">277</span></a><span class="sd">        Parameters:</span>
</span><span id="ChromaVectorDB-278"><a href="#ChromaVectorDB-278"><span class="linenos">278</span></a><span class="sd">        -----------</span>
</span><span id="ChromaVectorDB-279"><a href="#ChromaVectorDB-279"><span class="linenos">279</span></a><span class="sd">        documents : List[str]</span>
</span><span id="ChromaVectorDB-280"><a href="#ChromaVectorDB-280"><span class="linenos">280</span></a><span class="sd">            List of text documents to add to the database.</span>
</span><span id="ChromaVectorDB-281"><a href="#ChromaVectorDB-281"><span class="linenos">281</span></a><span class="sd">            Each document will be converted to a vector embedding.</span>
</span><span id="ChromaVectorDB-282"><a href="#ChromaVectorDB-282"><span class="linenos">282</span></a><span class="sd">            </span>
</span><span id="ChromaVectorDB-283"><a href="#ChromaVectorDB-283"><span class="linenos">283</span></a><span class="sd">        metadatas : List[Dict]</span>
</span><span id="ChromaVectorDB-284"><a href="#ChromaVectorDB-284"><span class="linenos">284</span></a><span class="sd">            List of metadata dictionaries for each document.</span>
</span><span id="ChromaVectorDB-285"><a href="#ChromaVectorDB-285"><span class="linenos">285</span></a><span class="sd">            Each metadata dict can contain any key-value pairs for</span>
</span><span id="ChromaVectorDB-286"><a href="#ChromaVectorDB-286"><span class="linenos">286</span></a><span class="sd">            document categorization and filtering.</span>
</span><span id="ChromaVectorDB-287"><a href="#ChromaVectorDB-287"><span class="linenos">287</span></a><span class="sd">            </span>
</span><span id="ChromaVectorDB-288"><a href="#ChromaVectorDB-288"><span class="linenos">288</span></a><span class="sd">        ids : List[str]</span>
</span><span id="ChromaVectorDB-289"><a href="#ChromaVectorDB-289"><span class="linenos">289</span></a><span class="sd">            List of unique identifiers for each document.</span>
</span><span id="ChromaVectorDB-290"><a href="#ChromaVectorDB-290"><span class="linenos">290</span></a><span class="sd">            IDs must be unique within the collection.</span>
</span><span id="ChromaVectorDB-291"><a href="#ChromaVectorDB-291"><span class="linenos">291</span></a><span class="sd">            </span>
</span><span id="ChromaVectorDB-292"><a href="#ChromaVectorDB-292"><span class="linenos">292</span></a><span class="sd">        Raises:</span>
</span><span id="ChromaVectorDB-293"><a href="#ChromaVectorDB-293"><span class="linenos">293</span></a><span class="sd">        -------</span>
</span><span id="ChromaVectorDB-294"><a href="#ChromaVectorDB-294"><span class="linenos">294</span></a><span class="sd">        ValueError</span>
</span><span id="ChromaVectorDB-295"><a href="#ChromaVectorDB-295"><span class="linenos">295</span></a><span class="sd">            If the lengths of documents, metadatas, and ids don&#39;t match.</span>
</span><span id="ChromaVectorDB-296"><a href="#ChromaVectorDB-296"><span class="linenos">296</span></a><span class="sd">            </span>
</span><span id="ChromaVectorDB-297"><a href="#ChromaVectorDB-297"><span class="linenos">297</span></a><span class="sd">        Examples:</span>
</span><span id="ChromaVectorDB-298"><a href="#ChromaVectorDB-298"><span class="linenos">298</span></a><span class="sd">        ---------</span>
</span><span id="ChromaVectorDB-299"><a href="#ChromaVectorDB-299"><span class="linenos">299</span></a><span class="sd">        ```python</span>
</span><span id="ChromaVectorDB-300"><a href="#ChromaVectorDB-300"><span class="linenos">300</span></a><span class="sd">        # Add documents with metadata</span>
</span><span id="ChromaVectorDB-301"><a href="#ChromaVectorDB-301"><span class="linenos">301</span></a><span class="sd">        documents = [</span>
</span><span id="ChromaVectorDB-302"><a href="#ChromaVectorDB-302"><span class="linenos">302</span></a><span class="sd">            &quot;Machine learning is a subset of artificial intelligence.&quot;,</span>
</span><span id="ChromaVectorDB-303"><a href="#ChromaVectorDB-303"><span class="linenos">303</span></a><span class="sd">            &quot;Deep learning uses neural networks with multiple layers.&quot;</span>
</span><span id="ChromaVectorDB-304"><a href="#ChromaVectorDB-304"><span class="linenos">304</span></a><span class="sd">        ]</span>
</span><span id="ChromaVectorDB-305"><a href="#ChromaVectorDB-305"><span class="linenos">305</span></a><span class="sd">        </span>
</span><span id="ChromaVectorDB-306"><a href="#ChromaVectorDB-306"><span class="linenos">306</span></a><span class="sd">        metadatas = [</span>
</span><span id="ChromaVectorDB-307"><a href="#ChromaVectorDB-307"><span class="linenos">307</span></a><span class="sd">            {&quot;topic&quot;: &quot;machine_learning&quot;, &quot;source&quot;: &quot;textbook&quot;, &quot;year&quot;: 2023},</span>
</span><span id="ChromaVectorDB-308"><a href="#ChromaVectorDB-308"><span class="linenos">308</span></a><span class="sd">            {&quot;topic&quot;: &quot;deep_learning&quot;, &quot;source&quot;: &quot;research_paper&quot;, &quot;year&quot;: 2023}</span>
</span><span id="ChromaVectorDB-309"><a href="#ChromaVectorDB-309"><span class="linenos">309</span></a><span class="sd">        ]</span>
</span><span id="ChromaVectorDB-310"><a href="#ChromaVectorDB-310"><span class="linenos">310</span></a><span class="sd">        </span>
</span><span id="ChromaVectorDB-311"><a href="#ChromaVectorDB-311"><span class="linenos">311</span></a><span class="sd">        ids = [&quot;doc_001&quot;, &quot;doc_002&quot;]</span>
</span><span id="ChromaVectorDB-312"><a href="#ChromaVectorDB-312"><span class="linenos">312</span></a><span class="sd">        </span>
</span><span id="ChromaVectorDB-313"><a href="#ChromaVectorDB-313"><span class="linenos">313</span></a><span class="sd">        vector_db.add(documents, metadatas, ids)</span>
</span><span id="ChromaVectorDB-314"><a href="#ChromaVectorDB-314"><span class="linenos">314</span></a><span class="sd">        ```</span>
</span><span id="ChromaVectorDB-315"><a href="#ChromaVectorDB-315"><span class="linenos">315</span></a><span class="sd">        </span>
</span><span id="ChromaVectorDB-316"><a href="#ChromaVectorDB-316"><span class="linenos">316</span></a><span class="sd">        Notes:</span>
</span><span id="ChromaVectorDB-317"><a href="#ChromaVectorDB-317"><span class="linenos">317</span></a><span class="sd">        ------</span>
</span><span id="ChromaVectorDB-318"><a href="#ChromaVectorDB-318"><span class="linenos">318</span></a><span class="sd">        - All three lists must have the same length</span>
</span><span id="ChromaVectorDB-319"><a href="#ChromaVectorDB-319"><span class="linenos">319</span></a><span class="sd">        - IDs must be unique within the collection</span>
</span><span id="ChromaVectorDB-320"><a href="#ChromaVectorDB-320"><span class="linenos">320</span></a><span class="sd">        - Documents are automatically embedded using the configured model</span>
</span><span id="ChromaVectorDB-321"><a href="#ChromaVectorDB-321"><span class="linenos">321</span></a><span class="sd">        - Metadata can be used for filtering during queries</span>
</span><span id="ChromaVectorDB-322"><a href="#ChromaVectorDB-322"><span class="linenos">322</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ChromaVectorDB-323"><a href="#ChromaVectorDB-323"><span class="linenos">323</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">metadatas</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">ids</span><span class="p">)):</span>
</span><span id="ChromaVectorDB-324"><a href="#ChromaVectorDB-324"><span class="linenos">324</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;documents, metadatas, and ids must have the same length&quot;</span><span class="p">)</span>
</span><span id="ChromaVectorDB-325"><a href="#ChromaVectorDB-325"><span class="linenos">325</span></a>            
</span><span id="ChromaVectorDB-326"><a href="#ChromaVectorDB-326"><span class="linenos">326</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_collection</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
</span><span id="ChromaVectorDB-327"><a href="#ChromaVectorDB-327"><span class="linenos">327</span></a>            <span class="n">documents</span><span class="o">=</span><span class="n">documents</span><span class="p">,</span>
</span><span id="ChromaVectorDB-328"><a href="#ChromaVectorDB-328"><span class="linenos">328</span></a>            <span class="n">metadatas</span><span class="o">=</span><span class="n">metadatas</span><span class="p">,</span>
</span><span id="ChromaVectorDB-329"><a href="#ChromaVectorDB-329"><span class="linenos">329</span></a>            <span class="n">ids</span><span class="o">=</span><span class="n">ids</span>
</span><span id="ChromaVectorDB-330"><a href="#ChromaVectorDB-330"><span class="linenos">330</span></a>        <span class="p">)</span>
</span><span id="ChromaVectorDB-331"><a href="#ChromaVectorDB-331"><span class="linenos">331</span></a>
</span><span id="ChromaVectorDB-332"><a href="#ChromaVectorDB-332"><span class="linenos">332</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="ChromaVectorDB-333"><a href="#ChromaVectorDB-333"><span class="linenos">333</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ChromaVectorDB-334"><a href="#ChromaVectorDB-334"><span class="linenos">334</span></a><span class="sd">        Search for similar documents in the ChromaDB collection.</span>
</span><span id="ChromaVectorDB-335"><a href="#ChromaVectorDB-335"><span class="linenos">335</span></a><span class="sd">        </span>
</span><span id="ChromaVectorDB-336"><a href="#ChromaVectorDB-336"><span class="linenos">336</span></a><span class="sd">        This method performs semantic search by converting the query to an</span>
</span><span id="ChromaVectorDB-337"><a href="#ChromaVectorDB-337"><span class="linenos">337</span></a><span class="sd">        embedding and finding the most similar document embeddings in the</span>
</span><span id="ChromaVectorDB-338"><a href="#ChromaVectorDB-338"><span class="linenos">338</span></a><span class="sd">        collection.</span>
</span><span id="ChromaVectorDB-339"><a href="#ChromaVectorDB-339"><span class="linenos">339</span></a><span class="sd">        </span>
</span><span id="ChromaVectorDB-340"><a href="#ChromaVectorDB-340"><span class="linenos">340</span></a><span class="sd">        Parameters:</span>
</span><span id="ChromaVectorDB-341"><a href="#ChromaVectorDB-341"><span class="linenos">341</span></a><span class="sd">        -----------</span>
</span><span id="ChromaVectorDB-342"><a href="#ChromaVectorDB-342"><span class="linenos">342</span></a><span class="sd">        query : str</span>
</span><span id="ChromaVectorDB-343"><a href="#ChromaVectorDB-343"><span class="linenos">343</span></a><span class="sd">            The text query to search for. This will be converted to a</span>
</span><span id="ChromaVectorDB-344"><a href="#ChromaVectorDB-344"><span class="linenos">344</span></a><span class="sd">            vector embedding and compared against stored documents.</span>
</span><span id="ChromaVectorDB-345"><a href="#ChromaVectorDB-345"><span class="linenos">345</span></a><span class="sd">            </span>
</span><span id="ChromaVectorDB-346"><a href="#ChromaVectorDB-346"><span class="linenos">346</span></a><span class="sd">        k : int, default=10</span>
</span><span id="ChromaVectorDB-347"><a href="#ChromaVectorDB-347"><span class="linenos">347</span></a><span class="sd">            Number of most similar documents to return. Higher values</span>
</span><span id="ChromaVectorDB-348"><a href="#ChromaVectorDB-348"><span class="linenos">348</span></a><span class="sd">            return more results but may include less relevant documents.</span>
</span><span id="ChromaVectorDB-349"><a href="#ChromaVectorDB-349"><span class="linenos">349</span></a><span class="sd">            </span>
</span><span id="ChromaVectorDB-350"><a href="#ChromaVectorDB-350"><span class="linenos">350</span></a><span class="sd">        Returns:</span>
</span><span id="ChromaVectorDB-351"><a href="#ChromaVectorDB-351"><span class="linenos">351</span></a><span class="sd">        --------</span>
</span><span id="ChromaVectorDB-352"><a href="#ChromaVectorDB-352"><span class="linenos">352</span></a><span class="sd">        Dict[str, Any]</span>
</span><span id="ChromaVectorDB-353"><a href="#ChromaVectorDB-353"><span class="linenos">353</span></a><span class="sd">            A dictionary containing search results with the following structure:</span>
</span><span id="ChromaVectorDB-354"><a href="#ChromaVectorDB-354"><span class="linenos">354</span></a><span class="sd">            {</span>
</span><span id="ChromaVectorDB-355"><a href="#ChromaVectorDB-355"><span class="linenos">355</span></a><span class="sd">                &#39;ids&#39;: List[List[str]] - Document IDs of retrieved documents,</span>
</span><span id="ChromaVectorDB-356"><a href="#ChromaVectorDB-356"><span class="linenos">356</span></a><span class="sd">                &#39;documents&#39;: List[List[str]] - The actual document content,</span>
</span><span id="ChromaVectorDB-357"><a href="#ChromaVectorDB-357"><span class="linenos">357</span></a><span class="sd">                &#39;metadatas&#39;: List[List[Dict]] - Metadata for each document,</span>
</span><span id="ChromaVectorDB-358"><a href="#ChromaVectorDB-358"><span class="linenos">358</span></a><span class="sd">                &#39;distances&#39;: List[List[float]] - Similarity scores (lower = more similar)</span>
</span><span id="ChromaVectorDB-359"><a href="#ChromaVectorDB-359"><span class="linenos">359</span></a><span class="sd">            }</span>
</span><span id="ChromaVectorDB-360"><a href="#ChromaVectorDB-360"><span class="linenos">360</span></a><span class="sd">            </span>
</span><span id="ChromaVectorDB-361"><a href="#ChromaVectorDB-361"><span class="linenos">361</span></a><span class="sd">        Examples:</span>
</span><span id="ChromaVectorDB-362"><a href="#ChromaVectorDB-362"><span class="linenos">362</span></a><span class="sd">        ---------</span>
</span><span id="ChromaVectorDB-363"><a href="#ChromaVectorDB-363"><span class="linenos">363</span></a><span class="sd">        ```python</span>
</span><span id="ChromaVectorDB-364"><a href="#ChromaVectorDB-364"><span class="linenos">364</span></a><span class="sd">        # Basic search</span>
</span><span id="ChromaVectorDB-365"><a href="#ChromaVectorDB-365"><span class="linenos">365</span></a><span class="sd">        results = vector_db.query(&quot;What is machine learning?&quot;, k=5)</span>
</span><span id="ChromaVectorDB-366"><a href="#ChromaVectorDB-366"><span class="linenos">366</span></a><span class="sd">        </span>
</span><span id="ChromaVectorDB-367"><a href="#ChromaVectorDB-367"><span class="linenos">367</span></a><span class="sd">        # Access results</span>
</span><span id="ChromaVectorDB-368"><a href="#ChromaVectorDB-368"><span class="linenos">368</span></a><span class="sd">        for i, (doc_id, document, metadata, distance) in enumerate(zip(</span>
</span><span id="ChromaVectorDB-369"><a href="#ChromaVectorDB-369"><span class="linenos">369</span></a><span class="sd">            results[&#39;ids&#39;][0], </span>
</span><span id="ChromaVectorDB-370"><a href="#ChromaVectorDB-370"><span class="linenos">370</span></a><span class="sd">            results[&#39;documents&#39;][0], </span>
</span><span id="ChromaVectorDB-371"><a href="#ChromaVectorDB-371"><span class="linenos">371</span></a><span class="sd">            results[&#39;metadatas&#39;][0], </span>
</span><span id="ChromaVectorDB-372"><a href="#ChromaVectorDB-372"><span class="linenos">372</span></a><span class="sd">            results[&#39;distances&#39;][0]</span>
</span><span id="ChromaVectorDB-373"><a href="#ChromaVectorDB-373"><span class="linenos">373</span></a><span class="sd">        )):</span>
</span><span id="ChromaVectorDB-374"><a href="#ChromaVectorDB-374"><span class="linenos">374</span></a><span class="sd">            print(f&quot;Result {i+1}:&quot;)</span>
</span><span id="ChromaVectorDB-375"><a href="#ChromaVectorDB-375"><span class="linenos">375</span></a><span class="sd">            print(f&quot;  ID: {doc_id}&quot;)</span>
</span><span id="ChromaVectorDB-376"><a href="#ChromaVectorDB-376"><span class="linenos">376</span></a><span class="sd">            print(f&quot;  Content: {document[:100]}...&quot;)</span>
</span><span id="ChromaVectorDB-377"><a href="#ChromaVectorDB-377"><span class="linenos">377</span></a><span class="sd">            print(f&quot;  Similarity: {1 - distance:.3f}&quot;)</span>
</span><span id="ChromaVectorDB-378"><a href="#ChromaVectorDB-378"><span class="linenos">378</span></a><span class="sd">            print(f&quot;  Metadata: {metadata}&quot;)</span>
</span><span id="ChromaVectorDB-379"><a href="#ChromaVectorDB-379"><span class="linenos">379</span></a><span class="sd">        ```</span>
</span><span id="ChromaVectorDB-380"><a href="#ChromaVectorDB-380"><span class="linenos">380</span></a><span class="sd">        </span>
</span><span id="ChromaVectorDB-381"><a href="#ChromaVectorDB-381"><span class="linenos">381</span></a><span class="sd">        Notes:</span>
</span><span id="ChromaVectorDB-382"><a href="#ChromaVectorDB-382"><span class="linenos">382</span></a><span class="sd">        ------</span>
</span><span id="ChromaVectorDB-383"><a href="#ChromaVectorDB-383"><span class="linenos">383</span></a><span class="sd">        - Results are returned in order of similarity (most similar first)</span>
</span><span id="ChromaVectorDB-384"><a href="#ChromaVectorDB-384"><span class="linenos">384</span></a><span class="sd">        - Distance scores are cosine distances (0 = identical, 2 = opposite)</span>
</span><span id="ChromaVectorDB-385"><a href="#ChromaVectorDB-385"><span class="linenos">385</span></a><span class="sd">        - If fewer than k documents exist, all available documents are returned</span>
</span><span id="ChromaVectorDB-386"><a href="#ChromaVectorDB-386"><span class="linenos">386</span></a><span class="sd">        - The query is automatically embedded using the same model as stored documents</span>
</span><span id="ChromaVectorDB-387"><a href="#ChromaVectorDB-387"><span class="linenos">387</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ChromaVectorDB-388"><a href="#ChromaVectorDB-388"><span class="linenos">388</span></a>        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
</span><span id="ChromaVectorDB-389"><a href="#ChromaVectorDB-389"><span class="linenos">389</span></a>            <span class="n">query_texts</span><span class="o">=</span><span class="n">query</span><span class="p">,</span>
</span><span id="ChromaVectorDB-390"><a href="#ChromaVectorDB-390"><span class="linenos">390</span></a>            <span class="n">n_results</span><span class="o">=</span><span class="n">k</span>
</span><span id="ChromaVectorDB-391"><a href="#ChromaVectorDB-391"><span class="linenos">391</span></a>        <span class="p">)</span>
</span><span id="ChromaVectorDB-392"><a href="#ChromaVectorDB-392"><span class="linenos">392</span></a>        <span class="k">return</span> <span class="n">results</span>
</span></pre></div>


            <div class="docstring"><p>ChromaDB implementation of the vector database interface.</p>

<p>This class provides a concrete implementation of the vector database
using ChromaDB as the backend. ChromaDB is an open-source embedding
database that supports persistent storage and efficient similarity search.</p>

<p>Features:</p>

<ul>
<li>Persistent storage of document embeddings</li>
<li>Efficient similarity search with configurable result count</li>
<li>Metadata storage for each document</li>
<li>Automatic collection creation if it doesn't exist</li>
<li>Support for custom embedding models via LiteLLM</li>
</ul>

<p>Attributes:
    _client (chromadb.PersistentClient): ChromaDB client instance
    _collection (chromadb.Collection): Active collection for operations</p>

<h2 id="examples">Examples:</h2>

<p>Basic usage:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="c1"># Initialize with a new collection</span>
<span class="n">vector_db</span> <span class="o">=</span> <span class="n">ChromaVectorDB</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;my_documents&quot;</span><span class="p">)</span>

<span class="c1"># Add documents</span>
<span class="n">documents</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Document 1 content&quot;</span><span class="p">,</span> <span class="s2">&quot;Document 2 content&quot;</span><span class="p">]</span>
<span class="n">metadatas</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;file1.txt&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;file2.txt&quot;</span><span class="p">}]</span>
<span class="n">ids</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;doc1&quot;</span><span class="p">,</span> <span class="s2">&quot;doc2&quot;</span><span class="p">]</span>

<span class="n">vector_db</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">documents</span><span class="p">,</span> <span class="n">metadatas</span><span class="p">,</span> <span class="n">ids</span><span class="p">)</span>

<span class="c1"># Search for similar documents</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">vector_db</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;search query&quot;</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</code></pre>
</div>

<p>Using with specific embedding model:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="c1"># Initialize with OpenAI embeddings</span>
<span class="n">vector_db</span> <span class="o">=</span> <span class="n">ChromaVectorDB</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;research_papers&quot;</span><span class="p">,</span>
    <span class="n">vectorizer_provider</span><span class="o">=</span><span class="s2">&quot;openai&quot;</span><span class="p">,</span>
    <span class="n">vectorizer_model</span><span class="o">=</span><span class="s2">&quot;text-embedding-ada-002&quot;</span>
<span class="p">)</span>
</code></pre>
</div>
</div>


                            <div id="ChromaVectorDB.__init__" class="classattr">
                                        <input id="ChromaVectorDB.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">ChromaVectorDB</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">vectorizer_provider</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">vectorizer_model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="ChromaVectorDB.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ChromaVectorDB.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ChromaVectorDB.__init__-222"><a href="#ChromaVectorDB.__init__-222"><span class="linenos">222</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
</span><span id="ChromaVectorDB.__init__-223"><a href="#ChromaVectorDB.__init__-223"><span class="linenos">223</span></a>                 <span class="n">vectorizer_provider</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
</span><span id="ChromaVectorDB.__init__-224"><a href="#ChromaVectorDB.__init__-224"><span class="linenos">224</span></a>                 <span class="n">vectorizer_model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="ChromaVectorDB.__init__-225"><a href="#ChromaVectorDB.__init__-225"><span class="linenos">225</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ChromaVectorDB.__init__-226"><a href="#ChromaVectorDB.__init__-226"><span class="linenos">226</span></a><span class="sd">        Initialize the ChromaDB vector database.</span>
</span><span id="ChromaVectorDB.__init__-227"><a href="#ChromaVectorDB.__init__-227"><span class="linenos">227</span></a><span class="sd">        </span>
</span><span id="ChromaVectorDB.__init__-228"><a href="#ChromaVectorDB.__init__-228"><span class="linenos">228</span></a><span class="sd">        Parameters:</span>
</span><span id="ChromaVectorDB.__init__-229"><a href="#ChromaVectorDB.__init__-229"><span class="linenos">229</span></a><span class="sd">        -----------</span>
</span><span id="ChromaVectorDB.__init__-230"><a href="#ChromaVectorDB.__init__-230"><span class="linenos">230</span></a><span class="sd">        name : str, optional</span>
</span><span id="ChromaVectorDB.__init__-231"><a href="#ChromaVectorDB.__init__-231"><span class="linenos">231</span></a><span class="sd">            Name of the ChromaDB collection. If provided, the collection</span>
</span><span id="ChromaVectorDB.__init__-232"><a href="#ChromaVectorDB.__init__-232"><span class="linenos">232</span></a><span class="sd">            will be created if it doesn&#39;t exist, or connected to if it does.</span>
</span><span id="ChromaVectorDB.__init__-233"><a href="#ChromaVectorDB.__init__-233"><span class="linenos">233</span></a><span class="sd">            </span>
</span><span id="ChromaVectorDB.__init__-234"><a href="#ChromaVectorDB.__init__-234"><span class="linenos">234</span></a><span class="sd">        vectorizer_provider : str, optional</span>
</span><span id="ChromaVectorDB.__init__-235"><a href="#ChromaVectorDB.__init__-235"><span class="linenos">235</span></a><span class="sd">            The embedding provider to use for vectorization.</span>
</span><span id="ChromaVectorDB.__init__-236"><a href="#ChromaVectorDB.__init__-236"><span class="linenos">236</span></a><span class="sd">            Examples: &quot;openai&quot;, &quot;anthropic&quot;, &quot;cohere&quot;</span>
</span><span id="ChromaVectorDB.__init__-237"><a href="#ChromaVectorDB.__init__-237"><span class="linenos">237</span></a><span class="sd">            </span>
</span><span id="ChromaVectorDB.__init__-238"><a href="#ChromaVectorDB.__init__-238"><span class="linenos">238</span></a><span class="sd">        vectorizer_model : str, optional</span>
</span><span id="ChromaVectorDB.__init__-239"><a href="#ChromaVectorDB.__init__-239"><span class="linenos">239</span></a><span class="sd">            The specific embedding model to use.</span>
</span><span id="ChromaVectorDB.__init__-240"><a href="#ChromaVectorDB.__init__-240"><span class="linenos">240</span></a><span class="sd">            Examples: &quot;text-embedding-ada-002&quot;, &quot;text-embedding-3-small&quot;</span>
</span><span id="ChromaVectorDB.__init__-241"><a href="#ChromaVectorDB.__init__-241"><span class="linenos">241</span></a><span class="sd">            </span>
</span><span id="ChromaVectorDB.__init__-242"><a href="#ChromaVectorDB.__init__-242"><span class="linenos">242</span></a><span class="sd">        Examples:</span>
</span><span id="ChromaVectorDB.__init__-243"><a href="#ChromaVectorDB.__init__-243"><span class="linenos">243</span></a><span class="sd">        ---------</span>
</span><span id="ChromaVectorDB.__init__-244"><a href="#ChromaVectorDB.__init__-244"><span class="linenos">244</span></a><span class="sd">        ```python</span>
</span><span id="ChromaVectorDB.__init__-245"><a href="#ChromaVectorDB.__init__-245"><span class="linenos">245</span></a><span class="sd">        # Create new collection</span>
</span><span id="ChromaVectorDB.__init__-246"><a href="#ChromaVectorDB.__init__-246"><span class="linenos">246</span></a><span class="sd">        vector_db = ChromaVectorDB(&quot;my_documents&quot;)</span>
</span><span id="ChromaVectorDB.__init__-247"><a href="#ChromaVectorDB.__init__-247"><span class="linenos">247</span></a><span class="sd">        </span>
</span><span id="ChromaVectorDB.__init__-248"><a href="#ChromaVectorDB.__init__-248"><span class="linenos">248</span></a><span class="sd">        # Connect to existing collection with custom embeddings</span>
</span><span id="ChromaVectorDB.__init__-249"><a href="#ChromaVectorDB.__init__-249"><span class="linenos">249</span></a><span class="sd">        vector_db = ChromaVectorDB(</span>
</span><span id="ChromaVectorDB.__init__-250"><a href="#ChromaVectorDB.__init__-250"><span class="linenos">250</span></a><span class="sd">            name=&quot;existing_collection&quot;,</span>
</span><span id="ChromaVectorDB.__init__-251"><a href="#ChromaVectorDB.__init__-251"><span class="linenos">251</span></a><span class="sd">            vectorizer_provider=&quot;openai&quot;,</span>
</span><span id="ChromaVectorDB.__init__-252"><a href="#ChromaVectorDB.__init__-252"><span class="linenos">252</span></a><span class="sd">            vectorizer_model=&quot;text-embedding-ada-002&quot;</span>
</span><span id="ChromaVectorDB.__init__-253"><a href="#ChromaVectorDB.__init__-253"><span class="linenos">253</span></a><span class="sd">        )</span>
</span><span id="ChromaVectorDB.__init__-254"><a href="#ChromaVectorDB.__init__-254"><span class="linenos">254</span></a><span class="sd">        ```</span>
</span><span id="ChromaVectorDB.__init__-255"><a href="#ChromaVectorDB.__init__-255"><span class="linenos">255</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ChromaVectorDB.__init__-256"><a href="#ChromaVectorDB.__init__-256"><span class="linenos">256</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">vectorizer_provider</span><span class="p">,</span> <span class="n">vectorizer_model</span><span class="p">)</span>
</span><span id="ChromaVectorDB.__init__-257"><a href="#ChromaVectorDB.__init__-257"><span class="linenos">257</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="ChromaVectorDB.__init__-258"><a href="#ChromaVectorDB.__init__-258"><span class="linenos">258</span></a>            <span class="kn">import</span><span class="w"> </span><span class="nn">chromadb</span>
</span><span id="ChromaVectorDB.__init__-259"><a href="#ChromaVectorDB.__init__-259"><span class="linenos">259</span></a>        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
</span><span id="ChromaVectorDB.__init__-260"><a href="#ChromaVectorDB.__init__-260"><span class="linenos">260</span></a>            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;chromadb is not installed. Please install it with &#39;pip install chromadb&#39;&quot;</span><span class="p">)</span>
</span><span id="ChromaVectorDB.__init__-261"><a href="#ChromaVectorDB.__init__-261"><span class="linenos">261</span></a>
</span><span id="ChromaVectorDB.__init__-262"><a href="#ChromaVectorDB.__init__-262"><span class="linenos">262</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_client</span> <span class="o">=</span> <span class="n">chromadb</span><span class="o">.</span><span class="n">PersistentClient</span><span class="p">()</span>
</span><span id="ChromaVectorDB.__init__-263"><a href="#ChromaVectorDB.__init__-263"><span class="linenos">263</span></a>        <span class="k">if</span> <span class="n">name</span><span class="p">:</span>
</span><span id="ChromaVectorDB.__init__-264"><a href="#ChromaVectorDB.__init__-264"><span class="linenos">264</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="ChromaVectorDB.__init__-265"><a href="#ChromaVectorDB.__init__-265"><span class="linenos">265</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_collection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">get_collection</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span><span id="ChromaVectorDB.__init__-266"><a href="#ChromaVectorDB.__init__-266"><span class="linenos">266</span></a>            <span class="k">except</span> <span class="n">chromadb</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">NotFoundError</span><span class="p">:</span>
</span><span id="ChromaVectorDB.__init__-267"><a href="#ChromaVectorDB.__init__-267"><span class="linenos">267</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_collection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client</span><span class="o">.</span><span class="n">create_collection</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the ChromaDB vector database.</p>

<h2 id="parameters">Parameters:</h2>

<p>name : str, optional
    Name of the ChromaDB collection. If provided, the collection
    will be created if it doesn't exist, or connected to if it does.</p>

<p>vectorizer_provider : str, optional
    The embedding provider to use for vectorization.
    Examples: "openai", "anthropic", "cohere"</p>

<p>vectorizer_model : str, optional
    The specific embedding model to use.
    Examples: "text-embedding-ada-002", "text-embedding-3-small"</p>

<h2 id="examples">Examples:</h2>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="c1"># Create new collection</span>
<span class="n">vector_db</span> <span class="o">=</span> <span class="n">ChromaVectorDB</span><span class="p">(</span><span class="s2">&quot;my_documents&quot;</span><span class="p">)</span>

<span class="c1"># Connect to existing collection with custom embeddings</span>
<span class="n">vector_db</span> <span class="o">=</span> <span class="n">ChromaVectorDB</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;existing_collection&quot;</span><span class="p">,</span>
    <span class="n">vectorizer_provider</span><span class="o">=</span><span class="s2">&quot;openai&quot;</span><span class="p">,</span>
    <span class="n">vectorizer_model</span><span class="o">=</span><span class="s2">&quot;text-embedding-ada-002&quot;</span>
<span class="p">)</span>
</code></pre>
</div>
</div>


                            </div>
                            <div id="ChromaVectorDB.add" class="classattr">
                                        <input id="ChromaVectorDB.add-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">documents</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>,</span><span class="param">	<span class="n">metadatas</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span>,</span><span class="param">	<span class="n">ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="ChromaVectorDB.add-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ChromaVectorDB.add"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ChromaVectorDB.add-269"><a href="#ChromaVectorDB.add-269"><span class="linenos">269</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">documents</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">metadatas</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">],</span> <span class="n">ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ChromaVectorDB.add-270"><a href="#ChromaVectorDB.add-270"><span class="linenos">270</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ChromaVectorDB.add-271"><a href="#ChromaVectorDB.add-271"><span class="linenos">271</span></a><span class="sd">        Add documents to the ChromaDB collection.</span>
</span><span id="ChromaVectorDB.add-272"><a href="#ChromaVectorDB.add-272"><span class="linenos">272</span></a><span class="sd">        </span>
</span><span id="ChromaVectorDB.add-273"><a href="#ChromaVectorDB.add-273"><span class="linenos">273</span></a><span class="sd">        This method adds documents along with their metadata and IDs to the</span>
</span><span id="ChromaVectorDB.add-274"><a href="#ChromaVectorDB.add-274"><span class="linenos">274</span></a><span class="sd">        ChromaDB collection. The documents are automatically converted to</span>
</span><span id="ChromaVectorDB.add-275"><a href="#ChromaVectorDB.add-275"><span class="linenos">275</span></a><span class="sd">        embeddings using the configured embedding model.</span>
</span><span id="ChromaVectorDB.add-276"><a href="#ChromaVectorDB.add-276"><span class="linenos">276</span></a><span class="sd">        </span>
</span><span id="ChromaVectorDB.add-277"><a href="#ChromaVectorDB.add-277"><span class="linenos">277</span></a><span class="sd">        Parameters:</span>
</span><span id="ChromaVectorDB.add-278"><a href="#ChromaVectorDB.add-278"><span class="linenos">278</span></a><span class="sd">        -----------</span>
</span><span id="ChromaVectorDB.add-279"><a href="#ChromaVectorDB.add-279"><span class="linenos">279</span></a><span class="sd">        documents : List[str]</span>
</span><span id="ChromaVectorDB.add-280"><a href="#ChromaVectorDB.add-280"><span class="linenos">280</span></a><span class="sd">            List of text documents to add to the database.</span>
</span><span id="ChromaVectorDB.add-281"><a href="#ChromaVectorDB.add-281"><span class="linenos">281</span></a><span class="sd">            Each document will be converted to a vector embedding.</span>
</span><span id="ChromaVectorDB.add-282"><a href="#ChromaVectorDB.add-282"><span class="linenos">282</span></a><span class="sd">            </span>
</span><span id="ChromaVectorDB.add-283"><a href="#ChromaVectorDB.add-283"><span class="linenos">283</span></a><span class="sd">        metadatas : List[Dict]</span>
</span><span id="ChromaVectorDB.add-284"><a href="#ChromaVectorDB.add-284"><span class="linenos">284</span></a><span class="sd">            List of metadata dictionaries for each document.</span>
</span><span id="ChromaVectorDB.add-285"><a href="#ChromaVectorDB.add-285"><span class="linenos">285</span></a><span class="sd">            Each metadata dict can contain any key-value pairs for</span>
</span><span id="ChromaVectorDB.add-286"><a href="#ChromaVectorDB.add-286"><span class="linenos">286</span></a><span class="sd">            document categorization and filtering.</span>
</span><span id="ChromaVectorDB.add-287"><a href="#ChromaVectorDB.add-287"><span class="linenos">287</span></a><span class="sd">            </span>
</span><span id="ChromaVectorDB.add-288"><a href="#ChromaVectorDB.add-288"><span class="linenos">288</span></a><span class="sd">        ids : List[str]</span>
</span><span id="ChromaVectorDB.add-289"><a href="#ChromaVectorDB.add-289"><span class="linenos">289</span></a><span class="sd">            List of unique identifiers for each document.</span>
</span><span id="ChromaVectorDB.add-290"><a href="#ChromaVectorDB.add-290"><span class="linenos">290</span></a><span class="sd">            IDs must be unique within the collection.</span>
</span><span id="ChromaVectorDB.add-291"><a href="#ChromaVectorDB.add-291"><span class="linenos">291</span></a><span class="sd">            </span>
</span><span id="ChromaVectorDB.add-292"><a href="#ChromaVectorDB.add-292"><span class="linenos">292</span></a><span class="sd">        Raises:</span>
</span><span id="ChromaVectorDB.add-293"><a href="#ChromaVectorDB.add-293"><span class="linenos">293</span></a><span class="sd">        -------</span>
</span><span id="ChromaVectorDB.add-294"><a href="#ChromaVectorDB.add-294"><span class="linenos">294</span></a><span class="sd">        ValueError</span>
</span><span id="ChromaVectorDB.add-295"><a href="#ChromaVectorDB.add-295"><span class="linenos">295</span></a><span class="sd">            If the lengths of documents, metadatas, and ids don&#39;t match.</span>
</span><span id="ChromaVectorDB.add-296"><a href="#ChromaVectorDB.add-296"><span class="linenos">296</span></a><span class="sd">            </span>
</span><span id="ChromaVectorDB.add-297"><a href="#ChromaVectorDB.add-297"><span class="linenos">297</span></a><span class="sd">        Examples:</span>
</span><span id="ChromaVectorDB.add-298"><a href="#ChromaVectorDB.add-298"><span class="linenos">298</span></a><span class="sd">        ---------</span>
</span><span id="ChromaVectorDB.add-299"><a href="#ChromaVectorDB.add-299"><span class="linenos">299</span></a><span class="sd">        ```python</span>
</span><span id="ChromaVectorDB.add-300"><a href="#ChromaVectorDB.add-300"><span class="linenos">300</span></a><span class="sd">        # Add documents with metadata</span>
</span><span id="ChromaVectorDB.add-301"><a href="#ChromaVectorDB.add-301"><span class="linenos">301</span></a><span class="sd">        documents = [</span>
</span><span id="ChromaVectorDB.add-302"><a href="#ChromaVectorDB.add-302"><span class="linenos">302</span></a><span class="sd">            &quot;Machine learning is a subset of artificial intelligence.&quot;,</span>
</span><span id="ChromaVectorDB.add-303"><a href="#ChromaVectorDB.add-303"><span class="linenos">303</span></a><span class="sd">            &quot;Deep learning uses neural networks with multiple layers.&quot;</span>
</span><span id="ChromaVectorDB.add-304"><a href="#ChromaVectorDB.add-304"><span class="linenos">304</span></a><span class="sd">        ]</span>
</span><span id="ChromaVectorDB.add-305"><a href="#ChromaVectorDB.add-305"><span class="linenos">305</span></a><span class="sd">        </span>
</span><span id="ChromaVectorDB.add-306"><a href="#ChromaVectorDB.add-306"><span class="linenos">306</span></a><span class="sd">        metadatas = [</span>
</span><span id="ChromaVectorDB.add-307"><a href="#ChromaVectorDB.add-307"><span class="linenos">307</span></a><span class="sd">            {&quot;topic&quot;: &quot;machine_learning&quot;, &quot;source&quot;: &quot;textbook&quot;, &quot;year&quot;: 2023},</span>
</span><span id="ChromaVectorDB.add-308"><a href="#ChromaVectorDB.add-308"><span class="linenos">308</span></a><span class="sd">            {&quot;topic&quot;: &quot;deep_learning&quot;, &quot;source&quot;: &quot;research_paper&quot;, &quot;year&quot;: 2023}</span>
</span><span id="ChromaVectorDB.add-309"><a href="#ChromaVectorDB.add-309"><span class="linenos">309</span></a><span class="sd">        ]</span>
</span><span id="ChromaVectorDB.add-310"><a href="#ChromaVectorDB.add-310"><span class="linenos">310</span></a><span class="sd">        </span>
</span><span id="ChromaVectorDB.add-311"><a href="#ChromaVectorDB.add-311"><span class="linenos">311</span></a><span class="sd">        ids = [&quot;doc_001&quot;, &quot;doc_002&quot;]</span>
</span><span id="ChromaVectorDB.add-312"><a href="#ChromaVectorDB.add-312"><span class="linenos">312</span></a><span class="sd">        </span>
</span><span id="ChromaVectorDB.add-313"><a href="#ChromaVectorDB.add-313"><span class="linenos">313</span></a><span class="sd">        vector_db.add(documents, metadatas, ids)</span>
</span><span id="ChromaVectorDB.add-314"><a href="#ChromaVectorDB.add-314"><span class="linenos">314</span></a><span class="sd">        ```</span>
</span><span id="ChromaVectorDB.add-315"><a href="#ChromaVectorDB.add-315"><span class="linenos">315</span></a><span class="sd">        </span>
</span><span id="ChromaVectorDB.add-316"><a href="#ChromaVectorDB.add-316"><span class="linenos">316</span></a><span class="sd">        Notes:</span>
</span><span id="ChromaVectorDB.add-317"><a href="#ChromaVectorDB.add-317"><span class="linenos">317</span></a><span class="sd">        ------</span>
</span><span id="ChromaVectorDB.add-318"><a href="#ChromaVectorDB.add-318"><span class="linenos">318</span></a><span class="sd">        - All three lists must have the same length</span>
</span><span id="ChromaVectorDB.add-319"><a href="#ChromaVectorDB.add-319"><span class="linenos">319</span></a><span class="sd">        - IDs must be unique within the collection</span>
</span><span id="ChromaVectorDB.add-320"><a href="#ChromaVectorDB.add-320"><span class="linenos">320</span></a><span class="sd">        - Documents are automatically embedded using the configured model</span>
</span><span id="ChromaVectorDB.add-321"><a href="#ChromaVectorDB.add-321"><span class="linenos">321</span></a><span class="sd">        - Metadata can be used for filtering during queries</span>
</span><span id="ChromaVectorDB.add-322"><a href="#ChromaVectorDB.add-322"><span class="linenos">322</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ChromaVectorDB.add-323"><a href="#ChromaVectorDB.add-323"><span class="linenos">323</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">metadatas</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">ids</span><span class="p">)):</span>
</span><span id="ChromaVectorDB.add-324"><a href="#ChromaVectorDB.add-324"><span class="linenos">324</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;documents, metadatas, and ids must have the same length&quot;</span><span class="p">)</span>
</span><span id="ChromaVectorDB.add-325"><a href="#ChromaVectorDB.add-325"><span class="linenos">325</span></a>            
</span><span id="ChromaVectorDB.add-326"><a href="#ChromaVectorDB.add-326"><span class="linenos">326</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_collection</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
</span><span id="ChromaVectorDB.add-327"><a href="#ChromaVectorDB.add-327"><span class="linenos">327</span></a>            <span class="n">documents</span><span class="o">=</span><span class="n">documents</span><span class="p">,</span>
</span><span id="ChromaVectorDB.add-328"><a href="#ChromaVectorDB.add-328"><span class="linenos">328</span></a>            <span class="n">metadatas</span><span class="o">=</span><span class="n">metadatas</span><span class="p">,</span>
</span><span id="ChromaVectorDB.add-329"><a href="#ChromaVectorDB.add-329"><span class="linenos">329</span></a>            <span class="n">ids</span><span class="o">=</span><span class="n">ids</span>
</span><span id="ChromaVectorDB.add-330"><a href="#ChromaVectorDB.add-330"><span class="linenos">330</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Add documents to the ChromaDB collection.</p>

<p>This method adds documents along with their metadata and IDs to the
ChromaDB collection. The documents are automatically converted to
embeddings using the configured embedding model.</p>

<h2 id="parameters">Parameters:</h2>

<p>documents : List[str]
    List of text documents to add to the database.
    Each document will be converted to a vector embedding.</p>

<p>metadatas : List[Dict]
    List of metadata dictionaries for each document.
    Each metadata dict can contain any key-value pairs for
    document categorization and filtering.</p>

<p>ids : List[str]
    List of unique identifiers for each document.
    IDs must be unique within the collection.</p>

<h2 id="raises">Raises:</h2>

<p>ValueError
    If the lengths of documents, metadatas, and ids don't match.</p>

<h2 id="examples">Examples:</h2>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="c1"># Add documents with metadata</span>
<span class="n">documents</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;Machine learning is a subset of artificial intelligence.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Deep learning uses neural networks with multiple layers.&quot;</span>
<span class="p">]</span>

<span class="n">metadatas</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">&quot;topic&quot;</span><span class="p">:</span> <span class="s2">&quot;machine_learning&quot;</span><span class="p">,</span> <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;textbook&quot;</span><span class="p">,</span> <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="mi">2023</span><span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;topic&quot;</span><span class="p">:</span> <span class="s2">&quot;deep_learning&quot;</span><span class="p">,</span> <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;research_paper&quot;</span><span class="p">,</span> <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="mi">2023</span><span class="p">}</span>
<span class="p">]</span>

<span class="n">ids</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;doc_001&quot;</span><span class="p">,</span> <span class="s2">&quot;doc_002&quot;</span><span class="p">]</span>

<span class="n">vector_db</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">documents</span><span class="p">,</span> <span class="n">metadatas</span><span class="p">,</span> <span class="n">ids</span><span class="p">)</span>
</code></pre>
</div>

<h2 id="notes">Notes:</h2>

<ul>
<li>All three lists must have the same length</li>
<li>IDs must be unique within the collection</li>
<li>Documents are automatically embedded using the configured model</li>
<li>Metadata can be used for filtering during queries</li>
</ul>
</div>


                            </div>
                            <div id="ChromaVectorDB.query" class="classattr">
                                        <input id="ChromaVectorDB.query-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">query</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">query</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">k</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span></span><span class="return-annotation">) -> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="ChromaVectorDB.query-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ChromaVectorDB.query"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ChromaVectorDB.query-332"><a href="#ChromaVectorDB.query-332"><span class="linenos">332</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="ChromaVectorDB.query-333"><a href="#ChromaVectorDB.query-333"><span class="linenos">333</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ChromaVectorDB.query-334"><a href="#ChromaVectorDB.query-334"><span class="linenos">334</span></a><span class="sd">        Search for similar documents in the ChromaDB collection.</span>
</span><span id="ChromaVectorDB.query-335"><a href="#ChromaVectorDB.query-335"><span class="linenos">335</span></a><span class="sd">        </span>
</span><span id="ChromaVectorDB.query-336"><a href="#ChromaVectorDB.query-336"><span class="linenos">336</span></a><span class="sd">        This method performs semantic search by converting the query to an</span>
</span><span id="ChromaVectorDB.query-337"><a href="#ChromaVectorDB.query-337"><span class="linenos">337</span></a><span class="sd">        embedding and finding the most similar document embeddings in the</span>
</span><span id="ChromaVectorDB.query-338"><a href="#ChromaVectorDB.query-338"><span class="linenos">338</span></a><span class="sd">        collection.</span>
</span><span id="ChromaVectorDB.query-339"><a href="#ChromaVectorDB.query-339"><span class="linenos">339</span></a><span class="sd">        </span>
</span><span id="ChromaVectorDB.query-340"><a href="#ChromaVectorDB.query-340"><span class="linenos">340</span></a><span class="sd">        Parameters:</span>
</span><span id="ChromaVectorDB.query-341"><a href="#ChromaVectorDB.query-341"><span class="linenos">341</span></a><span class="sd">        -----------</span>
</span><span id="ChromaVectorDB.query-342"><a href="#ChromaVectorDB.query-342"><span class="linenos">342</span></a><span class="sd">        query : str</span>
</span><span id="ChromaVectorDB.query-343"><a href="#ChromaVectorDB.query-343"><span class="linenos">343</span></a><span class="sd">            The text query to search for. This will be converted to a</span>
</span><span id="ChromaVectorDB.query-344"><a href="#ChromaVectorDB.query-344"><span class="linenos">344</span></a><span class="sd">            vector embedding and compared against stored documents.</span>
</span><span id="ChromaVectorDB.query-345"><a href="#ChromaVectorDB.query-345"><span class="linenos">345</span></a><span class="sd">            </span>
</span><span id="ChromaVectorDB.query-346"><a href="#ChromaVectorDB.query-346"><span class="linenos">346</span></a><span class="sd">        k : int, default=10</span>
</span><span id="ChromaVectorDB.query-347"><a href="#ChromaVectorDB.query-347"><span class="linenos">347</span></a><span class="sd">            Number of most similar documents to return. Higher values</span>
</span><span id="ChromaVectorDB.query-348"><a href="#ChromaVectorDB.query-348"><span class="linenos">348</span></a><span class="sd">            return more results but may include less relevant documents.</span>
</span><span id="ChromaVectorDB.query-349"><a href="#ChromaVectorDB.query-349"><span class="linenos">349</span></a><span class="sd">            </span>
</span><span id="ChromaVectorDB.query-350"><a href="#ChromaVectorDB.query-350"><span class="linenos">350</span></a><span class="sd">        Returns:</span>
</span><span id="ChromaVectorDB.query-351"><a href="#ChromaVectorDB.query-351"><span class="linenos">351</span></a><span class="sd">        --------</span>
</span><span id="ChromaVectorDB.query-352"><a href="#ChromaVectorDB.query-352"><span class="linenos">352</span></a><span class="sd">        Dict[str, Any]</span>
</span><span id="ChromaVectorDB.query-353"><a href="#ChromaVectorDB.query-353"><span class="linenos">353</span></a><span class="sd">            A dictionary containing search results with the following structure:</span>
</span><span id="ChromaVectorDB.query-354"><a href="#ChromaVectorDB.query-354"><span class="linenos">354</span></a><span class="sd">            {</span>
</span><span id="ChromaVectorDB.query-355"><a href="#ChromaVectorDB.query-355"><span class="linenos">355</span></a><span class="sd">                &#39;ids&#39;: List[List[str]] - Document IDs of retrieved documents,</span>
</span><span id="ChromaVectorDB.query-356"><a href="#ChromaVectorDB.query-356"><span class="linenos">356</span></a><span class="sd">                &#39;documents&#39;: List[List[str]] - The actual document content,</span>
</span><span id="ChromaVectorDB.query-357"><a href="#ChromaVectorDB.query-357"><span class="linenos">357</span></a><span class="sd">                &#39;metadatas&#39;: List[List[Dict]] - Metadata for each document,</span>
</span><span id="ChromaVectorDB.query-358"><a href="#ChromaVectorDB.query-358"><span class="linenos">358</span></a><span class="sd">                &#39;distances&#39;: List[List[float]] - Similarity scores (lower = more similar)</span>
</span><span id="ChromaVectorDB.query-359"><a href="#ChromaVectorDB.query-359"><span class="linenos">359</span></a><span class="sd">            }</span>
</span><span id="ChromaVectorDB.query-360"><a href="#ChromaVectorDB.query-360"><span class="linenos">360</span></a><span class="sd">            </span>
</span><span id="ChromaVectorDB.query-361"><a href="#ChromaVectorDB.query-361"><span class="linenos">361</span></a><span class="sd">        Examples:</span>
</span><span id="ChromaVectorDB.query-362"><a href="#ChromaVectorDB.query-362"><span class="linenos">362</span></a><span class="sd">        ---------</span>
</span><span id="ChromaVectorDB.query-363"><a href="#ChromaVectorDB.query-363"><span class="linenos">363</span></a><span class="sd">        ```python</span>
</span><span id="ChromaVectorDB.query-364"><a href="#ChromaVectorDB.query-364"><span class="linenos">364</span></a><span class="sd">        # Basic search</span>
</span><span id="ChromaVectorDB.query-365"><a href="#ChromaVectorDB.query-365"><span class="linenos">365</span></a><span class="sd">        results = vector_db.query(&quot;What is machine learning?&quot;, k=5)</span>
</span><span id="ChromaVectorDB.query-366"><a href="#ChromaVectorDB.query-366"><span class="linenos">366</span></a><span class="sd">        </span>
</span><span id="ChromaVectorDB.query-367"><a href="#ChromaVectorDB.query-367"><span class="linenos">367</span></a><span class="sd">        # Access results</span>
</span><span id="ChromaVectorDB.query-368"><a href="#ChromaVectorDB.query-368"><span class="linenos">368</span></a><span class="sd">        for i, (doc_id, document, metadata, distance) in enumerate(zip(</span>
</span><span id="ChromaVectorDB.query-369"><a href="#ChromaVectorDB.query-369"><span class="linenos">369</span></a><span class="sd">            results[&#39;ids&#39;][0], </span>
</span><span id="ChromaVectorDB.query-370"><a href="#ChromaVectorDB.query-370"><span class="linenos">370</span></a><span class="sd">            results[&#39;documents&#39;][0], </span>
</span><span id="ChromaVectorDB.query-371"><a href="#ChromaVectorDB.query-371"><span class="linenos">371</span></a><span class="sd">            results[&#39;metadatas&#39;][0], </span>
</span><span id="ChromaVectorDB.query-372"><a href="#ChromaVectorDB.query-372"><span class="linenos">372</span></a><span class="sd">            results[&#39;distances&#39;][0]</span>
</span><span id="ChromaVectorDB.query-373"><a href="#ChromaVectorDB.query-373"><span class="linenos">373</span></a><span class="sd">        )):</span>
</span><span id="ChromaVectorDB.query-374"><a href="#ChromaVectorDB.query-374"><span class="linenos">374</span></a><span class="sd">            print(f&quot;Result {i+1}:&quot;)</span>
</span><span id="ChromaVectorDB.query-375"><a href="#ChromaVectorDB.query-375"><span class="linenos">375</span></a><span class="sd">            print(f&quot;  ID: {doc_id}&quot;)</span>
</span><span id="ChromaVectorDB.query-376"><a href="#ChromaVectorDB.query-376"><span class="linenos">376</span></a><span class="sd">            print(f&quot;  Content: {document[:100]}...&quot;)</span>
</span><span id="ChromaVectorDB.query-377"><a href="#ChromaVectorDB.query-377"><span class="linenos">377</span></a><span class="sd">            print(f&quot;  Similarity: {1 - distance:.3f}&quot;)</span>
</span><span id="ChromaVectorDB.query-378"><a href="#ChromaVectorDB.query-378"><span class="linenos">378</span></a><span class="sd">            print(f&quot;  Metadata: {metadata}&quot;)</span>
</span><span id="ChromaVectorDB.query-379"><a href="#ChromaVectorDB.query-379"><span class="linenos">379</span></a><span class="sd">        ```</span>
</span><span id="ChromaVectorDB.query-380"><a href="#ChromaVectorDB.query-380"><span class="linenos">380</span></a><span class="sd">        </span>
</span><span id="ChromaVectorDB.query-381"><a href="#ChromaVectorDB.query-381"><span class="linenos">381</span></a><span class="sd">        Notes:</span>
</span><span id="ChromaVectorDB.query-382"><a href="#ChromaVectorDB.query-382"><span class="linenos">382</span></a><span class="sd">        ------</span>
</span><span id="ChromaVectorDB.query-383"><a href="#ChromaVectorDB.query-383"><span class="linenos">383</span></a><span class="sd">        - Results are returned in order of similarity (most similar first)</span>
</span><span id="ChromaVectorDB.query-384"><a href="#ChromaVectorDB.query-384"><span class="linenos">384</span></a><span class="sd">        - Distance scores are cosine distances (0 = identical, 2 = opposite)</span>
</span><span id="ChromaVectorDB.query-385"><a href="#ChromaVectorDB.query-385"><span class="linenos">385</span></a><span class="sd">        - If fewer than k documents exist, all available documents are returned</span>
</span><span id="ChromaVectorDB.query-386"><a href="#ChromaVectorDB.query-386"><span class="linenos">386</span></a><span class="sd">        - The query is automatically embedded using the same model as stored documents</span>
</span><span id="ChromaVectorDB.query-387"><a href="#ChromaVectorDB.query-387"><span class="linenos">387</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ChromaVectorDB.query-388"><a href="#ChromaVectorDB.query-388"><span class="linenos">388</span></a>        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
</span><span id="ChromaVectorDB.query-389"><a href="#ChromaVectorDB.query-389"><span class="linenos">389</span></a>            <span class="n">query_texts</span><span class="o">=</span><span class="n">query</span><span class="p">,</span>
</span><span id="ChromaVectorDB.query-390"><a href="#ChromaVectorDB.query-390"><span class="linenos">390</span></a>            <span class="n">n_results</span><span class="o">=</span><span class="n">k</span>
</span><span id="ChromaVectorDB.query-391"><a href="#ChromaVectorDB.query-391"><span class="linenos">391</span></a>        <span class="p">)</span>
</span><span id="ChromaVectorDB.query-392"><a href="#ChromaVectorDB.query-392"><span class="linenos">392</span></a>        <span class="k">return</span> <span class="n">results</span>
</span></pre></div>


            <div class="docstring"><p>Search for similar documents in the ChromaDB collection.</p>

<p>This method performs semantic search by converting the query to an
embedding and finding the most similar document embeddings in the
collection.</p>

<h2 id="parameters">Parameters:</h2>

<p>query : str
    The text query to search for. This will be converted to a
    vector embedding and compared against stored documents.</p>

<p>k : int, default=10
    Number of most similar documents to return. Higher values
    return more results but may include less relevant documents.</p>

<h2 id="returns">Returns:</h2>

<p>Dict[str, Any]
    A dictionary containing search results with the following structure:
    {
        'ids': List[List[str]] - Document IDs of retrieved documents,
        'documents': List[List[str]] - The actual document content,
        'metadatas': List[List[Dict]] - Metadata for each document,
        'distances': List[List[float]] - Similarity scores (lower = more similar)
    }</p>

<h2 id="examples">Examples:</h2>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="c1"># Basic search</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">vector_db</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;What is machine learning?&quot;</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="c1"># Access results</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">doc_id</span><span class="p">,</span> <span class="n">document</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">distance</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> 
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;documents&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> 
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;metadatas&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> 
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;distances&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="p">)):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Result </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  ID: </span><span class="si">{</span><span class="n">doc_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Content: </span><span class="si">{</span><span class="n">document</span><span class="p">[:</span><span class="mi">100</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Similarity: </span><span class="si">{</span><span class="mi">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">distance</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Metadata: </span><span class="si">{</span><span class="n">metadata</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre>
</div>

<h2 id="notes">Notes:</h2>

<ul>
<li>Results are returned in order of similarity (most similar first)</li>
<li>Distance scores are cosine distances (0 = identical, 2 = opposite)</li>
<li>If fewer than k documents exist, all available documents are returned</li>
<li>The query is automatically embedded using the same model as stored documents</li>
</ul>
</div>


                            </div>
                </section>
                <section id="DocumentsBuilder">
                            <input id="DocumentsBuilder-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">DocumentsBuilder</span>:

                <label class="view-source-button" for="DocumentsBuilder-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DocumentsBuilder"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DocumentsBuilder-14"><a href="#DocumentsBuilder-14"><span class="linenos"> 14</span></a><span class="k">class</span><span class="w"> </span><span class="nc">DocumentsBuilder</span><span class="p">:</span>
</span><span id="DocumentsBuilder-15"><a href="#DocumentsBuilder-15"><span class="linenos"> 15</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DocumentsBuilder-16"><a href="#DocumentsBuilder-16"><span class="linenos"> 16</span></a><span class="sd">    A utility class for building document collections from various sources.</span>
</span><span id="DocumentsBuilder-17"><a href="#DocumentsBuilder-17"><span class="linenos"> 17</span></a><span class="sd">    </span>
</span><span id="DocumentsBuilder-18"><a href="#DocumentsBuilder-18"><span class="linenos"> 18</span></a><span class="sd">    This class provides methods to extract text content from files and web pages,</span>
</span><span id="DocumentsBuilder-19"><a href="#DocumentsBuilder-19"><span class="linenos"> 19</span></a><span class="sd">    split the content into manageable chunks with configurable size and overlap,</span>
</span><span id="DocumentsBuilder-20"><a href="#DocumentsBuilder-20"><span class="linenos"> 20</span></a><span class="sd">    and prepare the data for storage in vector databases.</span>
</span><span id="DocumentsBuilder-21"><a href="#DocumentsBuilder-21"><span class="linenos"> 21</span></a><span class="sd">    </span>
</span><span id="DocumentsBuilder-22"><a href="#DocumentsBuilder-22"><span class="linenos"> 22</span></a><span class="sd">    The DocumentsBuilder is designed to work seamlessly with the RAG system,</span>
</span><span id="DocumentsBuilder-23"><a href="#DocumentsBuilder-23"><span class="linenos"> 23</span></a><span class="sd">    producing output that can be directly used with vector database operations.</span>
</span><span id="DocumentsBuilder-24"><a href="#DocumentsBuilder-24"><span class="linenos"> 24</span></a><span class="sd">    </span>
</span><span id="DocumentsBuilder-25"><a href="#DocumentsBuilder-25"><span class="linenos"> 25</span></a><span class="sd">    Features:</span>
</span><span id="DocumentsBuilder-26"><a href="#DocumentsBuilder-26"><span class="linenos"> 26</span></a><span class="sd">    - File-based document extraction with UTF-8 encoding support</span>
</span><span id="DocumentsBuilder-27"><a href="#DocumentsBuilder-27"><span class="linenos"> 27</span></a><span class="sd">    - Text string processing for in-memory content</span>
</span><span id="DocumentsBuilder-28"><a href="#DocumentsBuilder-28"><span class="linenos"> 28</span></a><span class="sd">    - Web scraping with multiple engine options (requests, tavily, selenium)</span>
</span><span id="DocumentsBuilder-29"><a href="#DocumentsBuilder-29"><span class="linenos"> 29</span></a><span class="sd">    - Word document extraction (.doc and .docx formats)</span>
</span><span id="DocumentsBuilder-30"><a href="#DocumentsBuilder-30"><span class="linenos"> 30</span></a><span class="sd">    - PDF document extraction with metadata</span>
</span><span id="DocumentsBuilder-31"><a href="#DocumentsBuilder-31"><span class="linenos"> 31</span></a><span class="sd">    - Multiple chunking strategies (word, sentence, paragraph, fixed, semantic)</span>
</span><span id="DocumentsBuilder-32"><a href="#DocumentsBuilder-32"><span class="linenos"> 32</span></a><span class="sd">    - Configurable chunk size and overlap parameters</span>
</span><span id="DocumentsBuilder-33"><a href="#DocumentsBuilder-33"><span class="linenos"> 33</span></a><span class="sd">    - Rich metadata generation for each document chunk</span>
</span><span id="DocumentsBuilder-34"><a href="#DocumentsBuilder-34"><span class="linenos"> 34</span></a><span class="sd">    - Unique ID generation for database storage</span>
</span><span id="DocumentsBuilder-35"><a href="#DocumentsBuilder-35"><span class="linenos"> 35</span></a><span class="sd">    </span>
</span><span id="DocumentsBuilder-36"><a href="#DocumentsBuilder-36"><span class="linenos"> 36</span></a><span class="sd">    Attributes:</span>
</span><span id="DocumentsBuilder-37"><a href="#DocumentsBuilder-37"><span class="linenos"> 37</span></a><span class="sd">        _chunk_strategy (str): The chunking strategy to use</span>
</span><span id="DocumentsBuilder-38"><a href="#DocumentsBuilder-38"><span class="linenos"> 38</span></a><span class="sd">        _chunk_size (int): Maximum size of each text chunk in characters</span>
</span><span id="DocumentsBuilder-39"><a href="#DocumentsBuilder-39"><span class="linenos"> 39</span></a><span class="sd">        _chunk_overlap (int): Number of characters to overlap between chunks</span>
</span><span id="DocumentsBuilder-40"><a href="#DocumentsBuilder-40"><span class="linenos"> 40</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="DocumentsBuilder-41"><a href="#DocumentsBuilder-41"><span class="linenos"> 41</span></a>
</span><span id="DocumentsBuilder-42"><a href="#DocumentsBuilder-42"><span class="linenos"> 42</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="DocumentsBuilder-43"><a href="#DocumentsBuilder-43"><span class="linenos"> 43</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="DocumentsBuilder-44"><a href="#DocumentsBuilder-44"><span class="linenos"> 44</span></a>        <span class="n">chunk_strategy</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;word&quot;</span><span class="p">,</span>
</span><span id="DocumentsBuilder-45"><a href="#DocumentsBuilder-45"><span class="linenos"> 45</span></a>        <span class="n">chunk_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
</span><span id="DocumentsBuilder-46"><a href="#DocumentsBuilder-46"><span class="linenos"> 46</span></a>        <span class="n">chunk_overlap</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="DocumentsBuilder-47"><a href="#DocumentsBuilder-47"><span class="linenos"> 47</span></a>        <span class="n">custom_split_func</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="DocumentsBuilder-48"><a href="#DocumentsBuilder-48"><span class="linenos"> 48</span></a>    <span class="p">):</span>
</span><span id="DocumentsBuilder-49"><a href="#DocumentsBuilder-49"><span class="linenos"> 49</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DocumentsBuilder-50"><a href="#DocumentsBuilder-50"><span class="linenos"> 50</span></a><span class="sd">        Initialize the DocumentsBuilder with chunking parameters.</span>
</span><span id="DocumentsBuilder-51"><a href="#DocumentsBuilder-51"><span class="linenos"> 51</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DocumentsBuilder-52"><a href="#DocumentsBuilder-52"><span class="linenos"> 52</span></a>        <span class="c1"># If custom_split_func is provided, automatically set strategy to &quot;custom&quot;</span>
</span><span id="DocumentsBuilder-53"><a href="#DocumentsBuilder-53"><span class="linenos"> 53</span></a>        <span class="k">if</span> <span class="n">custom_split_func</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DocumentsBuilder-54"><a href="#DocumentsBuilder-54"><span class="linenos"> 54</span></a>            <span class="n">chunk_strategy</span> <span class="o">=</span> <span class="s2">&quot;custom&quot;</span>
</span><span id="DocumentsBuilder-55"><a href="#DocumentsBuilder-55"><span class="linenos"> 55</span></a>        
</span><span id="DocumentsBuilder-56"><a href="#DocumentsBuilder-56"><span class="linenos"> 56</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_chunk_strategy</span> <span class="o">=</span> <span class="n">chunk_strategy</span>
</span><span id="DocumentsBuilder-57"><a href="#DocumentsBuilder-57"><span class="linenos"> 57</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_chunk_size</span> <span class="o">=</span> <span class="n">chunk_size</span>
</span><span id="DocumentsBuilder-58"><a href="#DocumentsBuilder-58"><span class="linenos"> 58</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_chunk_overlap</span> <span class="o">=</span> <span class="n">chunk_overlap</span>
</span><span id="DocumentsBuilder-59"><a href="#DocumentsBuilder-59"><span class="linenos"> 59</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_custom_split_func</span> <span class="o">=</span> <span class="n">custom_split_func</span>
</span><span id="DocumentsBuilder-60"><a href="#DocumentsBuilder-60"><span class="linenos"> 60</span></a>
</span><span id="DocumentsBuilder-61"><a href="#DocumentsBuilder-61"><span class="linenos"> 61</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_module_cache</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">object</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="DocumentsBuilder-62"><a href="#DocumentsBuilder-62"><span class="linenos"> 62</span></a>        
</span><span id="DocumentsBuilder-63"><a href="#DocumentsBuilder-63"><span class="linenos"> 63</span></a>        <span class="k">if</span> <span class="n">chunk_overlap</span> <span class="o">&gt;=</span> <span class="n">chunk_size</span><span class="p">:</span>
</span><span id="DocumentsBuilder-64"><a href="#DocumentsBuilder-64"><span class="linenos"> 64</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="DocumentsBuilder-65"><a href="#DocumentsBuilder-65"><span class="linenos"> 65</span></a>                <span class="sa">f</span><span class="s2">&quot;chunk_overlap (</span><span class="si">{</span><span class="n">chunk_overlap</span><span class="si">}</span><span class="s2">) must be less than chunk_size (</span><span class="si">{</span><span class="n">chunk_size</span><span class="si">}</span><span class="s2">) &quot;</span>
</span><span id="DocumentsBuilder-66"><a href="#DocumentsBuilder-66"><span class="linenos"> 66</span></a>                <span class="s2">&quot;to prevent infinite loops. Recommended: chunk_overlap should be 10-20</span><span class="si">% o</span><span class="s2">f chunk_size.&quot;</span>
</span><span id="DocumentsBuilder-67"><a href="#DocumentsBuilder-67"><span class="linenos"> 67</span></a>            <span class="p">)</span>
</span><span id="DocumentsBuilder-68"><a href="#DocumentsBuilder-68"><span class="linenos"> 68</span></a>        
</span><span id="DocumentsBuilder-69"><a href="#DocumentsBuilder-69"><span class="linenos"> 69</span></a>        <span class="k">if</span> <span class="n">chunk_size</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="DocumentsBuilder-70"><a href="#DocumentsBuilder-70"><span class="linenos"> 70</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;chunk_size must be positive, got </span><span class="si">{</span><span class="n">chunk_size</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="DocumentsBuilder-71"><a href="#DocumentsBuilder-71"><span class="linenos"> 71</span></a>        
</span><span id="DocumentsBuilder-72"><a href="#DocumentsBuilder-72"><span class="linenos"> 72</span></a>        <span class="k">if</span> <span class="n">chunk_overlap</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="DocumentsBuilder-73"><a href="#DocumentsBuilder-73"><span class="linenos"> 73</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;chunk_overlap must be non-negative, got </span><span class="si">{</span><span class="n">chunk_overlap</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="DocumentsBuilder-74"><a href="#DocumentsBuilder-74"><span class="linenos"> 74</span></a>        
</span><span id="DocumentsBuilder-75"><a href="#DocumentsBuilder-75"><span class="linenos"> 75</span></a>        <span class="k">if</span> <span class="n">chunk_strategy</span> <span class="o">==</span> <span class="s2">&quot;custom&quot;</span> <span class="ow">and</span> <span class="n">custom_split_func</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DocumentsBuilder-76"><a href="#DocumentsBuilder-76"><span class="linenos"> 76</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;custom_split_func must be provided when chunk_strategy=&#39;custom&#39;&quot;</span><span class="p">)</span>
</span><span id="DocumentsBuilder-77"><a href="#DocumentsBuilder-77"><span class="linenos"> 77</span></a>        
</span><span id="DocumentsBuilder-78"><a href="#DocumentsBuilder-78"><span class="linenos"> 78</span></a>        <span class="k">if</span> <span class="n">custom_split_func</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">custom_split_func</span><span class="p">):</span>
</span><span id="DocumentsBuilder-79"><a href="#DocumentsBuilder-79"><span class="linenos"> 79</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;custom_split_func must be callable&quot;</span><span class="p">)</span>
</span><span id="DocumentsBuilder-80"><a href="#DocumentsBuilder-80"><span class="linenos"> 80</span></a>
</span><span id="DocumentsBuilder-81"><a href="#DocumentsBuilder-81"><span class="linenos"> 81</span></a>    <span class="c1"># ---------- Lazy import helpers ----------</span>
</span><span id="DocumentsBuilder-82"><a href="#DocumentsBuilder-82"><span class="linenos"> 82</span></a>    <span class="nd">@staticmethod</span>
</span><span id="DocumentsBuilder-83"><a href="#DocumentsBuilder-83"><span class="linenos"> 83</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_has_module</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="DocumentsBuilder-84"><a href="#DocumentsBuilder-84"><span class="linenos"> 84</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Rileva se un modulo è installato senza importarlo completamente.&quot;&quot;&quot;</span>
</span><span id="DocumentsBuilder-85"><a href="#DocumentsBuilder-85"><span class="linenos"> 85</span></a>        <span class="n">spec</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">find_spec</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span><span id="DocumentsBuilder-86"><a href="#DocumentsBuilder-86"><span class="linenos"> 86</span></a>        <span class="k">return</span> <span class="n">spec</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="DocumentsBuilder-87"><a href="#DocumentsBuilder-87"><span class="linenos"> 87</span></a>
</span><span id="DocumentsBuilder-88"><a href="#DocumentsBuilder-88"><span class="linenos"> 88</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_module</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="DocumentsBuilder-89"><a href="#DocumentsBuilder-89"><span class="linenos"> 89</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Importa pigramente un modulo e lo cache-izza.&quot;&quot;&quot;</span>
</span><span id="DocumentsBuilder-90"><a href="#DocumentsBuilder-90"><span class="linenos"> 90</span></a>        <span class="n">mod</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_module_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span><span id="DocumentsBuilder-91"><a href="#DocumentsBuilder-91"><span class="linenos"> 91</span></a>        <span class="k">if</span> <span class="n">mod</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DocumentsBuilder-92"><a href="#DocumentsBuilder-92"><span class="linenos"> 92</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="DocumentsBuilder-93"><a href="#DocumentsBuilder-93"><span class="linenos"> 93</span></a>                <span class="n">mod</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span><span id="DocumentsBuilder-94"><a href="#DocumentsBuilder-94"><span class="linenos"> 94</span></a>            <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="DocumentsBuilder-95"><a href="#DocumentsBuilder-95"><span class="linenos"> 95</span></a>                <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>
</span><span id="DocumentsBuilder-96"><a href="#DocumentsBuilder-96"><span class="linenos"> 96</span></a>                    <span class="sa">f</span><span class="s2">&quot;Il modulo &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; è richiesto per questa operazione. &quot;</span>
</span><span id="DocumentsBuilder-97"><a href="#DocumentsBuilder-97"><span class="linenos"> 97</span></a>                    <span class="sa">f</span><span class="s2">&quot;Installa con: pip install </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="DocumentsBuilder-98"><a href="#DocumentsBuilder-98"><span class="linenos"> 98</span></a>                <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</span><span id="DocumentsBuilder-99"><a href="#DocumentsBuilder-99"><span class="linenos"> 99</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_module_cache</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">mod</span>
</span><span id="DocumentsBuilder-100"><a href="#DocumentsBuilder-100"><span class="linenos">100</span></a>        <span class="k">return</span> <span class="n">mod</span>
</span><span id="DocumentsBuilder-101"><a href="#DocumentsBuilder-101"><span class="linenos">101</span></a>
</span><span id="DocumentsBuilder-102"><a href="#DocumentsBuilder-102"><span class="linenos">102</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">from_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
</span><span id="DocumentsBuilder-103"><a href="#DocumentsBuilder-103"><span class="linenos">103</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DocumentsBuilder-104"><a href="#DocumentsBuilder-104"><span class="linenos">104</span></a><span class="sd">        Read a file and split it into chunks with specified size and overlap.</span>
</span><span id="DocumentsBuilder-105"><a href="#DocumentsBuilder-105"><span class="linenos">105</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DocumentsBuilder-106"><a href="#DocumentsBuilder-106"><span class="linenos">106</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
</span><span id="DocumentsBuilder-107"><a href="#DocumentsBuilder-107"><span class="linenos">107</span></a>            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File not found: </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="DocumentsBuilder-108"><a href="#DocumentsBuilder-108"><span class="linenos">108</span></a>        
</span><span id="DocumentsBuilder-109"><a href="#DocumentsBuilder-109"><span class="linenos">109</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="DocumentsBuilder-110"><a href="#DocumentsBuilder-110"><span class="linenos">110</span></a>            <span class="n">text</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="DocumentsBuilder-111"><a href="#DocumentsBuilder-111"><span class="linenos">111</span></a>        
</span><span id="DocumentsBuilder-112"><a href="#DocumentsBuilder-112"><span class="linenos">112</span></a>        <span class="n">chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_split_text</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</span><span id="DocumentsBuilder-113"><a href="#DocumentsBuilder-113"><span class="linenos">113</span></a>        
</span><span id="DocumentsBuilder-114"><a href="#DocumentsBuilder-114"><span class="linenos">114</span></a>        <span class="n">documents</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DocumentsBuilder-115"><a href="#DocumentsBuilder-115"><span class="linenos">115</span></a>        <span class="n">metadatas</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DocumentsBuilder-116"><a href="#DocumentsBuilder-116"><span class="linenos">116</span></a>        <span class="n">ids</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DocumentsBuilder-117"><a href="#DocumentsBuilder-117"><span class="linenos">117</span></a>        
</span><span id="DocumentsBuilder-118"><a href="#DocumentsBuilder-118"><span class="linenos">118</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">chunks</span><span class="p">):</span>
</span><span id="DocumentsBuilder-119"><a href="#DocumentsBuilder-119"><span class="linenos">119</span></a>            <span class="n">chunk_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
</span><span id="DocumentsBuilder-120"><a href="#DocumentsBuilder-120"><span class="linenos">120</span></a>            <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="DocumentsBuilder-121"><a href="#DocumentsBuilder-121"><span class="linenos">121</span></a>                <span class="s1">&#39;file_path&#39;</span><span class="p">:</span> <span class="n">file_path</span><span class="p">,</span>
</span><span id="DocumentsBuilder-122"><a href="#DocumentsBuilder-122"><span class="linenos">122</span></a>                <span class="s1">&#39;file_name&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file_path</span><span class="p">),</span>
</span><span id="DocumentsBuilder-123"><a href="#DocumentsBuilder-123"><span class="linenos">123</span></a>                <span class="s1">&#39;chunk_index&#39;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span>
</span><span id="DocumentsBuilder-124"><a href="#DocumentsBuilder-124"><span class="linenos">124</span></a>                <span class="s1">&#39;total_chunks&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunks</span><span class="p">),</span>
</span><span id="DocumentsBuilder-125"><a href="#DocumentsBuilder-125"><span class="linenos">125</span></a>                <span class="s1">&#39;chunk_size&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
</span><span id="DocumentsBuilder-126"><a href="#DocumentsBuilder-126"><span class="linenos">126</span></a>            <span class="p">}</span>
</span><span id="DocumentsBuilder-127"><a href="#DocumentsBuilder-127"><span class="linenos">127</span></a>            <span class="n">documents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
</span><span id="DocumentsBuilder-128"><a href="#DocumentsBuilder-128"><span class="linenos">128</span></a>            <span class="n">metadatas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span>
</span><span id="DocumentsBuilder-129"><a href="#DocumentsBuilder-129"><span class="linenos">129</span></a>            <span class="n">ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk_id</span><span class="p">)</span>
</span><span id="DocumentsBuilder-130"><a href="#DocumentsBuilder-130"><span class="linenos">130</span></a>        
</span><span id="DocumentsBuilder-131"><a href="#DocumentsBuilder-131"><span class="linenos">131</span></a>        <span class="k">return</span> <span class="n">documents</span><span class="p">,</span> <span class="n">metadatas</span><span class="p">,</span> <span class="n">ids</span>
</span><span id="DocumentsBuilder-132"><a href="#DocumentsBuilder-132"><span class="linenos">132</span></a>
</span><span id="DocumentsBuilder-133"><a href="#DocumentsBuilder-133"><span class="linenos">133</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">from_str</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">source_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;text_string&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
</span><span id="DocumentsBuilder-134"><a href="#DocumentsBuilder-134"><span class="linenos">134</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DocumentsBuilder-135"><a href="#DocumentsBuilder-135"><span class="linenos">135</span></a><span class="sd">        Process a text string and split it into chunks with specified size and overlap.</span>
</span><span id="DocumentsBuilder-136"><a href="#DocumentsBuilder-136"><span class="linenos">136</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DocumentsBuilder-137"><a href="#DocumentsBuilder-137"><span class="linenos">137</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">text</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
</span><span id="DocumentsBuilder-138"><a href="#DocumentsBuilder-138"><span class="linenos">138</span></a>            <span class="k">return</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
</span><span id="DocumentsBuilder-139"><a href="#DocumentsBuilder-139"><span class="linenos">139</span></a>        
</span><span id="DocumentsBuilder-140"><a href="#DocumentsBuilder-140"><span class="linenos">140</span></a>        <span class="n">chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_split_text</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</span><span id="DocumentsBuilder-141"><a href="#DocumentsBuilder-141"><span class="linenos">141</span></a>        
</span><span id="DocumentsBuilder-142"><a href="#DocumentsBuilder-142"><span class="linenos">142</span></a>        <span class="n">documents</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DocumentsBuilder-143"><a href="#DocumentsBuilder-143"><span class="linenos">143</span></a>        <span class="n">metadatas</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DocumentsBuilder-144"><a href="#DocumentsBuilder-144"><span class="linenos">144</span></a>        <span class="n">ids</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DocumentsBuilder-145"><a href="#DocumentsBuilder-145"><span class="linenos">145</span></a>        
</span><span id="DocumentsBuilder-146"><a href="#DocumentsBuilder-146"><span class="linenos">146</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">chunks</span><span class="p">):</span>
</span><span id="DocumentsBuilder-147"><a href="#DocumentsBuilder-147"><span class="linenos">147</span></a>            <span class="n">chunk_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
</span><span id="DocumentsBuilder-148"><a href="#DocumentsBuilder-148"><span class="linenos">148</span></a>            <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="DocumentsBuilder-149"><a href="#DocumentsBuilder-149"><span class="linenos">149</span></a>                <span class="s1">&#39;source_type&#39;</span><span class="p">:</span> <span class="s1">&#39;text_string&#39;</span><span class="p">,</span>
</span><span id="DocumentsBuilder-150"><a href="#DocumentsBuilder-150"><span class="linenos">150</span></a>                <span class="s1">&#39;source_name&#39;</span><span class="p">:</span> <span class="n">source_name</span><span class="p">,</span>
</span><span id="DocumentsBuilder-151"><a href="#DocumentsBuilder-151"><span class="linenos">151</span></a>                <span class="s1">&#39;chunk_index&#39;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span>
</span><span id="DocumentsBuilder-152"><a href="#DocumentsBuilder-152"><span class="linenos">152</span></a>                <span class="s1">&#39;total_chunks&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunks</span><span class="p">),</span>
</span><span id="DocumentsBuilder-153"><a href="#DocumentsBuilder-153"><span class="linenos">153</span></a>                <span class="s1">&#39;chunk_size&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunk</span><span class="p">),</span>
</span><span id="DocumentsBuilder-154"><a href="#DocumentsBuilder-154"><span class="linenos">154</span></a>                <span class="s1">&#39;chunk_strategy&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chunk_strategy</span>
</span><span id="DocumentsBuilder-155"><a href="#DocumentsBuilder-155"><span class="linenos">155</span></a>            <span class="p">}</span>
</span><span id="DocumentsBuilder-156"><a href="#DocumentsBuilder-156"><span class="linenos">156</span></a>            <span class="n">documents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
</span><span id="DocumentsBuilder-157"><a href="#DocumentsBuilder-157"><span class="linenos">157</span></a>            <span class="n">metadatas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span>
</span><span id="DocumentsBuilder-158"><a href="#DocumentsBuilder-158"><span class="linenos">158</span></a>            <span class="n">ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk_id</span><span class="p">)</span>
</span><span id="DocumentsBuilder-159"><a href="#DocumentsBuilder-159"><span class="linenos">159</span></a>        
</span><span id="DocumentsBuilder-160"><a href="#DocumentsBuilder-160"><span class="linenos">160</span></a>        <span class="k">return</span> <span class="n">documents</span><span class="p">,</span> <span class="n">metadatas</span><span class="p">,</span> <span class="n">ids</span>
</span><span id="DocumentsBuilder-161"><a href="#DocumentsBuilder-161"><span class="linenos">161</span></a>
</span><span id="DocumentsBuilder-162"><a href="#DocumentsBuilder-162"><span class="linenos">162</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">from_doc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">extraction_method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;auto&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
</span><span id="DocumentsBuilder-163"><a href="#DocumentsBuilder-163"><span class="linenos">163</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DocumentsBuilder-164"><a href="#DocumentsBuilder-164"><span class="linenos">164</span></a><span class="sd">        Extract text from Word documents (.doc and .docx files) and split into chunks.</span>
</span><span id="DocumentsBuilder-165"><a href="#DocumentsBuilder-165"><span class="linenos">165</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DocumentsBuilder-166"><a href="#DocumentsBuilder-166"><span class="linenos">166</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
</span><span id="DocumentsBuilder-167"><a href="#DocumentsBuilder-167"><span class="linenos">167</span></a>            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File not found: </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="DocumentsBuilder-168"><a href="#DocumentsBuilder-168"><span class="linenos">168</span></a>        
</span><span id="DocumentsBuilder-169"><a href="#DocumentsBuilder-169"><span class="linenos">169</span></a>        <span class="n">file_extension</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">file_path</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="DocumentsBuilder-170"><a href="#DocumentsBuilder-170"><span class="linenos">170</span></a>        <span class="k">if</span> <span class="n">file_extension</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;.doc&#39;</span><span class="p">,</span> <span class="s1">&#39;.docx&#39;</span><span class="p">]:</span>
</span><span id="DocumentsBuilder-171"><a href="#DocumentsBuilder-171"><span class="linenos">171</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported file format: </span><span class="si">{</span><span class="n">file_extension</span><span class="si">}</span><span class="s2">. Only .doc and .docx files are supported.&quot;</span><span class="p">)</span>
</span><span id="DocumentsBuilder-172"><a href="#DocumentsBuilder-172"><span class="linenos">172</span></a>        
</span><span id="DocumentsBuilder-173"><a href="#DocumentsBuilder-173"><span class="linenos">173</span></a>        <span class="c1"># Selezione metodo al volo con lazy detection</span>
</span><span id="DocumentsBuilder-174"><a href="#DocumentsBuilder-174"><span class="linenos">174</span></a>        <span class="k">if</span> <span class="n">extraction_method</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span><span class="p">:</span>
</span><span id="DocumentsBuilder-175"><a href="#DocumentsBuilder-175"><span class="linenos">175</span></a>            <span class="k">if</span> <span class="n">file_extension</span> <span class="o">==</span> <span class="s1">&#39;.docx&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_module</span><span class="p">(</span><span class="s2">&quot;docx&quot;</span><span class="p">):</span>
</span><span id="DocumentsBuilder-176"><a href="#DocumentsBuilder-176"><span class="linenos">176</span></a>                <span class="n">extraction_method</span> <span class="o">=</span> <span class="s2">&quot;docx&quot;</span>
</span><span id="DocumentsBuilder-177"><a href="#DocumentsBuilder-177"><span class="linenos">177</span></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_module</span><span class="p">(</span><span class="s2">&quot;docx2txt&quot;</span><span class="p">):</span>
</span><span id="DocumentsBuilder-178"><a href="#DocumentsBuilder-178"><span class="linenos">178</span></a>                <span class="n">extraction_method</span> <span class="o">=</span> <span class="s2">&quot;docx2txt&quot;</span>
</span><span id="DocumentsBuilder-179"><a href="#DocumentsBuilder-179"><span class="linenos">179</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DocumentsBuilder-180"><a href="#DocumentsBuilder-180"><span class="linenos">180</span></a>                <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>
</span><span id="DocumentsBuilder-181"><a href="#DocumentsBuilder-181"><span class="linenos">181</span></a>                    <span class="s2">&quot;docx2txt is required for .docx file extraction. Install with: pip install docx2txt&quot;</span>
</span><span id="DocumentsBuilder-182"><a href="#DocumentsBuilder-182"><span class="linenos">182</span></a>                <span class="p">)</span>
</span><span id="DocumentsBuilder-183"><a href="#DocumentsBuilder-183"><span class="linenos">183</span></a>        
</span><span id="DocumentsBuilder-184"><a href="#DocumentsBuilder-184"><span class="linenos">184</span></a>        <span class="k">if</span> <span class="n">extraction_method</span> <span class="o">==</span> <span class="s2">&quot;docx&quot;</span><span class="p">:</span>
</span><span id="DocumentsBuilder-185"><a href="#DocumentsBuilder-185"><span class="linenos">185</span></a>            <span class="k">if</span> <span class="n">file_extension</span> <span class="o">!=</span> <span class="s1">&#39;.docx&#39;</span><span class="p">:</span>
</span><span id="DocumentsBuilder-186"><a href="#DocumentsBuilder-186"><span class="linenos">186</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&#39;docx&#39; extraction method only supports .docx files&quot;</span><span class="p">)</span>
</span><span id="DocumentsBuilder-187"><a href="#DocumentsBuilder-187"><span class="linenos">187</span></a>            <span class="n">text</span><span class="p">,</span> <span class="n">doc_properties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_with_docx</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="DocumentsBuilder-188"><a href="#DocumentsBuilder-188"><span class="linenos">188</span></a>        <span class="k">elif</span> <span class="n">extraction_method</span> <span class="o">==</span> <span class="s2">&quot;docx2txt&quot;</span><span class="p">:</span>
</span><span id="DocumentsBuilder-189"><a href="#DocumentsBuilder-189"><span class="linenos">189</span></a>            <span class="n">text</span><span class="p">,</span> <span class="n">doc_properties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_with_docx2txt</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="DocumentsBuilder-190"><a href="#DocumentsBuilder-190"><span class="linenos">190</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DocumentsBuilder-191"><a href="#DocumentsBuilder-191"><span class="linenos">191</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported extraction method: </span><span class="si">{</span><span class="n">extraction_method</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="DocumentsBuilder-192"><a href="#DocumentsBuilder-192"><span class="linenos">192</span></a>        
</span><span id="DocumentsBuilder-193"><a href="#DocumentsBuilder-193"><span class="linenos">193</span></a>        <span class="n">chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_split_text</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</span><span id="DocumentsBuilder-194"><a href="#DocumentsBuilder-194"><span class="linenos">194</span></a>        
</span><span id="DocumentsBuilder-195"><a href="#DocumentsBuilder-195"><span class="linenos">195</span></a>        <span class="n">documents</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DocumentsBuilder-196"><a href="#DocumentsBuilder-196"><span class="linenos">196</span></a>        <span class="n">metadatas</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DocumentsBuilder-197"><a href="#DocumentsBuilder-197"><span class="linenos">197</span></a>        <span class="n">ids</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DocumentsBuilder-198"><a href="#DocumentsBuilder-198"><span class="linenos">198</span></a>        
</span><span id="DocumentsBuilder-199"><a href="#DocumentsBuilder-199"><span class="linenos">199</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">chunks</span><span class="p">):</span>
</span><span id="DocumentsBuilder-200"><a href="#DocumentsBuilder-200"><span class="linenos">200</span></a>            <span class="n">chunk_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
</span><span id="DocumentsBuilder-201"><a href="#DocumentsBuilder-201"><span class="linenos">201</span></a>            <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="DocumentsBuilder-202"><a href="#DocumentsBuilder-202"><span class="linenos">202</span></a>                <span class="s1">&#39;file_path&#39;</span><span class="p">:</span> <span class="n">file_path</span><span class="p">,</span>
</span><span id="DocumentsBuilder-203"><a href="#DocumentsBuilder-203"><span class="linenos">203</span></a>                <span class="s1">&#39;file_name&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file_path</span><span class="p">),</span>
</span><span id="DocumentsBuilder-204"><a href="#DocumentsBuilder-204"><span class="linenos">204</span></a>                <span class="s1">&#39;document_format&#39;</span><span class="p">:</span> <span class="n">file_extension</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span>  <span class="c1"># Remove the dot</span>
</span><span id="DocumentsBuilder-205"><a href="#DocumentsBuilder-205"><span class="linenos">205</span></a>                <span class="s1">&#39;extraction_method&#39;</span><span class="p">:</span> <span class="n">extraction_method</span><span class="p">,</span>
</span><span id="DocumentsBuilder-206"><a href="#DocumentsBuilder-206"><span class="linenos">206</span></a>                <span class="s1">&#39;chunk_index&#39;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span>
</span><span id="DocumentsBuilder-207"><a href="#DocumentsBuilder-207"><span class="linenos">207</span></a>                <span class="s1">&#39;total_chunks&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunks</span><span class="p">),</span>
</span><span id="DocumentsBuilder-208"><a href="#DocumentsBuilder-208"><span class="linenos">208</span></a>                <span class="s1">&#39;chunk_size&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
</span><span id="DocumentsBuilder-209"><a href="#DocumentsBuilder-209"><span class="linenos">209</span></a>            <span class="p">}</span>
</span><span id="DocumentsBuilder-210"><a href="#DocumentsBuilder-210"><span class="linenos">210</span></a>            <span class="k">if</span> <span class="n">doc_properties</span><span class="p">:</span>
</span><span id="DocumentsBuilder-211"><a href="#DocumentsBuilder-211"><span class="linenos">211</span></a>                <span class="n">metadata</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">doc_properties</span><span class="p">)</span>
</span><span id="DocumentsBuilder-212"><a href="#DocumentsBuilder-212"><span class="linenos">212</span></a>            
</span><span id="DocumentsBuilder-213"><a href="#DocumentsBuilder-213"><span class="linenos">213</span></a>            <span class="n">documents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
</span><span id="DocumentsBuilder-214"><a href="#DocumentsBuilder-214"><span class="linenos">214</span></a>            <span class="n">metadatas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span>
</span><span id="DocumentsBuilder-215"><a href="#DocumentsBuilder-215"><span class="linenos">215</span></a>            <span class="n">ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk_id</span><span class="p">)</span>
</span><span id="DocumentsBuilder-216"><a href="#DocumentsBuilder-216"><span class="linenos">216</span></a>        
</span><span id="DocumentsBuilder-217"><a href="#DocumentsBuilder-217"><span class="linenos">217</span></a>        <span class="k">return</span> <span class="n">documents</span><span class="p">,</span> <span class="n">metadatas</span><span class="p">,</span> <span class="n">ids</span>
</span><span id="DocumentsBuilder-218"><a href="#DocumentsBuilder-218"><span class="linenos">218</span></a>
</span><span id="DocumentsBuilder-219"><a href="#DocumentsBuilder-219"><span class="linenos">219</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">from_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">page_range</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
</span><span id="DocumentsBuilder-220"><a href="#DocumentsBuilder-220"><span class="linenos">220</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DocumentsBuilder-221"><a href="#DocumentsBuilder-221"><span class="linenos">221</span></a><span class="sd">        Extract text from PDF documents and split into chunks.</span>
</span><span id="DocumentsBuilder-222"><a href="#DocumentsBuilder-222"><span class="linenos">222</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DocumentsBuilder-223"><a href="#DocumentsBuilder-223"><span class="linenos">223</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
</span><span id="DocumentsBuilder-224"><a href="#DocumentsBuilder-224"><span class="linenos">224</span></a>            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File not found: </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="DocumentsBuilder-225"><a href="#DocumentsBuilder-225"><span class="linenos">225</span></a>        
</span><span id="DocumentsBuilder-226"><a href="#DocumentsBuilder-226"><span class="linenos">226</span></a>        <span class="n">file_extension</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">file_path</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="DocumentsBuilder-227"><a href="#DocumentsBuilder-227"><span class="linenos">227</span></a>        <span class="k">if</span> <span class="n">file_extension</span> <span class="o">!=</span> <span class="s1">&#39;.pdf&#39;</span><span class="p">:</span>
</span><span id="DocumentsBuilder-228"><a href="#DocumentsBuilder-228"><span class="linenos">228</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported file format: </span><span class="si">{</span><span class="n">file_extension</span><span class="si">}</span><span class="s2">. Only .pdf files are supported.&quot;</span><span class="p">)</span>
</span><span id="DocumentsBuilder-229"><a href="#DocumentsBuilder-229"><span class="linenos">229</span></a>        
</span><span id="DocumentsBuilder-230"><a href="#DocumentsBuilder-230"><span class="linenos">230</span></a>        <span class="c1"># qui PyPDF2 viene importato solo se davvero richiesto</span>
</span><span id="DocumentsBuilder-231"><a href="#DocumentsBuilder-231"><span class="linenos">231</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_module</span><span class="p">(</span><span class="s2">&quot;PyPDF2&quot;</span><span class="p">):</span>
</span><span id="DocumentsBuilder-232"><a href="#DocumentsBuilder-232"><span class="linenos">232</span></a>            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;PyPDF2 is required for PDF file extraction. Install with: pip install PyPDF2&quot;</span><span class="p">)</span>
</span><span id="DocumentsBuilder-233"><a href="#DocumentsBuilder-233"><span class="linenos">233</span></a>        
</span><span id="DocumentsBuilder-234"><a href="#DocumentsBuilder-234"><span class="linenos">234</span></a>        <span class="n">text</span><span class="p">,</span> <span class="n">pdf_properties</span><span class="p">,</span> <span class="n">page_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_from_pdf</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">page_range</span><span class="p">)</span>
</span><span id="DocumentsBuilder-235"><a href="#DocumentsBuilder-235"><span class="linenos">235</span></a>        
</span><span id="DocumentsBuilder-236"><a href="#DocumentsBuilder-236"><span class="linenos">236</span></a>        <span class="n">chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_split_text</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</span><span id="DocumentsBuilder-237"><a href="#DocumentsBuilder-237"><span class="linenos">237</span></a>        
</span><span id="DocumentsBuilder-238"><a href="#DocumentsBuilder-238"><span class="linenos">238</span></a>        <span class="n">documents</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DocumentsBuilder-239"><a href="#DocumentsBuilder-239"><span class="linenos">239</span></a>        <span class="n">metadatas</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DocumentsBuilder-240"><a href="#DocumentsBuilder-240"><span class="linenos">240</span></a>        <span class="n">ids</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DocumentsBuilder-241"><a href="#DocumentsBuilder-241"><span class="linenos">241</span></a>        
</span><span id="DocumentsBuilder-242"><a href="#DocumentsBuilder-242"><span class="linenos">242</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">chunks</span><span class="p">):</span>
</span><span id="DocumentsBuilder-243"><a href="#DocumentsBuilder-243"><span class="linenos">243</span></a>            <span class="n">chunk_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
</span><span id="DocumentsBuilder-244"><a href="#DocumentsBuilder-244"><span class="linenos">244</span></a>            <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="DocumentsBuilder-245"><a href="#DocumentsBuilder-245"><span class="linenos">245</span></a>                <span class="s1">&#39;file_path&#39;</span><span class="p">:</span> <span class="n">file_path</span><span class="p">,</span>
</span><span id="DocumentsBuilder-246"><a href="#DocumentsBuilder-246"><span class="linenos">246</span></a>                <span class="s1">&#39;file_name&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file_path</span><span class="p">),</span>
</span><span id="DocumentsBuilder-247"><a href="#DocumentsBuilder-247"><span class="linenos">247</span></a>                <span class="s1">&#39;document_format&#39;</span><span class="p">:</span> <span class="s1">&#39;pdf&#39;</span><span class="p">,</span>
</span><span id="DocumentsBuilder-248"><a href="#DocumentsBuilder-248"><span class="linenos">248</span></a>                <span class="s1">&#39;chunk_index&#39;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span>
</span><span id="DocumentsBuilder-249"><a href="#DocumentsBuilder-249"><span class="linenos">249</span></a>                <span class="s1">&#39;total_chunks&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunks</span><span class="p">),</span>
</span><span id="DocumentsBuilder-250"><a href="#DocumentsBuilder-250"><span class="linenos">250</span></a>                <span class="s1">&#39;chunk_size&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
</span><span id="DocumentsBuilder-251"><a href="#DocumentsBuilder-251"><span class="linenos">251</span></a>            <span class="p">}</span>
</span><span id="DocumentsBuilder-252"><a href="#DocumentsBuilder-252"><span class="linenos">252</span></a>            <span class="k">if</span> <span class="n">pdf_properties</span><span class="p">:</span>
</span><span id="DocumentsBuilder-253"><a href="#DocumentsBuilder-253"><span class="linenos">253</span></a>                <span class="n">metadata</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">pdf_properties</span><span class="p">)</span>
</span><span id="DocumentsBuilder-254"><a href="#DocumentsBuilder-254"><span class="linenos">254</span></a>            <span class="k">if</span> <span class="n">page_info</span><span class="p">:</span>
</span><span id="DocumentsBuilder-255"><a href="#DocumentsBuilder-255"><span class="linenos">255</span></a>                <span class="n">metadata</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">page_info</span><span class="p">)</span>
</span><span id="DocumentsBuilder-256"><a href="#DocumentsBuilder-256"><span class="linenos">256</span></a>            
</span><span id="DocumentsBuilder-257"><a href="#DocumentsBuilder-257"><span class="linenos">257</span></a>            <span class="n">documents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
</span><span id="DocumentsBuilder-258"><a href="#DocumentsBuilder-258"><span class="linenos">258</span></a>            <span class="n">metadatas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span>
</span><span id="DocumentsBuilder-259"><a href="#DocumentsBuilder-259"><span class="linenos">259</span></a>            <span class="n">ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk_id</span><span class="p">)</span>
</span><span id="DocumentsBuilder-260"><a href="#DocumentsBuilder-260"><span class="linenos">260</span></a>        
</span><span id="DocumentsBuilder-261"><a href="#DocumentsBuilder-261"><span class="linenos">261</span></a>        <span class="k">return</span> <span class="n">documents</span><span class="p">,</span> <span class="n">metadatas</span><span class="p">,</span> <span class="n">ids</span>
</span><span id="DocumentsBuilder-262"><a href="#DocumentsBuilder-262"><span class="linenos">262</span></a>
</span><span id="DocumentsBuilder-263"><a href="#DocumentsBuilder-263"><span class="linenos">263</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">from_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">engine</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;requests&quot;</span><span class="p">,</span> <span class="n">deep</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
</span><span id="DocumentsBuilder-264"><a href="#DocumentsBuilder-264"><span class="linenos">264</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DocumentsBuilder-265"><a href="#DocumentsBuilder-265"><span class="linenos">265</span></a><span class="sd">        Scrape content from a URL and split it into chunks with specified size and overlap.</span>
</span><span id="DocumentsBuilder-266"><a href="#DocumentsBuilder-266"><span class="linenos">266</span></a><span class="sd">        </span>
</span><span id="DocumentsBuilder-267"><a href="#DocumentsBuilder-267"><span class="linenos">267</span></a><span class="sd">        Notes:</span>
</span><span id="DocumentsBuilder-268"><a href="#DocumentsBuilder-268"><span class="linenos">268</span></a><span class="sd">        - Scraping may take time depending on the engine and website complexity</span>
</span><span id="DocumentsBuilder-269"><a href="#DocumentsBuilder-269"><span class="linenos">269</span></a><span class="sd">        - Some websites may block automated scraping</span>
</span><span id="DocumentsBuilder-270"><a href="#DocumentsBuilder-270"><span class="linenos">270</span></a><span class="sd">        - Selenium requires Chrome/Chromium to be installed</span>
</span><span id="DocumentsBuilder-271"><a href="#DocumentsBuilder-271"><span class="linenos">271</span></a><span class="sd">        - Tavily requires an API key to be configured</span>
</span><span id="DocumentsBuilder-272"><a href="#DocumentsBuilder-272"><span class="linenos">272</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DocumentsBuilder-273"><a href="#DocumentsBuilder-273"><span class="linenos">273</span></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">monoai.tools.webscraping</span><span class="w"> </span><span class="kn">import</span> <span class="n">scrape_web</span>
</span><span id="DocumentsBuilder-274"><a href="#DocumentsBuilder-274"><span class="linenos">274</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">scrape_web</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="n">engine</span><span class="p">,</span> <span class="n">deep</span><span class="o">=</span><span class="n">deep</span><span class="p">)</span>
</span><span id="DocumentsBuilder-275"><a href="#DocumentsBuilder-275"><span class="linenos">275</span></a>                
</span><span id="DocumentsBuilder-276"><a href="#DocumentsBuilder-276"><span class="linenos">276</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">):</span>
</span><span id="DocumentsBuilder-277"><a href="#DocumentsBuilder-277"><span class="linenos">277</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to extract text content from URL: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="DocumentsBuilder-278"><a href="#DocumentsBuilder-278"><span class="linenos">278</span></a>        
</span><span id="DocumentsBuilder-279"><a href="#DocumentsBuilder-279"><span class="linenos">279</span></a>        <span class="n">text</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span>
</span><span id="DocumentsBuilder-280"><a href="#DocumentsBuilder-280"><span class="linenos">280</span></a>        <span class="n">chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_split_text</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</span><span id="DocumentsBuilder-281"><a href="#DocumentsBuilder-281"><span class="linenos">281</span></a>        
</span><span id="DocumentsBuilder-282"><a href="#DocumentsBuilder-282"><span class="linenos">282</span></a>        <span class="n">documents</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DocumentsBuilder-283"><a href="#DocumentsBuilder-283"><span class="linenos">283</span></a>        <span class="n">metadatas</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DocumentsBuilder-284"><a href="#DocumentsBuilder-284"><span class="linenos">284</span></a>        <span class="n">ids</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DocumentsBuilder-285"><a href="#DocumentsBuilder-285"><span class="linenos">285</span></a>        
</span><span id="DocumentsBuilder-286"><a href="#DocumentsBuilder-286"><span class="linenos">286</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">chunks</span><span class="p">):</span>
</span><span id="DocumentsBuilder-287"><a href="#DocumentsBuilder-287"><span class="linenos">287</span></a>            <span class="n">chunk_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
</span><span id="DocumentsBuilder-288"><a href="#DocumentsBuilder-288"><span class="linenos">288</span></a>            <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="DocumentsBuilder-289"><a href="#DocumentsBuilder-289"><span class="linenos">289</span></a>                <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span>
</span><span id="DocumentsBuilder-290"><a href="#DocumentsBuilder-290"><span class="linenos">290</span></a>                <span class="s1">&#39;source_type&#39;</span><span class="p">:</span> <span class="s1">&#39;web_page&#39;</span><span class="p">,</span>
</span><span id="DocumentsBuilder-291"><a href="#DocumentsBuilder-291"><span class="linenos">291</span></a>                <span class="s1">&#39;scraping_engine&#39;</span><span class="p">:</span> <span class="n">engine</span><span class="p">,</span>
</span><span id="DocumentsBuilder-292"><a href="#DocumentsBuilder-292"><span class="linenos">292</span></a>                <span class="s1">&#39;deep_extraction&#39;</span><span class="p">:</span> <span class="n">deep</span><span class="p">,</span>
</span><span id="DocumentsBuilder-293"><a href="#DocumentsBuilder-293"><span class="linenos">293</span></a>                <span class="s1">&#39;chunk_index&#39;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span>
</span><span id="DocumentsBuilder-294"><a href="#DocumentsBuilder-294"><span class="linenos">294</span></a>                <span class="s1">&#39;total_chunks&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunks</span><span class="p">),</span>
</span><span id="DocumentsBuilder-295"><a href="#DocumentsBuilder-295"><span class="linenos">295</span></a>                <span class="s1">&#39;chunk_size&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
</span><span id="DocumentsBuilder-296"><a href="#DocumentsBuilder-296"><span class="linenos">296</span></a>            <span class="p">}</span>
</span><span id="DocumentsBuilder-297"><a href="#DocumentsBuilder-297"><span class="linenos">297</span></a>            <span class="n">documents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
</span><span id="DocumentsBuilder-298"><a href="#DocumentsBuilder-298"><span class="linenos">298</span></a>            <span class="n">metadatas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span>
</span><span id="DocumentsBuilder-299"><a href="#DocumentsBuilder-299"><span class="linenos">299</span></a>            <span class="n">ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk_id</span><span class="p">)</span>
</span><span id="DocumentsBuilder-300"><a href="#DocumentsBuilder-300"><span class="linenos">300</span></a>        
</span><span id="DocumentsBuilder-301"><a href="#DocumentsBuilder-301"><span class="linenos">301</span></a>        <span class="k">return</span> <span class="n">documents</span><span class="p">,</span> <span class="n">metadatas</span><span class="p">,</span> <span class="n">ids</span>
</span><span id="DocumentsBuilder-302"><a href="#DocumentsBuilder-302"><span class="linenos">302</span></a>    
</span><span id="DocumentsBuilder-303"><a href="#DocumentsBuilder-303"><span class="linenos">303</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_with_docx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">]:</span>
</span><span id="DocumentsBuilder-304"><a href="#DocumentsBuilder-304"><span class="linenos">304</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DocumentsBuilder-305"><a href="#DocumentsBuilder-305"><span class="linenos">305</span></a><span class="sd">        Extract text from a .docx file using python-docx library (lazy import).</span>
</span><span id="DocumentsBuilder-306"><a href="#DocumentsBuilder-306"><span class="linenos">306</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DocumentsBuilder-307"><a href="#DocumentsBuilder-307"><span class="linenos">307</span></a>        <span class="n">docx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_module</span><span class="p">(</span><span class="s2">&quot;docx&quot;</span><span class="p">)</span>
</span><span id="DocumentsBuilder-308"><a href="#DocumentsBuilder-308"><span class="linenos">308</span></a>        <span class="n">Document</span> <span class="o">=</span> <span class="n">docx</span><span class="o">.</span><span class="n">Document</span> 
</span><span id="DocumentsBuilder-309"><a href="#DocumentsBuilder-309"><span class="linenos">309</span></a>        <span class="n">doc</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="DocumentsBuilder-310"><a href="#DocumentsBuilder-310"><span class="linenos">310</span></a>        
</span><span id="DocumentsBuilder-311"><a href="#DocumentsBuilder-311"><span class="linenos">311</span></a>        <span class="c1"># Extract text from paragraphs</span>
</span><span id="DocumentsBuilder-312"><a href="#DocumentsBuilder-312"><span class="linenos">312</span></a>        <span class="n">text_parts</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DocumentsBuilder-313"><a href="#DocumentsBuilder-313"><span class="linenos">313</span></a>        <span class="k">for</span> <span class="n">paragraph</span> <span class="ow">in</span> <span class="n">doc</span><span class="o">.</span><span class="n">paragraphs</span><span class="p">:</span>
</span><span id="DocumentsBuilder-314"><a href="#DocumentsBuilder-314"><span class="linenos">314</span></a>            <span class="k">if</span> <span class="n">paragraph</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
</span><span id="DocumentsBuilder-315"><a href="#DocumentsBuilder-315"><span class="linenos">315</span></a>                <span class="n">text_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">paragraph</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span><span id="DocumentsBuilder-316"><a href="#DocumentsBuilder-316"><span class="linenos">316</span></a>        
</span><span id="DocumentsBuilder-317"><a href="#DocumentsBuilder-317"><span class="linenos">317</span></a>        <span class="c1"># Extract text from tables</span>
</span><span id="DocumentsBuilder-318"><a href="#DocumentsBuilder-318"><span class="linenos">318</span></a>        <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">doc</span><span class="o">.</span><span class="n">tables</span><span class="p">:</span>
</span><span id="DocumentsBuilder-319"><a href="#DocumentsBuilder-319"><span class="linenos">319</span></a>            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">rows</span><span class="p">:</span>
</span><span id="DocumentsBuilder-320"><a href="#DocumentsBuilder-320"><span class="linenos">320</span></a>                <span class="n">row_text</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DocumentsBuilder-321"><a href="#DocumentsBuilder-321"><span class="linenos">321</span></a>                <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">row</span><span class="o">.</span><span class="n">cells</span><span class="p">:</span>
</span><span id="DocumentsBuilder-322"><a href="#DocumentsBuilder-322"><span class="linenos">322</span></a>                    <span class="k">if</span> <span class="n">cell</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
</span><span id="DocumentsBuilder-323"><a href="#DocumentsBuilder-323"><span class="linenos">323</span></a>                        <span class="n">row_text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cell</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
</span><span id="DocumentsBuilder-324"><a href="#DocumentsBuilder-324"><span class="linenos">324</span></a>                <span class="k">if</span> <span class="n">row_text</span><span class="p">:</span>
</span><span id="DocumentsBuilder-325"><a href="#DocumentsBuilder-325"><span class="linenos">325</span></a>                    <span class="n">text_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot; | &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">row_text</span><span class="p">))</span>
</span><span id="DocumentsBuilder-326"><a href="#DocumentsBuilder-326"><span class="linenos">326</span></a>        
</span><span id="DocumentsBuilder-327"><a href="#DocumentsBuilder-327"><span class="linenos">327</span></a>        <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">text_parts</span><span class="p">)</span>
</span><span id="DocumentsBuilder-328"><a href="#DocumentsBuilder-328"><span class="linenos">328</span></a>        
</span><span id="DocumentsBuilder-329"><a href="#DocumentsBuilder-329"><span class="linenos">329</span></a>        <span class="c1"># Extract document properties</span>
</span><span id="DocumentsBuilder-330"><a href="#DocumentsBuilder-330"><span class="linenos">330</span></a>        <span class="n">properties</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="DocumentsBuilder-331"><a href="#DocumentsBuilder-331"><span class="linenos">331</span></a>        <span class="n">core_props</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">core_properties</span>
</span><span id="DocumentsBuilder-332"><a href="#DocumentsBuilder-332"><span class="linenos">332</span></a>        <span class="k">if</span> <span class="n">core_props</span><span class="o">.</span><span class="n">title</span><span class="p">:</span>
</span><span id="DocumentsBuilder-333"><a href="#DocumentsBuilder-333"><span class="linenos">333</span></a>            <span class="n">properties</span><span class="p">[</span><span class="s1">&#39;document_title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">core_props</span><span class="o">.</span><span class="n">title</span>
</span><span id="DocumentsBuilder-334"><a href="#DocumentsBuilder-334"><span class="linenos">334</span></a>        <span class="k">if</span> <span class="n">core_props</span><span class="o">.</span><span class="n">author</span><span class="p">:</span>
</span><span id="DocumentsBuilder-335"><a href="#DocumentsBuilder-335"><span class="linenos">335</span></a>            <span class="n">properties</span><span class="p">[</span><span class="s1">&#39;document_author&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">core_props</span><span class="o">.</span><span class="n">author</span>
</span><span id="DocumentsBuilder-336"><a href="#DocumentsBuilder-336"><span class="linenos">336</span></a>        <span class="k">if</span> <span class="n">core_props</span><span class="o">.</span><span class="n">subject</span><span class="p">:</span>
</span><span id="DocumentsBuilder-337"><a href="#DocumentsBuilder-337"><span class="linenos">337</span></a>            <span class="n">properties</span><span class="p">[</span><span class="s1">&#39;document_subject&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">core_props</span><span class="o">.</span><span class="n">subject</span>
</span><span id="DocumentsBuilder-338"><a href="#DocumentsBuilder-338"><span class="linenos">338</span></a>        <span class="k">if</span> <span class="n">core_props</span><span class="o">.</span><span class="n">created</span><span class="p">:</span>
</span><span id="DocumentsBuilder-339"><a href="#DocumentsBuilder-339"><span class="linenos">339</span></a>            <span class="n">properties</span><span class="p">[</span><span class="s1">&#39;document_created&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">core_props</span><span class="o">.</span><span class="n">created</span><span class="p">)</span>
</span><span id="DocumentsBuilder-340"><a href="#DocumentsBuilder-340"><span class="linenos">340</span></a>        <span class="k">if</span> <span class="n">core_props</span><span class="o">.</span><span class="n">modified</span><span class="p">:</span>
</span><span id="DocumentsBuilder-341"><a href="#DocumentsBuilder-341"><span class="linenos">341</span></a>            <span class="n">properties</span><span class="p">[</span><span class="s1">&#39;document_modified&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">core_props</span><span class="o">.</span><span class="n">modified</span><span class="p">)</span>
</span><span id="DocumentsBuilder-342"><a href="#DocumentsBuilder-342"><span class="linenos">342</span></a>        
</span><span id="DocumentsBuilder-343"><a href="#DocumentsBuilder-343"><span class="linenos">343</span></a>        <span class="k">return</span> <span class="n">text</span><span class="p">,</span> <span class="n">properties</span>
</span><span id="DocumentsBuilder-344"><a href="#DocumentsBuilder-344"><span class="linenos">344</span></a>    
</span><span id="DocumentsBuilder-345"><a href="#DocumentsBuilder-345"><span class="linenos">345</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_with_docx2txt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">]:</span>
</span><span id="DocumentsBuilder-346"><a href="#DocumentsBuilder-346"><span class="linenos">346</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DocumentsBuilder-347"><a href="#DocumentsBuilder-347"><span class="linenos">347</span></a><span class="sd">        Extract text from a Word document using docx2txt library (lazy import).</span>
</span><span id="DocumentsBuilder-348"><a href="#DocumentsBuilder-348"><span class="linenos">348</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DocumentsBuilder-349"><a href="#DocumentsBuilder-349"><span class="linenos">349</span></a>        <span class="n">docx2txt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_module</span><span class="p">(</span><span class="s2">&quot;docx2txt&quot;</span><span class="p">)</span>
</span><span id="DocumentsBuilder-350"><a href="#DocumentsBuilder-350"><span class="linenos">350</span></a>        <span class="n">text</span> <span class="o">=</span> <span class="n">docx2txt</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>  
</span><span id="DocumentsBuilder-351"><a href="#DocumentsBuilder-351"><span class="linenos">351</span></a>        <span class="k">return</span> <span class="n">text</span><span class="p">,</span> <span class="p">{}</span>
</span><span id="DocumentsBuilder-352"><a href="#DocumentsBuilder-352"><span class="linenos">352</span></a>    
</span><span id="DocumentsBuilder-353"><a href="#DocumentsBuilder-353"><span class="linenos">353</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_from_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">page_range</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Dict</span><span class="p">]:</span>
</span><span id="DocumentsBuilder-354"><a href="#DocumentsBuilder-354"><span class="linenos">354</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DocumentsBuilder-355"><a href="#DocumentsBuilder-355"><span class="linenos">355</span></a><span class="sd">        Extract text and metadata from a PDF file using PyPDF2 (lazy import).</span>
</span><span id="DocumentsBuilder-356"><a href="#DocumentsBuilder-356"><span class="linenos">356</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DocumentsBuilder-357"><a href="#DocumentsBuilder-357"><span class="linenos">357</span></a>        <span class="n">PyPDF2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_module</span><span class="p">(</span><span class="s2">&quot;PyPDF2&quot;</span><span class="p">)</span>
</span><span id="DocumentsBuilder-358"><a href="#DocumentsBuilder-358"><span class="linenos">358</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="DocumentsBuilder-359"><a href="#DocumentsBuilder-359"><span class="linenos">359</span></a>            <span class="n">pdf_reader</span> <span class="o">=</span> <span class="n">PyPDF2</span><span class="o">.</span><span class="n">PdfReader</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> 
</span><span id="DocumentsBuilder-360"><a href="#DocumentsBuilder-360"><span class="linenos">360</span></a>            
</span><span id="DocumentsBuilder-361"><a href="#DocumentsBuilder-361"><span class="linenos">361</span></a>            <span class="c1"># Get total number of pages</span>
</span><span id="DocumentsBuilder-362"><a href="#DocumentsBuilder-362"><span class="linenos">362</span></a>            <span class="n">total_pages</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pdf_reader</span><span class="o">.</span><span class="n">pages</span><span class="p">)</span>
</span><span id="DocumentsBuilder-363"><a href="#DocumentsBuilder-363"><span class="linenos">363</span></a>            
</span><span id="DocumentsBuilder-364"><a href="#DocumentsBuilder-364"><span class="linenos">364</span></a>            <span class="c1"># Determine page range</span>
</span><span id="DocumentsBuilder-365"><a href="#DocumentsBuilder-365"><span class="linenos">365</span></a>            <span class="k">if</span> <span class="n">page_range</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DocumentsBuilder-366"><a href="#DocumentsBuilder-366"><span class="linenos">366</span></a>                <span class="n">start_page</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="DocumentsBuilder-367"><a href="#DocumentsBuilder-367"><span class="linenos">367</span></a>                <span class="n">end_page</span> <span class="o">=</span> <span class="n">total_pages</span>
</span><span id="DocumentsBuilder-368"><a href="#DocumentsBuilder-368"><span class="linenos">368</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DocumentsBuilder-369"><a href="#DocumentsBuilder-369"><span class="linenos">369</span></a>                <span class="n">start_page</span><span class="p">,</span> <span class="n">end_page</span> <span class="o">=</span> <span class="n">page_range</span>
</span><span id="DocumentsBuilder-370"><a href="#DocumentsBuilder-370"><span class="linenos">370</span></a>                <span class="c1"># Validate page range</span>
</span><span id="DocumentsBuilder-371"><a href="#DocumentsBuilder-371"><span class="linenos">371</span></a>                <span class="k">if</span> <span class="n">start_page</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">end_page</span> <span class="o">&gt;</span> <span class="n">total_pages</span> <span class="ow">or</span> <span class="n">start_page</span> <span class="o">&gt;</span> <span class="n">end_page</span><span class="p">:</span>
</span><span id="DocumentsBuilder-372"><a href="#DocumentsBuilder-372"><span class="linenos">372</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid page range: </span><span class="si">{</span><span class="n">page_range</span><span class="si">}</span><span class="s2">. Pages must be between 1 and </span><span class="si">{</span><span class="n">total_pages</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="DocumentsBuilder-373"><a href="#DocumentsBuilder-373"><span class="linenos">373</span></a>            
</span><span id="DocumentsBuilder-374"><a href="#DocumentsBuilder-374"><span class="linenos">374</span></a>            <span class="c1"># Extract text from specified pages</span>
</span><span id="DocumentsBuilder-375"><a href="#DocumentsBuilder-375"><span class="linenos">375</span></a>            <span class="n">text_parts</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DocumentsBuilder-376"><a href="#DocumentsBuilder-376"><span class="linenos">376</span></a>            <span class="k">for</span> <span class="n">page_num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_page</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">end_page</span><span class="p">):</span>
</span><span id="DocumentsBuilder-377"><a href="#DocumentsBuilder-377"><span class="linenos">377</span></a>                <span class="n">page</span> <span class="o">=</span> <span class="n">pdf_reader</span><span class="o">.</span><span class="n">pages</span><span class="p">[</span><span class="n">page_num</span><span class="p">]</span>
</span><span id="DocumentsBuilder-378"><a href="#DocumentsBuilder-378"><span class="linenos">378</span></a>                <span class="n">page_text</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">extract_text</span><span class="p">()</span>
</span><span id="DocumentsBuilder-379"><a href="#DocumentsBuilder-379"><span class="linenos">379</span></a>                <span class="k">if</span> <span class="n">page_text</span> <span class="ow">and</span> <span class="n">page_text</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
</span><span id="DocumentsBuilder-380"><a href="#DocumentsBuilder-380"><span class="linenos">380</span></a>                    <span class="n">text_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">page_text</span><span class="p">)</span>
</span><span id="DocumentsBuilder-381"><a href="#DocumentsBuilder-381"><span class="linenos">381</span></a>            
</span><span id="DocumentsBuilder-382"><a href="#DocumentsBuilder-382"><span class="linenos">382</span></a>            <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">text_parts</span><span class="p">)</span>
</span><span id="DocumentsBuilder-383"><a href="#DocumentsBuilder-383"><span class="linenos">383</span></a>            
</span><span id="DocumentsBuilder-384"><a href="#DocumentsBuilder-384"><span class="linenos">384</span></a>            <span class="c1"># Extract PDF properties</span>
</span><span id="DocumentsBuilder-385"><a href="#DocumentsBuilder-385"><span class="linenos">385</span></a>            <span class="n">properties</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="DocumentsBuilder-386"><a href="#DocumentsBuilder-386"><span class="linenos">386</span></a>            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">pdf_reader</span><span class="p">,</span> <span class="s2">&quot;metadata&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="DocumentsBuilder-387"><a href="#DocumentsBuilder-387"><span class="linenos">387</span></a>                <span class="n">metadata</span> <span class="o">=</span> <span class="n">pdf_reader</span><span class="o">.</span><span class="n">metadata</span>
</span><span id="DocumentsBuilder-388"><a href="#DocumentsBuilder-388"><span class="linenos">388</span></a>
</span><span id="DocumentsBuilder-389"><a href="#DocumentsBuilder-389"><span class="linenos">389</span></a>                <span class="k">def</span><span class="w"> </span><span class="nf">_get</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
</span><span id="DocumentsBuilder-390"><a href="#DocumentsBuilder-390"><span class="linenos">390</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="DocumentsBuilder-391"><a href="#DocumentsBuilder-391"><span class="linenos">391</span></a>                        <span class="k">return</span> <span class="n">meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="s2">&quot;get&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="DocumentsBuilder-392"><a href="#DocumentsBuilder-392"><span class="linenos">392</span></a>                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="DocumentsBuilder-393"><a href="#DocumentsBuilder-393"><span class="linenos">393</span></a>                        <span class="k">return</span> <span class="kc">None</span>
</span><span id="DocumentsBuilder-394"><a href="#DocumentsBuilder-394"><span class="linenos">394</span></a>
</span><span id="DocumentsBuilder-395"><a href="#DocumentsBuilder-395"><span class="linenos">395</span></a>                <span class="n">mapping</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="DocumentsBuilder-396"><a href="#DocumentsBuilder-396"><span class="linenos">396</span></a>                    <span class="p">(</span><span class="s1">&#39;/Title&#39;</span><span class="p">,</span> <span class="s1">&#39;pdf_title&#39;</span><span class="p">),</span>
</span><span id="DocumentsBuilder-397"><a href="#DocumentsBuilder-397"><span class="linenos">397</span></a>                    <span class="p">(</span><span class="s1">&#39;/Author&#39;</span><span class="p">,</span> <span class="s1">&#39;pdf_author&#39;</span><span class="p">),</span>
</span><span id="DocumentsBuilder-398"><a href="#DocumentsBuilder-398"><span class="linenos">398</span></a>                    <span class="p">(</span><span class="s1">&#39;/Subject&#39;</span><span class="p">,</span> <span class="s1">&#39;pdf_subject&#39;</span><span class="p">),</span>
</span><span id="DocumentsBuilder-399"><a href="#DocumentsBuilder-399"><span class="linenos">399</span></a>                    <span class="p">(</span><span class="s1">&#39;/Creator&#39;</span><span class="p">,</span> <span class="s1">&#39;pdf_creator&#39;</span><span class="p">),</span>
</span><span id="DocumentsBuilder-400"><a href="#DocumentsBuilder-400"><span class="linenos">400</span></a>                    <span class="p">(</span><span class="s1">&#39;/Producer&#39;</span><span class="p">,</span> <span class="s1">&#39;pdf_producer&#39;</span><span class="p">),</span>
</span><span id="DocumentsBuilder-401"><a href="#DocumentsBuilder-401"><span class="linenos">401</span></a>                    <span class="p">(</span><span class="s1">&#39;/CreationDate&#39;</span><span class="p">,</span> <span class="s1">&#39;pdf_creation_date&#39;</span><span class="p">),</span>
</span><span id="DocumentsBuilder-402"><a href="#DocumentsBuilder-402"><span class="linenos">402</span></a>                    <span class="p">(</span><span class="s1">&#39;/ModDate&#39;</span><span class="p">,</span> <span class="s1">&#39;pdf_modification_date&#39;</span><span class="p">),</span>
</span><span id="DocumentsBuilder-403"><a href="#DocumentsBuilder-403"><span class="linenos">403</span></a>                <span class="p">]</span>
</span><span id="DocumentsBuilder-404"><a href="#DocumentsBuilder-404"><span class="linenos">404</span></a>                <span class="k">for</span> <span class="n">k_src</span><span class="p">,</span> <span class="n">k_dst</span> <span class="ow">in</span> <span class="n">mapping</span><span class="p">:</span>
</span><span id="DocumentsBuilder-405"><a href="#DocumentsBuilder-405"><span class="linenos">405</span></a>                    <span class="n">val</span> <span class="o">=</span> <span class="n">_get</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="n">k_src</span><span class="p">)</span>
</span><span id="DocumentsBuilder-406"><a href="#DocumentsBuilder-406"><span class="linenos">406</span></a>                    <span class="k">if</span> <span class="n">val</span><span class="p">:</span>
</span><span id="DocumentsBuilder-407"><a href="#DocumentsBuilder-407"><span class="linenos">407</span></a>                        <span class="n">properties</span><span class="p">[</span><span class="n">k_dst</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
</span><span id="DocumentsBuilder-408"><a href="#DocumentsBuilder-408"><span class="linenos">408</span></a>            
</span><span id="DocumentsBuilder-409"><a href="#DocumentsBuilder-409"><span class="linenos">409</span></a>            <span class="c1"># Add page information</span>
</span><span id="DocumentsBuilder-410"><a href="#DocumentsBuilder-410"><span class="linenos">410</span></a>            <span class="n">page_info</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="DocumentsBuilder-411"><a href="#DocumentsBuilder-411"><span class="linenos">411</span></a>                <span class="s1">&#39;total_pages&#39;</span><span class="p">:</span> <span class="n">total_pages</span><span class="p">,</span>
</span><span id="DocumentsBuilder-412"><a href="#DocumentsBuilder-412"><span class="linenos">412</span></a>                <span class="s1">&#39;extracted_pages_start&#39;</span><span class="p">:</span> <span class="n">start_page</span><span class="p">,</span>
</span><span id="DocumentsBuilder-413"><a href="#DocumentsBuilder-413"><span class="linenos">413</span></a>                <span class="s1">&#39;extracted_pages_end&#39;</span><span class="p">:</span> <span class="n">end_page</span><span class="p">,</span>
</span><span id="DocumentsBuilder-414"><a href="#DocumentsBuilder-414"><span class="linenos">414</span></a>                <span class="s1">&#39;extracted_pages_count&#39;</span><span class="p">:</span> <span class="n">end_page</span> <span class="o">-</span> <span class="n">start_page</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="DocumentsBuilder-415"><a href="#DocumentsBuilder-415"><span class="linenos">415</span></a>            <span class="p">}</span>
</span><span id="DocumentsBuilder-416"><a href="#DocumentsBuilder-416"><span class="linenos">416</span></a>            
</span><span id="DocumentsBuilder-417"><a href="#DocumentsBuilder-417"><span class="linenos">417</span></a>            <span class="k">return</span> <span class="n">text</span><span class="p">,</span> <span class="n">properties</span><span class="p">,</span> <span class="n">page_info</span>
</span><span id="DocumentsBuilder-418"><a href="#DocumentsBuilder-418"><span class="linenos">418</span></a>    
</span><span id="DocumentsBuilder-419"><a href="#DocumentsBuilder-419"><span class="linenos">419</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_split_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="DocumentsBuilder-420"><a href="#DocumentsBuilder-420"><span class="linenos">420</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DocumentsBuilder-421"><a href="#DocumentsBuilder-421"><span class="linenos">421</span></a><span class="sd">        Split text into chunks using the specified chunking strategy.</span>
</span><span id="DocumentsBuilder-422"><a href="#DocumentsBuilder-422"><span class="linenos">422</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DocumentsBuilder-423"><a href="#DocumentsBuilder-423"><span class="linenos">423</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chunk_size</span><span class="p">:</span>
</span><span id="DocumentsBuilder-424"><a href="#DocumentsBuilder-424"><span class="linenos">424</span></a>            <span class="k">return</span> <span class="p">[</span><span class="n">text</span><span class="p">]</span>
</span><span id="DocumentsBuilder-425"><a href="#DocumentsBuilder-425"><span class="linenos">425</span></a>        
</span><span id="DocumentsBuilder-426"><a href="#DocumentsBuilder-426"><span class="linenos">426</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chunk_strategy</span> <span class="o">==</span> <span class="s2">&quot;word&quot;</span><span class="p">:</span>
</span><span id="DocumentsBuilder-427"><a href="#DocumentsBuilder-427"><span class="linenos">427</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_split_by_words</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</span><span id="DocumentsBuilder-428"><a href="#DocumentsBuilder-428"><span class="linenos">428</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chunk_strategy</span> <span class="o">==</span> <span class="s2">&quot;sentence&quot;</span><span class="p">:</span>
</span><span id="DocumentsBuilder-429"><a href="#DocumentsBuilder-429"><span class="linenos">429</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_split_by_sentences</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</span><span id="DocumentsBuilder-430"><a href="#DocumentsBuilder-430"><span class="linenos">430</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chunk_strategy</span> <span class="o">==</span> <span class="s2">&quot;paragraph&quot;</span><span class="p">:</span>
</span><span id="DocumentsBuilder-431"><a href="#DocumentsBuilder-431"><span class="linenos">431</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_split_by_paragraphs</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</span><span id="DocumentsBuilder-432"><a href="#DocumentsBuilder-432"><span class="linenos">432</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chunk_strategy</span> <span class="o">==</span> <span class="s2">&quot;fixed&quot;</span><span class="p">:</span>
</span><span id="DocumentsBuilder-433"><a href="#DocumentsBuilder-433"><span class="linenos">433</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_split_fixed</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</span><span id="DocumentsBuilder-434"><a href="#DocumentsBuilder-434"><span class="linenos">434</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chunk_strategy</span> <span class="o">==</span> <span class="s2">&quot;semantic&quot;</span><span class="p">:</span>
</span><span id="DocumentsBuilder-435"><a href="#DocumentsBuilder-435"><span class="linenos">435</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_split_semantic</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</span><span id="DocumentsBuilder-436"><a href="#DocumentsBuilder-436"><span class="linenos">436</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chunk_strategy</span> <span class="o">==</span> <span class="s2">&quot;custom&quot;</span><span class="p">:</span>
</span><span id="DocumentsBuilder-437"><a href="#DocumentsBuilder-437"><span class="linenos">437</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_custom_split_func</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chunk_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chunk_overlap</span><span class="p">)</span>
</span><span id="DocumentsBuilder-438"><a href="#DocumentsBuilder-438"><span class="linenos">438</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DocumentsBuilder-439"><a href="#DocumentsBuilder-439"><span class="linenos">439</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported chunk strategy: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_chunk_strategy</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="DocumentsBuilder-440"><a href="#DocumentsBuilder-440"><span class="linenos">440</span></a>    
</span><span id="DocumentsBuilder-441"><a href="#DocumentsBuilder-441"><span class="linenos">441</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_split_by_words</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="DocumentsBuilder-442"><a href="#DocumentsBuilder-442"><span class="linenos">442</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DocumentsBuilder-443"><a href="#DocumentsBuilder-443"><span class="linenos">443</span></a><span class="sd">        Split text by word boundaries while respecting word count.</span>
</span><span id="DocumentsBuilder-444"><a href="#DocumentsBuilder-444"><span class="linenos">444</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DocumentsBuilder-445"><a href="#DocumentsBuilder-445"><span class="linenos">445</span></a>        <span class="n">words</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
</span><span id="DocumentsBuilder-446"><a href="#DocumentsBuilder-446"><span class="linenos">446</span></a>        
</span><span id="DocumentsBuilder-447"><a href="#DocumentsBuilder-447"><span class="linenos">447</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chunk_size</span><span class="p">:</span>
</span><span id="DocumentsBuilder-448"><a href="#DocumentsBuilder-448"><span class="linenos">448</span></a>            <span class="k">return</span> <span class="p">[</span><span class="n">text</span><span class="p">]</span>
</span><span id="DocumentsBuilder-449"><a href="#DocumentsBuilder-449"><span class="linenos">449</span></a>        
</span><span id="DocumentsBuilder-450"><a href="#DocumentsBuilder-450"><span class="linenos">450</span></a>        <span class="n">chunks</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DocumentsBuilder-451"><a href="#DocumentsBuilder-451"><span class="linenos">451</span></a>        <span class="n">start_word</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="DocumentsBuilder-452"><a href="#DocumentsBuilder-452"><span class="linenos">452</span></a>        
</span><span id="DocumentsBuilder-453"><a href="#DocumentsBuilder-453"><span class="linenos">453</span></a>        <span class="k">while</span> <span class="n">start_word</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">):</span>
</span><span id="DocumentsBuilder-454"><a href="#DocumentsBuilder-454"><span class="linenos">454</span></a>            <span class="n">end_word</span> <span class="o">=</span> <span class="n">start_word</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chunk_size</span>
</span><span id="DocumentsBuilder-455"><a href="#DocumentsBuilder-455"><span class="linenos">455</span></a>            <span class="n">chunk_words</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="n">start_word</span><span class="p">:</span><span class="n">end_word</span><span class="p">]</span>
</span><span id="DocumentsBuilder-456"><a href="#DocumentsBuilder-456"><span class="linenos">456</span></a>            <span class="n">chunk</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">chunk_words</span><span class="p">)</span>
</span><span id="DocumentsBuilder-457"><a href="#DocumentsBuilder-457"><span class="linenos">457</span></a>            
</span><span id="DocumentsBuilder-458"><a href="#DocumentsBuilder-458"><span class="linenos">458</span></a>            <span class="k">if</span> <span class="n">chunk</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
</span><span id="DocumentsBuilder-459"><a href="#DocumentsBuilder-459"><span class="linenos">459</span></a>                <span class="n">chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
</span><span id="DocumentsBuilder-460"><a href="#DocumentsBuilder-460"><span class="linenos">460</span></a>            
</span><span id="DocumentsBuilder-461"><a href="#DocumentsBuilder-461"><span class="linenos">461</span></a>            <span class="n">new_start_word</span> <span class="o">=</span> <span class="n">end_word</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chunk_overlap</span>
</span><span id="DocumentsBuilder-462"><a href="#DocumentsBuilder-462"><span class="linenos">462</span></a>            <span class="k">if</span> <span class="n">new_start_word</span> <span class="o">&lt;=</span> <span class="n">start_word</span><span class="p">:</span>
</span><span id="DocumentsBuilder-463"><a href="#DocumentsBuilder-463"><span class="linenos">463</span></a>                <span class="n">new_start_word</span> <span class="o">=</span> <span class="n">start_word</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="DocumentsBuilder-464"><a href="#DocumentsBuilder-464"><span class="linenos">464</span></a>            <span class="n">start_word</span> <span class="o">=</span> <span class="n">new_start_word</span>
</span><span id="DocumentsBuilder-465"><a href="#DocumentsBuilder-465"><span class="linenos">465</span></a>            
</span><span id="DocumentsBuilder-466"><a href="#DocumentsBuilder-466"><span class="linenos">466</span></a>            <span class="k">if</span> <span class="n">start_word</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">):</span>
</span><span id="DocumentsBuilder-467"><a href="#DocumentsBuilder-467"><span class="linenos">467</span></a>                <span class="k">break</span>
</span><span id="DocumentsBuilder-468"><a href="#DocumentsBuilder-468"><span class="linenos">468</span></a>        
</span><span id="DocumentsBuilder-469"><a href="#DocumentsBuilder-469"><span class="linenos">469</span></a>        <span class="k">return</span> <span class="n">chunks</span>
</span><span id="DocumentsBuilder-470"><a href="#DocumentsBuilder-470"><span class="linenos">470</span></a>    
</span><span id="DocumentsBuilder-471"><a href="#DocumentsBuilder-471"><span class="linenos">471</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_split_by_sentences</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="DocumentsBuilder-472"><a href="#DocumentsBuilder-472"><span class="linenos">472</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DocumentsBuilder-473"><a href="#DocumentsBuilder-473"><span class="linenos">473</span></a><span class="sd">        Split text by sentence boundaries while respecting sentence count.</span>
</span><span id="DocumentsBuilder-474"><a href="#DocumentsBuilder-474"><span class="linenos">474</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DocumentsBuilder-475"><a href="#DocumentsBuilder-475"><span class="linenos">475</span></a>        <span class="n">sentence_endings</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;!&#39;</span><span class="p">,</span> <span class="s1">&#39;?&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">]</span>
</span><span id="DocumentsBuilder-476"><a href="#DocumentsBuilder-476"><span class="linenos">476</span></a>        
</span><span id="DocumentsBuilder-477"><a href="#DocumentsBuilder-477"><span class="linenos">477</span></a>        <span class="n">sentences</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DocumentsBuilder-478"><a href="#DocumentsBuilder-478"><span class="linenos">478</span></a>        <span class="n">last_pos</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="DocumentsBuilder-479"><a href="#DocumentsBuilder-479"><span class="linenos">479</span></a>        
</span><span id="DocumentsBuilder-480"><a href="#DocumentsBuilder-480"><span class="linenos">480</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">char</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
</span><span id="DocumentsBuilder-481"><a href="#DocumentsBuilder-481"><span class="linenos">481</span></a>            <span class="k">if</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">sentence_endings</span><span class="p">:</span>
</span><span id="DocumentsBuilder-482"><a href="#DocumentsBuilder-482"><span class="linenos">482</span></a>                <span class="n">sentence</span> <span class="o">=</span> <span class="n">text</span><span class="p">[</span><span class="n">last_pos</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="DocumentsBuilder-483"><a href="#DocumentsBuilder-483"><span class="linenos">483</span></a>                <span class="k">if</span> <span class="n">sentence</span><span class="p">:</span>
</span><span id="DocumentsBuilder-484"><a href="#DocumentsBuilder-484"><span class="linenos">484</span></a>                    <span class="n">sentences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span>
</span><span id="DocumentsBuilder-485"><a href="#DocumentsBuilder-485"><span class="linenos">485</span></a>                <span class="n">last_pos</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="DocumentsBuilder-486"><a href="#DocumentsBuilder-486"><span class="linenos">486</span></a>        
</span><span id="DocumentsBuilder-487"><a href="#DocumentsBuilder-487"><span class="linenos">487</span></a>        <span class="k">if</span> <span class="n">last_pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
</span><span id="DocumentsBuilder-488"><a href="#DocumentsBuilder-488"><span class="linenos">488</span></a>            <span class="n">last_sentence</span> <span class="o">=</span> <span class="n">text</span><span class="p">[</span><span class="n">last_pos</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="DocumentsBuilder-489"><a href="#DocumentsBuilder-489"><span class="linenos">489</span></a>            <span class="k">if</span> <span class="n">last_sentence</span><span class="p">:</span>
</span><span id="DocumentsBuilder-490"><a href="#DocumentsBuilder-490"><span class="linenos">490</span></a>                <span class="n">sentences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">last_sentence</span><span class="p">)</span>
</span><span id="DocumentsBuilder-491"><a href="#DocumentsBuilder-491"><span class="linenos">491</span></a>        
</span><span id="DocumentsBuilder-492"><a href="#DocumentsBuilder-492"><span class="linenos">492</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sentences</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chunk_size</span><span class="p">:</span>
</span><span id="DocumentsBuilder-493"><a href="#DocumentsBuilder-493"><span class="linenos">493</span></a>            <span class="k">return</span> <span class="p">[</span><span class="n">text</span><span class="p">]</span>
</span><span id="DocumentsBuilder-494"><a href="#DocumentsBuilder-494"><span class="linenos">494</span></a>        
</span><span id="DocumentsBuilder-495"><a href="#DocumentsBuilder-495"><span class="linenos">495</span></a>        <span class="n">chunks</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DocumentsBuilder-496"><a href="#DocumentsBuilder-496"><span class="linenos">496</span></a>        <span class="n">start_sentence</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="DocumentsBuilder-497"><a href="#DocumentsBuilder-497"><span class="linenos">497</span></a>        
</span><span id="DocumentsBuilder-498"><a href="#DocumentsBuilder-498"><span class="linenos">498</span></a>        <span class="k">while</span> <span class="n">start_sentence</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">sentences</span><span class="p">):</span>
</span><span id="DocumentsBuilder-499"><a href="#DocumentsBuilder-499"><span class="linenos">499</span></a>            <span class="n">end_sentence</span> <span class="o">=</span> <span class="n">start_sentence</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chunk_size</span>
</span><span id="DocumentsBuilder-500"><a href="#DocumentsBuilder-500"><span class="linenos">500</span></a>            <span class="n">chunk_sentences</span> <span class="o">=</span> <span class="n">sentences</span><span class="p">[</span><span class="n">start_sentence</span><span class="p">:</span><span class="n">end_sentence</span><span class="p">]</span>
</span><span id="DocumentsBuilder-501"><a href="#DocumentsBuilder-501"><span class="linenos">501</span></a>            <span class="n">chunk</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">chunk_sentences</span><span class="p">)</span>
</span><span id="DocumentsBuilder-502"><a href="#DocumentsBuilder-502"><span class="linenos">502</span></a>            
</span><span id="DocumentsBuilder-503"><a href="#DocumentsBuilder-503"><span class="linenos">503</span></a>            <span class="k">if</span> <span class="n">chunk</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
</span><span id="DocumentsBuilder-504"><a href="#DocumentsBuilder-504"><span class="linenos">504</span></a>                <span class="n">chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
</span><span id="DocumentsBuilder-505"><a href="#DocumentsBuilder-505"><span class="linenos">505</span></a>            
</span><span id="DocumentsBuilder-506"><a href="#DocumentsBuilder-506"><span class="linenos">506</span></a>            <span class="n">new_start_sentence</span> <span class="o">=</span> <span class="n">end_sentence</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chunk_overlap</span>
</span><span id="DocumentsBuilder-507"><a href="#DocumentsBuilder-507"><span class="linenos">507</span></a>            <span class="k">if</span> <span class="n">new_start_sentence</span> <span class="o">&lt;=</span> <span class="n">start_sentence</span><span class="p">:</span>
</span><span id="DocumentsBuilder-508"><a href="#DocumentsBuilder-508"><span class="linenos">508</span></a>                <span class="n">new_start_sentence</span> <span class="o">=</span> <span class="n">start_sentence</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="DocumentsBuilder-509"><a href="#DocumentsBuilder-509"><span class="linenos">509</span></a>            <span class="n">start_sentence</span> <span class="o">=</span> <span class="n">new_start_sentence</span>
</span><span id="DocumentsBuilder-510"><a href="#DocumentsBuilder-510"><span class="linenos">510</span></a>            
</span><span id="DocumentsBuilder-511"><a href="#DocumentsBuilder-511"><span class="linenos">511</span></a>            <span class="k">if</span> <span class="n">start_sentence</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sentences</span><span class="p">):</span>
</span><span id="DocumentsBuilder-512"><a href="#DocumentsBuilder-512"><span class="linenos">512</span></a>                <span class="k">break</span>
</span><span id="DocumentsBuilder-513"><a href="#DocumentsBuilder-513"><span class="linenos">513</span></a>        
</span><span id="DocumentsBuilder-514"><a href="#DocumentsBuilder-514"><span class="linenos">514</span></a>        <span class="k">return</span> <span class="n">chunks</span>
</span><span id="DocumentsBuilder-515"><a href="#DocumentsBuilder-515"><span class="linenos">515</span></a>    
</span><span id="DocumentsBuilder-516"><a href="#DocumentsBuilder-516"><span class="linenos">516</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_split_by_paragraphs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="DocumentsBuilder-517"><a href="#DocumentsBuilder-517"><span class="linenos">517</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DocumentsBuilder-518"><a href="#DocumentsBuilder-518"><span class="linenos">518</span></a><span class="sd">        Split text by paragraph boundaries while respecting paragraph count.</span>
</span><span id="DocumentsBuilder-519"><a href="#DocumentsBuilder-519"><span class="linenos">519</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DocumentsBuilder-520"><a href="#DocumentsBuilder-520"><span class="linenos">520</span></a>        <span class="n">paragraphs</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span>
</span><span id="DocumentsBuilder-521"><a href="#DocumentsBuilder-521"><span class="linenos">521</span></a>        
</span><span id="DocumentsBuilder-522"><a href="#DocumentsBuilder-522"><span class="linenos">522</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">paragraphs</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chunk_size</span><span class="p">:</span>
</span><span id="DocumentsBuilder-523"><a href="#DocumentsBuilder-523"><span class="linenos">523</span></a>            <span class="k">return</span> <span class="p">[</span><span class="n">text</span><span class="p">]</span>
</span><span id="DocumentsBuilder-524"><a href="#DocumentsBuilder-524"><span class="linenos">524</span></a>        
</span><span id="DocumentsBuilder-525"><a href="#DocumentsBuilder-525"><span class="linenos">525</span></a>        <span class="n">chunks</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DocumentsBuilder-526"><a href="#DocumentsBuilder-526"><span class="linenos">526</span></a>        <span class="n">start_paragraph</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="DocumentsBuilder-527"><a href="#DocumentsBuilder-527"><span class="linenos">527</span></a>        
</span><span id="DocumentsBuilder-528"><a href="#DocumentsBuilder-528"><span class="linenos">528</span></a>        <span class="k">while</span> <span class="n">start_paragraph</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">paragraphs</span><span class="p">):</span>
</span><span id="DocumentsBuilder-529"><a href="#DocumentsBuilder-529"><span class="linenos">529</span></a>            <span class="n">end_paragraph</span> <span class="o">=</span> <span class="n">start_paragraph</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chunk_size</span>
</span><span id="DocumentsBuilder-530"><a href="#DocumentsBuilder-530"><span class="linenos">530</span></a>            <span class="n">chunk_paragraphs</span> <span class="o">=</span> <span class="n">paragraphs</span><span class="p">[</span><span class="n">start_paragraph</span><span class="p">:</span><span class="n">end_paragraph</span><span class="p">]</span>
</span><span id="DocumentsBuilder-531"><a href="#DocumentsBuilder-531"><span class="linenos">531</span></a>            <span class="n">chunk</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">chunk_paragraphs</span><span class="p">)</span>
</span><span id="DocumentsBuilder-532"><a href="#DocumentsBuilder-532"><span class="linenos">532</span></a>            
</span><span id="DocumentsBuilder-533"><a href="#DocumentsBuilder-533"><span class="linenos">533</span></a>            <span class="k">if</span> <span class="n">chunk</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
</span><span id="DocumentsBuilder-534"><a href="#DocumentsBuilder-534"><span class="linenos">534</span></a>                <span class="n">chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
</span><span id="DocumentsBuilder-535"><a href="#DocumentsBuilder-535"><span class="linenos">535</span></a>            
</span><span id="DocumentsBuilder-536"><a href="#DocumentsBuilder-536"><span class="linenos">536</span></a>            <span class="n">new_start_paragraph</span> <span class="o">=</span> <span class="n">end_paragraph</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chunk_overlap</span>
</span><span id="DocumentsBuilder-537"><a href="#DocumentsBuilder-537"><span class="linenos">537</span></a>            <span class="k">if</span> <span class="n">new_start_paragraph</span> <span class="o">&lt;=</span> <span class="n">start_paragraph</span><span class="p">:</span>
</span><span id="DocumentsBuilder-538"><a href="#DocumentsBuilder-538"><span class="linenos">538</span></a>                <span class="n">new_start_paragraph</span> <span class="o">=</span> <span class="n">start_paragraph</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="DocumentsBuilder-539"><a href="#DocumentsBuilder-539"><span class="linenos">539</span></a>            <span class="n">start_paragraph</span> <span class="o">=</span> <span class="n">new_start_paragraph</span>
</span><span id="DocumentsBuilder-540"><a href="#DocumentsBuilder-540"><span class="linenos">540</span></a>            
</span><span id="DocumentsBuilder-541"><a href="#DocumentsBuilder-541"><span class="linenos">541</span></a>            <span class="k">if</span> <span class="n">start_paragraph</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">paragraphs</span><span class="p">):</span>
</span><span id="DocumentsBuilder-542"><a href="#DocumentsBuilder-542"><span class="linenos">542</span></a>                <span class="k">break</span>
</span><span id="DocumentsBuilder-543"><a href="#DocumentsBuilder-543"><span class="linenos">543</span></a>        
</span><span id="DocumentsBuilder-544"><a href="#DocumentsBuilder-544"><span class="linenos">544</span></a>        <span class="k">return</span> <span class="n">chunks</span>
</span><span id="DocumentsBuilder-545"><a href="#DocumentsBuilder-545"><span class="linenos">545</span></a>    
</span><span id="DocumentsBuilder-546"><a href="#DocumentsBuilder-546"><span class="linenos">546</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_split_fixed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="DocumentsBuilder-547"><a href="#DocumentsBuilder-547"><span class="linenos">547</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DocumentsBuilder-548"><a href="#DocumentsBuilder-548"><span class="linenos">548</span></a><span class="sd">        Split text into fixed-size chunks without considering boundaries.</span>
</span><span id="DocumentsBuilder-549"><a href="#DocumentsBuilder-549"><span class="linenos">549</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DocumentsBuilder-550"><a href="#DocumentsBuilder-550"><span class="linenos">550</span></a>        <span class="n">chunks</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DocumentsBuilder-551"><a href="#DocumentsBuilder-551"><span class="linenos">551</span></a>        <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="DocumentsBuilder-552"><a href="#DocumentsBuilder-552"><span class="linenos">552</span></a>        
</span><span id="DocumentsBuilder-553"><a href="#DocumentsBuilder-553"><span class="linenos">553</span></a>        <span class="k">while</span> <span class="n">start</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
</span><span id="DocumentsBuilder-554"><a href="#DocumentsBuilder-554"><span class="linenos">554</span></a>            <span class="n">end</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chunk_size</span>
</span><span id="DocumentsBuilder-555"><a href="#DocumentsBuilder-555"><span class="linenos">555</span></a>            <span class="n">chunk</span> <span class="o">=</span> <span class="n">text</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="DocumentsBuilder-556"><a href="#DocumentsBuilder-556"><span class="linenos">556</span></a>            
</span><span id="DocumentsBuilder-557"><a href="#DocumentsBuilder-557"><span class="linenos">557</span></a>            <span class="k">if</span> <span class="n">chunk</span><span class="p">:</span>
</span><span id="DocumentsBuilder-558"><a href="#DocumentsBuilder-558"><span class="linenos">558</span></a>                <span class="n">chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
</span><span id="DocumentsBuilder-559"><a href="#DocumentsBuilder-559"><span class="linenos">559</span></a>            
</span><span id="DocumentsBuilder-560"><a href="#DocumentsBuilder-560"><span class="linenos">560</span></a>            <span class="n">new_start</span> <span class="o">=</span> <span class="n">end</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chunk_overlap</span>
</span><span id="DocumentsBuilder-561"><a href="#DocumentsBuilder-561"><span class="linenos">561</span></a>            <span class="k">if</span> <span class="n">new_start</span> <span class="o">&lt;=</span> <span class="n">start</span><span class="p">:</span>
</span><span id="DocumentsBuilder-562"><a href="#DocumentsBuilder-562"><span class="linenos">562</span></a>                <span class="n">new_start</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="DocumentsBuilder-563"><a href="#DocumentsBuilder-563"><span class="linenos">563</span></a>            <span class="n">start</span> <span class="o">=</span> <span class="n">new_start</span>
</span><span id="DocumentsBuilder-564"><a href="#DocumentsBuilder-564"><span class="linenos">564</span></a>            
</span><span id="DocumentsBuilder-565"><a href="#DocumentsBuilder-565"><span class="linenos">565</span></a>            <span class="k">if</span> <span class="n">start</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
</span><span id="DocumentsBuilder-566"><a href="#DocumentsBuilder-566"><span class="linenos">566</span></a>                <span class="k">break</span>
</span><span id="DocumentsBuilder-567"><a href="#DocumentsBuilder-567"><span class="linenos">567</span></a>        
</span><span id="DocumentsBuilder-568"><a href="#DocumentsBuilder-568"><span class="linenos">568</span></a>        <span class="k">return</span> <span class="n">chunks</span>
</span><span id="DocumentsBuilder-569"><a href="#DocumentsBuilder-569"><span class="linenos">569</span></a>    
</span><span id="DocumentsBuilder-570"><a href="#DocumentsBuilder-570"><span class="linenos">570</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_split_semantic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="DocumentsBuilder-571"><a href="#DocumentsBuilder-571"><span class="linenos">571</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DocumentsBuilder-572"><a href="#DocumentsBuilder-572"><span class="linenos">572</span></a><span class="sd">        Split text by semantic boundaries.</span>
</span><span id="DocumentsBuilder-573"><a href="#DocumentsBuilder-573"><span class="linenos">573</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DocumentsBuilder-574"><a href="#DocumentsBuilder-574"><span class="linenos">574</span></a>        <span class="n">semantic_patterns</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="DocumentsBuilder-575"><a href="#DocumentsBuilder-575"><span class="linenos">575</span></a>            <span class="s1">&#39;</span><span class="se">\n</span><span class="s1"># &#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">## &#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">### &#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">#### &#39;</span><span class="p">,</span>  <span class="c1"># Markdown headers</span>
</span><span id="DocumentsBuilder-576"><a href="#DocumentsBuilder-576"><span class="linenos">576</span></a>            <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">1. &#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">2. &#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">3. &#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">4. &#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">5. &#39;</span><span class="p">,</span>  <span class="c1"># Numbered lists</span>
</span><span id="DocumentsBuilder-577"><a href="#DocumentsBuilder-577"><span class="linenos">577</span></a>            <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">• &#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">- &#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">* &#39;</span><span class="p">,</span>  <span class="c1"># Bullet points</span>
</span><span id="DocumentsBuilder-578"><a href="#DocumentsBuilder-578"><span class="linenos">578</span></a>            <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">,</span>  <span class="c1"># Paragraph breaks</span>
</span><span id="DocumentsBuilder-579"><a href="#DocumentsBuilder-579"><span class="linenos">579</span></a>            <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">---</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">___</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>  <span class="c1"># Horizontal rules</span>
</span><span id="DocumentsBuilder-580"><a href="#DocumentsBuilder-580"><span class="linenos">580</span></a>            <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">Chapter &#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">Section &#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">Part &#39;</span><span class="p">,</span>  <span class="c1"># Document sections</span>
</span><span id="DocumentsBuilder-581"><a href="#DocumentsBuilder-581"><span class="linenos">581</span></a>        <span class="p">]</span>
</span><span id="DocumentsBuilder-582"><a href="#DocumentsBuilder-582"><span class="linenos">582</span></a>        
</span><span id="DocumentsBuilder-583"><a href="#DocumentsBuilder-583"><span class="linenos">583</span></a>        <span class="n">chunks</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DocumentsBuilder-584"><a href="#DocumentsBuilder-584"><span class="linenos">584</span></a>        <span class="n">current_chunk</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="DocumentsBuilder-585"><a href="#DocumentsBuilder-585"><span class="linenos">585</span></a>        
</span><span id="DocumentsBuilder-586"><a href="#DocumentsBuilder-586"><span class="linenos">586</span></a>        <span class="n">parts</span> <span class="o">=</span> <span class="p">[</span><span class="n">text</span><span class="p">]</span>
</span><span id="DocumentsBuilder-587"><a href="#DocumentsBuilder-587"><span class="linenos">587</span></a>        <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">semantic_patterns</span><span class="p">:</span>
</span><span id="DocumentsBuilder-588"><a href="#DocumentsBuilder-588"><span class="linenos">588</span></a>            <span class="n">new_parts</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DocumentsBuilder-589"><a href="#DocumentsBuilder-589"><span class="linenos">589</span></a>            <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">:</span>
</span><span id="DocumentsBuilder-590"><a href="#DocumentsBuilder-590"><span class="linenos">590</span></a>                <span class="k">if</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">part</span><span class="p">:</span>
</span><span id="DocumentsBuilder-591"><a href="#DocumentsBuilder-591"><span class="linenos">591</span></a>                    <span class="n">split_parts</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>
</span><span id="DocumentsBuilder-592"><a href="#DocumentsBuilder-592"><span class="linenos">592</span></a>                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">split_part</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">split_parts</span><span class="p">):</span>
</span><span id="DocumentsBuilder-593"><a href="#DocumentsBuilder-593"><span class="linenos">593</span></a>                        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="DocumentsBuilder-594"><a href="#DocumentsBuilder-594"><span class="linenos">594</span></a>                            <span class="n">split_part</span> <span class="o">=</span> <span class="n">pattern</span> <span class="o">+</span> <span class="n">split_part</span>
</span><span id="DocumentsBuilder-595"><a href="#DocumentsBuilder-595"><span class="linenos">595</span></a>                        <span class="k">if</span> <span class="n">split_part</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
</span><span id="DocumentsBuilder-596"><a href="#DocumentsBuilder-596"><span class="linenos">596</span></a>                            <span class="n">new_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">split_part</span><span class="p">)</span>
</span><span id="DocumentsBuilder-597"><a href="#DocumentsBuilder-597"><span class="linenos">597</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DocumentsBuilder-598"><a href="#DocumentsBuilder-598"><span class="linenos">598</span></a>                    <span class="n">new_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>
</span><span id="DocumentsBuilder-599"><a href="#DocumentsBuilder-599"><span class="linenos">599</span></a>            <span class="n">parts</span> <span class="o">=</span> <span class="n">new_parts</span>
</span><span id="DocumentsBuilder-600"><a href="#DocumentsBuilder-600"><span class="linenos">600</span></a>        
</span><span id="DocumentsBuilder-601"><a href="#DocumentsBuilder-601"><span class="linenos">601</span></a>        <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">:</span>
</span><span id="DocumentsBuilder-602"><a href="#DocumentsBuilder-602"><span class="linenos">602</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">current_chunk</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">part</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chunk_size</span> <span class="ow">and</span> <span class="n">current_chunk</span><span class="p">:</span>
</span><span id="DocumentsBuilder-603"><a href="#DocumentsBuilder-603"><span class="linenos">603</span></a>                <span class="n">chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_chunk</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
</span><span id="DocumentsBuilder-604"><a href="#DocumentsBuilder-604"><span class="linenos">604</span></a>                <span class="n">overlap_start</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">current_chunk</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chunk_overlap</span><span class="p">)</span>
</span><span id="DocumentsBuilder-605"><a href="#DocumentsBuilder-605"><span class="linenos">605</span></a>                <span class="n">current_chunk</span> <span class="o">=</span> <span class="n">current_chunk</span><span class="p">[</span><span class="n">overlap_start</span><span class="p">:]</span> <span class="o">+</span> <span class="n">part</span>
</span><span id="DocumentsBuilder-606"><a href="#DocumentsBuilder-606"><span class="linenos">606</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DocumentsBuilder-607"><a href="#DocumentsBuilder-607"><span class="linenos">607</span></a>                <span class="n">current_chunk</span> <span class="o">+=</span> <span class="n">part</span>
</span><span id="DocumentsBuilder-608"><a href="#DocumentsBuilder-608"><span class="linenos">608</span></a>        
</span><span id="DocumentsBuilder-609"><a href="#DocumentsBuilder-609"><span class="linenos">609</span></a>        <span class="k">if</span> <span class="n">current_chunk</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
</span><span id="DocumentsBuilder-610"><a href="#DocumentsBuilder-610"><span class="linenos">610</span></a>            <span class="n">chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_chunk</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
</span><span id="DocumentsBuilder-611"><a href="#DocumentsBuilder-611"><span class="linenos">611</span></a>        
</span><span id="DocumentsBuilder-612"><a href="#DocumentsBuilder-612"><span class="linenos">612</span></a>        <span class="k">return</span> <span class="n">chunks</span>
</span></pre></div>


            <div class="docstring"><p>A utility class for building document collections from various sources.</p>

<p>This class provides methods to extract text content from files and web pages,
split the content into manageable chunks with configurable size and overlap,
and prepare the data for storage in vector databases.</p>

<p>The DocumentsBuilder is designed to work seamlessly with the RAG system,
producing output that can be directly used with vector database operations.</p>

<p>Features:</p>

<ul>
<li>File-based document extraction with UTF-8 encoding support</li>
<li>Text string processing for in-memory content</li>
<li>Web scraping with multiple engine options (requests, tavily, selenium)</li>
<li>Word document extraction (.doc and .docx formats)</li>
<li>PDF document extraction with metadata</li>
<li>Multiple chunking strategies (word, sentence, paragraph, fixed, semantic)</li>
<li>Configurable chunk size and overlap parameters</li>
<li>Rich metadata generation for each document chunk</li>
<li>Unique ID generation for database storage</li>
</ul>

<p>Attributes:
    _chunk_strategy (str): The chunking strategy to use
    _chunk_size (int): Maximum size of each text chunk in characters
    _chunk_overlap (int): Number of characters to overlap between chunks</p>
</div>


                            <div id="DocumentsBuilder.__init__" class="classattr">
                                        <input id="DocumentsBuilder.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">DocumentsBuilder</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">chunk_strategy</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;word&#39;</span>,</span><span class="param">	<span class="n">chunk_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span>,</span><span class="param">	<span class="n">chunk_overlap</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">custom_split_func</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">function</span> <span class="nb">callable</span><span class="o">&gt;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="DocumentsBuilder.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DocumentsBuilder.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DocumentsBuilder.__init__-42"><a href="#DocumentsBuilder.__init__-42"><span class="linenos">42</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="DocumentsBuilder.__init__-43"><a href="#DocumentsBuilder.__init__-43"><span class="linenos">43</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="DocumentsBuilder.__init__-44"><a href="#DocumentsBuilder.__init__-44"><span class="linenos">44</span></a>        <span class="n">chunk_strategy</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;word&quot;</span><span class="p">,</span>
</span><span id="DocumentsBuilder.__init__-45"><a href="#DocumentsBuilder.__init__-45"><span class="linenos">45</span></a>        <span class="n">chunk_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
</span><span id="DocumentsBuilder.__init__-46"><a href="#DocumentsBuilder.__init__-46"><span class="linenos">46</span></a>        <span class="n">chunk_overlap</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="DocumentsBuilder.__init__-47"><a href="#DocumentsBuilder.__init__-47"><span class="linenos">47</span></a>        <span class="n">custom_split_func</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="DocumentsBuilder.__init__-48"><a href="#DocumentsBuilder.__init__-48"><span class="linenos">48</span></a>    <span class="p">):</span>
</span><span id="DocumentsBuilder.__init__-49"><a href="#DocumentsBuilder.__init__-49"><span class="linenos">49</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DocumentsBuilder.__init__-50"><a href="#DocumentsBuilder.__init__-50"><span class="linenos">50</span></a><span class="sd">        Initialize the DocumentsBuilder with chunking parameters.</span>
</span><span id="DocumentsBuilder.__init__-51"><a href="#DocumentsBuilder.__init__-51"><span class="linenos">51</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DocumentsBuilder.__init__-52"><a href="#DocumentsBuilder.__init__-52"><span class="linenos">52</span></a>        <span class="c1"># If custom_split_func is provided, automatically set strategy to &quot;custom&quot;</span>
</span><span id="DocumentsBuilder.__init__-53"><a href="#DocumentsBuilder.__init__-53"><span class="linenos">53</span></a>        <span class="k">if</span> <span class="n">custom_split_func</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DocumentsBuilder.__init__-54"><a href="#DocumentsBuilder.__init__-54"><span class="linenos">54</span></a>            <span class="n">chunk_strategy</span> <span class="o">=</span> <span class="s2">&quot;custom&quot;</span>
</span><span id="DocumentsBuilder.__init__-55"><a href="#DocumentsBuilder.__init__-55"><span class="linenos">55</span></a>        
</span><span id="DocumentsBuilder.__init__-56"><a href="#DocumentsBuilder.__init__-56"><span class="linenos">56</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_chunk_strategy</span> <span class="o">=</span> <span class="n">chunk_strategy</span>
</span><span id="DocumentsBuilder.__init__-57"><a href="#DocumentsBuilder.__init__-57"><span class="linenos">57</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_chunk_size</span> <span class="o">=</span> <span class="n">chunk_size</span>
</span><span id="DocumentsBuilder.__init__-58"><a href="#DocumentsBuilder.__init__-58"><span class="linenos">58</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_chunk_overlap</span> <span class="o">=</span> <span class="n">chunk_overlap</span>
</span><span id="DocumentsBuilder.__init__-59"><a href="#DocumentsBuilder.__init__-59"><span class="linenos">59</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_custom_split_func</span> <span class="o">=</span> <span class="n">custom_split_func</span>
</span><span id="DocumentsBuilder.__init__-60"><a href="#DocumentsBuilder.__init__-60"><span class="linenos">60</span></a>
</span><span id="DocumentsBuilder.__init__-61"><a href="#DocumentsBuilder.__init__-61"><span class="linenos">61</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_module_cache</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">object</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="DocumentsBuilder.__init__-62"><a href="#DocumentsBuilder.__init__-62"><span class="linenos">62</span></a>        
</span><span id="DocumentsBuilder.__init__-63"><a href="#DocumentsBuilder.__init__-63"><span class="linenos">63</span></a>        <span class="k">if</span> <span class="n">chunk_overlap</span> <span class="o">&gt;=</span> <span class="n">chunk_size</span><span class="p">:</span>
</span><span id="DocumentsBuilder.__init__-64"><a href="#DocumentsBuilder.__init__-64"><span class="linenos">64</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="DocumentsBuilder.__init__-65"><a href="#DocumentsBuilder.__init__-65"><span class="linenos">65</span></a>                <span class="sa">f</span><span class="s2">&quot;chunk_overlap (</span><span class="si">{</span><span class="n">chunk_overlap</span><span class="si">}</span><span class="s2">) must be less than chunk_size (</span><span class="si">{</span><span class="n">chunk_size</span><span class="si">}</span><span class="s2">) &quot;</span>
</span><span id="DocumentsBuilder.__init__-66"><a href="#DocumentsBuilder.__init__-66"><span class="linenos">66</span></a>                <span class="s2">&quot;to prevent infinite loops. Recommended: chunk_overlap should be 10-20</span><span class="si">% o</span><span class="s2">f chunk_size.&quot;</span>
</span><span id="DocumentsBuilder.__init__-67"><a href="#DocumentsBuilder.__init__-67"><span class="linenos">67</span></a>            <span class="p">)</span>
</span><span id="DocumentsBuilder.__init__-68"><a href="#DocumentsBuilder.__init__-68"><span class="linenos">68</span></a>        
</span><span id="DocumentsBuilder.__init__-69"><a href="#DocumentsBuilder.__init__-69"><span class="linenos">69</span></a>        <span class="k">if</span> <span class="n">chunk_size</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="DocumentsBuilder.__init__-70"><a href="#DocumentsBuilder.__init__-70"><span class="linenos">70</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;chunk_size must be positive, got </span><span class="si">{</span><span class="n">chunk_size</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="DocumentsBuilder.__init__-71"><a href="#DocumentsBuilder.__init__-71"><span class="linenos">71</span></a>        
</span><span id="DocumentsBuilder.__init__-72"><a href="#DocumentsBuilder.__init__-72"><span class="linenos">72</span></a>        <span class="k">if</span> <span class="n">chunk_overlap</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="DocumentsBuilder.__init__-73"><a href="#DocumentsBuilder.__init__-73"><span class="linenos">73</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;chunk_overlap must be non-negative, got </span><span class="si">{</span><span class="n">chunk_overlap</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="DocumentsBuilder.__init__-74"><a href="#DocumentsBuilder.__init__-74"><span class="linenos">74</span></a>        
</span><span id="DocumentsBuilder.__init__-75"><a href="#DocumentsBuilder.__init__-75"><span class="linenos">75</span></a>        <span class="k">if</span> <span class="n">chunk_strategy</span> <span class="o">==</span> <span class="s2">&quot;custom&quot;</span> <span class="ow">and</span> <span class="n">custom_split_func</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DocumentsBuilder.__init__-76"><a href="#DocumentsBuilder.__init__-76"><span class="linenos">76</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;custom_split_func must be provided when chunk_strategy=&#39;custom&#39;&quot;</span><span class="p">)</span>
</span><span id="DocumentsBuilder.__init__-77"><a href="#DocumentsBuilder.__init__-77"><span class="linenos">77</span></a>        
</span><span id="DocumentsBuilder.__init__-78"><a href="#DocumentsBuilder.__init__-78"><span class="linenos">78</span></a>        <span class="k">if</span> <span class="n">custom_split_func</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">custom_split_func</span><span class="p">):</span>
</span><span id="DocumentsBuilder.__init__-79"><a href="#DocumentsBuilder.__init__-79"><span class="linenos">79</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;custom_split_func must be callable&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the DocumentsBuilder with chunking parameters.</p>
</div>


                            </div>
                            <div id="DocumentsBuilder.from_file" class="classattr">
                                        <input id="DocumentsBuilder.from_file-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">from_file</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="DocumentsBuilder.from_file-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DocumentsBuilder.from_file"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DocumentsBuilder.from_file-102"><a href="#DocumentsBuilder.from_file-102"><span class="linenos">102</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">from_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
</span><span id="DocumentsBuilder.from_file-103"><a href="#DocumentsBuilder.from_file-103"><span class="linenos">103</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DocumentsBuilder.from_file-104"><a href="#DocumentsBuilder.from_file-104"><span class="linenos">104</span></a><span class="sd">        Read a file and split it into chunks with specified size and overlap.</span>
</span><span id="DocumentsBuilder.from_file-105"><a href="#DocumentsBuilder.from_file-105"><span class="linenos">105</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DocumentsBuilder.from_file-106"><a href="#DocumentsBuilder.from_file-106"><span class="linenos">106</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
</span><span id="DocumentsBuilder.from_file-107"><a href="#DocumentsBuilder.from_file-107"><span class="linenos">107</span></a>            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File not found: </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="DocumentsBuilder.from_file-108"><a href="#DocumentsBuilder.from_file-108"><span class="linenos">108</span></a>        
</span><span id="DocumentsBuilder.from_file-109"><a href="#DocumentsBuilder.from_file-109"><span class="linenos">109</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="DocumentsBuilder.from_file-110"><a href="#DocumentsBuilder.from_file-110"><span class="linenos">110</span></a>            <span class="n">text</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="DocumentsBuilder.from_file-111"><a href="#DocumentsBuilder.from_file-111"><span class="linenos">111</span></a>        
</span><span id="DocumentsBuilder.from_file-112"><a href="#DocumentsBuilder.from_file-112"><span class="linenos">112</span></a>        <span class="n">chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_split_text</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</span><span id="DocumentsBuilder.from_file-113"><a href="#DocumentsBuilder.from_file-113"><span class="linenos">113</span></a>        
</span><span id="DocumentsBuilder.from_file-114"><a href="#DocumentsBuilder.from_file-114"><span class="linenos">114</span></a>        <span class="n">documents</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DocumentsBuilder.from_file-115"><a href="#DocumentsBuilder.from_file-115"><span class="linenos">115</span></a>        <span class="n">metadatas</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DocumentsBuilder.from_file-116"><a href="#DocumentsBuilder.from_file-116"><span class="linenos">116</span></a>        <span class="n">ids</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DocumentsBuilder.from_file-117"><a href="#DocumentsBuilder.from_file-117"><span class="linenos">117</span></a>        
</span><span id="DocumentsBuilder.from_file-118"><a href="#DocumentsBuilder.from_file-118"><span class="linenos">118</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">chunks</span><span class="p">):</span>
</span><span id="DocumentsBuilder.from_file-119"><a href="#DocumentsBuilder.from_file-119"><span class="linenos">119</span></a>            <span class="n">chunk_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
</span><span id="DocumentsBuilder.from_file-120"><a href="#DocumentsBuilder.from_file-120"><span class="linenos">120</span></a>            <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="DocumentsBuilder.from_file-121"><a href="#DocumentsBuilder.from_file-121"><span class="linenos">121</span></a>                <span class="s1">&#39;file_path&#39;</span><span class="p">:</span> <span class="n">file_path</span><span class="p">,</span>
</span><span id="DocumentsBuilder.from_file-122"><a href="#DocumentsBuilder.from_file-122"><span class="linenos">122</span></a>                <span class="s1">&#39;file_name&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file_path</span><span class="p">),</span>
</span><span id="DocumentsBuilder.from_file-123"><a href="#DocumentsBuilder.from_file-123"><span class="linenos">123</span></a>                <span class="s1">&#39;chunk_index&#39;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span>
</span><span id="DocumentsBuilder.from_file-124"><a href="#DocumentsBuilder.from_file-124"><span class="linenos">124</span></a>                <span class="s1">&#39;total_chunks&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunks</span><span class="p">),</span>
</span><span id="DocumentsBuilder.from_file-125"><a href="#DocumentsBuilder.from_file-125"><span class="linenos">125</span></a>                <span class="s1">&#39;chunk_size&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
</span><span id="DocumentsBuilder.from_file-126"><a href="#DocumentsBuilder.from_file-126"><span class="linenos">126</span></a>            <span class="p">}</span>
</span><span id="DocumentsBuilder.from_file-127"><a href="#DocumentsBuilder.from_file-127"><span class="linenos">127</span></a>            <span class="n">documents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
</span><span id="DocumentsBuilder.from_file-128"><a href="#DocumentsBuilder.from_file-128"><span class="linenos">128</span></a>            <span class="n">metadatas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span>
</span><span id="DocumentsBuilder.from_file-129"><a href="#DocumentsBuilder.from_file-129"><span class="linenos">129</span></a>            <span class="n">ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk_id</span><span class="p">)</span>
</span><span id="DocumentsBuilder.from_file-130"><a href="#DocumentsBuilder.from_file-130"><span class="linenos">130</span></a>        
</span><span id="DocumentsBuilder.from_file-131"><a href="#DocumentsBuilder.from_file-131"><span class="linenos">131</span></a>        <span class="k">return</span> <span class="n">documents</span><span class="p">,</span> <span class="n">metadatas</span><span class="p">,</span> <span class="n">ids</span>
</span></pre></div>


            <div class="docstring"><p>Read a file and split it into chunks with specified size and overlap.</p>
</div>


                            </div>
                            <div id="DocumentsBuilder.from_str" class="classattr">
                                        <input id="DocumentsBuilder.from_str-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">from_str</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">text</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">source_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;text_string&#39;</span></span><span class="return-annotation">) -> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="DocumentsBuilder.from_str-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DocumentsBuilder.from_str"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DocumentsBuilder.from_str-133"><a href="#DocumentsBuilder.from_str-133"><span class="linenos">133</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">from_str</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">source_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;text_string&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
</span><span id="DocumentsBuilder.from_str-134"><a href="#DocumentsBuilder.from_str-134"><span class="linenos">134</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DocumentsBuilder.from_str-135"><a href="#DocumentsBuilder.from_str-135"><span class="linenos">135</span></a><span class="sd">        Process a text string and split it into chunks with specified size and overlap.</span>
</span><span id="DocumentsBuilder.from_str-136"><a href="#DocumentsBuilder.from_str-136"><span class="linenos">136</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DocumentsBuilder.from_str-137"><a href="#DocumentsBuilder.from_str-137"><span class="linenos">137</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">text</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
</span><span id="DocumentsBuilder.from_str-138"><a href="#DocumentsBuilder.from_str-138"><span class="linenos">138</span></a>            <span class="k">return</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
</span><span id="DocumentsBuilder.from_str-139"><a href="#DocumentsBuilder.from_str-139"><span class="linenos">139</span></a>        
</span><span id="DocumentsBuilder.from_str-140"><a href="#DocumentsBuilder.from_str-140"><span class="linenos">140</span></a>        <span class="n">chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_split_text</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</span><span id="DocumentsBuilder.from_str-141"><a href="#DocumentsBuilder.from_str-141"><span class="linenos">141</span></a>        
</span><span id="DocumentsBuilder.from_str-142"><a href="#DocumentsBuilder.from_str-142"><span class="linenos">142</span></a>        <span class="n">documents</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DocumentsBuilder.from_str-143"><a href="#DocumentsBuilder.from_str-143"><span class="linenos">143</span></a>        <span class="n">metadatas</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DocumentsBuilder.from_str-144"><a href="#DocumentsBuilder.from_str-144"><span class="linenos">144</span></a>        <span class="n">ids</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DocumentsBuilder.from_str-145"><a href="#DocumentsBuilder.from_str-145"><span class="linenos">145</span></a>        
</span><span id="DocumentsBuilder.from_str-146"><a href="#DocumentsBuilder.from_str-146"><span class="linenos">146</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">chunks</span><span class="p">):</span>
</span><span id="DocumentsBuilder.from_str-147"><a href="#DocumentsBuilder.from_str-147"><span class="linenos">147</span></a>            <span class="n">chunk_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
</span><span id="DocumentsBuilder.from_str-148"><a href="#DocumentsBuilder.from_str-148"><span class="linenos">148</span></a>            <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="DocumentsBuilder.from_str-149"><a href="#DocumentsBuilder.from_str-149"><span class="linenos">149</span></a>                <span class="s1">&#39;source_type&#39;</span><span class="p">:</span> <span class="s1">&#39;text_string&#39;</span><span class="p">,</span>
</span><span id="DocumentsBuilder.from_str-150"><a href="#DocumentsBuilder.from_str-150"><span class="linenos">150</span></a>                <span class="s1">&#39;source_name&#39;</span><span class="p">:</span> <span class="n">source_name</span><span class="p">,</span>
</span><span id="DocumentsBuilder.from_str-151"><a href="#DocumentsBuilder.from_str-151"><span class="linenos">151</span></a>                <span class="s1">&#39;chunk_index&#39;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span>
</span><span id="DocumentsBuilder.from_str-152"><a href="#DocumentsBuilder.from_str-152"><span class="linenos">152</span></a>                <span class="s1">&#39;total_chunks&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunks</span><span class="p">),</span>
</span><span id="DocumentsBuilder.from_str-153"><a href="#DocumentsBuilder.from_str-153"><span class="linenos">153</span></a>                <span class="s1">&#39;chunk_size&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunk</span><span class="p">),</span>
</span><span id="DocumentsBuilder.from_str-154"><a href="#DocumentsBuilder.from_str-154"><span class="linenos">154</span></a>                <span class="s1">&#39;chunk_strategy&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chunk_strategy</span>
</span><span id="DocumentsBuilder.from_str-155"><a href="#DocumentsBuilder.from_str-155"><span class="linenos">155</span></a>            <span class="p">}</span>
</span><span id="DocumentsBuilder.from_str-156"><a href="#DocumentsBuilder.from_str-156"><span class="linenos">156</span></a>            <span class="n">documents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
</span><span id="DocumentsBuilder.from_str-157"><a href="#DocumentsBuilder.from_str-157"><span class="linenos">157</span></a>            <span class="n">metadatas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span>
</span><span id="DocumentsBuilder.from_str-158"><a href="#DocumentsBuilder.from_str-158"><span class="linenos">158</span></a>            <span class="n">ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk_id</span><span class="p">)</span>
</span><span id="DocumentsBuilder.from_str-159"><a href="#DocumentsBuilder.from_str-159"><span class="linenos">159</span></a>        
</span><span id="DocumentsBuilder.from_str-160"><a href="#DocumentsBuilder.from_str-160"><span class="linenos">160</span></a>        <span class="k">return</span> <span class="n">documents</span><span class="p">,</span> <span class="n">metadatas</span><span class="p">,</span> <span class="n">ids</span>
</span></pre></div>


            <div class="docstring"><p>Process a text string and split it into chunks with specified size and overlap.</p>
</div>


                            </div>
                            <div id="DocumentsBuilder.from_doc" class="classattr">
                                        <input id="DocumentsBuilder.from_doc-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">from_doc</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">extraction_method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;auto&#39;</span></span><span class="return-annotation">) -> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="DocumentsBuilder.from_doc-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DocumentsBuilder.from_doc"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DocumentsBuilder.from_doc-162"><a href="#DocumentsBuilder.from_doc-162"><span class="linenos">162</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">from_doc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">extraction_method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;auto&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
</span><span id="DocumentsBuilder.from_doc-163"><a href="#DocumentsBuilder.from_doc-163"><span class="linenos">163</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DocumentsBuilder.from_doc-164"><a href="#DocumentsBuilder.from_doc-164"><span class="linenos">164</span></a><span class="sd">        Extract text from Word documents (.doc and .docx files) and split into chunks.</span>
</span><span id="DocumentsBuilder.from_doc-165"><a href="#DocumentsBuilder.from_doc-165"><span class="linenos">165</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DocumentsBuilder.from_doc-166"><a href="#DocumentsBuilder.from_doc-166"><span class="linenos">166</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
</span><span id="DocumentsBuilder.from_doc-167"><a href="#DocumentsBuilder.from_doc-167"><span class="linenos">167</span></a>            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File not found: </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="DocumentsBuilder.from_doc-168"><a href="#DocumentsBuilder.from_doc-168"><span class="linenos">168</span></a>        
</span><span id="DocumentsBuilder.from_doc-169"><a href="#DocumentsBuilder.from_doc-169"><span class="linenos">169</span></a>        <span class="n">file_extension</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">file_path</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="DocumentsBuilder.from_doc-170"><a href="#DocumentsBuilder.from_doc-170"><span class="linenos">170</span></a>        <span class="k">if</span> <span class="n">file_extension</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;.doc&#39;</span><span class="p">,</span> <span class="s1">&#39;.docx&#39;</span><span class="p">]:</span>
</span><span id="DocumentsBuilder.from_doc-171"><a href="#DocumentsBuilder.from_doc-171"><span class="linenos">171</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported file format: </span><span class="si">{</span><span class="n">file_extension</span><span class="si">}</span><span class="s2">. Only .doc and .docx files are supported.&quot;</span><span class="p">)</span>
</span><span id="DocumentsBuilder.from_doc-172"><a href="#DocumentsBuilder.from_doc-172"><span class="linenos">172</span></a>        
</span><span id="DocumentsBuilder.from_doc-173"><a href="#DocumentsBuilder.from_doc-173"><span class="linenos">173</span></a>        <span class="c1"># Selezione metodo al volo con lazy detection</span>
</span><span id="DocumentsBuilder.from_doc-174"><a href="#DocumentsBuilder.from_doc-174"><span class="linenos">174</span></a>        <span class="k">if</span> <span class="n">extraction_method</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span><span class="p">:</span>
</span><span id="DocumentsBuilder.from_doc-175"><a href="#DocumentsBuilder.from_doc-175"><span class="linenos">175</span></a>            <span class="k">if</span> <span class="n">file_extension</span> <span class="o">==</span> <span class="s1">&#39;.docx&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_module</span><span class="p">(</span><span class="s2">&quot;docx&quot;</span><span class="p">):</span>
</span><span id="DocumentsBuilder.from_doc-176"><a href="#DocumentsBuilder.from_doc-176"><span class="linenos">176</span></a>                <span class="n">extraction_method</span> <span class="o">=</span> <span class="s2">&quot;docx&quot;</span>
</span><span id="DocumentsBuilder.from_doc-177"><a href="#DocumentsBuilder.from_doc-177"><span class="linenos">177</span></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_module</span><span class="p">(</span><span class="s2">&quot;docx2txt&quot;</span><span class="p">):</span>
</span><span id="DocumentsBuilder.from_doc-178"><a href="#DocumentsBuilder.from_doc-178"><span class="linenos">178</span></a>                <span class="n">extraction_method</span> <span class="o">=</span> <span class="s2">&quot;docx2txt&quot;</span>
</span><span id="DocumentsBuilder.from_doc-179"><a href="#DocumentsBuilder.from_doc-179"><span class="linenos">179</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DocumentsBuilder.from_doc-180"><a href="#DocumentsBuilder.from_doc-180"><span class="linenos">180</span></a>                <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>
</span><span id="DocumentsBuilder.from_doc-181"><a href="#DocumentsBuilder.from_doc-181"><span class="linenos">181</span></a>                    <span class="s2">&quot;docx2txt is required for .docx file extraction. Install with: pip install docx2txt&quot;</span>
</span><span id="DocumentsBuilder.from_doc-182"><a href="#DocumentsBuilder.from_doc-182"><span class="linenos">182</span></a>                <span class="p">)</span>
</span><span id="DocumentsBuilder.from_doc-183"><a href="#DocumentsBuilder.from_doc-183"><span class="linenos">183</span></a>        
</span><span id="DocumentsBuilder.from_doc-184"><a href="#DocumentsBuilder.from_doc-184"><span class="linenos">184</span></a>        <span class="k">if</span> <span class="n">extraction_method</span> <span class="o">==</span> <span class="s2">&quot;docx&quot;</span><span class="p">:</span>
</span><span id="DocumentsBuilder.from_doc-185"><a href="#DocumentsBuilder.from_doc-185"><span class="linenos">185</span></a>            <span class="k">if</span> <span class="n">file_extension</span> <span class="o">!=</span> <span class="s1">&#39;.docx&#39;</span><span class="p">:</span>
</span><span id="DocumentsBuilder.from_doc-186"><a href="#DocumentsBuilder.from_doc-186"><span class="linenos">186</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&#39;docx&#39; extraction method only supports .docx files&quot;</span><span class="p">)</span>
</span><span id="DocumentsBuilder.from_doc-187"><a href="#DocumentsBuilder.from_doc-187"><span class="linenos">187</span></a>            <span class="n">text</span><span class="p">,</span> <span class="n">doc_properties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_with_docx</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="DocumentsBuilder.from_doc-188"><a href="#DocumentsBuilder.from_doc-188"><span class="linenos">188</span></a>        <span class="k">elif</span> <span class="n">extraction_method</span> <span class="o">==</span> <span class="s2">&quot;docx2txt&quot;</span><span class="p">:</span>
</span><span id="DocumentsBuilder.from_doc-189"><a href="#DocumentsBuilder.from_doc-189"><span class="linenos">189</span></a>            <span class="n">text</span><span class="p">,</span> <span class="n">doc_properties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_with_docx2txt</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</span><span id="DocumentsBuilder.from_doc-190"><a href="#DocumentsBuilder.from_doc-190"><span class="linenos">190</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DocumentsBuilder.from_doc-191"><a href="#DocumentsBuilder.from_doc-191"><span class="linenos">191</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported extraction method: </span><span class="si">{</span><span class="n">extraction_method</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="DocumentsBuilder.from_doc-192"><a href="#DocumentsBuilder.from_doc-192"><span class="linenos">192</span></a>        
</span><span id="DocumentsBuilder.from_doc-193"><a href="#DocumentsBuilder.from_doc-193"><span class="linenos">193</span></a>        <span class="n">chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_split_text</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</span><span id="DocumentsBuilder.from_doc-194"><a href="#DocumentsBuilder.from_doc-194"><span class="linenos">194</span></a>        
</span><span id="DocumentsBuilder.from_doc-195"><a href="#DocumentsBuilder.from_doc-195"><span class="linenos">195</span></a>        <span class="n">documents</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DocumentsBuilder.from_doc-196"><a href="#DocumentsBuilder.from_doc-196"><span class="linenos">196</span></a>        <span class="n">metadatas</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DocumentsBuilder.from_doc-197"><a href="#DocumentsBuilder.from_doc-197"><span class="linenos">197</span></a>        <span class="n">ids</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DocumentsBuilder.from_doc-198"><a href="#DocumentsBuilder.from_doc-198"><span class="linenos">198</span></a>        
</span><span id="DocumentsBuilder.from_doc-199"><a href="#DocumentsBuilder.from_doc-199"><span class="linenos">199</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">chunks</span><span class="p">):</span>
</span><span id="DocumentsBuilder.from_doc-200"><a href="#DocumentsBuilder.from_doc-200"><span class="linenos">200</span></a>            <span class="n">chunk_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
</span><span id="DocumentsBuilder.from_doc-201"><a href="#DocumentsBuilder.from_doc-201"><span class="linenos">201</span></a>            <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="DocumentsBuilder.from_doc-202"><a href="#DocumentsBuilder.from_doc-202"><span class="linenos">202</span></a>                <span class="s1">&#39;file_path&#39;</span><span class="p">:</span> <span class="n">file_path</span><span class="p">,</span>
</span><span id="DocumentsBuilder.from_doc-203"><a href="#DocumentsBuilder.from_doc-203"><span class="linenos">203</span></a>                <span class="s1">&#39;file_name&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file_path</span><span class="p">),</span>
</span><span id="DocumentsBuilder.from_doc-204"><a href="#DocumentsBuilder.from_doc-204"><span class="linenos">204</span></a>                <span class="s1">&#39;document_format&#39;</span><span class="p">:</span> <span class="n">file_extension</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span>  <span class="c1"># Remove the dot</span>
</span><span id="DocumentsBuilder.from_doc-205"><a href="#DocumentsBuilder.from_doc-205"><span class="linenos">205</span></a>                <span class="s1">&#39;extraction_method&#39;</span><span class="p">:</span> <span class="n">extraction_method</span><span class="p">,</span>
</span><span id="DocumentsBuilder.from_doc-206"><a href="#DocumentsBuilder.from_doc-206"><span class="linenos">206</span></a>                <span class="s1">&#39;chunk_index&#39;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span>
</span><span id="DocumentsBuilder.from_doc-207"><a href="#DocumentsBuilder.from_doc-207"><span class="linenos">207</span></a>                <span class="s1">&#39;total_chunks&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunks</span><span class="p">),</span>
</span><span id="DocumentsBuilder.from_doc-208"><a href="#DocumentsBuilder.from_doc-208"><span class="linenos">208</span></a>                <span class="s1">&#39;chunk_size&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
</span><span id="DocumentsBuilder.from_doc-209"><a href="#DocumentsBuilder.from_doc-209"><span class="linenos">209</span></a>            <span class="p">}</span>
</span><span id="DocumentsBuilder.from_doc-210"><a href="#DocumentsBuilder.from_doc-210"><span class="linenos">210</span></a>            <span class="k">if</span> <span class="n">doc_properties</span><span class="p">:</span>
</span><span id="DocumentsBuilder.from_doc-211"><a href="#DocumentsBuilder.from_doc-211"><span class="linenos">211</span></a>                <span class="n">metadata</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">doc_properties</span><span class="p">)</span>
</span><span id="DocumentsBuilder.from_doc-212"><a href="#DocumentsBuilder.from_doc-212"><span class="linenos">212</span></a>            
</span><span id="DocumentsBuilder.from_doc-213"><a href="#DocumentsBuilder.from_doc-213"><span class="linenos">213</span></a>            <span class="n">documents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
</span><span id="DocumentsBuilder.from_doc-214"><a href="#DocumentsBuilder.from_doc-214"><span class="linenos">214</span></a>            <span class="n">metadatas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span>
</span><span id="DocumentsBuilder.from_doc-215"><a href="#DocumentsBuilder.from_doc-215"><span class="linenos">215</span></a>            <span class="n">ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk_id</span><span class="p">)</span>
</span><span id="DocumentsBuilder.from_doc-216"><a href="#DocumentsBuilder.from_doc-216"><span class="linenos">216</span></a>        
</span><span id="DocumentsBuilder.from_doc-217"><a href="#DocumentsBuilder.from_doc-217"><span class="linenos">217</span></a>        <span class="k">return</span> <span class="n">documents</span><span class="p">,</span> <span class="n">metadatas</span><span class="p">,</span> <span class="n">ids</span>
</span></pre></div>


            <div class="docstring"><p>Extract text from Word documents (.doc and .docx files) and split into chunks.</p>
</div>


                            </div>
                            <div id="DocumentsBuilder.from_pdf" class="classattr">
                                        <input id="DocumentsBuilder.from_pdf-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">from_pdf</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">page_range</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="DocumentsBuilder.from_pdf-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DocumentsBuilder.from_pdf"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DocumentsBuilder.from_pdf-219"><a href="#DocumentsBuilder.from_pdf-219"><span class="linenos">219</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">from_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">page_range</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
</span><span id="DocumentsBuilder.from_pdf-220"><a href="#DocumentsBuilder.from_pdf-220"><span class="linenos">220</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DocumentsBuilder.from_pdf-221"><a href="#DocumentsBuilder.from_pdf-221"><span class="linenos">221</span></a><span class="sd">        Extract text from PDF documents and split into chunks.</span>
</span><span id="DocumentsBuilder.from_pdf-222"><a href="#DocumentsBuilder.from_pdf-222"><span class="linenos">222</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DocumentsBuilder.from_pdf-223"><a href="#DocumentsBuilder.from_pdf-223"><span class="linenos">223</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
</span><span id="DocumentsBuilder.from_pdf-224"><a href="#DocumentsBuilder.from_pdf-224"><span class="linenos">224</span></a>            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File not found: </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="DocumentsBuilder.from_pdf-225"><a href="#DocumentsBuilder.from_pdf-225"><span class="linenos">225</span></a>        
</span><span id="DocumentsBuilder.from_pdf-226"><a href="#DocumentsBuilder.from_pdf-226"><span class="linenos">226</span></a>        <span class="n">file_extension</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">file_path</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="DocumentsBuilder.from_pdf-227"><a href="#DocumentsBuilder.from_pdf-227"><span class="linenos">227</span></a>        <span class="k">if</span> <span class="n">file_extension</span> <span class="o">!=</span> <span class="s1">&#39;.pdf&#39;</span><span class="p">:</span>
</span><span id="DocumentsBuilder.from_pdf-228"><a href="#DocumentsBuilder.from_pdf-228"><span class="linenos">228</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported file format: </span><span class="si">{</span><span class="n">file_extension</span><span class="si">}</span><span class="s2">. Only .pdf files are supported.&quot;</span><span class="p">)</span>
</span><span id="DocumentsBuilder.from_pdf-229"><a href="#DocumentsBuilder.from_pdf-229"><span class="linenos">229</span></a>        
</span><span id="DocumentsBuilder.from_pdf-230"><a href="#DocumentsBuilder.from_pdf-230"><span class="linenos">230</span></a>        <span class="c1"># qui PyPDF2 viene importato solo se davvero richiesto</span>
</span><span id="DocumentsBuilder.from_pdf-231"><a href="#DocumentsBuilder.from_pdf-231"><span class="linenos">231</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_module</span><span class="p">(</span><span class="s2">&quot;PyPDF2&quot;</span><span class="p">):</span>
</span><span id="DocumentsBuilder.from_pdf-232"><a href="#DocumentsBuilder.from_pdf-232"><span class="linenos">232</span></a>            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;PyPDF2 is required for PDF file extraction. Install with: pip install PyPDF2&quot;</span><span class="p">)</span>
</span><span id="DocumentsBuilder.from_pdf-233"><a href="#DocumentsBuilder.from_pdf-233"><span class="linenos">233</span></a>        
</span><span id="DocumentsBuilder.from_pdf-234"><a href="#DocumentsBuilder.from_pdf-234"><span class="linenos">234</span></a>        <span class="n">text</span><span class="p">,</span> <span class="n">pdf_properties</span><span class="p">,</span> <span class="n">page_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_from_pdf</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">page_range</span><span class="p">)</span>
</span><span id="DocumentsBuilder.from_pdf-235"><a href="#DocumentsBuilder.from_pdf-235"><span class="linenos">235</span></a>        
</span><span id="DocumentsBuilder.from_pdf-236"><a href="#DocumentsBuilder.from_pdf-236"><span class="linenos">236</span></a>        <span class="n">chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_split_text</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</span><span id="DocumentsBuilder.from_pdf-237"><a href="#DocumentsBuilder.from_pdf-237"><span class="linenos">237</span></a>        
</span><span id="DocumentsBuilder.from_pdf-238"><a href="#DocumentsBuilder.from_pdf-238"><span class="linenos">238</span></a>        <span class="n">documents</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DocumentsBuilder.from_pdf-239"><a href="#DocumentsBuilder.from_pdf-239"><span class="linenos">239</span></a>        <span class="n">metadatas</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DocumentsBuilder.from_pdf-240"><a href="#DocumentsBuilder.from_pdf-240"><span class="linenos">240</span></a>        <span class="n">ids</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DocumentsBuilder.from_pdf-241"><a href="#DocumentsBuilder.from_pdf-241"><span class="linenos">241</span></a>        
</span><span id="DocumentsBuilder.from_pdf-242"><a href="#DocumentsBuilder.from_pdf-242"><span class="linenos">242</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">chunks</span><span class="p">):</span>
</span><span id="DocumentsBuilder.from_pdf-243"><a href="#DocumentsBuilder.from_pdf-243"><span class="linenos">243</span></a>            <span class="n">chunk_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
</span><span id="DocumentsBuilder.from_pdf-244"><a href="#DocumentsBuilder.from_pdf-244"><span class="linenos">244</span></a>            <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="DocumentsBuilder.from_pdf-245"><a href="#DocumentsBuilder.from_pdf-245"><span class="linenos">245</span></a>                <span class="s1">&#39;file_path&#39;</span><span class="p">:</span> <span class="n">file_path</span><span class="p">,</span>
</span><span id="DocumentsBuilder.from_pdf-246"><a href="#DocumentsBuilder.from_pdf-246"><span class="linenos">246</span></a>                <span class="s1">&#39;file_name&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file_path</span><span class="p">),</span>
</span><span id="DocumentsBuilder.from_pdf-247"><a href="#DocumentsBuilder.from_pdf-247"><span class="linenos">247</span></a>                <span class="s1">&#39;document_format&#39;</span><span class="p">:</span> <span class="s1">&#39;pdf&#39;</span><span class="p">,</span>
</span><span id="DocumentsBuilder.from_pdf-248"><a href="#DocumentsBuilder.from_pdf-248"><span class="linenos">248</span></a>                <span class="s1">&#39;chunk_index&#39;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span>
</span><span id="DocumentsBuilder.from_pdf-249"><a href="#DocumentsBuilder.from_pdf-249"><span class="linenos">249</span></a>                <span class="s1">&#39;total_chunks&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunks</span><span class="p">),</span>
</span><span id="DocumentsBuilder.from_pdf-250"><a href="#DocumentsBuilder.from_pdf-250"><span class="linenos">250</span></a>                <span class="s1">&#39;chunk_size&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
</span><span id="DocumentsBuilder.from_pdf-251"><a href="#DocumentsBuilder.from_pdf-251"><span class="linenos">251</span></a>            <span class="p">}</span>
</span><span id="DocumentsBuilder.from_pdf-252"><a href="#DocumentsBuilder.from_pdf-252"><span class="linenos">252</span></a>            <span class="k">if</span> <span class="n">pdf_properties</span><span class="p">:</span>
</span><span id="DocumentsBuilder.from_pdf-253"><a href="#DocumentsBuilder.from_pdf-253"><span class="linenos">253</span></a>                <span class="n">metadata</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">pdf_properties</span><span class="p">)</span>
</span><span id="DocumentsBuilder.from_pdf-254"><a href="#DocumentsBuilder.from_pdf-254"><span class="linenos">254</span></a>            <span class="k">if</span> <span class="n">page_info</span><span class="p">:</span>
</span><span id="DocumentsBuilder.from_pdf-255"><a href="#DocumentsBuilder.from_pdf-255"><span class="linenos">255</span></a>                <span class="n">metadata</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">page_info</span><span class="p">)</span>
</span><span id="DocumentsBuilder.from_pdf-256"><a href="#DocumentsBuilder.from_pdf-256"><span class="linenos">256</span></a>            
</span><span id="DocumentsBuilder.from_pdf-257"><a href="#DocumentsBuilder.from_pdf-257"><span class="linenos">257</span></a>            <span class="n">documents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
</span><span id="DocumentsBuilder.from_pdf-258"><a href="#DocumentsBuilder.from_pdf-258"><span class="linenos">258</span></a>            <span class="n">metadatas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span>
</span><span id="DocumentsBuilder.from_pdf-259"><a href="#DocumentsBuilder.from_pdf-259"><span class="linenos">259</span></a>            <span class="n">ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk_id</span><span class="p">)</span>
</span><span id="DocumentsBuilder.from_pdf-260"><a href="#DocumentsBuilder.from_pdf-260"><span class="linenos">260</span></a>        
</span><span id="DocumentsBuilder.from_pdf-261"><a href="#DocumentsBuilder.from_pdf-261"><span class="linenos">261</span></a>        <span class="k">return</span> <span class="n">documents</span><span class="p">,</span> <span class="n">metadatas</span><span class="p">,</span> <span class="n">ids</span>
</span></pre></div>


            <div class="docstring"><p>Extract text from PDF documents and split into chunks.</p>
</div>


                            </div>
                            <div id="DocumentsBuilder.from_url" class="classattr">
                                        <input id="DocumentsBuilder.from_url-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">from_url</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">url</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">engine</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;requests&#39;</span>,</span><span class="param">	<span class="n">deep</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="DocumentsBuilder.from_url-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DocumentsBuilder.from_url"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DocumentsBuilder.from_url-263"><a href="#DocumentsBuilder.from_url-263"><span class="linenos">263</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">from_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">engine</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;requests&quot;</span><span class="p">,</span> <span class="n">deep</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
</span><span id="DocumentsBuilder.from_url-264"><a href="#DocumentsBuilder.from_url-264"><span class="linenos">264</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DocumentsBuilder.from_url-265"><a href="#DocumentsBuilder.from_url-265"><span class="linenos">265</span></a><span class="sd">        Scrape content from a URL and split it into chunks with specified size and overlap.</span>
</span><span id="DocumentsBuilder.from_url-266"><a href="#DocumentsBuilder.from_url-266"><span class="linenos">266</span></a><span class="sd">        </span>
</span><span id="DocumentsBuilder.from_url-267"><a href="#DocumentsBuilder.from_url-267"><span class="linenos">267</span></a><span class="sd">        Notes:</span>
</span><span id="DocumentsBuilder.from_url-268"><a href="#DocumentsBuilder.from_url-268"><span class="linenos">268</span></a><span class="sd">        - Scraping may take time depending on the engine and website complexity</span>
</span><span id="DocumentsBuilder.from_url-269"><a href="#DocumentsBuilder.from_url-269"><span class="linenos">269</span></a><span class="sd">        - Some websites may block automated scraping</span>
</span><span id="DocumentsBuilder.from_url-270"><a href="#DocumentsBuilder.from_url-270"><span class="linenos">270</span></a><span class="sd">        - Selenium requires Chrome/Chromium to be installed</span>
</span><span id="DocumentsBuilder.from_url-271"><a href="#DocumentsBuilder.from_url-271"><span class="linenos">271</span></a><span class="sd">        - Tavily requires an API key to be configured</span>
</span><span id="DocumentsBuilder.from_url-272"><a href="#DocumentsBuilder.from_url-272"><span class="linenos">272</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DocumentsBuilder.from_url-273"><a href="#DocumentsBuilder.from_url-273"><span class="linenos">273</span></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">monoai.tools.webscraping</span><span class="w"> </span><span class="kn">import</span> <span class="n">scrape_web</span>
</span><span id="DocumentsBuilder.from_url-274"><a href="#DocumentsBuilder.from_url-274"><span class="linenos">274</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">scrape_web</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="n">engine</span><span class="p">,</span> <span class="n">deep</span><span class="o">=</span><span class="n">deep</span><span class="p">)</span>
</span><span id="DocumentsBuilder.from_url-275"><a href="#DocumentsBuilder.from_url-275"><span class="linenos">275</span></a>                
</span><span id="DocumentsBuilder.from_url-276"><a href="#DocumentsBuilder.from_url-276"><span class="linenos">276</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">):</span>
</span><span id="DocumentsBuilder.from_url-277"><a href="#DocumentsBuilder.from_url-277"><span class="linenos">277</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to extract text content from URL: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="DocumentsBuilder.from_url-278"><a href="#DocumentsBuilder.from_url-278"><span class="linenos">278</span></a>        
</span><span id="DocumentsBuilder.from_url-279"><a href="#DocumentsBuilder.from_url-279"><span class="linenos">279</span></a>        <span class="n">text</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span>
</span><span id="DocumentsBuilder.from_url-280"><a href="#DocumentsBuilder.from_url-280"><span class="linenos">280</span></a>        <span class="n">chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_split_text</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</span><span id="DocumentsBuilder.from_url-281"><a href="#DocumentsBuilder.from_url-281"><span class="linenos">281</span></a>        
</span><span id="DocumentsBuilder.from_url-282"><a href="#DocumentsBuilder.from_url-282"><span class="linenos">282</span></a>        <span class="n">documents</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DocumentsBuilder.from_url-283"><a href="#DocumentsBuilder.from_url-283"><span class="linenos">283</span></a>        <span class="n">metadatas</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DocumentsBuilder.from_url-284"><a href="#DocumentsBuilder.from_url-284"><span class="linenos">284</span></a>        <span class="n">ids</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DocumentsBuilder.from_url-285"><a href="#DocumentsBuilder.from_url-285"><span class="linenos">285</span></a>        
</span><span id="DocumentsBuilder.from_url-286"><a href="#DocumentsBuilder.from_url-286"><span class="linenos">286</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">chunks</span><span class="p">):</span>
</span><span id="DocumentsBuilder.from_url-287"><a href="#DocumentsBuilder.from_url-287"><span class="linenos">287</span></a>            <span class="n">chunk_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
</span><span id="DocumentsBuilder.from_url-288"><a href="#DocumentsBuilder.from_url-288"><span class="linenos">288</span></a>            <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="DocumentsBuilder.from_url-289"><a href="#DocumentsBuilder.from_url-289"><span class="linenos">289</span></a>                <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span>
</span><span id="DocumentsBuilder.from_url-290"><a href="#DocumentsBuilder.from_url-290"><span class="linenos">290</span></a>                <span class="s1">&#39;source_type&#39;</span><span class="p">:</span> <span class="s1">&#39;web_page&#39;</span><span class="p">,</span>
</span><span id="DocumentsBuilder.from_url-291"><a href="#DocumentsBuilder.from_url-291"><span class="linenos">291</span></a>                <span class="s1">&#39;scraping_engine&#39;</span><span class="p">:</span> <span class="n">engine</span><span class="p">,</span>
</span><span id="DocumentsBuilder.from_url-292"><a href="#DocumentsBuilder.from_url-292"><span class="linenos">292</span></a>                <span class="s1">&#39;deep_extraction&#39;</span><span class="p">:</span> <span class="n">deep</span><span class="p">,</span>
</span><span id="DocumentsBuilder.from_url-293"><a href="#DocumentsBuilder.from_url-293"><span class="linenos">293</span></a>                <span class="s1">&#39;chunk_index&#39;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span>
</span><span id="DocumentsBuilder.from_url-294"><a href="#DocumentsBuilder.from_url-294"><span class="linenos">294</span></a>                <span class="s1">&#39;total_chunks&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunks</span><span class="p">),</span>
</span><span id="DocumentsBuilder.from_url-295"><a href="#DocumentsBuilder.from_url-295"><span class="linenos">295</span></a>                <span class="s1">&#39;chunk_size&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
</span><span id="DocumentsBuilder.from_url-296"><a href="#DocumentsBuilder.from_url-296"><span class="linenos">296</span></a>            <span class="p">}</span>
</span><span id="DocumentsBuilder.from_url-297"><a href="#DocumentsBuilder.from_url-297"><span class="linenos">297</span></a>            <span class="n">documents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
</span><span id="DocumentsBuilder.from_url-298"><a href="#DocumentsBuilder.from_url-298"><span class="linenos">298</span></a>            <span class="n">metadatas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span>
</span><span id="DocumentsBuilder.from_url-299"><a href="#DocumentsBuilder.from_url-299"><span class="linenos">299</span></a>            <span class="n">ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk_id</span><span class="p">)</span>
</span><span id="DocumentsBuilder.from_url-300"><a href="#DocumentsBuilder.from_url-300"><span class="linenos">300</span></a>        
</span><span id="DocumentsBuilder.from_url-301"><a href="#DocumentsBuilder.from_url-301"><span class="linenos">301</span></a>        <span class="k">return</span> <span class="n">documents</span><span class="p">,</span> <span class="n">metadatas</span><span class="p">,</span> <span class="n">ids</span>
</span></pre></div>


            <div class="docstring"><p>Scrape content from a URL and split it into chunks with specified size and overlap.</p>

<p>Notes:</p>

<ul>
<li>Scraping may take time depending on the engine and website complexity</li>
<li>Some websites may block automated scraping</li>
<li>Selenium requires Chrome/Chromium to be installed</li>
<li>Tavily requires an API key to be configured</li>
</ul>
</div>


                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>