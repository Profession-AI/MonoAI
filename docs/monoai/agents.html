<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 15.0.4"/>
    <title>monoai.agents API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note{color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.tip{color:#0a3622;background-color:#d1e7dd;border-color:#a3cfbb;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%230a3622%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%206a6%206%200%201%201%2010.174%204.31c-.203.196-.359.4-.453.619l-.762%201.769A.5.5%200%200%201%2010.5%2013a.5.5%200%200%201%200%201%20.5.5%200%200%201%200%201l-.224.447a1%201%200%200%201-.894.553H6.618a1%201%200%200%201-.894-.553L5.5%2015a.5.5%200%200%201%200-1%20.5.5%200%200%201%200-1%20.5.5%200%200%201-.46-.302l-.761-1.77a2%202%200%200%200-.453-.618A5.98%205.98%200%200%201%202%206m6-5a5%205%200%200%200-3.479%208.592c.263.254.514.564.676.941L5.83%2012h4.342l.632-1.467c.162-.377.413-.687.676-.941A5%205%200%200%200%208%201%22/%3E%3C/svg%3E");}.pdoc .alert.important{color:#055160;background-color:#cff4fc;border-color:#9eeaf9;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23055160%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%200a2%202%200%200%200-2%202v12a2%202%200%200%200%202%202h12a2%202%200%200%200%202-2V2a2%202%200%200%200-2-2zm6%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.caution{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M11.46.146A.5.5%200%200%200%2011.107%200H4.893a.5.5%200%200%200-.353.146L.146%204.54A.5.5%200%200%200%200%204.893v6.214a.5.5%200%200%200%20.146.353l4.394%204.394a.5.5%200%200%200%20.353.146h6.214a.5.5%200%200%200%20.353-.146l4.394-4.394a.5.5%200%200%200%20.146-.353V4.893a.5.5%200%200%200-.146-.353zM8%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../monoai.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;monoai</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#_AgenticLoop">_AgenticLoop</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#_AgenticLoop.__init__">_AgenticLoop</a>
                        </li>
                        <li>
                                <a class="function" href="#_AgenticLoop.register_tools">register_tools</a>
                        </li>
                        <li>
                                <a class="function" href="#_AgenticLoop.register_mcp_servers">register_mcp_servers</a>
                        </li>
                        <li>
                                <a class="function" href="#_AgenticLoop.enable_streaming">enable_streaming</a>
                        </li>
                        <li>
                                <a class="function" href="#_AgenticLoop.disable_streaming">disable_streaming</a>
                        </li>
                        <li>
                                <a class="function" href="#_AgenticLoop.create_streaming">create_streaming</a>
                        </li>
                        <li>
                                <a class="function" href="#_AgenticLoop.start">start</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#_FunctionCallingMixin">_FunctionCallingMixin</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="class" href="#_ReactMixin">_ReactMixin</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="class" href="#_BaseReactLoop">_BaseReactLoop</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="class" href="#FunctionCallingAgenticLoop">FunctionCallingAgenticLoop</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#FunctionCallingAgenticLoop.start">start</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#ReactAgenticLoop">ReactAgenticLoop</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#ReactAgenticLoop.start">start</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#ReactWithFCAgenticLoop">ReactWithFCAgenticLoop</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#ReactWithFCAgenticLoop.start">start</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#ProgrammaticAgenticLoop">ProgrammaticAgenticLoop</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#ProgrammaticAgenticLoop.start">start</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#PlanAndExecuteAgenticLoop">PlanAndExecuteAgenticLoop</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#PlanAndExecuteAgenticLoop.start">start</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#ReflexionAgenticLoop">ReflexionAgenticLoop</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#ReflexionAgenticLoop.start">start</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#SelfAskAgenticLoop">SelfAskAgenticLoop</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#SelfAskAgenticLoop.start">start</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#SelfAskWithSearchLoop">SelfAskWithSearchLoop</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#SelfAskWithSearchLoop.start">start</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Agent">Agent</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Agent.__init__">Agent</a>
                        </li>
                        <li>
                                <a class="variable" href="#Agent.name">name</a>
                        </li>
                        <li>
                                <a class="function" href="#Agent.run">run</a>
                        </li>
                        <li>
                                <a class="function" href="#Agent.enable_streaming">enable_streaming</a>
                        </li>
                        <li>
                                <a class="function" href="#Agent.disable_streaming">disable_streaming</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../monoai.html">monoai</a><wbr>.agents    </h1>

                        <div class="docstring"><p>MonoAI Agents Package</p>

<p>This package provides a comprehensive set of agentic loop implementations
that support real-time streaming responses during the entire generation phase.
The agents are designed to work with various AI paradigms and can process
user queries through iterative reasoning, tool usage, and structured output generation.</p>

<p>Key Features:</p>

<ul>
<li>Real-time streaming of AI responses</li>
<li>Multiple agent paradigms (React, Function Calling, Plan-and-Execute, etc.)</li>
<li>Step-based reasoning format for transparent decision making</li>
<li>Tool integration and execution</li>
<li>Configurable iteration limits and debugging</li>
<li>Asynchronous streaming with proper resource management</li>
</ul>

<p>Agent Paradigms:
The agents use a structured step-based format for reasoning:</p>

<ul>
<li>Thought N: <reasoning process and analysis></li>
<li>Action N: {"name": "tool_name", "arguments": {...}}</li>
<li>Observation N: <tool execution result></li>
<li>Final answer: <conclusive response to user query></li>
</ul>

<p>Streaming Architecture:
Streaming allows real-time processing of AI responses as they are generated, enabling:</p>

<ul>
<li>Immediate feedback to users</li>
<li>Progress monitoring during long operations</li>
<li>Better user experience with responsive interfaces</li>
<li>Debugging and monitoring of agent reasoning</li>
</ul>

<p>Usage Examples:</p>

<ol>
<li><p>Basic React Agent with Streaming:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn"><a href="">monoai.agents</a></span><span class="w"> </span><span class="kn">import</span> <span class="n">Agent</span>

<span class="n">agent</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">paradigm</span><span class="o">=</span><span class="s2">&quot;react&quot;</span><span class="p">)</span>
<span class="n">agent</span><span class="o">.</span><span class="n">enable_streaming</span><span class="p">()</span>  <span class="c1"># Uses default console output</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;What is the capital of France?&quot;</span><span class="p">)</span>
</code></pre>
</div></li>

<li><p>Custom Streaming Handler:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn"><a href="">monoai.agents</a></span><span class="w"> </span><span class="kn">import</span> <span class="n">Agent</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="k">def</span><span class="w"> </span><span class="nf">custom_stream_handler</span><span class="p">(</span><span class="n">content</span><span class="p">):</span>
    <span class="c1"># Process streaming content in real-time</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Streaming: </span><span class="si">{</span><span class="n">content</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">agent</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">paradigm</span><span class="o">=</span><span class="s2">&quot;react&quot;</span><span class="p">)</span>
<span class="n">agent</span><span class="o">.</span><span class="n">enable_streaming</span><span class="p">(</span><span class="n">custom_stream_handler</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;Your query here&quot;</span><span class="p">)</span>
</code></pre>
</div></li>

<li><p>Function Calling Agent:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn"><a href="">monoai.agents</a></span><span class="w"> </span><span class="kn">import</span> <span class="n">Agent</span>
<span class="kn">from</span><span class="w"> </span><span class="nn"><a href="tools.html">monoai.tools</a></span><span class="w"> </span><span class="kn">import</span> <span class="n">search_web</span>

<span class="n">agent</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">paradigm</span><span class="o">=</span><span class="s2">&quot;function_calling&quot;</span><span class="p">)</span>
<span class="n">agent</span><span class="o">.</span><span class="n">register_tools</span><span class="p">([</span><span class="n">search_web</span><span class="p">])</span>
<span class="n">agent</span><span class="o">.</span><span class="n">enable_streaming</span><span class="p">()</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;Search for recent AI news&quot;</span><span class="p">)</span>
</code></pre>
</div></li>

<li><p>Plan and Execute Agent:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">agent</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">paradigm</span><span class="o">=</span><span class="s2">&quot;plan-and-execute&quot;</span><span class="p">)</span>
<span class="n">agent</span><span class="o">.</span><span class="n">enable_streaming</span><span class="p">()</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;Create a detailed project plan&quot;</span><span class="p">)</span>
</code></pre>
</div></li>
</ol>

<p>Available Agent Types:</p>

<ul>
<li>FunctionCallingAgenticLoop: Native OpenAI function calling</li>
<li>ReactAgenticLoop: ReAct reasoning pattern</li>
<li>ReactWithFCAgenticLoop: Hybrid ReAct + Function Calling</li>
<li>ProgrammaticAgenticLoop: Code generation and execution</li>
<li>PlanAndExecuteAgenticLoop: Planning then execution pattern</li>
<li>ReflexionAgenticLoop: Self-reflection and improvement</li>
<li>SelfAskAgenticLoop: Self-questioning approach</li>
<li>SelfAskWithSearchLoop: Self-ask with web search capabilities</li>
</ul>

<p>Streaming Callback Format:
The streaming callback receives content as plain text strings. For advanced use cases,
you can access the raw streaming data through the model's streaming methods.</p>

<p>Error Handling:</p>

<ul>
<li>Automatic fallback to non-streaming mode on errors</li>
<li>Proper cleanup of async resources</li>
<li>Configurable debug output</li>
<li>Iteration limits to prevent infinite loops</li>
</ul>

<p>Thread Safety:
This implementation is designed for single-threaded use. For concurrent access,
create separate agent instances for each thread or process.</p>
</div>

                        <input id="mod-agents-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-agents-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="sd">MonoAI Agents Package</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="sd">This package provides a comprehensive set of agentic loop implementations</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="sd">that support real-time streaming responses during the entire generation phase.</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="sd">The agents are designed to work with various AI paradigms and can process</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="sd">user queries through iterative reasoning, tool usage, and structured output generation.</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="sd">Key Features:</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="sd">- Real-time streaming of AI responses</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="sd">- Multiple agent paradigms (React, Function Calling, Plan-and-Execute, etc.)</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a><span class="sd">- Step-based reasoning format for transparent decision making</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="sd">- Tool integration and execution</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="sd">- Configurable iteration limits and debugging</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a><span class="sd">- Asynchronous streaming with proper resource management</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="sd">Agent Paradigms:</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="sd">The agents use a structured step-based format for reasoning:</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a><span class="sd">- Thought N: &lt;reasoning process and analysis&gt;</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="sd">- Action N: {&quot;name&quot;: &quot;tool_name&quot;, &quot;arguments&quot;: {...}}</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a><span class="sd">- Observation N: &lt;tool execution result&gt;</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a><span class="sd">- Final answer: &lt;conclusive response to user query&gt;</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a><span class="sd">Streaming Architecture:</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a><span class="sd">Streaming allows real-time processing of AI responses as they are generated, enabling:</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a><span class="sd">- Immediate feedback to users</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a><span class="sd">- Progress monitoring during long operations</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a><span class="sd">- Better user experience with responsive interfaces</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a><span class="sd">- Debugging and monitoring of agent reasoning</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a><span class="sd">Usage Examples:</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a><span class="sd">1. Basic React Agent with Streaming:</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a><span class="sd">    ```python</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a><span class="sd">    from monoai.agents import Agent</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a><span class="sd">    </span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a><span class="sd">    agent = Agent(model, paradigm=&quot;react&quot;)</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a><span class="sd">    agent.enable_streaming()  # Uses default console output</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a><span class="sd">    result = agent.run(&quot;What is the capital of France?&quot;)</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a><span class="sd">    ```</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a><span class="sd">2. Custom Streaming Handler:</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a><span class="sd">    ```python</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a><span class="sd">    from monoai.agents import Agent</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a><span class="sd">    import json</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a><span class="sd">    </span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a><span class="sd">    def custom_stream_handler(content):</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a><span class="sd">        # Process streaming content in real-time</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a><span class="sd">        print(f&quot;Streaming: {content}&quot;, end=&#39;&#39;, flush=True)</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a><span class="sd">    </span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a><span class="sd">    agent = Agent(model, paradigm=&quot;react&quot;)</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a><span class="sd">    agent.enable_streaming(custom_stream_handler)</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a><span class="sd">    result = agent.run(&quot;Your query here&quot;)</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a><span class="sd">    ```</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a><span class="sd">3. Function Calling Agent:</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a><span class="sd">    ```python</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a><span class="sd">    from monoai.agents import Agent</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a><span class="sd">    from monoai.tools import search_web</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a><span class="sd">    </span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a><span class="sd">    agent = Agent(model, paradigm=&quot;function_calling&quot;)</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a><span class="sd">    agent.register_tools([search_web])</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a><span class="sd">    agent.enable_streaming()</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a><span class="sd">    result = agent.run(&quot;Search for recent AI news&quot;)</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a><span class="sd">    ```</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a><span class="sd">4. Plan and Execute Agent:</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a><span class="sd">    ```python</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a><span class="sd">    agent = Agent(model, paradigm=&quot;plan-and-execute&quot;)</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a><span class="sd">    agent.enable_streaming()</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a><span class="sd">    result = agent.run(&quot;Create a detailed project plan&quot;)</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a><span class="sd">    ```</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a><span class="sd">Available Agent Types:</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a><span class="sd">- FunctionCallingAgenticLoop: Native OpenAI function calling</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a><span class="sd">- ReactAgenticLoop: ReAct reasoning pattern</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a><span class="sd">- ReactWithFCAgenticLoop: Hybrid ReAct + Function Calling</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a><span class="sd">- ProgrammaticAgenticLoop: Code generation and execution</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a><span class="sd">- PlanAndExecuteAgenticLoop: Planning then execution pattern</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a><span class="sd">- ReflexionAgenticLoop: Self-reflection and improvement</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a><span class="sd">- SelfAskAgenticLoop: Self-questioning approach</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a><span class="sd">- SelfAskWithSearchLoop: Self-ask with web search capabilities</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a><span class="sd">Streaming Callback Format:</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a><span class="sd">The streaming callback receives content as plain text strings. For advanced use cases,</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a><span class="sd">you can access the raw streaming data through the model&#39;s streaming methods.</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a><span class="sd">Error Handling:</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a><span class="sd">- Automatic fallback to non-streaming mode on errors</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a><span class="sd">- Proper cleanup of async resources</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a><span class="sd">- Configurable debug output</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a><span class="sd">- Iteration limits to prevent infinite loops</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a><span class="sd">Thread Safety:</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a><span class="sd">This implementation is designed for single-threaded use. For concurrent access,</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a><span class="sd">create separate agent instances for each thread or process.</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.agentic_loops._agentic_loop</span><span class="w"> </span><span class="kn">import</span> <span class="n">_AgenticLoop</span><span class="p">,</span> <span class="n">_FunctionCallingMixin</span><span class="p">,</span> <span class="n">_ReactMixin</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.agentic_loops._function_calling_agentic_loop</span><span class="w"> </span><span class="kn">import</span> <span class="n">FunctionCallingAgenticLoop</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.agentic_loops._react_agentic_loop</span><span class="w"> </span><span class="kn">import</span> <span class="n">ReactAgenticLoop</span><span class="p">,</span> <span class="n">ReactWithFCAgenticLoop</span><span class="p">,</span> <span class="n">_BaseReactLoop</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.agentic_loops._other_agentic_loops</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a>    <span class="n">ProgrammaticAgenticLoop</span><span class="p">,</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a>    <span class="n">PlanAndExecuteAgenticLoop</span><span class="p">,</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a>    <span class="n">ReflexionAgenticLoop</span><span class="p">,</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a>    <span class="n">SelfAskAgenticLoop</span><span class="p">,</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a>    <span class="n">SelfAskWithSearchLoop</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a><span class="p">)</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a><span class="c1"># Main Agent class that provides a unified interface</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.agent</span><span class="w"> </span><span class="kn">import</span> <span class="n">Agent</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a>    <span class="c1"># Base classes</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a>    <span class="s1">&#39;_AgenticLoop&#39;</span><span class="p">,</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a>    <span class="s1">&#39;_FunctionCallingMixin&#39;</span><span class="p">,</span> 
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a>    <span class="s1">&#39;_ReactMixin&#39;</span><span class="p">,</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a>    <span class="s1">&#39;_BaseReactLoop&#39;</span><span class="p">,</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>    
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a>    <span class="c1"># Agent implementations</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a>    <span class="s1">&#39;FunctionCallingAgenticLoop&#39;</span><span class="p">,</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a>    <span class="s1">&#39;ReactAgenticLoop&#39;</span><span class="p">,</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>    <span class="s1">&#39;ReactWithFCAgenticLoop&#39;</span><span class="p">,</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a>    <span class="s1">&#39;ProgrammaticAgenticLoop&#39;</span><span class="p">,</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>    <span class="s1">&#39;PlanAndExecuteAgenticLoop&#39;</span><span class="p">,</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a>    <span class="s1">&#39;ReflexionAgenticLoop&#39;</span><span class="p">,</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a>    <span class="s1">&#39;SelfAskAgenticLoop&#39;</span><span class="p">,</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a>    <span class="s1">&#39;SelfAskWithSearchLoop&#39;</span><span class="p">,</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a>    
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a>    <span class="c1"># Main interface</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a>    <span class="s1">&#39;Agent&#39;</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a><span class="p">]</span>
</span></pre></div>


            </section>
                <section id="_AgenticLoop">
                            <input id="_AgenticLoop-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">_AgenticLoop</span>:

                <label class="view-source-button" for="_AgenticLoop-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#_AgenticLoop"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="_AgenticLoop-222"><a href="#_AgenticLoop-222"><span class="linenos"> 222</span></a><span class="k">class</span><span class="w"> </span><span class="nc">_AgenticLoop</span><span class="p">:</span>
</span><span id="_AgenticLoop-223"><a href="#_AgenticLoop-223"><span class="linenos"> 223</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for all agentic loop implementations.</span>
</span><span id="_AgenticLoop-224"><a href="#_AgenticLoop-224"><span class="linenos"> 224</span></a><span class="sd">    </span>
</span><span id="_AgenticLoop-225"><a href="#_AgenticLoop-225"><span class="linenos"> 225</span></a><span class="sd">    This class provides the core functionality for all AI agents, including</span>
</span><span id="_AgenticLoop-226"><a href="#_AgenticLoop-226"><span class="linenos"> 226</span></a><span class="sd">    tool management, message creation, model execution, and streaming support.</span>
</span><span id="_AgenticLoop-227"><a href="#_AgenticLoop-227"><span class="linenos"> 227</span></a><span class="sd">    It&#39;s designed to be extended by specific classes that implement different</span>
</span><span id="_AgenticLoop-228"><a href="#_AgenticLoop-228"><span class="linenos"> 228</span></a><span class="sd">    agentic approaches and reasoning patterns.</span>
</span><span id="_AgenticLoop-229"><a href="#_AgenticLoop-229"><span class="linenos"> 229</span></a><span class="sd">    </span>
</span><span id="_AgenticLoop-230"><a href="#_AgenticLoop-230"><span class="linenos"> 230</span></a><span class="sd">    The base class handles common operations like:</span>
</span><span id="_AgenticLoop-231"><a href="#_AgenticLoop-231"><span class="linenos"> 231</span></a><span class="sd">    - Tool registration and execution</span>
</span><span id="_AgenticLoop-232"><a href="#_AgenticLoop-232"><span class="linenos"> 232</span></a><span class="sd">    - Message formatting and conversation management</span>
</span><span id="_AgenticLoop-233"><a href="#_AgenticLoop-233"><span class="linenos"> 233</span></a><span class="sd">    - Model interaction (both streaming and non-streaming)</span>
</span><span id="_AgenticLoop-234"><a href="#_AgenticLoop-234"><span class="linenos"> 234</span></a><span class="sd">    - Step-based reasoning format parsing</span>
</span><span id="_AgenticLoop-235"><a href="#_AgenticLoop-235"><span class="linenos"> 235</span></a><span class="sd">    - Debug output and iteration limits</span>
</span><span id="_AgenticLoop-236"><a href="#_AgenticLoop-236"><span class="linenos"> 236</span></a><span class="sd">    </span>
</span><span id="_AgenticLoop-237"><a href="#_AgenticLoop-237"><span class="linenos"> 237</span></a><span class="sd">    Attributes</span>
</span><span id="_AgenticLoop-238"><a href="#_AgenticLoop-238"><span class="linenos"> 238</span></a><span class="sd">    ----------</span>
</span><span id="_AgenticLoop-239"><a href="#_AgenticLoop-239"><span class="linenos"> 239</span></a><span class="sd">    _model : Any</span>
</span><span id="_AgenticLoop-240"><a href="#_AgenticLoop-240"><span class="linenos"> 240</span></a><span class="sd">        AI model instance used for execution</span>
</span><span id="_AgenticLoop-241"><a href="#_AgenticLoop-241"><span class="linenos"> 241</span></a><span class="sd">    _agentic_prompt : str, Prompt, optional</span>
</span><span id="_AgenticLoop-242"><a href="#_AgenticLoop-242"><span class="linenos"> 242</span></a><span class="sd">        Custom prompt for the agent (None for default). Can be a string, </span>
</span><span id="_AgenticLoop-243"><a href="#_AgenticLoop-243"><span class="linenos"> 243</span></a><span class="sd">        a Prompt object, or a path to a .prompt file</span>
</span><span id="_AgenticLoop-244"><a href="#_AgenticLoop-244"><span class="linenos"> 244</span></a><span class="sd">    _debug : bool</span>
</span><span id="_AgenticLoop-245"><a href="#_AgenticLoop-245"><span class="linenos"> 245</span></a><span class="sd">        Flag to enable debug output</span>
</span><span id="_AgenticLoop-246"><a href="#_AgenticLoop-246"><span class="linenos"> 246</span></a><span class="sd">    _max_iter : Optional[int]</span>
</span><span id="_AgenticLoop-247"><a href="#_AgenticLoop-247"><span class="linenos"> 247</span></a><span class="sd">        Maximum number of iterations allowed (None for unlimited)</span>
</span><span id="_AgenticLoop-248"><a href="#_AgenticLoop-248"><span class="linenos"> 248</span></a><span class="sd">    _stream_callback : Optional[Callable[[str], None]]</span>
</span><span id="_AgenticLoop-249"><a href="#_AgenticLoop-249"><span class="linenos"> 249</span></a><span class="sd">        Callback function for handling streaming content</span>
</span><span id="_AgenticLoop-250"><a href="#_AgenticLoop-250"><span class="linenos"> 250</span></a><span class="sd">    _tools : Dict[str, Any]</span>
</span><span id="_AgenticLoop-251"><a href="#_AgenticLoop-251"><span class="linenos"> 251</span></a><span class="sd">        Dictionary of available tools, mapped by name</span>
</span><span id="_AgenticLoop-252"><a href="#_AgenticLoop-252"><span class="linenos"> 252</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="_AgenticLoop-253"><a href="#_AgenticLoop-253"><span class="linenos"> 253</span></a>
</span><span id="_AgenticLoop-254"><a href="#_AgenticLoop-254"><span class="linenos"> 254</span></a>    <span class="n">_DEFAULT_PROMPT_PATH</span> <span class="o">=</span> <span class="s2">&quot;monoai/agents/prompts/&quot;</span>
</span><span id="_AgenticLoop-255"><a href="#_AgenticLoop-255"><span class="linenos"> 255</span></a>    
</span><span id="_AgenticLoop-256"><a href="#_AgenticLoop-256"><span class="linenos"> 256</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">Model</span><span class="p">,</span> <span class="n">agentic_prompt</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">max_iter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
</span><span id="_AgenticLoop-257"><a href="#_AgenticLoop-257"><span class="linenos"> 257</span></a>                 <span class="n">stream_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">]]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">human_feedback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="_AgenticLoop-258"><a href="#_AgenticLoop-258"><span class="linenos"> 258</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the agent with model and configuration.</span>
</span><span id="_AgenticLoop-259"><a href="#_AgenticLoop-259"><span class="linenos"> 259</span></a><span class="sd">        </span>
</span><span id="_AgenticLoop-260"><a href="#_AgenticLoop-260"><span class="linenos"> 260</span></a><span class="sd">        Parameters</span>
</span><span id="_AgenticLoop-261"><a href="#_AgenticLoop-261"><span class="linenos"> 261</span></a><span class="sd">        ----------</span>
</span><span id="_AgenticLoop-262"><a href="#_AgenticLoop-262"><span class="linenos"> 262</span></a><span class="sd">        model : Any</span>
</span><span id="_AgenticLoop-263"><a href="#_AgenticLoop-263"><span class="linenos"> 263</span></a><span class="sd">            AI model instance to use for execution</span>
</span><span id="_AgenticLoop-264"><a href="#_AgenticLoop-264"><span class="linenos"> 264</span></a><span class="sd">        agentic_prompt : str, optional</span>
</span><span id="_AgenticLoop-265"><a href="#_AgenticLoop-265"><span class="linenos"> 265</span></a><span class="sd">            Custom prompt for the agent (None to use default)</span>
</span><span id="_AgenticLoop-266"><a href="#_AgenticLoop-266"><span class="linenos"> 266</span></a><span class="sd">        debug : bool, default False</span>
</span><span id="_AgenticLoop-267"><a href="#_AgenticLoop-267"><span class="linenos"> 267</span></a><span class="sd">            Enable debug output and logging</span>
</span><span id="_AgenticLoop-268"><a href="#_AgenticLoop-268"><span class="linenos"> 268</span></a><span class="sd">        max_iter : Optional[int], default None</span>
</span><span id="_AgenticLoop-269"><a href="#_AgenticLoop-269"><span class="linenos"> 269</span></a><span class="sd">            Maximum number of iterations allowed (None for unlimited)</span>
</span><span id="_AgenticLoop-270"><a href="#_AgenticLoop-270"><span class="linenos"> 270</span></a><span class="sd">        stream_callback : Optional[Callable[[str], None]], default None</span>
</span><span id="_AgenticLoop-271"><a href="#_AgenticLoop-271"><span class="linenos"> 271</span></a><span class="sd">            Callback function for handling streaming content chunks</span>
</span><span id="_AgenticLoop-272"><a href="#_AgenticLoop-272"><span class="linenos"> 272</span></a><span class="sd">        human_feedback : Optional[str], default None</span>
</span><span id="_AgenticLoop-273"><a href="#_AgenticLoop-273"><span class="linenos"> 273</span></a><span class="sd">            Human feedback mode for controlling agent execution. Can be:</span>
</span><span id="_AgenticLoop-274"><a href="#_AgenticLoop-274"><span class="linenos"> 274</span></a><span class="sd">            - None: No human feedback required</span>
</span><span id="_AgenticLoop-275"><a href="#_AgenticLoop-275"><span class="linenos"> 275</span></a><span class="sd">            - &quot;actions&quot;: Pause and request confirmation before executing tool actions</span>
</span><span id="_AgenticLoop-276"><a href="#_AgenticLoop-276"><span class="linenos"> 276</span></a><span class="sd">            - &quot;all&quot;: Pause after every step for human review</span>
</span><span id="_AgenticLoop-277"><a href="#_AgenticLoop-277"><span class="linenos"> 277</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="_AgenticLoop-278"><a href="#_AgenticLoop-278"><span class="linenos"> 278</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="n">model</span>
</span><span id="_AgenticLoop-279"><a href="#_AgenticLoop-279"><span class="linenos"> 279</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_agentic_prompt</span> <span class="o">=</span> <span class="n">agentic_prompt</span>
</span><span id="_AgenticLoop-280"><a href="#_AgenticLoop-280"><span class="linenos"> 280</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_debug</span> <span class="o">=</span> <span class="n">debug</span>
</span><span id="_AgenticLoop-281"><a href="#_AgenticLoop-281"><span class="linenos"> 281</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_max_iter</span> <span class="o">=</span> <span class="n">max_iter</span>
</span><span id="_AgenticLoop-282"><a href="#_AgenticLoop-282"><span class="linenos"> 282</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stream_callback</span> <span class="o">=</span> <span class="n">stream_callback</span>
</span><span id="_AgenticLoop-283"><a href="#_AgenticLoop-283"><span class="linenos"> 283</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_human_feedback</span> <span class="o">=</span> <span class="n">human_feedback</span>
</span><span id="_AgenticLoop-284"><a href="#_AgenticLoop-284"><span class="linenos"> 284</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_tools</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="_AgenticLoop-285"><a href="#_AgenticLoop-285"><span class="linenos"> 285</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_mcp_servers</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="_AgenticLoop-286"><a href="#_AgenticLoop-286"><span class="linenos"> 286</span></a>
</span><span id="_AgenticLoop-287"><a href="#_AgenticLoop-287"><span class="linenos"> 287</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">register_tools</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tools</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="_AgenticLoop-288"><a href="#_AgenticLoop-288"><span class="linenos"> 288</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Register tools with the agent.</span>
</span><span id="_AgenticLoop-289"><a href="#_AgenticLoop-289"><span class="linenos"> 289</span></a><span class="sd">        </span>
</span><span id="_AgenticLoop-290"><a href="#_AgenticLoop-290"><span class="linenos"> 290</span></a><span class="sd">        Parameters</span>
</span><span id="_AgenticLoop-291"><a href="#_AgenticLoop-291"><span class="linenos"> 291</span></a><span class="sd">        ----------</span>
</span><span id="_AgenticLoop-292"><a href="#_AgenticLoop-292"><span class="linenos"> 292</span></a><span class="sd">        tools : List[Any]</span>
</span><span id="_AgenticLoop-293"><a href="#_AgenticLoop-293"><span class="linenos"> 293</span></a><span class="sd">            List of tool functions to register. Each tool must have a</span>
</span><span id="_AgenticLoop-294"><a href="#_AgenticLoop-294"><span class="linenos"> 294</span></a><span class="sd">            __name__ attribute for identification.</span>
</span><span id="_AgenticLoop-295"><a href="#_AgenticLoop-295"><span class="linenos"> 295</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="_AgenticLoop-296"><a href="#_AgenticLoop-296"><span class="linenos"> 296</span></a>        <span class="k">for</span> <span class="n">tool</span> <span class="ow">in</span> <span class="n">tools</span><span class="p">:</span>
</span><span id="_AgenticLoop-297"><a href="#_AgenticLoop-297"><span class="linenos"> 297</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_tools</span><span class="p">[</span><span class="n">tool</span><span class="o">.</span><span class="vm">__name__</span><span class="p">]</span> <span class="o">=</span> <span class="n">tool</span>
</span><span id="_AgenticLoop-298"><a href="#_AgenticLoop-298"><span class="linenos"> 298</span></a>
</span><span id="_AgenticLoop-299"><a href="#_AgenticLoop-299"><span class="linenos"> 299</span></a>    
</span><span id="_AgenticLoop-300"><a href="#_AgenticLoop-300"><span class="linenos"> 300</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">register_mcp_servers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mcp_servers</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="_AgenticLoop-301"><a href="#_AgenticLoop-301"><span class="linenos"> 301</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Register MCP servers with the agent.</span>
</span><span id="_AgenticLoop-302"><a href="#_AgenticLoop-302"><span class="linenos"> 302</span></a><span class="sd">        </span>
</span><span id="_AgenticLoop-303"><a href="#_AgenticLoop-303"><span class="linenos"> 303</span></a><span class="sd">        Parameters</span>
</span><span id="_AgenticLoop-304"><a href="#_AgenticLoop-304"><span class="linenos"> 304</span></a><span class="sd">        ----------</span>
</span><span id="_AgenticLoop-305"><a href="#_AgenticLoop-305"><span class="linenos"> 305</span></a><span class="sd">        mcp_servers : List[Any]</span>
</span><span id="_AgenticLoop-306"><a href="#_AgenticLoop-306"><span class="linenos"> 306</span></a><span class="sd">            List of MCP server instances to register.</span>
</span><span id="_AgenticLoop-307"><a href="#_AgenticLoop-307"><span class="linenos"> 307</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="_AgenticLoop-308"><a href="#_AgenticLoop-308"><span class="linenos"> 308</span></a>        <span class="n">tools</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="_AgenticLoop-309"><a href="#_AgenticLoop-309"><span class="linenos"> 309</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_mcp_servers</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="_AgenticLoop-310"><a href="#_AgenticLoop-310"><span class="linenos"> 310</span></a>        <span class="k">for</span> <span class="n">mcp_server</span> <span class="ow">in</span> <span class="n">mcp_servers</span><span class="p">:</span>
</span><span id="_AgenticLoop-311"><a href="#_AgenticLoop-311"><span class="linenos"> 311</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_debug_print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connecting to MCP server: </span><span class="si">{</span><span class="n">mcp_server</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="_AgenticLoop-312"><a href="#_AgenticLoop-312"><span class="linenos"> 312</span></a>                <span class="c1"># Use context manager for proper connection handling</span>
</span><span id="_AgenticLoop-313"><a href="#_AgenticLoop-313"><span class="linenos"> 313</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_mcp_servers</span><span class="p">[</span><span class="n">mcp_server</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">mcp_server</span>
</span><span id="_AgenticLoop-314"><a href="#_AgenticLoop-314"><span class="linenos"> 314</span></a>                <span class="n">server_tools</span> <span class="o">=</span>  <span class="n">mcp_server</span><span class="o">.</span><span class="n">get_tools</span><span class="p">()</span>
</span><span id="_AgenticLoop-315"><a href="#_AgenticLoop-315"><span class="linenos"> 315</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_debug_print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Retrieved </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">server_tools</span><span class="p">)</span><span class="si">}</span><span class="s2"> tools from </span><span class="si">{</span><span class="n">mcp_server</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="_AgenticLoop-316"><a href="#_AgenticLoop-316"><span class="linenos"> 316</span></a>                <span class="k">for</span> <span class="n">tool</span> <span class="ow">in</span> <span class="n">server_tools</span><span class="p">:</span>
</span><span id="_AgenticLoop-317"><a href="#_AgenticLoop-317"><span class="linenos"> 317</span></a>                    <span class="c1"># Create a new tool name with MCP prefix</span>
</span><span id="_AgenticLoop-318"><a href="#_AgenticLoop-318"><span class="linenos"> 318</span></a>                    <span class="n">original_name</span> <span class="o">=</span> <span class="n">tool</span><span class="o">.</span><span class="n">name</span>
</span><span id="_AgenticLoop-319"><a href="#_AgenticLoop-319"><span class="linenos"> 319</span></a>                    <span class="n">tool</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;mcp_</span><span class="si">{</span><span class="n">mcp_server</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">original_name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="_AgenticLoop-320"><a href="#_AgenticLoop-320"><span class="linenos"> 320</span></a>                    <span class="n">tools</span><span class="p">[</span><span class="n">tool</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">tool</span>
</span><span id="_AgenticLoop-321"><a href="#_AgenticLoop-321"><span class="linenos"> 321</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_debug_print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; - </span><span class="si">{</span><span class="n">tool</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="_AgenticLoop-322"><a href="#_AgenticLoop-322"><span class="linenos"> 322</span></a>                
</span><span id="_AgenticLoop-323"><a href="#_AgenticLoop-323"><span class="linenos"> 323</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_tools</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">tools</span><span class="p">)</span>
</span><span id="_AgenticLoop-324"><a href="#_AgenticLoop-324"><span class="linenos"> 324</span></a>
</span><span id="_AgenticLoop-325"><a href="#_AgenticLoop-325"><span class="linenos"> 325</span></a>    
</span><span id="_AgenticLoop-326"><a href="#_AgenticLoop-326"><span class="linenos"> 326</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">enable_streaming</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="_AgenticLoop-327"><a href="#_AgenticLoop-327"><span class="linenos"> 327</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Enable streaming responses for this agent.</span>
</span><span id="_AgenticLoop-328"><a href="#_AgenticLoop-328"><span class="linenos"> 328</span></a><span class="sd">        </span>
</span><span id="_AgenticLoop-329"><a href="#_AgenticLoop-329"><span class="linenos"> 329</span></a><span class="sd">        When streaming is enabled, the agent will call the provided callback</span>
</span><span id="_AgenticLoop-330"><a href="#_AgenticLoop-330"><span class="linenos"> 330</span></a><span class="sd">        function with each content chunk as it&#39;s generated, allowing for</span>
</span><span id="_AgenticLoop-331"><a href="#_AgenticLoop-331"><span class="linenos"> 331</span></a><span class="sd">        real-time processing and display of the AI&#39;s response.</span>
</span><span id="_AgenticLoop-332"><a href="#_AgenticLoop-332"><span class="linenos"> 332</span></a><span class="sd">        </span>
</span><span id="_AgenticLoop-333"><a href="#_AgenticLoop-333"><span class="linenos"> 333</span></a><span class="sd">        Parameters</span>
</span><span id="_AgenticLoop-334"><a href="#_AgenticLoop-334"><span class="linenos"> 334</span></a><span class="sd">        ----------</span>
</span><span id="_AgenticLoop-335"><a href="#_AgenticLoop-335"><span class="linenos"> 335</span></a><span class="sd">        stream_callback : Optional[Callable[[str], None]], default None</span>
</span><span id="_AgenticLoop-336"><a href="#_AgenticLoop-336"><span class="linenos"> 336</span></a><span class="sd">            Callback function to handle streaming content chunks.</span>
</span><span id="_AgenticLoop-337"><a href="#_AgenticLoop-337"><span class="linenos"> 337</span></a><span class="sd">            If None, uses a default callback that prints content to console.</span>
</span><span id="_AgenticLoop-338"><a href="#_AgenticLoop-338"><span class="linenos"> 338</span></a><span class="sd">            The callback receives plain text content strings.</span>
</span><span id="_AgenticLoop-339"><a href="#_AgenticLoop-339"><span class="linenos"> 339</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="_AgenticLoop-340"><a href="#_AgenticLoop-340"><span class="linenos"> 340</span></a>        <span class="k">if</span> <span class="n">stream_callback</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="_AgenticLoop-341"><a href="#_AgenticLoop-341"><span class="linenos"> 341</span></a>            <span class="k">def</span><span class="w"> </span><span class="nf">default_callback</span><span class="p">(</span><span class="n">content</span><span class="p">):</span>
</span><span id="_AgenticLoop-342"><a href="#_AgenticLoop-342"><span class="linenos"> 342</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="_AgenticLoop-343"><a href="#_AgenticLoop-343"><span class="linenos"> 343</span></a>            
</span><span id="_AgenticLoop-344"><a href="#_AgenticLoop-344"><span class="linenos"> 344</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_stream_callback</span> <span class="o">=</span> <span class="n">default_callback</span>
</span><span id="_AgenticLoop-345"><a href="#_AgenticLoop-345"><span class="linenos"> 345</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="_AgenticLoop-346"><a href="#_AgenticLoop-346"><span class="linenos"> 346</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_stream_callback</span> <span class="o">=</span> <span class="n">stream_callback</span>
</span><span id="_AgenticLoop-347"><a href="#_AgenticLoop-347"><span class="linenos"> 347</span></a>    
</span><span id="_AgenticLoop-348"><a href="#_AgenticLoop-348"><span class="linenos"> 348</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">disable_streaming</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="_AgenticLoop-349"><a href="#_AgenticLoop-349"><span class="linenos"> 349</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Disable streaming responses for this agent.</span>
</span><span id="_AgenticLoop-350"><a href="#_AgenticLoop-350"><span class="linenos"> 350</span></a><span class="sd">        </span>
</span><span id="_AgenticLoop-351"><a href="#_AgenticLoop-351"><span class="linenos"> 351</span></a><span class="sd">        After calling this method, the agent will use standard (non-streaming)</span>
</span><span id="_AgenticLoop-352"><a href="#_AgenticLoop-352"><span class="linenos"> 352</span></a><span class="sd">        model execution for all subsequent requests.</span>
</span><span id="_AgenticLoop-353"><a href="#_AgenticLoop-353"><span class="linenos"> 353</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="_AgenticLoop-354"><a href="#_AgenticLoop-354"><span class="linenos"> 354</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stream_callback</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="_AgenticLoop-355"><a href="#_AgenticLoop-355"><span class="linenos"> 355</span></a>    
</span><span id="_AgenticLoop-356"><a href="#_AgenticLoop-356"><span class="linenos"> 356</span></a>    <span class="nd">@classmethod</span>
</span><span id="_AgenticLoop-357"><a href="#_AgenticLoop-357"><span class="linenos"> 357</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_streaming</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">stream_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
</span><span id="_AgenticLoop-358"><a href="#_AgenticLoop-358"><span class="linenos"> 358</span></a>                        <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;_AgenticLoop&#39;</span><span class="p">:</span>
</span><span id="_AgenticLoop-359"><a href="#_AgenticLoop-359"><span class="linenos"> 359</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create an agent instance with streaming enabled.</span>
</span><span id="_AgenticLoop-360"><a href="#_AgenticLoop-360"><span class="linenos"> 360</span></a><span class="sd">        </span>
</span><span id="_AgenticLoop-361"><a href="#_AgenticLoop-361"><span class="linenos"> 361</span></a><span class="sd">        This is a convenience class method that creates an agent instance</span>
</span><span id="_AgenticLoop-362"><a href="#_AgenticLoop-362"><span class="linenos"> 362</span></a><span class="sd">        with streaming already enabled, avoiding the need to call</span>
</span><span id="_AgenticLoop-363"><a href="#_AgenticLoop-363"><span class="linenos"> 363</span></a><span class="sd">        enable_streaming() separately.</span>
</span><span id="_AgenticLoop-364"><a href="#_AgenticLoop-364"><span class="linenos"> 364</span></a><span class="sd">        </span>
</span><span id="_AgenticLoop-365"><a href="#_AgenticLoop-365"><span class="linenos"> 365</span></a><span class="sd">        Parameters</span>
</span><span id="_AgenticLoop-366"><a href="#_AgenticLoop-366"><span class="linenos"> 366</span></a><span class="sd">        ----------</span>
</span><span id="_AgenticLoop-367"><a href="#_AgenticLoop-367"><span class="linenos"> 367</span></a><span class="sd">        model : Any</span>
</span><span id="_AgenticLoop-368"><a href="#_AgenticLoop-368"><span class="linenos"> 368</span></a><span class="sd">            AI model instance to use</span>
</span><span id="_AgenticLoop-369"><a href="#_AgenticLoop-369"><span class="linenos"> 369</span></a><span class="sd">        stream_callback : Optional[Callable[[str], None]], default None</span>
</span><span id="_AgenticLoop-370"><a href="#_AgenticLoop-370"><span class="linenos"> 370</span></a><span class="sd">            Callback function for handling streaming content chunks</span>
</span><span id="_AgenticLoop-371"><a href="#_AgenticLoop-371"><span class="linenos"> 371</span></a><span class="sd">        **kwargs</span>
</span><span id="_AgenticLoop-372"><a href="#_AgenticLoop-372"><span class="linenos"> 372</span></a><span class="sd">            Additional parameters to pass to the constructor</span>
</span><span id="_AgenticLoop-373"><a href="#_AgenticLoop-373"><span class="linenos"> 373</span></a><span class="sd">        </span>
</span><span id="_AgenticLoop-374"><a href="#_AgenticLoop-374"><span class="linenos"> 374</span></a><span class="sd">        Returns</span>
</span><span id="_AgenticLoop-375"><a href="#_AgenticLoop-375"><span class="linenos"> 375</span></a><span class="sd">        -------</span>
</span><span id="_AgenticLoop-376"><a href="#_AgenticLoop-376"><span class="linenos"> 376</span></a><span class="sd">        _AgenticLoop</span>
</span><span id="_AgenticLoop-377"><a href="#_AgenticLoop-377"><span class="linenos"> 377</span></a><span class="sd">            Agent instance with streaming enabled</span>
</span><span id="_AgenticLoop-378"><a href="#_AgenticLoop-378"><span class="linenos"> 378</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="_AgenticLoop-379"><a href="#_AgenticLoop-379"><span class="linenos"> 379</span></a>        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">stream_callback</span><span class="o">=</span><span class="n">stream_callback</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="_AgenticLoop-380"><a href="#_AgenticLoop-380"><span class="linenos"> 380</span></a>
</span><span id="_AgenticLoop-381"><a href="#_AgenticLoop-381"><span class="linenos"> 381</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_tools</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="_AgenticLoop-382"><a href="#_AgenticLoop-382"><span class="linenos"> 382</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a descriptive string of available tools.</span>
</span><span id="_AgenticLoop-383"><a href="#_AgenticLoop-383"><span class="linenos"> 383</span></a><span class="sd">        </span>
</span><span id="_AgenticLoop-384"><a href="#_AgenticLoop-384"><span class="linenos"> 384</span></a><span class="sd">        This method creates a formatted string listing all registered tools</span>
</span><span id="_AgenticLoop-385"><a href="#_AgenticLoop-385"><span class="linenos"> 385</span></a><span class="sd">        with their signatures and documentation. This string is typically</span>
</span><span id="_AgenticLoop-386"><a href="#_AgenticLoop-386"><span class="linenos"> 386</span></a><span class="sd">        included in prompts to help the AI model understand what tools</span>
</span><span id="_AgenticLoop-387"><a href="#_AgenticLoop-387"><span class="linenos"> 387</span></a><span class="sd">        are available for use.</span>
</span><span id="_AgenticLoop-388"><a href="#_AgenticLoop-388"><span class="linenos"> 388</span></a><span class="sd">        </span>
</span><span id="_AgenticLoop-389"><a href="#_AgenticLoop-389"><span class="linenos"> 389</span></a><span class="sd">        Returns</span>
</span><span id="_AgenticLoop-390"><a href="#_AgenticLoop-390"><span class="linenos"> 390</span></a><span class="sd">        -------</span>
</span><span id="_AgenticLoop-391"><a href="#_AgenticLoop-391"><span class="linenos"> 391</span></a><span class="sd">        str</span>
</span><span id="_AgenticLoop-392"><a href="#_AgenticLoop-392"><span class="linenos"> 392</span></a><span class="sd">            Formatted string with descriptions of all available tools,</span>
</span><span id="_AgenticLoop-393"><a href="#_AgenticLoop-393"><span class="linenos"> 393</span></a><span class="sd">            one per line with &quot; - &quot; prefix. Returns empty string if no tools.</span>
</span><span id="_AgenticLoop-394"><a href="#_AgenticLoop-394"><span class="linenos"> 394</span></a><span class="sd">            </span>
</span><span id="_AgenticLoop-395"><a href="#_AgenticLoop-395"><span class="linenos"> 395</span></a><span class="sd">            Example:</span>
</span><span id="_AgenticLoop-396"><a href="#_AgenticLoop-396"><span class="linenos"> 396</span></a><span class="sd">             - colab_downloader(colab_url): Downloads a Jupyter notebook from Google Drive and returns its Python code as a string.  </span>
</span><span id="_AgenticLoop-397"><a href="#_AgenticLoop-397"><span class="linenos"> 397</span></a><span class="sd">                Args:     colab_url (str): The Google Drive URL of the notebook (should contain &#39;drive/&#39;).</span>
</span><span id="_AgenticLoop-398"><a href="#_AgenticLoop-398"><span class="linenos"> 398</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="_AgenticLoop-399"><a href="#_AgenticLoop-399"><span class="linenos"> 399</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tools</span><span class="p">:</span>
</span><span id="_AgenticLoop-400"><a href="#_AgenticLoop-400"><span class="linenos"> 400</span></a>            <span class="k">return</span> <span class="s2">&quot;&quot;</span>
</span><span id="_AgenticLoop-401"><a href="#_AgenticLoop-401"><span class="linenos"> 401</span></a>        
</span><span id="_AgenticLoop-402"><a href="#_AgenticLoop-402"><span class="linenos"> 402</span></a>        <span class="n">tools</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="_AgenticLoop-403"><a href="#_AgenticLoop-403"><span class="linenos"> 403</span></a>        <span class="k">for</span> <span class="n">tool_name</span><span class="p">,</span> <span class="n">tool_func</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tools</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="_AgenticLoop-404"><a href="#_AgenticLoop-404"><span class="linenos"> 404</span></a>            <span class="k">if</span> <span class="n">tool_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;mcp_&quot;</span><span class="p">):</span>
</span><span id="_AgenticLoop-405"><a href="#_AgenticLoop-405"><span class="linenos"> 405</span></a>                <span class="n">tools</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; - </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_encode_mcp_tool</span><span class="p">(</span><span class="n">tool_func</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="_AgenticLoop-406"><a href="#_AgenticLoop-406"><span class="linenos"> 406</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="_AgenticLoop-407"><a href="#_AgenticLoop-407"><span class="linenos"> 407</span></a>                <span class="n">tools</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; - </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_encode_tool</span><span class="p">(</span><span class="n">tool_func</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="_AgenticLoop-408"><a href="#_AgenticLoop-408"><span class="linenos"> 408</span></a>        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tools</span><span class="p">)</span>
</span><span id="_AgenticLoop-409"><a href="#_AgenticLoop-409"><span class="linenos"> 409</span></a>
</span><span id="_AgenticLoop-410"><a href="#_AgenticLoop-410"><span class="linenos"> 410</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_base_messages</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="_AgenticLoop-411"><a href="#_AgenticLoop-411"><span class="linenos"> 411</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate base messages for the specific agent type.</span>
</span><span id="_AgenticLoop-412"><a href="#_AgenticLoop-412"><span class="linenos"> 412</span></a><span class="sd">        </span>
</span><span id="_AgenticLoop-413"><a href="#_AgenticLoop-413"><span class="linenos"> 413</span></a><span class="sd">        This method creates the initial message structure for the agent,</span>
</span><span id="_AgenticLoop-414"><a href="#_AgenticLoop-414"><span class="linenos"> 414</span></a><span class="sd">        including the appropriate prompt template and user query. The</span>
</span><span id="_AgenticLoop-415"><a href="#_AgenticLoop-415"><span class="linenos"> 415</span></a><span class="sd">        prompt template is selected based on the agent type and includes</span>
</span><span id="_AgenticLoop-416"><a href="#_AgenticLoop-416"><span class="linenos"> 416</span></a><span class="sd">        information about available tools.</span>
</span><span id="_AgenticLoop-417"><a href="#_AgenticLoop-417"><span class="linenos"> 417</span></a><span class="sd">        </span>
</span><span id="_AgenticLoop-418"><a href="#_AgenticLoop-418"><span class="linenos"> 418</span></a><span class="sd">        Parameters</span>
</span><span id="_AgenticLoop-419"><a href="#_AgenticLoop-419"><span class="linenos"> 419</span></a><span class="sd">        ----------</span>
</span><span id="_AgenticLoop-420"><a href="#_AgenticLoop-420"><span class="linenos"> 420</span></a><span class="sd">        agent_type : str</span>
</span><span id="_AgenticLoop-421"><a href="#_AgenticLoop-421"><span class="linenos"> 421</span></a><span class="sd">            Type of agent to determine which prompt template to use</span>
</span><span id="_AgenticLoop-422"><a href="#_AgenticLoop-422"><span class="linenos"> 422</span></a><span class="sd">        query : str</span>
</span><span id="_AgenticLoop-423"><a href="#_AgenticLoop-423"><span class="linenos"> 423</span></a><span class="sd">            User query to include in the prompt</span>
</span><span id="_AgenticLoop-424"><a href="#_AgenticLoop-424"><span class="linenos"> 424</span></a><span class="sd">        </span>
</span><span id="_AgenticLoop-425"><a href="#_AgenticLoop-425"><span class="linenos"> 425</span></a><span class="sd">        Returns</span>
</span><span id="_AgenticLoop-426"><a href="#_AgenticLoop-426"><span class="linenos"> 426</span></a><span class="sd">        -------</span>
</span><span id="_AgenticLoop-427"><a href="#_AgenticLoop-427"><span class="linenos"> 427</span></a><span class="sd">        List[Dict[str, Any]]</span>
</span><span id="_AgenticLoop-428"><a href="#_AgenticLoop-428"><span class="linenos"> 428</span></a><span class="sd">            List of base messages for the agent, including the prompt and query</span>
</span><span id="_AgenticLoop-429"><a href="#_AgenticLoop-429"><span class="linenos"> 429</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="_AgenticLoop-430"><a href="#_AgenticLoop-430"><span class="linenos"> 430</span></a>        <span class="n">tools</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_tools</span><span class="p">()</span>
</span><span id="_AgenticLoop-431"><a href="#_AgenticLoop-431"><span class="linenos"> 431</span></a>        <span class="n">prompt_data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;available_tools&quot;</span><span class="p">:</span> <span class="n">tools</span><span class="p">}</span>
</span><span id="_AgenticLoop-432"><a href="#_AgenticLoop-432"><span class="linenos"> 432</span></a>        
</span><span id="_AgenticLoop-433"><a href="#_AgenticLoop-433"><span class="linenos"> 433</span></a>        <span class="c1"># Handle case where _agentic_prompt is already a Prompt object</span>
</span><span id="_AgenticLoop-434"><a href="#_AgenticLoop-434"><span class="linenos"> 434</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agentic_prompt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_agentic_prompt</span><span class="p">,</span> <span class="s1">&#39;as_dict&#39;</span><span class="p">):</span>
</span><span id="_AgenticLoop-435"><a href="#_AgenticLoop-435"><span class="linenos"> 435</span></a>            <span class="c1"># It&#39;s already a Prompt object, just update the data and return</span>
</span><span id="_AgenticLoop-436"><a href="#_AgenticLoop-436"><span class="linenos"> 436</span></a>            <span class="n">agentic_prompt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agentic_prompt</span>
</span><span id="_AgenticLoop-437"><a href="#_AgenticLoop-437"><span class="linenos"> 437</span></a>            <span class="c1"># Update prompt data if the prompt supports it</span>
</span><span id="_AgenticLoop-438"><a href="#_AgenticLoop-438"><span class="linenos"> 438</span></a>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">agentic_prompt</span><span class="p">,</span> <span class="s1">&#39;prompt_data&#39;</span><span class="p">):</span>
</span><span id="_AgenticLoop-439"><a href="#_AgenticLoop-439"><span class="linenos"> 439</span></a>                <span class="n">agentic_prompt</span><span class="o">.</span><span class="n">prompt_data</span> <span class="o">=</span> <span class="n">prompt_data</span>
</span><span id="_AgenticLoop-440"><a href="#_AgenticLoop-440"><span class="linenos"> 440</span></a>        <span class="k">else</span><span class="p">:</span>           
</span><span id="_AgenticLoop-441"><a href="#_AgenticLoop-441"><span class="linenos"> 441</span></a>            <span class="c1"># Otherwise, determine prompt configuration and create new Prompt</span>
</span><span id="_AgenticLoop-442"><a href="#_AgenticLoop-442"><span class="linenos"> 442</span></a>            <span class="n">prompt_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_determine_prompt_config</span><span class="p">(</span><span class="n">agent_type</span><span class="p">)</span>
</span><span id="_AgenticLoop-443"><a href="#_AgenticLoop-443"><span class="linenos"> 443</span></a>            
</span><span id="_AgenticLoop-444"><a href="#_AgenticLoop-444"><span class="linenos"> 444</span></a>            <span class="n">agentic_prompt</span> <span class="o">=</span> <span class="n">Prompt</span><span class="p">(</span>
</span><span id="_AgenticLoop-445"><a href="#_AgenticLoop-445"><span class="linenos"> 445</span></a>                <span class="o">**</span><span class="n">prompt_config</span><span class="p">,</span>
</span><span id="_AgenticLoop-446"><a href="#_AgenticLoop-446"><span class="linenos"> 446</span></a>                <span class="n">is_system</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="_AgenticLoop-447"><a href="#_AgenticLoop-447"><span class="linenos"> 447</span></a>                <span class="n">prompt_data</span><span class="o">=</span><span class="n">prompt_data</span>
</span><span id="_AgenticLoop-448"><a href="#_AgenticLoop-448"><span class="linenos"> 448</span></a>            <span class="p">)</span>
</span><span id="_AgenticLoop-449"><a href="#_AgenticLoop-449"><span class="linenos"> 449</span></a>
</span><span id="_AgenticLoop-450"><a href="#_AgenticLoop-450"><span class="linenos"> 450</span></a>        <span class="n">messages</span> <span class="o">=</span> <span class="p">[</span><span class="n">agentic_prompt</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()]</span>
</span><span id="_AgenticLoop-451"><a href="#_AgenticLoop-451"><span class="linenos"> 451</span></a>
</span><span id="_AgenticLoop-452"><a href="#_AgenticLoop-452"><span class="linenos"> 452</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">Prompt</span><span class="p">):</span>
</span><span id="_AgenticLoop-453"><a href="#_AgenticLoop-453"><span class="linenos"> 453</span></a>            <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">as_dict</span><span class="p">())</span>
</span><span id="_AgenticLoop-454"><a href="#_AgenticLoop-454"><span class="linenos"> 454</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="_AgenticLoop-455"><a href="#_AgenticLoop-455"><span class="linenos"> 455</span></a>            <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">query</span><span class="p">})</span>
</span><span id="_AgenticLoop-456"><a href="#_AgenticLoop-456"><span class="linenos"> 456</span></a>
</span><span id="_AgenticLoop-457"><a href="#_AgenticLoop-457"><span class="linenos"> 457</span></a>        <span class="k">return</span> <span class="n">messages</span>
</span><span id="_AgenticLoop-458"><a href="#_AgenticLoop-458"><span class="linenos"> 458</span></a>    
</span><span id="_AgenticLoop-459"><a href="#_AgenticLoop-459"><span class="linenos"> 459</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_determine_prompt_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="_AgenticLoop-460"><a href="#_AgenticLoop-460"><span class="linenos"> 460</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Determine the prompt configuration based on agentic_prompt setting.</span>
</span><span id="_AgenticLoop-461"><a href="#_AgenticLoop-461"><span class="linenos"> 461</span></a><span class="sd">        </span>
</span><span id="_AgenticLoop-462"><a href="#_AgenticLoop-462"><span class="linenos"> 462</span></a><span class="sd">        Parameters</span>
</span><span id="_AgenticLoop-463"><a href="#_AgenticLoop-463"><span class="linenos"> 463</span></a><span class="sd">        ----------</span>
</span><span id="_AgenticLoop-464"><a href="#_AgenticLoop-464"><span class="linenos"> 464</span></a><span class="sd">        agent_type : str</span>
</span><span id="_AgenticLoop-465"><a href="#_AgenticLoop-465"><span class="linenos"> 465</span></a><span class="sd">            Type of agent for fallback prompt selection</span>
</span><span id="_AgenticLoop-466"><a href="#_AgenticLoop-466"><span class="linenos"> 466</span></a><span class="sd">            </span>
</span><span id="_AgenticLoop-467"><a href="#_AgenticLoop-467"><span class="linenos"> 467</span></a><span class="sd">        Returns</span>
</span><span id="_AgenticLoop-468"><a href="#_AgenticLoop-468"><span class="linenos"> 468</span></a><span class="sd">        -------</span>
</span><span id="_AgenticLoop-469"><a href="#_AgenticLoop-469"><span class="linenos"> 469</span></a><span class="sd">        Dict[str, Any]</span>
</span><span id="_AgenticLoop-470"><a href="#_AgenticLoop-470"><span class="linenos"> 470</span></a><span class="sd">            Configuration dictionary for Prompt initialization</span>
</span><span id="_AgenticLoop-471"><a href="#_AgenticLoop-471"><span class="linenos"> 471</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="_AgenticLoop-472"><a href="#_AgenticLoop-472"><span class="linenos"> 472</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agentic_prompt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="_AgenticLoop-473"><a href="#_AgenticLoop-473"><span class="linenos"> 473</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="_AgenticLoop-474"><a href="#_AgenticLoop-474"><span class="linenos"> 474</span></a>                <span class="s2">&quot;prompt_id&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_DEFAULT_PROMPT_PATH</span><span class="si">}{</span><span class="n">agent_type</span><span class="si">}</span><span class="s2">.prompt&quot;</span>
</span><span id="_AgenticLoop-475"><a href="#_AgenticLoop-475"><span class="linenos"> 475</span></a>            <span class="p">}</span>
</span><span id="_AgenticLoop-476"><a href="#_AgenticLoop-476"><span class="linenos"> 476</span></a>        
</span><span id="_AgenticLoop-477"><a href="#_AgenticLoop-477"><span class="linenos"> 477</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_agentic_prompt</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="_AgenticLoop-478"><a href="#_AgenticLoop-478"><span class="linenos"> 478</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agentic_prompt</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.prompt&quot;</span><span class="p">):</span>
</span><span id="_AgenticLoop-479"><a href="#_AgenticLoop-479"><span class="linenos"> 479</span></a>                <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;prompt_id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agentic_prompt</span><span class="p">}</span>
</span><span id="_AgenticLoop-480"><a href="#_AgenticLoop-480"><span class="linenos"> 480</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="_AgenticLoop-481"><a href="#_AgenticLoop-481"><span class="linenos"> 481</span></a>                <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;prompt&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agentic_prompt</span><span class="p">}</span>
</span><span id="_AgenticLoop-482"><a href="#_AgenticLoop-482"><span class="linenos"> 482</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="_AgenticLoop-483"><a href="#_AgenticLoop-483"><span class="linenos"> 483</span></a>            <span class="c1"># For non-string types (including Prompt objects), treat as prompt content</span>
</span><span id="_AgenticLoop-484"><a href="#_AgenticLoop-484"><span class="linenos"> 484</span></a>            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;prompt&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agentic_prompt</span><span class="p">}</span>
</span><span id="_AgenticLoop-485"><a href="#_AgenticLoop-485"><span class="linenos"> 485</span></a>
</span><span id="_AgenticLoop-486"><a href="#_AgenticLoop-486"><span class="linenos"> 486</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_debug_print</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="_AgenticLoop-487"><a href="#_AgenticLoop-487"><span class="linenos"> 487</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Print debug information if debug mode is enabled.</span>
</span><span id="_AgenticLoop-488"><a href="#_AgenticLoop-488"><span class="linenos"> 488</span></a><span class="sd">        </span>
</span><span id="_AgenticLoop-489"><a href="#_AgenticLoop-489"><span class="linenos"> 489</span></a><span class="sd">        Parameters</span>
</span><span id="_AgenticLoop-490"><a href="#_AgenticLoop-490"><span class="linenos"> 490</span></a><span class="sd">        ----------</span>
</span><span id="_AgenticLoop-491"><a href="#_AgenticLoop-491"><span class="linenos"> 491</span></a><span class="sd">        content : str</span>
</span><span id="_AgenticLoop-492"><a href="#_AgenticLoop-492"><span class="linenos"> 492</span></a><span class="sd">            Content to print in debug mode</span>
</span><span id="_AgenticLoop-493"><a href="#_AgenticLoop-493"><span class="linenos"> 493</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="_AgenticLoop-494"><a href="#_AgenticLoop-494"><span class="linenos"> 494</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_debug</span><span class="p">:</span>
</span><span id="_AgenticLoop-495"><a href="#_AgenticLoop-495"><span class="linenos"> 495</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</span><span id="_AgenticLoop-496"><a href="#_AgenticLoop-496"><span class="linenos"> 496</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-------&quot;</span><span class="p">)</span>
</span><span id="_AgenticLoop-497"><a href="#_AgenticLoop-497"><span class="linenos"> 497</span></a>    
</span><span id="_AgenticLoop-498"><a href="#_AgenticLoop-498"><span class="linenos"> 498</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_request_human_feedback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">step_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">action_data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="_AgenticLoop-499"><a href="#_AgenticLoop-499"><span class="linenos"> 499</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Request human feedback for the current step.</span>
</span><span id="_AgenticLoop-500"><a href="#_AgenticLoop-500"><span class="linenos"> 500</span></a><span class="sd">        </span>
</span><span id="_AgenticLoop-501"><a href="#_AgenticLoop-501"><span class="linenos"> 501</span></a><span class="sd">        This method pauses execution and asks the user for confirmation</span>
</span><span id="_AgenticLoop-502"><a href="#_AgenticLoop-502"><span class="linenos"> 502</span></a><span class="sd">        before proceeding with the current step.</span>
</span><span id="_AgenticLoop-503"><a href="#_AgenticLoop-503"><span class="linenos"> 503</span></a><span class="sd">        </span>
</span><span id="_AgenticLoop-504"><a href="#_AgenticLoop-504"><span class="linenos"> 504</span></a><span class="sd">        Parameters</span>
</span><span id="_AgenticLoop-505"><a href="#_AgenticLoop-505"><span class="linenos"> 505</span></a><span class="sd">        ----------</span>
</span><span id="_AgenticLoop-506"><a href="#_AgenticLoop-506"><span class="linenos"> 506</span></a><span class="sd">        step_type : str</span>
</span><span id="_AgenticLoop-507"><a href="#_AgenticLoop-507"><span class="linenos"> 507</span></a><span class="sd">            Type of step being executed (e.g., &quot;thought&quot;, &quot;action&quot;, &quot;observation&quot;)</span>
</span><span id="_AgenticLoop-508"><a href="#_AgenticLoop-508"><span class="linenos"> 508</span></a><span class="sd">        content : str</span>
</span><span id="_AgenticLoop-509"><a href="#_AgenticLoop-509"><span class="linenos"> 509</span></a><span class="sd">            Content of the current step</span>
</span><span id="_AgenticLoop-510"><a href="#_AgenticLoop-510"><span class="linenos"> 510</span></a><span class="sd">        action_data : Optional[Dict], default None</span>
</span><span id="_AgenticLoop-511"><a href="#_AgenticLoop-511"><span class="linenos"> 511</span></a><span class="sd">            Action data if this is an action step</span>
</span><span id="_AgenticLoop-512"><a href="#_AgenticLoop-512"><span class="linenos"> 512</span></a><span class="sd">        </span>
</span><span id="_AgenticLoop-513"><a href="#_AgenticLoop-513"><span class="linenos"> 513</span></a><span class="sd">        Returns</span>
</span><span id="_AgenticLoop-514"><a href="#_AgenticLoop-514"><span class="linenos"> 514</span></a><span class="sd">        -------</span>
</span><span id="_AgenticLoop-515"><a href="#_AgenticLoop-515"><span class="linenos"> 515</span></a><span class="sd">        bool</span>
</span><span id="_AgenticLoop-516"><a href="#_AgenticLoop-516"><span class="linenos"> 516</span></a><span class="sd">            True if the user approves the step, False if they want to stop</span>
</span><span id="_AgenticLoop-517"><a href="#_AgenticLoop-517"><span class="linenos"> 517</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="_AgenticLoop-518"><a href="#_AgenticLoop-518"><span class="linenos"> 518</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">60</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="_AgenticLoop-519"><a href="#_AgenticLoop-519"><span class="linenos"> 519</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;HUMAN FEEDBACK REQUIRED - </span><span class="si">{</span><span class="n">step_type</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> STEP&quot;</span><span class="p">)</span>
</span><span id="_AgenticLoop-520"><a href="#_AgenticLoop-520"><span class="linenos"> 520</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">60</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="_AgenticLoop-521"><a href="#_AgenticLoop-521"><span class="linenos"> 521</span></a>        
</span><span id="_AgenticLoop-522"><a href="#_AgenticLoop-522"><span class="linenos"> 522</span></a>        <span class="k">if</span> <span class="n">action_data</span><span class="p">:</span>
</span><span id="_AgenticLoop-523"><a href="#_AgenticLoop-523"><span class="linenos"> 523</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Action to execute: </span><span class="si">{</span><span class="n">action_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Unknown&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="_AgenticLoop-524"><a href="#_AgenticLoop-524"><span class="linenos"> 524</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Arguments: </span><span class="si">{</span><span class="n">action_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;arguments&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{})</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="_AgenticLoop-525"><a href="#_AgenticLoop-525"><span class="linenos"> 525</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="_AgenticLoop-526"><a href="#_AgenticLoop-526"><span class="linenos"> 526</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Content: </span><span class="si">{</span><span class="n">content</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="_AgenticLoop-527"><a href="#_AgenticLoop-527"><span class="linenos"> 527</span></a>        
</span><span id="_AgenticLoop-528"><a href="#_AgenticLoop-528"><span class="linenos"> 528</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Options:&quot;</span><span class="p">)</span>
</span><span id="_AgenticLoop-529"><a href="#_AgenticLoop-529"><span class="linenos"> 529</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  [y] Yes - Continue with this step&quot;</span><span class="p">)</span>
</span><span id="_AgenticLoop-530"><a href="#_AgenticLoop-530"><span class="linenos"> 530</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  [n] No - Stop execution&quot;</span><span class="p">)</span>
</span><span id="_AgenticLoop-531"><a href="#_AgenticLoop-531"><span class="linenos"> 531</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  [s] Skip - Skip this step and continue&quot;</span><span class="p">)</span>
</span><span id="_AgenticLoop-532"><a href="#_AgenticLoop-532"><span class="linenos"> 532</span></a>        
</span><span id="_AgenticLoop-533"><a href="#_AgenticLoop-533"><span class="linenos"> 533</span></a>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="_AgenticLoop-534"><a href="#_AgenticLoop-534"><span class="linenos"> 534</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="_AgenticLoop-535"><a href="#_AgenticLoop-535"><span class="linenos"> 535</span></a>                <span class="n">response</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Your choice (y/n/s): &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="_AgenticLoop-536"><a href="#_AgenticLoop-536"><span class="linenos"> 536</span></a>                <span class="k">if</span> <span class="n">response</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;yes&#39;</span><span class="p">]:</span>
</span><span id="_AgenticLoop-537"><a href="#_AgenticLoop-537"><span class="linenos"> 537</span></a>                    <span class="k">return</span> <span class="kc">True</span>
</span><span id="_AgenticLoop-538"><a href="#_AgenticLoop-538"><span class="linenos"> 538</span></a>                <span class="k">elif</span> <span class="n">response</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="s1">&#39;no&#39;</span><span class="p">]:</span>
</span><span id="_AgenticLoop-539"><a href="#_AgenticLoop-539"><span class="linenos"> 539</span></a>                    <span class="k">return</span> <span class="kc">False</span>
</span><span id="_AgenticLoop-540"><a href="#_AgenticLoop-540"><span class="linenos"> 540</span></a>                <span class="k">elif</span> <span class="n">response</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="s1">&#39;skip&#39;</span><span class="p">]:</span>
</span><span id="_AgenticLoop-541"><a href="#_AgenticLoop-541"><span class="linenos"> 541</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Step skipped.&quot;</span><span class="p">)</span>
</span><span id="_AgenticLoop-542"><a href="#_AgenticLoop-542"><span class="linenos"> 542</span></a>                    <span class="k">return</span> <span class="kc">True</span>  <span class="c1"># Continue but skip the current step</span>
</span><span id="_AgenticLoop-543"><a href="#_AgenticLoop-543"><span class="linenos"> 543</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="_AgenticLoop-544"><a href="#_AgenticLoop-544"><span class="linenos"> 544</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Please enter &#39;y&#39; for yes, &#39;n&#39; for no, or &#39;s&#39; for skip.&quot;</span><span class="p">)</span>
</span><span id="_AgenticLoop-545"><a href="#_AgenticLoop-545"><span class="linenos"> 545</span></a>            <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
</span><span id="_AgenticLoop-546"><a href="#_AgenticLoop-546"><span class="linenos"> 546</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Execution interrupted by user.&quot;</span><span class="p">)</span>
</span><span id="_AgenticLoop-547"><a href="#_AgenticLoop-547"><span class="linenos"> 547</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="_AgenticLoop-548"><a href="#_AgenticLoop-548"><span class="linenos"> 548</span></a>    
</span><span id="_AgenticLoop-549"><a href="#_AgenticLoop-549"><span class="linenos"> 549</span></a>
</span><span id="_AgenticLoop-550"><a href="#_AgenticLoop-550"><span class="linenos"> 550</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_step_format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="_AgenticLoop-551"><a href="#_AgenticLoop-551"><span class="linenos"> 551</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse the step-based format &lt;STEP_TYPE&gt;: &lt;RESULT&gt;.</span>
</span><span id="_AgenticLoop-552"><a href="#_AgenticLoop-552"><span class="linenos"> 552</span></a><span class="sd">        </span>
</span><span id="_AgenticLoop-553"><a href="#_AgenticLoop-553"><span class="linenos"> 553</span></a><span class="sd">        This method parses agent responses that follow the structured step format</span>
</span><span id="_AgenticLoop-554"><a href="#_AgenticLoop-554"><span class="linenos"> 554</span></a><span class="sd">        used by ReAct and similar reasoning patterns. It extracts the step type,</span>
</span><span id="_AgenticLoop-555"><a href="#_AgenticLoop-555"><span class="linenos"> 555</span></a><span class="sd">        step number, and content from formatted responses.</span>
</span><span id="_AgenticLoop-556"><a href="#_AgenticLoop-556"><span class="linenos"> 556</span></a><span class="sd">        </span>
</span><span id="_AgenticLoop-557"><a href="#_AgenticLoop-557"><span class="linenos"> 557</span></a><span class="sd">        Supported step types:</span>
</span><span id="_AgenticLoop-558"><a href="#_AgenticLoop-558"><span class="linenos"> 558</span></a><span class="sd">        - Thought: Reasoning and analysis steps</span>
</span><span id="_AgenticLoop-559"><a href="#_AgenticLoop-559"><span class="linenos"> 559</span></a><span class="sd">        - Action: Tool calls and actions (must be valid JSON)</span>
</span><span id="_AgenticLoop-560"><a href="#_AgenticLoop-560"><span class="linenos"> 560</span></a><span class="sd">        - Observation: Results from tool executions</span>
</span><span id="_AgenticLoop-561"><a href="#_AgenticLoop-561"><span class="linenos"> 561</span></a><span class="sd">        - Final answer: Conclusive responses to user queries</span>
</span><span id="_AgenticLoop-562"><a href="#_AgenticLoop-562"><span class="linenos"> 562</span></a><span class="sd">        </span>
</span><span id="_AgenticLoop-563"><a href="#_AgenticLoop-563"><span class="linenos"> 563</span></a><span class="sd">        Special handling: </span>
</span><span id="_AgenticLoop-564"><a href="#_AgenticLoop-564"><span class="linenos"> 564</span></a><span class="sd">        - If content contains both &quot;Thought&quot; and &quot;Action&quot;, the Action will be returned with priority.</span>
</span><span id="_AgenticLoop-565"><a href="#_AgenticLoop-565"><span class="linenos"> 565</span></a><span class="sd">        - If content contains both &quot;Thought&quot; and &quot;Final answer&quot;, the Final answer will be returned with priority.</span>
</span><span id="_AgenticLoop-566"><a href="#_AgenticLoop-566"><span class="linenos"> 566</span></a><span class="sd">        </span>
</span><span id="_AgenticLoop-567"><a href="#_AgenticLoop-567"><span class="linenos"> 567</span></a><span class="sd">        Parameters</span>
</span><span id="_AgenticLoop-568"><a href="#_AgenticLoop-568"><span class="linenos"> 568</span></a><span class="sd">        ----------</span>
</span><span id="_AgenticLoop-569"><a href="#_AgenticLoop-569"><span class="linenos"> 569</span></a><span class="sd">        content : str</span>
</span><span id="_AgenticLoop-570"><a href="#_AgenticLoop-570"><span class="linenos"> 570</span></a><span class="sd">            Content to parse in the format &lt;STEP_TYPE&gt;: &lt;RESULT&gt;</span>
</span><span id="_AgenticLoop-571"><a href="#_AgenticLoop-571"><span class="linenos"> 571</span></a><span class="sd">        </span>
</span><span id="_AgenticLoop-572"><a href="#_AgenticLoop-572"><span class="linenos"> 572</span></a><span class="sd">        Returns</span>
</span><span id="_AgenticLoop-573"><a href="#_AgenticLoop-573"><span class="linenos"> 573</span></a><span class="sd">        -------</span>
</span><span id="_AgenticLoop-574"><a href="#_AgenticLoop-574"><span class="linenos"> 574</span></a><span class="sd">        Optional[Dict[str, Any]]</span>
</span><span id="_AgenticLoop-575"><a href="#_AgenticLoop-575"><span class="linenos"> 575</span></a><span class="sd">            Dictionary containing:</span>
</span><span id="_AgenticLoop-576"><a href="#_AgenticLoop-576"><span class="linenos"> 576</span></a><span class="sd">            - step_type: Type of step (thought, action, observation, final answer)</span>
</span><span id="_AgenticLoop-577"><a href="#_AgenticLoop-577"><span class="linenos"> 577</span></a><span class="sd">            - step_number: Optional step number if present</span>
</span><span id="_AgenticLoop-578"><a href="#_AgenticLoop-578"><span class="linenos"> 578</span></a><span class="sd">            - content: Step content</span>
</span><span id="_AgenticLoop-579"><a href="#_AgenticLoop-579"><span class="linenos"> 579</span></a><span class="sd">            - action: Parsed action data (for action steps)</span>
</span><span id="_AgenticLoop-580"><a href="#_AgenticLoop-580"><span class="linenos"> 580</span></a><span class="sd">            - final_answer: Final answer content (for final answer steps)</span>
</span><span id="_AgenticLoop-581"><a href="#_AgenticLoop-581"><span class="linenos"> 581</span></a><span class="sd">            Returns None if parsing fails</span>
</span><span id="_AgenticLoop-582"><a href="#_AgenticLoop-582"><span class="linenos"> 582</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="_AgenticLoop-583"><a href="#_AgenticLoop-583"><span class="linenos"> 583</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">content</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="_AgenticLoop-584"><a href="#_AgenticLoop-584"><span class="linenos"> 584</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="_AgenticLoop-585"><a href="#_AgenticLoop-585"><span class="linenos"> 585</span></a>        
</span><span id="_AgenticLoop-586"><a href="#_AgenticLoop-586"><span class="linenos"> 586</span></a>        <span class="n">content</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="_AgenticLoop-587"><a href="#_AgenticLoop-587"><span class="linenos"> 587</span></a>        
</span><span id="_AgenticLoop-588"><a href="#_AgenticLoop-588"><span class="linenos"> 588</span></a>        <span class="c1"># Check for multiple step types and prioritize accordingly</span>
</span><span id="_AgenticLoop-589"><a href="#_AgenticLoop-589"><span class="linenos"> 589</span></a>        <span class="n">lines</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="_AgenticLoop-590"><a href="#_AgenticLoop-590"><span class="linenos"> 590</span></a>        <span class="n">action_start</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="_AgenticLoop-591"><a href="#_AgenticLoop-591"><span class="linenos"> 591</span></a>        <span class="n">thought_start</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="_AgenticLoop-592"><a href="#_AgenticLoop-592"><span class="linenos"> 592</span></a>        <span class="n">final_answer_start</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="_AgenticLoop-593"><a href="#_AgenticLoop-593"><span class="linenos"> 593</span></a>        
</span><span id="_AgenticLoop-594"><a href="#_AgenticLoop-594"><span class="linenos"> 594</span></a>        <span class="c1"># Find the start lines for Action, Thought, and Final answer</span>
</span><span id="_AgenticLoop-595"><a href="#_AgenticLoop-595"><span class="linenos"> 595</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
</span><span id="_AgenticLoop-596"><a href="#_AgenticLoop-596"><span class="linenos"> 596</span></a>            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^Action(?:\s+\d+)?\s*:&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
</span><span id="_AgenticLoop-597"><a href="#_AgenticLoop-597"><span class="linenos"> 597</span></a>                <span class="n">action_start</span> <span class="o">=</span> <span class="n">i</span>
</span><span id="_AgenticLoop-598"><a href="#_AgenticLoop-598"><span class="linenos"> 598</span></a>            <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^Thought(?:\s+\d+)?\s*:&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
</span><span id="_AgenticLoop-599"><a href="#_AgenticLoop-599"><span class="linenos"> 599</span></a>                <span class="n">thought_start</span> <span class="o">=</span> <span class="n">i</span>
</span><span id="_AgenticLoop-600"><a href="#_AgenticLoop-600"><span class="linenos"> 600</span></a>            <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^Final answer(?:\s+\d+)?\s*:&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
</span><span id="_AgenticLoop-601"><a href="#_AgenticLoop-601"><span class="linenos"> 601</span></a>                <span class="n">final_answer_start</span> <span class="o">=</span> <span class="n">i</span>
</span><span id="_AgenticLoop-602"><a href="#_AgenticLoop-602"><span class="linenos"> 602</span></a>        
</span><span id="_AgenticLoop-603"><a href="#_AgenticLoop-603"><span class="linenos"> 603</span></a>        <span class="c1"># Priority: Final answer &gt; Action &gt; Thought</span>
</span><span id="_AgenticLoop-604"><a href="#_AgenticLoop-604"><span class="linenos"> 604</span></a>        <span class="k">if</span> <span class="n">final_answer_start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="_AgenticLoop-605"><a href="#_AgenticLoop-605"><span class="linenos"> 605</span></a>            <span class="c1"># Final answer has highest priority</span>
</span><span id="_AgenticLoop-606"><a href="#_AgenticLoop-606"><span class="linenos"> 606</span></a>            <span class="n">step_type</span> <span class="o">=</span> <span class="s2">&quot;final_answer&quot;</span>
</span><span id="_AgenticLoop-607"><a href="#_AgenticLoop-607"><span class="linenos"> 607</span></a>            
</span><span id="_AgenticLoop-608"><a href="#_AgenticLoop-608"><span class="linenos"> 608</span></a>            <span class="c1"># Extract step number from Final answer line</span>
</span><span id="_AgenticLoop-609"><a href="#_AgenticLoop-609"><span class="linenos"> 609</span></a>            <span class="n">final_answer_line</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">final_answer_start</span><span class="p">]</span>
</span><span id="_AgenticLoop-610"><a href="#_AgenticLoop-610"><span class="linenos"> 610</span></a>            <span class="n">step_number_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Final answer\s+(\d+)\s*:&#39;</span><span class="p">,</span> <span class="n">final_answer_line</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
</span><span id="_AgenticLoop-611"><a href="#_AgenticLoop-611"><span class="linenos"> 611</span></a>            <span class="n">step_number</span> <span class="o">=</span> <span class="n">step_number_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">step_number_match</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="_AgenticLoop-612"><a href="#_AgenticLoop-612"><span class="linenos"> 612</span></a>            
</span><span id="_AgenticLoop-613"><a href="#_AgenticLoop-613"><span class="linenos"> 613</span></a>            <span class="c1"># Extract content from Final answer (everything after the colon on the first line)</span>
</span><span id="_AgenticLoop-614"><a href="#_AgenticLoop-614"><span class="linenos"> 614</span></a>            <span class="n">final_answer_content</span> <span class="o">=</span> <span class="n">final_answer_line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="_AgenticLoop-615"><a href="#_AgenticLoop-615"><span class="linenos"> 615</span></a>            
</span><span id="_AgenticLoop-616"><a href="#_AgenticLoop-616"><span class="linenos"> 616</span></a>            <span class="c1"># Add all subsequent lines until we hit another step type or end</span>
</span><span id="_AgenticLoop-617"><a href="#_AgenticLoop-617"><span class="linenos"> 617</span></a>            <span class="n">i</span> <span class="o">=</span> <span class="n">final_answer_start</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="_AgenticLoop-618"><a href="#_AgenticLoop-618"><span class="linenos"> 618</span></a>            <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
</span><span id="_AgenticLoop-619"><a href="#_AgenticLoop-619"><span class="linenos"> 619</span></a>                <span class="n">line</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="_AgenticLoop-620"><a href="#_AgenticLoop-620"><span class="linenos"> 620</span></a>                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^(Thought|Action|Observation|Final answer)(?:\s+\d+)?\s*:&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
</span><span id="_AgenticLoop-621"><a href="#_AgenticLoop-621"><span class="linenos"> 621</span></a>                    <span class="k">break</span>
</span><span id="_AgenticLoop-622"><a href="#_AgenticLoop-622"><span class="linenos"> 622</span></a>                <span class="k">if</span> <span class="n">line</span><span class="p">:</span>  <span class="c1"># Only add non-empty lines</span>
</span><span id="_AgenticLoop-623"><a href="#_AgenticLoop-623"><span class="linenos"> 623</span></a>                    <span class="n">final_answer_content</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">line</span>
</span><span id="_AgenticLoop-624"><a href="#_AgenticLoop-624"><span class="linenos"> 624</span></a>                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="_AgenticLoop-625"><a href="#_AgenticLoop-625"><span class="linenos"> 625</span></a>            
</span><span id="_AgenticLoop-626"><a href="#_AgenticLoop-626"><span class="linenos"> 626</span></a>            <span class="n">step_content</span> <span class="o">=</span> <span class="n">final_answer_content</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;```json&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;```&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="_AgenticLoop-627"><a href="#_AgenticLoop-627"><span class="linenos"> 627</span></a>            
</span><span id="_AgenticLoop-628"><a href="#_AgenticLoop-628"><span class="linenos"> 628</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="_AgenticLoop-629"><a href="#_AgenticLoop-629"><span class="linenos"> 629</span></a>                <span class="s2">&quot;step_type&quot;</span><span class="p">:</span> <span class="n">step_type</span><span class="p">,</span>
</span><span id="_AgenticLoop-630"><a href="#_AgenticLoop-630"><span class="linenos"> 630</span></a>                <span class="s2">&quot;step_number&quot;</span><span class="p">:</span> <span class="n">step_number</span><span class="p">,</span>
</span><span id="_AgenticLoop-631"><a href="#_AgenticLoop-631"><span class="linenos"> 631</span></a>                <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">step_content</span><span class="p">,</span>
</span><span id="_AgenticLoop-632"><a href="#_AgenticLoop-632"><span class="linenos"> 632</span></a>                <span class="s2">&quot;final_answer&quot;</span><span class="p">:</span> <span class="n">step_content</span>
</span><span id="_AgenticLoop-633"><a href="#_AgenticLoop-633"><span class="linenos"> 633</span></a>            <span class="p">}</span>
</span><span id="_AgenticLoop-634"><a href="#_AgenticLoop-634"><span class="linenos"> 634</span></a>            
</span><span id="_AgenticLoop-635"><a href="#_AgenticLoop-635"><span class="linenos"> 635</span></a>            <span class="k">return</span> <span class="n">result</span>
</span><span id="_AgenticLoop-636"><a href="#_AgenticLoop-636"><span class="linenos"> 636</span></a>            
</span><span id="_AgenticLoop-637"><a href="#_AgenticLoop-637"><span class="linenos"> 637</span></a>        <span class="k">elif</span> <span class="n">action_start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">thought_start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="_AgenticLoop-638"><a href="#_AgenticLoop-638"><span class="linenos"> 638</span></a>            <span class="c1"># Both Thought and Action present, prioritize Action</span>
</span><span id="_AgenticLoop-639"><a href="#_AgenticLoop-639"><span class="linenos"> 639</span></a>            <span class="n">step_type</span> <span class="o">=</span> <span class="s2">&quot;action&quot;</span>
</span><span id="_AgenticLoop-640"><a href="#_AgenticLoop-640"><span class="linenos"> 640</span></a>            
</span><span id="_AgenticLoop-641"><a href="#_AgenticLoop-641"><span class="linenos"> 641</span></a>            <span class="c1"># Extract step number from Action line</span>
</span><span id="_AgenticLoop-642"><a href="#_AgenticLoop-642"><span class="linenos"> 642</span></a>            <span class="n">action_line</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">action_start</span><span class="p">]</span>
</span><span id="_AgenticLoop-643"><a href="#_AgenticLoop-643"><span class="linenos"> 643</span></a>            <span class="n">step_number_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Action\s+(\d+)\s*:&#39;</span><span class="p">,</span> <span class="n">action_line</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
</span><span id="_AgenticLoop-644"><a href="#_AgenticLoop-644"><span class="linenos"> 644</span></a>            <span class="n">step_number</span> <span class="o">=</span> <span class="n">step_number_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">step_number_match</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="_AgenticLoop-645"><a href="#_AgenticLoop-645"><span class="linenos"> 645</span></a>            
</span><span id="_AgenticLoop-646"><a href="#_AgenticLoop-646"><span class="linenos"> 646</span></a>            <span class="c1"># Extract content from Action (everything after the colon on the first line)</span>
</span><span id="_AgenticLoop-647"><a href="#_AgenticLoop-647"><span class="linenos"> 647</span></a>            <span class="n">action_content</span> <span class="o">=</span> <span class="n">action_line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="_AgenticLoop-648"><a href="#_AgenticLoop-648"><span class="linenos"> 648</span></a>            
</span><span id="_AgenticLoop-649"><a href="#_AgenticLoop-649"><span class="linenos"> 649</span></a>            <span class="c1"># Add all subsequent lines until we hit another step type or end</span>
</span><span id="_AgenticLoop-650"><a href="#_AgenticLoop-650"><span class="linenos"> 650</span></a>            <span class="n">i</span> <span class="o">=</span> <span class="n">action_start</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="_AgenticLoop-651"><a href="#_AgenticLoop-651"><span class="linenos"> 651</span></a>            <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
</span><span id="_AgenticLoop-652"><a href="#_AgenticLoop-652"><span class="linenos"> 652</span></a>                <span class="n">line</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="_AgenticLoop-653"><a href="#_AgenticLoop-653"><span class="linenos"> 653</span></a>                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^(Thought|Action|Observation|Final answer)(?:\s+\d+)?\s*:&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">):</span>
</span><span id="_AgenticLoop-654"><a href="#_AgenticLoop-654"><span class="linenos"> 654</span></a>                    <span class="k">break</span>
</span><span id="_AgenticLoop-655"><a href="#_AgenticLoop-655"><span class="linenos"> 655</span></a>                <span class="k">if</span> <span class="n">line</span><span class="p">:</span>  <span class="c1"># Only add non-empty lines</span>
</span><span id="_AgenticLoop-656"><a href="#_AgenticLoop-656"><span class="linenos"> 656</span></a>                    <span class="n">action_content</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">line</span>
</span><span id="_AgenticLoop-657"><a href="#_AgenticLoop-657"><span class="linenos"> 657</span></a>                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="_AgenticLoop-658"><a href="#_AgenticLoop-658"><span class="linenos"> 658</span></a>            
</span><span id="_AgenticLoop-659"><a href="#_AgenticLoop-659"><span class="linenos"> 659</span></a>            <span class="n">step_content</span> <span class="o">=</span> <span class="n">action_content</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;```json&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;```&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="_AgenticLoop-660"><a href="#_AgenticLoop-660"><span class="linenos"> 660</span></a>            
</span><span id="_AgenticLoop-661"><a href="#_AgenticLoop-661"><span class="linenos"> 661</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="_AgenticLoop-662"><a href="#_AgenticLoop-662"><span class="linenos"> 662</span></a>                <span class="s2">&quot;step_type&quot;</span><span class="p">:</span> <span class="n">step_type</span><span class="p">,</span>
</span><span id="_AgenticLoop-663"><a href="#_AgenticLoop-663"><span class="linenos"> 663</span></a>                <span class="s2">&quot;step_number&quot;</span><span class="p">:</span> <span class="n">step_number</span><span class="p">,</span>
</span><span id="_AgenticLoop-664"><a href="#_AgenticLoop-664"><span class="linenos"> 664</span></a>                <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">step_content</span>
</span><span id="_AgenticLoop-665"><a href="#_AgenticLoop-665"><span class="linenos"> 665</span></a>            <span class="p">}</span>
</span><span id="_AgenticLoop-666"><a href="#_AgenticLoop-666"><span class="linenos"> 666</span></a>            
</span><span id="_AgenticLoop-667"><a href="#_AgenticLoop-667"><span class="linenos"> 667</span></a>            <span class="c1"># Parse action data (must be JSON)</span>
</span><span id="_AgenticLoop-668"><a href="#_AgenticLoop-668"><span class="linenos"> 668</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="_AgenticLoop-669"><a href="#_AgenticLoop-669"><span class="linenos"> 669</span></a>                <span class="n">action_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">step_content</span><span class="p">)</span>
</span><span id="_AgenticLoop-670"><a href="#_AgenticLoop-670"><span class="linenos"> 670</span></a>                <span class="n">result</span><span class="p">[</span><span class="s2">&quot;action&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">action_data</span>
</span><span id="_AgenticLoop-671"><a href="#_AgenticLoop-671"><span class="linenos"> 671</span></a>            <span class="k">except</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">:</span>
</span><span id="_AgenticLoop-672"><a href="#_AgenticLoop-672"><span class="linenos"> 672</span></a>                <span class="c1"># If not valid JSON, keep content as raw string</span>
</span><span id="_AgenticLoop-673"><a href="#_AgenticLoop-673"><span class="linenos"> 673</span></a>                <span class="n">result</span><span class="p">[</span><span class="s2">&quot;action&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;raw&quot;</span><span class="p">:</span> <span class="n">step_content</span><span class="p">}</span>
</span><span id="_AgenticLoop-674"><a href="#_AgenticLoop-674"><span class="linenos"> 674</span></a>            
</span><span id="_AgenticLoop-675"><a href="#_AgenticLoop-675"><span class="linenos"> 675</span></a>            <span class="k">return</span> <span class="n">result</span>
</span><span id="_AgenticLoop-676"><a href="#_AgenticLoop-676"><span class="linenos"> 676</span></a>        
</span><span id="_AgenticLoop-677"><a href="#_AgenticLoop-677"><span class="linenos"> 677</span></a>        <span class="c1"># Standard single step parsing</span>
</span><span id="_AgenticLoop-678"><a href="#_AgenticLoop-678"><span class="linenos"> 678</span></a>        <span class="n">step_pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;^(Thought|Action|Observation|Final answer)(?:\s+(\d+))?\s*:\s*(.*)$&#39;</span>
</span><span id="_AgenticLoop-679"><a href="#_AgenticLoop-679"><span class="linenos"> 679</span></a>        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">step_pattern</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>
</span><span id="_AgenticLoop-680"><a href="#_AgenticLoop-680"><span class="linenos"> 680</span></a>        
</span><span id="_AgenticLoop-681"><a href="#_AgenticLoop-681"><span class="linenos"> 681</span></a>        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
</span><span id="_AgenticLoop-682"><a href="#_AgenticLoop-682"><span class="linenos"> 682</span></a>            <span class="n">step_type</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="_AgenticLoop-683"><a href="#_AgenticLoop-683"><span class="linenos"> 683</span></a>            <span class="n">step_number</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="_AgenticLoop-684"><a href="#_AgenticLoop-684"><span class="linenos"> 684</span></a>            <span class="n">step_content</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;```json&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;```&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="_AgenticLoop-685"><a href="#_AgenticLoop-685"><span class="linenos"> 685</span></a>            
</span><span id="_AgenticLoop-686"><a href="#_AgenticLoop-686"><span class="linenos"> 686</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="_AgenticLoop-687"><a href="#_AgenticLoop-687"><span class="linenos"> 687</span></a>                <span class="s2">&quot;step_type&quot;</span><span class="p">:</span> <span class="n">step_type</span><span class="p">,</span>
</span><span id="_AgenticLoop-688"><a href="#_AgenticLoop-688"><span class="linenos"> 688</span></a>                <span class="s2">&quot;step_number&quot;</span><span class="p">:</span> <span class="n">step_number</span><span class="p">,</span>
</span><span id="_AgenticLoop-689"><a href="#_AgenticLoop-689"><span class="linenos"> 689</span></a>                <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">step_content</span>
</span><span id="_AgenticLoop-690"><a href="#_AgenticLoop-690"><span class="linenos"> 690</span></a>            <span class="p">}</span>
</span><span id="_AgenticLoop-691"><a href="#_AgenticLoop-691"><span class="linenos"> 691</span></a>            
</span><span id="_AgenticLoop-692"><a href="#_AgenticLoop-692"><span class="linenos"> 692</span></a>            <span class="c1"># Special handling for Action steps (must be JSON)</span>
</span><span id="_AgenticLoop-693"><a href="#_AgenticLoop-693"><span class="linenos"> 693</span></a>            <span class="k">if</span> <span class="n">step_type</span> <span class="o">==</span> <span class="s2">&quot;action&quot;</span><span class="p">:</span>
</span><span id="_AgenticLoop-694"><a href="#_AgenticLoop-694"><span class="linenos"> 694</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="_AgenticLoop-695"><a href="#_AgenticLoop-695"><span class="linenos"> 695</span></a>                    <span class="n">action_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">step_content</span><span class="p">)</span>
</span><span id="_AgenticLoop-696"><a href="#_AgenticLoop-696"><span class="linenos"> 696</span></a>                    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;action&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">action_data</span>
</span><span id="_AgenticLoop-697"><a href="#_AgenticLoop-697"><span class="linenos"> 697</span></a>                <span class="k">except</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">:</span>
</span><span id="_AgenticLoop-698"><a href="#_AgenticLoop-698"><span class="linenos"> 698</span></a>                    <span class="c1"># If not valid JSON, keep content as raw string</span>
</span><span id="_AgenticLoop-699"><a href="#_AgenticLoop-699"><span class="linenos"> 699</span></a>                    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;action&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;raw&quot;</span><span class="p">:</span> <span class="n">step_content</span><span class="p">}</span>
</span><span id="_AgenticLoop-700"><a href="#_AgenticLoop-700"><span class="linenos"> 700</span></a>            
</span><span id="_AgenticLoop-701"><a href="#_AgenticLoop-701"><span class="linenos"> 701</span></a>            <span class="c1"># Special handling for Final answer steps</span>
</span><span id="_AgenticLoop-702"><a href="#_AgenticLoop-702"><span class="linenos"> 702</span></a>            <span class="k">elif</span> <span class="n">step_type</span> <span class="o">==</span> <span class="s2">&quot;final_answer&quot;</span><span class="p">:</span>
</span><span id="_AgenticLoop-703"><a href="#_AgenticLoop-703"><span class="linenos"> 703</span></a>                <span class="n">result</span><span class="p">[</span><span class="s2">&quot;final_answer&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">step_content</span>
</span><span id="_AgenticLoop-704"><a href="#_AgenticLoop-704"><span class="linenos"> 704</span></a>            
</span><span id="_AgenticLoop-705"><a href="#_AgenticLoop-705"><span class="linenos"> 705</span></a>            <span class="k">return</span> <span class="n">result</span>
</span><span id="_AgenticLoop-706"><a href="#_AgenticLoop-706"><span class="linenos"> 706</span></a>        
</span><span id="_AgenticLoop-707"><a href="#_AgenticLoop-707"><span class="linenos"> 707</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="_AgenticLoop-708"><a href="#_AgenticLoop-708"><span class="linenos"> 708</span></a>
</span><span id="_AgenticLoop-709"><a href="#_AgenticLoop-709"><span class="linenos"> 709</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_execute_model_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">messages</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="_AgenticLoop-710"><a href="#_AgenticLoop-710"><span class="linenos"> 710</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute a model step and return the response.</span>
</span><span id="_AgenticLoop-711"><a href="#_AgenticLoop-711"><span class="linenos"> 711</span></a><span class="sd">        </span>
</span><span id="_AgenticLoop-712"><a href="#_AgenticLoop-712"><span class="linenos"> 712</span></a><span class="sd">        This method handles both streaming and non-streaming model execution.</span>
</span><span id="_AgenticLoop-713"><a href="#_AgenticLoop-713"><span class="linenos"> 713</span></a><span class="sd">        If streaming is enabled and not already in progress, it uses the</span>
</span><span id="_AgenticLoop-714"><a href="#_AgenticLoop-714"><span class="linenos"> 714</span></a><span class="sd">        streaming method. Otherwise, it uses standard model execution.</span>
</span><span id="_AgenticLoop-715"><a href="#_AgenticLoop-715"><span class="linenos"> 715</span></a><span class="sd">        </span>
</span><span id="_AgenticLoop-716"><a href="#_AgenticLoop-716"><span class="linenos"> 716</span></a><span class="sd">        Parameters</span>
</span><span id="_AgenticLoop-717"><a href="#_AgenticLoop-717"><span class="linenos"> 717</span></a><span class="sd">        ----------</span>
</span><span id="_AgenticLoop-718"><a href="#_AgenticLoop-718"><span class="linenos"> 718</span></a><span class="sd">        messages : List[Dict[str, Any]]</span>
</span><span id="_AgenticLoop-719"><a href="#_AgenticLoop-719"><span class="linenos"> 719</span></a><span class="sd">            List of messages to send to the model</span>
</span><span id="_AgenticLoop-720"><a href="#_AgenticLoop-720"><span class="linenos"> 720</span></a><span class="sd">        </span>
</span><span id="_AgenticLoop-721"><a href="#_AgenticLoop-721"><span class="linenos"> 721</span></a><span class="sd">        Returns</span>
</span><span id="_AgenticLoop-722"><a href="#_AgenticLoop-722"><span class="linenos"> 722</span></a><span class="sd">        -------</span>
</span><span id="_AgenticLoop-723"><a href="#_AgenticLoop-723"><span class="linenos"> 723</span></a><span class="sd">        Dict[str, Any]</span>
</span><span id="_AgenticLoop-724"><a href="#_AgenticLoop-724"><span class="linenos"> 724</span></a><span class="sd">            Model response in standard OpenAI format with usage information</span>
</span><span id="_AgenticLoop-725"><a href="#_AgenticLoop-725"><span class="linenos"> 725</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="_AgenticLoop-726"><a href="#_AgenticLoop-726"><span class="linenos"> 726</span></a>        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">_execute</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span>
</span><span id="_AgenticLoop-727"><a href="#_AgenticLoop-727"><span class="linenos"> 727</span></a>        
</span><span id="_AgenticLoop-728"><a href="#_AgenticLoop-728"><span class="linenos"> 728</span></a>        <span class="c1"># Extract usage information from the response</span>
</span><span id="_AgenticLoop-729"><a href="#_AgenticLoop-729"><span class="linenos"> 729</span></a>        <span class="n">usage_info</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="_AgenticLoop-730"><a href="#_AgenticLoop-730"><span class="linenos"> 730</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="s1">&#39;usage&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">resp</span><span class="o">.</span><span class="n">usage</span><span class="p">:</span>
</span><span id="_AgenticLoop-731"><a href="#_AgenticLoop-731"><span class="linenos"> 731</span></a>            <span class="n">usage_info</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="_AgenticLoop-732"><a href="#_AgenticLoop-732"><span class="linenos"> 732</span></a>                <span class="s2">&quot;total_tokens&quot;</span><span class="p">:</span> <span class="n">resp</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">total_tokens</span><span class="p">,</span>
</span><span id="_AgenticLoop-733"><a href="#_AgenticLoop-733"><span class="linenos"> 733</span></a>                <span class="s2">&quot;prompt_tokens&quot;</span><span class="p">:</span> <span class="n">resp</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">prompt_tokens</span><span class="p">,</span>
</span><span id="_AgenticLoop-734"><a href="#_AgenticLoop-734"><span class="linenos"> 734</span></a>                <span class="s2">&quot;completion_tokens&quot;</span><span class="p">:</span> <span class="n">resp</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">completion_tokens</span>
</span><span id="_AgenticLoop-735"><a href="#_AgenticLoop-735"><span class="linenos"> 735</span></a>            <span class="p">}</span>
</span><span id="_AgenticLoop-736"><a href="#_AgenticLoop-736"><span class="linenos"> 736</span></a>        
</span><span id="_AgenticLoop-737"><a href="#_AgenticLoop-737"><span class="linenos"> 737</span></a>        <span class="n">message</span> <span class="o">=</span> <span class="n">resp</span><span class="p">[</span><span class="s2">&quot;choices&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;message&quot;</span><span class="p">]</span>
</span><span id="_AgenticLoop-738"><a href="#_AgenticLoop-738"><span class="linenos"> 738</span></a>        
</span><span id="_AgenticLoop-739"><a href="#_AgenticLoop-739"><span class="linenos"> 739</span></a>        <span class="c1"># Add usage information to the message</span>
</span><span id="_AgenticLoop-740"><a href="#_AgenticLoop-740"><span class="linenos"> 740</span></a>        <span class="k">if</span> <span class="n">usage_info</span><span class="p">:</span>
</span><span id="_AgenticLoop-741"><a href="#_AgenticLoop-741"><span class="linenos"> 741</span></a>            <span class="n">message</span><span class="p">[</span><span class="s2">&quot;usage&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">usage_info</span>
</span><span id="_AgenticLoop-742"><a href="#_AgenticLoop-742"><span class="linenos"> 742</span></a>        <span class="k">return</span> <span class="n">message</span>
</span><span id="_AgenticLoop-743"><a href="#_AgenticLoop-743"><span class="linenos"> 743</span></a>    
</span><span id="_AgenticLoop-744"><a href="#_AgenticLoop-744"><span class="linenos"> 744</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_execute_model_step_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">messages</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="_AgenticLoop-745"><a href="#_AgenticLoop-745"><span class="linenos"> 745</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute a model step with streaming and return the complete response.</span>
</span><span id="_AgenticLoop-746"><a href="#_AgenticLoop-746"><span class="linenos"> 746</span></a><span class="sd">        </span>
</span><span id="_AgenticLoop-747"><a href="#_AgenticLoop-747"><span class="linenos"> 747</span></a><span class="sd">        This method handles asynchronous streaming of model responses, collecting</span>
</span><span id="_AgenticLoop-748"><a href="#_AgenticLoop-748"><span class="linenos"> 748</span></a><span class="sd">        all chunks and building the final response. It properly manages async</span>
</span><span id="_AgenticLoop-749"><a href="#_AgenticLoop-749"><span class="linenos"> 749</span></a><span class="sd">        resources to avoid memory leaks and task warnings.</span>
</span><span id="_AgenticLoop-750"><a href="#_AgenticLoop-750"><span class="linenos"> 750</span></a><span class="sd">        </span>
</span><span id="_AgenticLoop-751"><a href="#_AgenticLoop-751"><span class="linenos"> 751</span></a><span class="sd">        Parameters</span>
</span><span id="_AgenticLoop-752"><a href="#_AgenticLoop-752"><span class="linenos"> 752</span></a><span class="sd">        ----------</span>
</span><span id="_AgenticLoop-753"><a href="#_AgenticLoop-753"><span class="linenos"> 753</span></a><span class="sd">        messages : List[Dict[str, Any]]</span>
</span><span id="_AgenticLoop-754"><a href="#_AgenticLoop-754"><span class="linenos"> 754</span></a><span class="sd">            List of messages to send to the model</span>
</span><span id="_AgenticLoop-755"><a href="#_AgenticLoop-755"><span class="linenos"> 755</span></a><span class="sd">        </span>
</span><span id="_AgenticLoop-756"><a href="#_AgenticLoop-756"><span class="linenos"> 756</span></a><span class="sd">        Returns</span>
</span><span id="_AgenticLoop-757"><a href="#_AgenticLoop-757"><span class="linenos"> 757</span></a><span class="sd">        -------</span>
</span><span id="_AgenticLoop-758"><a href="#_AgenticLoop-758"><span class="linenos"> 758</span></a><span class="sd">        Dict[str, Any]</span>
</span><span id="_AgenticLoop-759"><a href="#_AgenticLoop-759"><span class="linenos"> 759</span></a><span class="sd">            Complete model response in standard OpenAI format</span>
</span><span id="_AgenticLoop-760"><a href="#_AgenticLoop-760"><span class="linenos"> 760</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="_AgenticLoop-761"><a href="#_AgenticLoop-761"><span class="linenos"> 761</span></a>
</span><span id="_AgenticLoop-762"><a href="#_AgenticLoop-762"><span class="linenos"> 762</span></a>        <span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
</span><span id="_AgenticLoop-763"><a href="#_AgenticLoop-763"><span class="linenos"> 763</span></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">litellm</span><span class="w"> </span><span class="kn">import</span> <span class="n">stream_chunk_builder</span>
</span><span id="_AgenticLoop-764"><a href="#_AgenticLoop-764"><span class="linenos"> 764</span></a>        
</span><span id="_AgenticLoop-765"><a href="#_AgenticLoop-765"><span class="linenos"> 765</span></a>        <span class="c1"># Usa asyncio.run per gestire correttamente il loop</span>
</span><span id="_AgenticLoop-766"><a href="#_AgenticLoop-766"><span class="linenos"> 766</span></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run_streaming</span><span class="p">():</span>
</span><span id="_AgenticLoop-767"><a href="#_AgenticLoop-767"><span class="linenos"> 767</span></a>            <span class="n">chunks</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="_AgenticLoop-768"><a href="#_AgenticLoop-768"><span class="linenos"> 768</span></a>            <span class="n">stream</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="_AgenticLoop-769"><a href="#_AgenticLoop-769"><span class="linenos"> 769</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="_AgenticLoop-770"><a href="#_AgenticLoop-770"><span class="linenos"> 770</span></a>                <span class="n">stream</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">_execute_stream</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span>
</span><span id="_AgenticLoop-771"><a href="#_AgenticLoop-771"><span class="linenos"> 771</span></a>                <span class="k">async</span> <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">stream</span><span class="p">:</span>
</span><span id="_AgenticLoop-772"><a href="#_AgenticLoop-772"><span class="linenos"> 772</span></a>                    <span class="n">chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
</span><span id="_AgenticLoop-773"><a href="#_AgenticLoop-773"><span class="linenos"> 773</span></a>                    <span class="n">content</span> <span class="o">=</span> <span class="n">chunk</span><span class="p">[</span><span class="s2">&quot;choices&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;delta&quot;</span><span class="p">][</span><span class="s2">&quot;content&quot;</span><span class="p">]</span>
</span><span id="_AgenticLoop-774"><a href="#_AgenticLoop-774"><span class="linenos"> 774</span></a>
</span><span id="_AgenticLoop-775"><a href="#_AgenticLoop-775"><span class="linenos"> 775</span></a>                    <span class="k">if</span> <span class="n">content</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="_AgenticLoop-776"><a href="#_AgenticLoop-776"><span class="linenos"> 776</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_stream_callback</span><span class="p">({</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;delta&quot;</span><span class="p">:</span> <span class="n">content</span><span class="p">})</span>
</span><span id="_AgenticLoop-777"><a href="#_AgenticLoop-777"><span class="linenos"> 777</span></a>
</span><span id="_AgenticLoop-778"><a href="#_AgenticLoop-778"><span class="linenos"> 778</span></a>            <span class="k">finally</span><span class="p">:</span>
</span><span id="_AgenticLoop-779"><a href="#_AgenticLoop-779"><span class="linenos"> 779</span></a>                <span class="k">if</span> <span class="n">stream</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="_AgenticLoop-780"><a href="#_AgenticLoop-780"><span class="linenos"> 780</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="_AgenticLoop-781"><a href="#_AgenticLoop-781"><span class="linenos"> 781</span></a>                        <span class="k">await</span> <span class="n">stream</span><span class="o">.</span><span class="n">aclose</span><span class="p">()</span>
</span><span id="_AgenticLoop-782"><a href="#_AgenticLoop-782"><span class="linenos"> 782</span></a>                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="_AgenticLoop-783"><a href="#_AgenticLoop-783"><span class="linenos"> 783</span></a>                        <span class="k">pass</span>
</span><span id="_AgenticLoop-784"><a href="#_AgenticLoop-784"><span class="linenos"> 784</span></a>            
</span><span id="_AgenticLoop-785"><a href="#_AgenticLoop-785"><span class="linenos"> 785</span></a>            <span class="k">return</span> <span class="n">chunks</span>
</span><span id="_AgenticLoop-786"><a href="#_AgenticLoop-786"><span class="linenos"> 786</span></a>
</span><span id="_AgenticLoop-787"><a href="#_AgenticLoop-787"><span class="linenos"> 787</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="_AgenticLoop-788"><a href="#_AgenticLoop-788"><span class="linenos"> 788</span></a>            <span class="n">chunks</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">run_streaming</span><span class="p">())</span>
</span><span id="_AgenticLoop-789"><a href="#_AgenticLoop-789"><span class="linenos"> 789</span></a>            <span class="n">resp</span> <span class="o">=</span> <span class="n">stream_chunk_builder</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span>
</span><span id="_AgenticLoop-790"><a href="#_AgenticLoop-790"><span class="linenos"> 790</span></a>            
</span><span id="_AgenticLoop-791"><a href="#_AgenticLoop-791"><span class="linenos"> 791</span></a>            <span class="c1"># Extract usage information from the response</span>
</span><span id="_AgenticLoop-792"><a href="#_AgenticLoop-792"><span class="linenos"> 792</span></a>            <span class="n">usage_info</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="_AgenticLoop-793"><a href="#_AgenticLoop-793"><span class="linenos"> 793</span></a>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="s1">&#39;usage&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">resp</span><span class="o">.</span><span class="n">usage</span><span class="p">:</span>
</span><span id="_AgenticLoop-794"><a href="#_AgenticLoop-794"><span class="linenos"> 794</span></a>                <span class="n">usage_info</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="_AgenticLoop-795"><a href="#_AgenticLoop-795"><span class="linenos"> 795</span></a>                    <span class="s2">&quot;total_tokens&quot;</span><span class="p">:</span> <span class="n">resp</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">total_tokens</span><span class="p">,</span>
</span><span id="_AgenticLoop-796"><a href="#_AgenticLoop-796"><span class="linenos"> 796</span></a>                    <span class="s2">&quot;prompt_tokens&quot;</span><span class="p">:</span> <span class="n">resp</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">prompt_tokens</span><span class="p">,</span>
</span><span id="_AgenticLoop-797"><a href="#_AgenticLoop-797"><span class="linenos"> 797</span></a>                    <span class="s2">&quot;completion_tokens&quot;</span><span class="p">:</span> <span class="n">resp</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">completion_tokens</span>
</span><span id="_AgenticLoop-798"><a href="#_AgenticLoop-798"><span class="linenos"> 798</span></a>                <span class="p">}</span>
</span><span id="_AgenticLoop-799"><a href="#_AgenticLoop-799"><span class="linenos"> 799</span></a>            
</span><span id="_AgenticLoop-800"><a href="#_AgenticLoop-800"><span class="linenos"> 800</span></a>            <span class="n">message</span> <span class="o">=</span> <span class="n">resp</span><span class="p">[</span><span class="s2">&quot;choices&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;message&quot;</span><span class="p">]</span>
</span><span id="_AgenticLoop-801"><a href="#_AgenticLoop-801"><span class="linenos"> 801</span></a>            
</span><span id="_AgenticLoop-802"><a href="#_AgenticLoop-802"><span class="linenos"> 802</span></a>            <span class="c1"># Add usage information to the message</span>
</span><span id="_AgenticLoop-803"><a href="#_AgenticLoop-803"><span class="linenos"> 803</span></a>            <span class="k">if</span> <span class="n">usage_info</span><span class="p">:</span>
</span><span id="_AgenticLoop-804"><a href="#_AgenticLoop-804"><span class="linenos"> 804</span></a>                <span class="n">message</span><span class="p">[</span><span class="s2">&quot;usage&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">usage_info</span>
</span><span id="_AgenticLoop-805"><a href="#_AgenticLoop-805"><span class="linenos"> 805</span></a>                
</span><span id="_AgenticLoop-806"><a href="#_AgenticLoop-806"><span class="linenos"> 806</span></a>            <span class="k">return</span> <span class="n">message</span>
</span><span id="_AgenticLoop-807"><a href="#_AgenticLoop-807"><span class="linenos"> 807</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="_AgenticLoop-808"><a href="#_AgenticLoop-808"><span class="linenos"> 808</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Streaming error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">, falling back to standard execution&quot;</span><span class="p">)</span>
</span><span id="_AgenticLoop-809"><a href="#_AgenticLoop-809"><span class="linenos"> 809</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_model_step</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span>
</span><span id="_AgenticLoop-810"><a href="#_AgenticLoop-810"><span class="linenos"> 810</span></a>            
</span><span id="_AgenticLoop-811"><a href="#_AgenticLoop-811"><span class="linenos"> 811</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_create_base_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="_AgenticLoop-812"><a href="#_AgenticLoop-812"><span class="linenos"> 812</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create the base response structure.</span>
</span><span id="_AgenticLoop-813"><a href="#_AgenticLoop-813"><span class="linenos"> 813</span></a><span class="sd">        </span>
</span><span id="_AgenticLoop-814"><a href="#_AgenticLoop-814"><span class="linenos"> 814</span></a><span class="sd">        Parameters</span>
</span><span id="_AgenticLoop-815"><a href="#_AgenticLoop-815"><span class="linenos"> 815</span></a><span class="sd">        ----------</span>
</span><span id="_AgenticLoop-816"><a href="#_AgenticLoop-816"><span class="linenos"> 816</span></a><span class="sd">        query : str</span>
</span><span id="_AgenticLoop-817"><a href="#_AgenticLoop-817"><span class="linenos"> 817</span></a><span class="sd">            Original user query</span>
</span><span id="_AgenticLoop-818"><a href="#_AgenticLoop-818"><span class="linenos"> 818</span></a><span class="sd">        </span>
</span><span id="_AgenticLoop-819"><a href="#_AgenticLoop-819"><span class="linenos"> 819</span></a><span class="sd">        Returns</span>
</span><span id="_AgenticLoop-820"><a href="#_AgenticLoop-820"><span class="linenos"> 820</span></a><span class="sd">        -------</span>
</span><span id="_AgenticLoop-821"><a href="#_AgenticLoop-821"><span class="linenos"> 821</span></a><span class="sd">        Dict[str, Any]</span>
</span><span id="_AgenticLoop-822"><a href="#_AgenticLoop-822"><span class="linenos"> 822</span></a><span class="sd">            Dictionary with base response structure:</span>
</span><span id="_AgenticLoop-823"><a href="#_AgenticLoop-823"><span class="linenos"> 823</span></a><span class="sd">            - prompt: Original user query</span>
</span><span id="_AgenticLoop-824"><a href="#_AgenticLoop-824"><span class="linenos"> 824</span></a><span class="sd">            - iterations: Empty list for iterations</span>
</span><span id="_AgenticLoop-825"><a href="#_AgenticLoop-825"><span class="linenos"> 825</span></a><span class="sd">            - usage: Dictionary for tracking token usage</span>
</span><span id="_AgenticLoop-826"><a href="#_AgenticLoop-826"><span class="linenos"> 826</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="_AgenticLoop-827"><a href="#_AgenticLoop-827"><span class="linenos"> 827</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="_AgenticLoop-828"><a href="#_AgenticLoop-828"><span class="linenos"> 828</span></a>            <span class="s2">&quot;prompt&quot;</span><span class="p">:</span> <span class="n">query</span><span class="p">,</span> 
</span><span id="_AgenticLoop-829"><a href="#_AgenticLoop-829"><span class="linenos"> 829</span></a>            <span class="s2">&quot;iterations&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="_AgenticLoop-830"><a href="#_AgenticLoop-830"><span class="linenos"> 830</span></a>            <span class="s2">&quot;usage&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="_AgenticLoop-831"><a href="#_AgenticLoop-831"><span class="linenos"> 831</span></a>                <span class="s2">&quot;total_tokens&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="_AgenticLoop-832"><a href="#_AgenticLoop-832"><span class="linenos"> 832</span></a>                <span class="s2">&quot;prompt_tokens&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="_AgenticLoop-833"><a href="#_AgenticLoop-833"><span class="linenos"> 833</span></a>                <span class="s2">&quot;completion_tokens&quot;</span><span class="p">:</span> <span class="mi">0</span>
</span><span id="_AgenticLoop-834"><a href="#_AgenticLoop-834"><span class="linenos"> 834</span></a>            <span class="p">}</span>
</span><span id="_AgenticLoop-835"><a href="#_AgenticLoop-835"><span class="linenos"> 835</span></a>        <span class="p">}</span>
</span><span id="_AgenticLoop-836"><a href="#_AgenticLoop-836"><span class="linenos"> 836</span></a>
</span><span id="_AgenticLoop-837"><a href="#_AgenticLoop-837"><span class="linenos"> 837</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_update_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">iteration_usage</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="_AgenticLoop-838"><a href="#_AgenticLoop-838"><span class="linenos"> 838</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the total usage in the response.</span>
</span><span id="_AgenticLoop-839"><a href="#_AgenticLoop-839"><span class="linenos"> 839</span></a><span class="sd">        </span>
</span><span id="_AgenticLoop-840"><a href="#_AgenticLoop-840"><span class="linenos"> 840</span></a><span class="sd">        Parameters</span>
</span><span id="_AgenticLoop-841"><a href="#_AgenticLoop-841"><span class="linenos"> 841</span></a><span class="sd">        ----------</span>
</span><span id="_AgenticLoop-842"><a href="#_AgenticLoop-842"><span class="linenos"> 842</span></a><span class="sd">        response : Dict[str, Any]</span>
</span><span id="_AgenticLoop-843"><a href="#_AgenticLoop-843"><span class="linenos"> 843</span></a><span class="sd">            Response dictionary to update</span>
</span><span id="_AgenticLoop-844"><a href="#_AgenticLoop-844"><span class="linenos"> 844</span></a><span class="sd">        iteration_usage : Dict[str, int]</span>
</span><span id="_AgenticLoop-845"><a href="#_AgenticLoop-845"><span class="linenos"> 845</span></a><span class="sd">            Usage information from current iteration</span>
</span><span id="_AgenticLoop-846"><a href="#_AgenticLoop-846"><span class="linenos"> 846</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="_AgenticLoop-847"><a href="#_AgenticLoop-847"><span class="linenos"> 847</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">iteration_usage</span><span class="p">,</span> <span class="s2">&quot;usage&quot;</span><span class="p">):</span>
</span><span id="_AgenticLoop-848"><a href="#_AgenticLoop-848"><span class="linenos"> 848</span></a>            <span class="n">response</span><span class="p">[</span><span class="s2">&quot;usage&quot;</span><span class="p">][</span><span class="s2">&quot;total_tokens&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">iteration_usage</span><span class="p">[</span><span class="s2">&quot;usage&quot;</span><span class="p">][</span><span class="s2">&quot;total_tokens&quot;</span><span class="p">]</span>
</span><span id="_AgenticLoop-849"><a href="#_AgenticLoop-849"><span class="linenos"> 849</span></a>            <span class="n">response</span><span class="p">[</span><span class="s2">&quot;usage&quot;</span><span class="p">][</span><span class="s2">&quot;prompt_tokens&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">iteration_usage</span><span class="p">[</span><span class="s2">&quot;usage&quot;</span><span class="p">][</span><span class="s2">&quot;prompt_tokens&quot;</span><span class="p">]</span>
</span><span id="_AgenticLoop-850"><a href="#_AgenticLoop-850"><span class="linenos"> 850</span></a>            <span class="n">response</span><span class="p">[</span><span class="s2">&quot;usage&quot;</span><span class="p">][</span><span class="s2">&quot;completion_tokens&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">iteration_usage</span><span class="p">[</span><span class="s2">&quot;usage&quot;</span><span class="p">][</span><span class="s2">&quot;completion_tokens&quot;</span><span class="p">]</span>
</span><span id="_AgenticLoop-851"><a href="#_AgenticLoop-851"><span class="linenos"> 851</span></a>
</span><span id="_AgenticLoop-852"><a href="#_AgenticLoop-852"><span class="linenos"> 852</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_handle_final_answer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iteration</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">response</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="_AgenticLoop-853"><a href="#_AgenticLoop-853"><span class="linenos"> 853</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle a final answer, returns True if this is the end.</span>
</span><span id="_AgenticLoop-854"><a href="#_AgenticLoop-854"><span class="linenos"> 854</span></a><span class="sd">        </span>
</span><span id="_AgenticLoop-855"><a href="#_AgenticLoop-855"><span class="linenos"> 855</span></a><span class="sd">        This method processes iterations that contain final answers and</span>
</span><span id="_AgenticLoop-856"><a href="#_AgenticLoop-856"><span class="linenos"> 856</span></a><span class="sd">        updates the response structure accordingly. It supports both</span>
</span><span id="_AgenticLoop-857"><a href="#_AgenticLoop-857"><span class="linenos"> 857</span></a><span class="sd">        the old format (final_answer key) and new step format.</span>
</span><span id="_AgenticLoop-858"><a href="#_AgenticLoop-858"><span class="linenos"> 858</span></a><span class="sd">        </span>
</span><span id="_AgenticLoop-859"><a href="#_AgenticLoop-859"><span class="linenos"> 859</span></a><span class="sd">        Parameters</span>
</span><span id="_AgenticLoop-860"><a href="#_AgenticLoop-860"><span class="linenos"> 860</span></a><span class="sd">        ----------</span>
</span><span id="_AgenticLoop-861"><a href="#_AgenticLoop-861"><span class="linenos"> 861</span></a><span class="sd">        iteration : Dict[str, Any]</span>
</span><span id="_AgenticLoop-862"><a href="#_AgenticLoop-862"><span class="linenos"> 862</span></a><span class="sd">            Current iteration potentially containing a final answer</span>
</span><span id="_AgenticLoop-863"><a href="#_AgenticLoop-863"><span class="linenos"> 863</span></a><span class="sd">        response : Dict[str, Any]</span>
</span><span id="_AgenticLoop-864"><a href="#_AgenticLoop-864"><span class="linenos"> 864</span></a><span class="sd">            Response dictionary to update</span>
</span><span id="_AgenticLoop-865"><a href="#_AgenticLoop-865"><span class="linenos"> 865</span></a><span class="sd">        </span>
</span><span id="_AgenticLoop-866"><a href="#_AgenticLoop-866"><span class="linenos"> 866</span></a><span class="sd">        Returns</span>
</span><span id="_AgenticLoop-867"><a href="#_AgenticLoop-867"><span class="linenos"> 867</span></a><span class="sd">        -------</span>
</span><span id="_AgenticLoop-868"><a href="#_AgenticLoop-868"><span class="linenos"> 868</span></a><span class="sd">        bool</span>
</span><span id="_AgenticLoop-869"><a href="#_AgenticLoop-869"><span class="linenos"> 869</span></a><span class="sd">            True if a final answer was found and processed, False otherwise</span>
</span><span id="_AgenticLoop-870"><a href="#_AgenticLoop-870"><span class="linenos"> 870</span></a><span class="sd">        </span>
</span><span id="_AgenticLoop-871"><a href="#_AgenticLoop-871"><span class="linenos"> 871</span></a><span class="sd">        Notes</span>
</span><span id="_AgenticLoop-872"><a href="#_AgenticLoop-872"><span class="linenos"> 872</span></a><span class="sd">        -----</span>
</span><span id="_AgenticLoop-873"><a href="#_AgenticLoop-873"><span class="linenos"> 873</span></a><span class="sd">        This method modifies the response object directly.</span>
</span><span id="_AgenticLoop-874"><a href="#_AgenticLoop-874"><span class="linenos"> 874</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="_AgenticLoop-875"><a href="#_AgenticLoop-875"><span class="linenos"> 875</span></a>        <span class="k">if</span> <span class="s2">&quot;final_answer&quot;</span> <span class="ow">in</span> <span class="n">iteration</span><span class="p">:</span>
</span><span id="_AgenticLoop-876"><a href="#_AgenticLoop-876"><span class="linenos"> 876</span></a>            <span class="n">response</span><span class="p">[</span><span class="s2">&quot;iterations&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iteration</span><span class="p">)</span>
</span><span id="_AgenticLoop-877"><a href="#_AgenticLoop-877"><span class="linenos"> 877</span></a>            <span class="n">response</span><span class="p">[</span><span class="s2">&quot;response&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">iteration</span><span class="p">[</span><span class="s2">&quot;final_answer&quot;</span><span class="p">]</span>
</span><span id="_AgenticLoop-878"><a href="#_AgenticLoop-878"><span class="linenos"> 878</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="_AgenticLoop-879"><a href="#_AgenticLoop-879"><span class="linenos"> 879</span></a>        <span class="k">elif</span> <span class="n">iteration</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;step_type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;final answer&quot;</span><span class="p">:</span>
</span><span id="_AgenticLoop-880"><a href="#_AgenticLoop-880"><span class="linenos"> 880</span></a>            <span class="n">response</span><span class="p">[</span><span class="s2">&quot;iterations&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iteration</span><span class="p">)</span>
</span><span id="_AgenticLoop-881"><a href="#_AgenticLoop-881"><span class="linenos"> 881</span></a>            <span class="n">response</span><span class="p">[</span><span class="s2">&quot;response&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">iteration</span><span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">]</span>
</span><span id="_AgenticLoop-882"><a href="#_AgenticLoop-882"><span class="linenos"> 882</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="_AgenticLoop-883"><a href="#_AgenticLoop-883"><span class="linenos"> 883</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="_AgenticLoop-884"><a href="#_AgenticLoop-884"><span class="linenos"> 884</span></a>
</span><span id="_AgenticLoop-885"><a href="#_AgenticLoop-885"><span class="linenos"> 885</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_pngimagefile_to_base64_data_uri</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="_AgenticLoop-886"><a href="#_AgenticLoop-886"><span class="linenos"> 886</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="_AgenticLoop-887"><a href="#_AgenticLoop-887"><span class="linenos"> 887</span></a><span class="sd">        Converte un oggetto PIL.PngImageFile in una stringa base64 data URI.</span>
</span><span id="_AgenticLoop-888"><a href="#_AgenticLoop-888"><span class="linenos"> 888</span></a><span class="sd">        </span>
</span><span id="_AgenticLoop-889"><a href="#_AgenticLoop-889"><span class="linenos"> 889</span></a><span class="sd">        Args:</span>
</span><span id="_AgenticLoop-890"><a href="#_AgenticLoop-890"><span class="linenos"> 890</span></a><span class="sd">            img (Image.Image): immagine PIL (PngImageFile o convertita in PNG)</span>
</span><span id="_AgenticLoop-891"><a href="#_AgenticLoop-891"><span class="linenos"> 891</span></a><span class="sd">        </span>
</span><span id="_AgenticLoop-892"><a href="#_AgenticLoop-892"><span class="linenos"> 892</span></a><span class="sd">        Returns:</span>
</span><span id="_AgenticLoop-893"><a href="#_AgenticLoop-893"><span class="linenos"> 893</span></a><span class="sd">            str: stringa &quot;data:image/png;base64,&lt;...&gt;&quot;</span>
</span><span id="_AgenticLoop-894"><a href="#_AgenticLoop-894"><span class="linenos"> 894</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="_AgenticLoop-895"><a href="#_AgenticLoop-895"><span class="linenos"> 895</span></a>        <span class="kn">import</span><span class="w"> </span><span class="nn">io</span>
</span><span id="_AgenticLoop-896"><a href="#_AgenticLoop-896"><span class="linenos"> 896</span></a>        <span class="kn">import</span><span class="w"> </span><span class="nn">base64</span>
</span><span id="_AgenticLoop-897"><a href="#_AgenticLoop-897"><span class="linenos"> 897</span></a>        <span class="n">buffer</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
</span><span id="_AgenticLoop-898"><a href="#_AgenticLoop-898"><span class="linenos"> 898</span></a>        <span class="n">img</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;PNG&quot;</span><span class="p">)</span>
</span><span id="_AgenticLoop-899"><a href="#_AgenticLoop-899"><span class="linenos"> 899</span></a>        <span class="n">buffer</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="_AgenticLoop-900"><a href="#_AgenticLoop-900"><span class="linenos"> 900</span></a>
</span><span id="_AgenticLoop-901"><a href="#_AgenticLoop-901"><span class="linenos"> 901</span></a>        <span class="c1"># codifica in base64</span>
</span><span id="_AgenticLoop-902"><a href="#_AgenticLoop-902"><span class="linenos"> 902</span></a>        <span class="n">encoded</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">buffer</span><span class="o">.</span><span class="n">read</span><span class="p">())</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
</span><span id="_AgenticLoop-903"><a href="#_AgenticLoop-903"><span class="linenos"> 903</span></a>
</span><span id="_AgenticLoop-904"><a href="#_AgenticLoop-904"><span class="linenos"> 904</span></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;data:image/png;base64,</span><span class="si">{</span><span class="n">encoded</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="_AgenticLoop-905"><a href="#_AgenticLoop-905"><span class="linenos"> 905</span></a>
</span><span id="_AgenticLoop-906"><a href="#_AgenticLoop-906"><span class="linenos"> 906</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_handle_tool_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iteration</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">response</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">messages</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="_AgenticLoop-907"><a href="#_AgenticLoop-907"><span class="linenos"> 907</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle a tool action execution.</span>
</span><span id="_AgenticLoop-908"><a href="#_AgenticLoop-908"><span class="linenos"> 908</span></a><span class="sd">        </span>
</span><span id="_AgenticLoop-909"><a href="#_AgenticLoop-909"><span class="linenos"> 909</span></a><span class="sd">        This method processes iterations that contain tool actions, executes</span>
</span><span id="_AgenticLoop-910"><a href="#_AgenticLoop-910"><span class="linenos"> 910</span></a><span class="sd">        the corresponding tools, and updates the conversation with the results.</span>
</span><span id="_AgenticLoop-911"><a href="#_AgenticLoop-911"><span class="linenos"> 911</span></a><span class="sd">        It supports both old and new step-based formats.</span>
</span><span id="_AgenticLoop-912"><a href="#_AgenticLoop-912"><span class="linenos"> 912</span></a><span class="sd">        </span>
</span><span id="_AgenticLoop-913"><a href="#_AgenticLoop-913"><span class="linenos"> 913</span></a><span class="sd">        Parameters</span>
</span><span id="_AgenticLoop-914"><a href="#_AgenticLoop-914"><span class="linenos"> 914</span></a><span class="sd">        ----------</span>
</span><span id="_AgenticLoop-915"><a href="#_AgenticLoop-915"><span class="linenos"> 915</span></a><span class="sd">        iteration : Dict[str, Any]</span>
</span><span id="_AgenticLoop-916"><a href="#_AgenticLoop-916"><span class="linenos"> 916</span></a><span class="sd">            Current iteration containing the tool action</span>
</span><span id="_AgenticLoop-917"><a href="#_AgenticLoop-917"><span class="linenos"> 917</span></a><span class="sd">        response : Dict[str, Any]</span>
</span><span id="_AgenticLoop-918"><a href="#_AgenticLoop-918"><span class="linenos"> 918</span></a><span class="sd">            Response dictionary to update</span>
</span><span id="_AgenticLoop-919"><a href="#_AgenticLoop-919"><span class="linenos"> 919</span></a><span class="sd">        messages : List[Dict[str, Any]]</span>
</span><span id="_AgenticLoop-920"><a href="#_AgenticLoop-920"><span class="linenos"> 920</span></a><span class="sd">            Message list to update with observation</span>
</span><span id="_AgenticLoop-921"><a href="#_AgenticLoop-921"><span class="linenos"> 921</span></a><span class="sd">        </span>
</span><span id="_AgenticLoop-922"><a href="#_AgenticLoop-922"><span class="linenos"> 922</span></a><span class="sd">        Notes</span>
</span><span id="_AgenticLoop-923"><a href="#_AgenticLoop-923"><span class="linenos"> 923</span></a><span class="sd">        -----</span>
</span><span id="_AgenticLoop-924"><a href="#_AgenticLoop-924"><span class="linenos"> 924</span></a><span class="sd">        This method modifies the response and messages objects directly.</span>
</span><span id="_AgenticLoop-925"><a href="#_AgenticLoop-925"><span class="linenos"> 925</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="_AgenticLoop-926"><a href="#_AgenticLoop-926"><span class="linenos"> 926</span></a>        <span class="c1"># Check if human feedback is required for actions</span>
</span><span id="_AgenticLoop-927"><a href="#_AgenticLoop-927"><span class="linenos"> 927</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_human_feedback</span> <span class="o">==</span> <span class="s2">&quot;actions&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_human_feedback</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
</span><span id="_AgenticLoop-928"><a href="#_AgenticLoop-928"><span class="linenos"> 928</span></a>            <span class="n">action_data</span> <span class="o">=</span> <span class="n">iteration</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;action&quot;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="_AgenticLoop-929"><a href="#_AgenticLoop-929"><span class="linenos"> 929</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request_human_feedback</span><span class="p">(</span><span class="s2">&quot;action&quot;</span><span class="p">,</span> <span class="n">iteration</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;content&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span> <span class="n">action_data</span><span class="p">):</span>
</span><span id="_AgenticLoop-930"><a href="#_AgenticLoop-930"><span class="linenos"> 930</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Execution stopped by user.&quot;</span><span class="p">)</span>
</span><span id="_AgenticLoop-931"><a href="#_AgenticLoop-931"><span class="linenos"> 931</span></a>                <span class="k">return</span>
</span><span id="_AgenticLoop-932"><a href="#_AgenticLoop-932"><span class="linenos"> 932</span></a>
</span><span id="_AgenticLoop-933"><a href="#_AgenticLoop-933"><span class="linenos"> 933</span></a>        <span class="k">if</span> <span class="s2">&quot;action&quot;</span> <span class="ow">in</span> <span class="n">iteration</span> <span class="ow">and</span> <span class="n">iteration</span><span class="p">[</span><span class="s2">&quot;action&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">):</span>
</span><span id="_AgenticLoop-934"><a href="#_AgenticLoop-934"><span class="linenos"> 934</span></a>            <span class="n">tool_call</span> <span class="o">=</span> <span class="n">iteration</span><span class="p">[</span><span class="s2">&quot;action&quot;</span><span class="p">]</span>
</span><span id="_AgenticLoop-935"><a href="#_AgenticLoop-935"><span class="linenos"> 935</span></a>            
</span><span id="_AgenticLoop-936"><a href="#_AgenticLoop-936"><span class="linenos"> 936</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stream_callback</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="_AgenticLoop-937"><a href="#_AgenticLoop-937"><span class="linenos"> 937</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_stream_callback</span><span class="p">({</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;tool_call&quot;</span><span class="p">,</span> <span class="s2">&quot;tool_call&quot;</span><span class="p">:</span> <span class="n">tool_call</span><span class="p">})</span>
</span><span id="_AgenticLoop-938"><a href="#_AgenticLoop-938"><span class="linenos"> 938</span></a>
</span><span id="_AgenticLoop-939"><a href="#_AgenticLoop-939"><span class="linenos"> 939</span></a>            <span class="k">if</span> <span class="n">tool_call</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;mcp_&quot;</span><span class="p">):</span>
</span><span id="_AgenticLoop-940"><a href="#_AgenticLoop-940"><span class="linenos"> 940</span></a>                <span class="n">tool_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_mcp_tool</span><span class="p">(</span><span class="n">tool_call</span><span class="p">)</span>
</span><span id="_AgenticLoop-941"><a href="#_AgenticLoop-941"><span class="linenos"> 941</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="_AgenticLoop-942"><a href="#_AgenticLoop-942"><span class="linenos"> 942</span></a>                <span class="n">tool_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_tool</span><span class="p">(</span><span class="n">tool_call</span><span class="p">)</span>
</span><span id="_AgenticLoop-943"><a href="#_AgenticLoop-943"><span class="linenos"> 943</span></a>
</span><span id="_AgenticLoop-944"><a href="#_AgenticLoop-944"><span class="linenos"> 944</span></a>            <span class="n">iteration</span><span class="p">[</span><span class="s2">&quot;observation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tool_result</span>
</span><span id="_AgenticLoop-945"><a href="#_AgenticLoop-945"><span class="linenos"> 945</span></a>            <span class="n">response</span><span class="p">[</span><span class="s2">&quot;iterations&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iteration</span><span class="p">)</span>
</span><span id="_AgenticLoop-946"><a href="#_AgenticLoop-946"><span class="linenos"> 946</span></a>
</span><span id="_AgenticLoop-947"><a href="#_AgenticLoop-947"><span class="linenos"> 947</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tool_result</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="_AgenticLoop-948"><a href="#_AgenticLoop-948"><span class="linenos"> 948</span></a>                <span class="k">if</span> <span class="s2">&quot;image&quot;</span> <span class="ow">in</span> <span class="n">tool_result</span><span class="p">:</span>
</span><span id="_AgenticLoop-949"><a href="#_AgenticLoop-949"><span class="linenos"> 949</span></a>                    <span class="n">img</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pngimagefile_to_base64_data_uri</span><span class="p">(</span><span class="n">tool_result</span><span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">])</span>
</span><span id="_AgenticLoop-950"><a href="#_AgenticLoop-950"><span class="linenos"> 950</span></a>                    <span class="n">msg</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;image_url&quot;</span><span class="p">,</span> <span class="s2">&quot;image_url&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">img</span><span class="p">}},</span> 
</span><span id="_AgenticLoop-951"><a href="#_AgenticLoop-951"><span class="linenos"> 951</span></a>                            <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;Ecco l&#39;immagine&quot;</span><span class="p">}]</span>
</span><span id="_AgenticLoop-952"><a href="#_AgenticLoop-952"><span class="linenos"> 952</span></a>                    <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">msg</span><span class="p">})</span>
</span><span id="_AgenticLoop-953"><a href="#_AgenticLoop-953"><span class="linenos"> 953</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="_AgenticLoop-954"><a href="#_AgenticLoop-954"><span class="linenos"> 954</span></a>                    <span class="n">msg</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s2">&quot;observation&quot;</span><span class="p">:</span> <span class="n">tool_result</span><span class="p">})</span>
</span><span id="_AgenticLoop-955"><a href="#_AgenticLoop-955"><span class="linenos"> 955</span></a>                    <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">msg</span><span class="p">})</span>
</span><span id="_AgenticLoop-956"><a href="#_AgenticLoop-956"><span class="linenos"> 956</span></a>        <span class="k">elif</span> <span class="n">iteration</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;step_type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;action&quot;</span> <span class="ow">and</span> <span class="s2">&quot;action&quot;</span> <span class="ow">in</span> <span class="n">iteration</span><span class="p">:</span>
</span><span id="_AgenticLoop-957"><a href="#_AgenticLoop-957"><span class="linenos"> 957</span></a>            <span class="n">tool_call</span> <span class="o">=</span> <span class="n">iteration</span><span class="p">[</span><span class="s2">&quot;action&quot;</span><span class="p">]</span>
</span><span id="_AgenticLoop-958"><a href="#_AgenticLoop-958"><span class="linenos"> 958</span></a>            <span class="n">tool_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_tool</span><span class="p">(</span><span class="n">tool_call</span><span class="p">)</span>
</span><span id="_AgenticLoop-959"><a href="#_AgenticLoop-959"><span class="linenos"> 959</span></a>            <span class="n">iteration</span><span class="p">[</span><span class="s2">&quot;observation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tool_result</span>
</span><span id="_AgenticLoop-960"><a href="#_AgenticLoop-960"><span class="linenos"> 960</span></a>            <span class="n">response</span><span class="p">[</span><span class="s2">&quot;iterations&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iteration</span><span class="p">)</span>
</span><span id="_AgenticLoop-961"><a href="#_AgenticLoop-961"><span class="linenos"> 961</span></a>            
</span><span id="_AgenticLoop-962"><a href="#_AgenticLoop-962"><span class="linenos"> 962</span></a>            <span class="c1"># Add observation in the new system format</span>
</span><span id="_AgenticLoop-963"><a href="#_AgenticLoop-963"><span class="linenos"> 963</span></a>            <span class="n">observation_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Observation </span><span class="si">{</span><span class="n">iteration</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;step_number&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">tool_result</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="_AgenticLoop-964"><a href="#_AgenticLoop-964"><span class="linenos"> 964</span></a>            <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">observation_msg</span><span class="p">})</span>
</span><span id="_AgenticLoop-965"><a href="#_AgenticLoop-965"><span class="linenos"> 965</span></a>
</span><span id="_AgenticLoop-966"><a href="#_AgenticLoop-966"><span class="linenos"> 966</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_handle_default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iteration</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">response</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">messages</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="_AgenticLoop-967"><a href="#_AgenticLoop-967"><span class="linenos"> 967</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle default case for unhandled iterations.</span>
</span><span id="_AgenticLoop-968"><a href="#_AgenticLoop-968"><span class="linenos"> 968</span></a><span class="sd">        </span>
</span><span id="_AgenticLoop-969"><a href="#_AgenticLoop-969"><span class="linenos"> 969</span></a><span class="sd">        This method processes iterations that don&#39;t match specific handlers,</span>
</span><span id="_AgenticLoop-970"><a href="#_AgenticLoop-970"><span class="linenos"> 970</span></a><span class="sd">        adding them to the response and updating the conversation flow.</span>
</span><span id="_AgenticLoop-971"><a href="#_AgenticLoop-971"><span class="linenos"> 971</span></a><span class="sd">        It supports both step-based and JSON formats.</span>
</span><span id="_AgenticLoop-972"><a href="#_AgenticLoop-972"><span class="linenos"> 972</span></a><span class="sd">        </span>
</span><span id="_AgenticLoop-973"><a href="#_AgenticLoop-973"><span class="linenos"> 973</span></a><span class="sd">        Parameters</span>
</span><span id="_AgenticLoop-974"><a href="#_AgenticLoop-974"><span class="linenos"> 974</span></a><span class="sd">        ----------</span>
</span><span id="_AgenticLoop-975"><a href="#_AgenticLoop-975"><span class="linenos"> 975</span></a><span class="sd">        iteration : Dict[str, Any]</span>
</span><span id="_AgenticLoop-976"><a href="#_AgenticLoop-976"><span class="linenos"> 976</span></a><span class="sd">            Current iteration to handle</span>
</span><span id="_AgenticLoop-977"><a href="#_AgenticLoop-977"><span class="linenos"> 977</span></a><span class="sd">        response : Dict[str, Any]</span>
</span><span id="_AgenticLoop-978"><a href="#_AgenticLoop-978"><span class="linenos"> 978</span></a><span class="sd">            Response dictionary to update</span>
</span><span id="_AgenticLoop-979"><a href="#_AgenticLoop-979"><span class="linenos"> 979</span></a><span class="sd">        messages : List[Dict[str, Any]]</span>
</span><span id="_AgenticLoop-980"><a href="#_AgenticLoop-980"><span class="linenos"> 980</span></a><span class="sd">            Message list to update</span>
</span><span id="_AgenticLoop-981"><a href="#_AgenticLoop-981"><span class="linenos"> 981</span></a><span class="sd">        </span>
</span><span id="_AgenticLoop-982"><a href="#_AgenticLoop-982"><span class="linenos"> 982</span></a><span class="sd">        Notes</span>
</span><span id="_AgenticLoop-983"><a href="#_AgenticLoop-983"><span class="linenos"> 983</span></a><span class="sd">        -----</span>
</span><span id="_AgenticLoop-984"><a href="#_AgenticLoop-984"><span class="linenos"> 984</span></a><span class="sd">        This method modifies the response and messages objects directly.</span>
</span><span id="_AgenticLoop-985"><a href="#_AgenticLoop-985"><span class="linenos"> 985</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="_AgenticLoop-986"><a href="#_AgenticLoop-986"><span class="linenos"> 986</span></a>        <span class="n">response</span><span class="p">[</span><span class="s2">&quot;iterations&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iteration</span><span class="p">)</span>
</span><span id="_AgenticLoop-987"><a href="#_AgenticLoop-987"><span class="linenos"> 987</span></a>        
</span><span id="_AgenticLoop-988"><a href="#_AgenticLoop-988"><span class="linenos"> 988</span></a>        <span class="c1"># For new format, add content as user message</span>
</span><span id="_AgenticLoop-989"><a href="#_AgenticLoop-989"><span class="linenos"> 989</span></a>        <span class="k">if</span> <span class="n">iteration</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;step_type&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;thought&quot;</span><span class="p">,</span> <span class="s2">&quot;observation&quot;</span><span class="p">]:</span>
</span><span id="_AgenticLoop-990"><a href="#_AgenticLoop-990"><span class="linenos"> 990</span></a>            <span class="n">step_type</span> <span class="o">=</span> <span class="n">iteration</span><span class="p">[</span><span class="s2">&quot;step_type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>
</span><span id="_AgenticLoop-991"><a href="#_AgenticLoop-991"><span class="linenos"> 991</span></a>            <span class="n">step_number</span> <span class="o">=</span> <span class="n">iteration</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;step_number&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="_AgenticLoop-992"><a href="#_AgenticLoop-992"><span class="linenos"> 992</span></a>            <span class="n">content</span> <span class="o">=</span> <span class="n">iteration</span><span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">]</span>
</span><span id="_AgenticLoop-993"><a href="#_AgenticLoop-993"><span class="linenos"> 993</span></a>            <span class="n">message_content</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">step_type</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">step_number</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">content</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="_AgenticLoop-994"><a href="#_AgenticLoop-994"><span class="linenos"> 994</span></a>            <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">message_content</span><span class="p">})</span>
</span><span id="_AgenticLoop-995"><a href="#_AgenticLoop-995"><span class="linenos"> 995</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="_AgenticLoop-996"><a href="#_AgenticLoop-996"><span class="linenos"> 996</span></a>            <span class="c1"># Fallback to JSON format for compatibility</span>
</span><span id="_AgenticLoop-997"><a href="#_AgenticLoop-997"><span class="linenos"> 997</span></a>            <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">iteration</span><span class="p">)})</span>
</span><span id="_AgenticLoop-998"><a href="#_AgenticLoop-998"><span class="linenos"> 998</span></a>
</span><span id="_AgenticLoop-999"><a href="#_AgenticLoop-999"><span class="linenos"> 999</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="_AgenticLoop-1000"><a href="#_AgenticLoop-1000"><span class="linenos">1000</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Abstract method to start the agentic loop.</span>
</span><span id="_AgenticLoop-1001"><a href="#_AgenticLoop-1001"><span class="linenos">1001</span></a><span class="sd">        </span>
</span><span id="_AgenticLoop-1002"><a href="#_AgenticLoop-1002"><span class="linenos">1002</span></a><span class="sd">        This method must be implemented by subclasses to define the specific</span>
</span><span id="_AgenticLoop-1003"><a href="#_AgenticLoop-1003"><span class="linenos">1003</span></a><span class="sd">        agentic behavior and reasoning pattern.</span>
</span><span id="_AgenticLoop-1004"><a href="#_AgenticLoop-1004"><span class="linenos">1004</span></a><span class="sd">        </span>
</span><span id="_AgenticLoop-1005"><a href="#_AgenticLoop-1005"><span class="linenos">1005</span></a><span class="sd">        Parameters</span>
</span><span id="_AgenticLoop-1006"><a href="#_AgenticLoop-1006"><span class="linenos">1006</span></a><span class="sd">        ----------</span>
</span><span id="_AgenticLoop-1007"><a href="#_AgenticLoop-1007"><span class="linenos">1007</span></a><span class="sd">        query : str</span>
</span><span id="_AgenticLoop-1008"><a href="#_AgenticLoop-1008"><span class="linenos">1008</span></a><span class="sd">            User query to process</span>
</span><span id="_AgenticLoop-1009"><a href="#_AgenticLoop-1009"><span class="linenos">1009</span></a><span class="sd">        </span>
</span><span id="_AgenticLoop-1010"><a href="#_AgenticLoop-1010"><span class="linenos">1010</span></a><span class="sd">        Returns</span>
</span><span id="_AgenticLoop-1011"><a href="#_AgenticLoop-1011"><span class="linenos">1011</span></a><span class="sd">        -------</span>
</span><span id="_AgenticLoop-1012"><a href="#_AgenticLoop-1012"><span class="linenos">1012</span></a><span class="sd">        Dict[str, Any]</span>
</span><span id="_AgenticLoop-1013"><a href="#_AgenticLoop-1013"><span class="linenos">1013</span></a><span class="sd">            Agent response containing iterations and final result</span>
</span><span id="_AgenticLoop-1014"><a href="#_AgenticLoop-1014"><span class="linenos">1014</span></a><span class="sd">        </span>
</span><span id="_AgenticLoop-1015"><a href="#_AgenticLoop-1015"><span class="linenos">1015</span></a><span class="sd">        Raises</span>
</span><span id="_AgenticLoop-1016"><a href="#_AgenticLoop-1016"><span class="linenos">1016</span></a><span class="sd">        ------</span>
</span><span id="_AgenticLoop-1017"><a href="#_AgenticLoop-1017"><span class="linenos">1017</span></a><span class="sd">        NotImplementedError</span>
</span><span id="_AgenticLoop-1018"><a href="#_AgenticLoop-1018"><span class="linenos">1018</span></a><span class="sd">            This method must be implemented by subclasses</span>
</span><span id="_AgenticLoop-1019"><a href="#_AgenticLoop-1019"><span class="linenos">1019</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="_AgenticLoop-1020"><a href="#_AgenticLoop-1020"><span class="linenos">1020</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span></pre></div>


            <div class="docstring"><p>Base class for all agentic loop implementations.</p>

<p>This class provides the core functionality for all AI agents, including
tool management, message creation, model execution, and streaming support.
It's designed to be extended by specific classes that implement different
agentic approaches and reasoning patterns.</p>

<p>The base class handles common operations like:</p>

<ul>
<li>Tool registration and execution</li>
<li>Message formatting and conversation management</li>
<li>Model interaction (both streaming and non-streaming)</li>
<li>Step-based reasoning format parsing</li>
<li>Debug output and iteration limits</li>
</ul>

<h6 id="attributes">Attributes</h6>

<ul>
<li><strong>_model</strong> (Any):
AI model instance used for execution</li>
<li><strong>_agentic_prompt</strong> (str, Prompt, optional):
Custom prompt for the agent (None for default). Can be a string, 
a Prompt object, or a path to a .prompt file</li>
<li><strong>_debug</strong> (bool):
Flag to enable debug output</li>
<li><strong>_max_iter</strong> (Optional[int]):
Maximum number of iterations allowed (None for unlimited)</li>
<li><strong>_stream_callback</strong> (Optional[Callable[[str], None]]):
Callback function for handling streaming content</li>
<li><strong>_tools</strong> (Dict[str, Any]):
Dictionary of available tools, mapped by name</li>
</ul>
</div>


                            <div id="_AgenticLoop.__init__" class="classattr">
                                        <input id="_AgenticLoop.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">_AgenticLoop</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">model</span><span class="p">:</span> <span class="n"><a href="models.html#Model">monoai.models.Model</a></span>,</span><span class="param">	<span class="n">agentic_prompt</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">max_iter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">stream_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">],</span> <span class="n">NoneType</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">human_feedback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="_AgenticLoop.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#_AgenticLoop.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="_AgenticLoop.__init__-256"><a href="#_AgenticLoop.__init__-256"><span class="linenos">256</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">Model</span><span class="p">,</span> <span class="n">agentic_prompt</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">max_iter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
</span><span id="_AgenticLoop.__init__-257"><a href="#_AgenticLoop.__init__-257"><span class="linenos">257</span></a>                 <span class="n">stream_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">]]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">human_feedback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="_AgenticLoop.__init__-258"><a href="#_AgenticLoop.__init__-258"><span class="linenos">258</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the agent with model and configuration.</span>
</span><span id="_AgenticLoop.__init__-259"><a href="#_AgenticLoop.__init__-259"><span class="linenos">259</span></a><span class="sd">        </span>
</span><span id="_AgenticLoop.__init__-260"><a href="#_AgenticLoop.__init__-260"><span class="linenos">260</span></a><span class="sd">        Parameters</span>
</span><span id="_AgenticLoop.__init__-261"><a href="#_AgenticLoop.__init__-261"><span class="linenos">261</span></a><span class="sd">        ----------</span>
</span><span id="_AgenticLoop.__init__-262"><a href="#_AgenticLoop.__init__-262"><span class="linenos">262</span></a><span class="sd">        model : Any</span>
</span><span id="_AgenticLoop.__init__-263"><a href="#_AgenticLoop.__init__-263"><span class="linenos">263</span></a><span class="sd">            AI model instance to use for execution</span>
</span><span id="_AgenticLoop.__init__-264"><a href="#_AgenticLoop.__init__-264"><span class="linenos">264</span></a><span class="sd">        agentic_prompt : str, optional</span>
</span><span id="_AgenticLoop.__init__-265"><a href="#_AgenticLoop.__init__-265"><span class="linenos">265</span></a><span class="sd">            Custom prompt for the agent (None to use default)</span>
</span><span id="_AgenticLoop.__init__-266"><a href="#_AgenticLoop.__init__-266"><span class="linenos">266</span></a><span class="sd">        debug : bool, default False</span>
</span><span id="_AgenticLoop.__init__-267"><a href="#_AgenticLoop.__init__-267"><span class="linenos">267</span></a><span class="sd">            Enable debug output and logging</span>
</span><span id="_AgenticLoop.__init__-268"><a href="#_AgenticLoop.__init__-268"><span class="linenos">268</span></a><span class="sd">        max_iter : Optional[int], default None</span>
</span><span id="_AgenticLoop.__init__-269"><a href="#_AgenticLoop.__init__-269"><span class="linenos">269</span></a><span class="sd">            Maximum number of iterations allowed (None for unlimited)</span>
</span><span id="_AgenticLoop.__init__-270"><a href="#_AgenticLoop.__init__-270"><span class="linenos">270</span></a><span class="sd">        stream_callback : Optional[Callable[[str], None]], default None</span>
</span><span id="_AgenticLoop.__init__-271"><a href="#_AgenticLoop.__init__-271"><span class="linenos">271</span></a><span class="sd">            Callback function for handling streaming content chunks</span>
</span><span id="_AgenticLoop.__init__-272"><a href="#_AgenticLoop.__init__-272"><span class="linenos">272</span></a><span class="sd">        human_feedback : Optional[str], default None</span>
</span><span id="_AgenticLoop.__init__-273"><a href="#_AgenticLoop.__init__-273"><span class="linenos">273</span></a><span class="sd">            Human feedback mode for controlling agent execution. Can be:</span>
</span><span id="_AgenticLoop.__init__-274"><a href="#_AgenticLoop.__init__-274"><span class="linenos">274</span></a><span class="sd">            - None: No human feedback required</span>
</span><span id="_AgenticLoop.__init__-275"><a href="#_AgenticLoop.__init__-275"><span class="linenos">275</span></a><span class="sd">            - &quot;actions&quot;: Pause and request confirmation before executing tool actions</span>
</span><span id="_AgenticLoop.__init__-276"><a href="#_AgenticLoop.__init__-276"><span class="linenos">276</span></a><span class="sd">            - &quot;all&quot;: Pause after every step for human review</span>
</span><span id="_AgenticLoop.__init__-277"><a href="#_AgenticLoop.__init__-277"><span class="linenos">277</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="_AgenticLoop.__init__-278"><a href="#_AgenticLoop.__init__-278"><span class="linenos">278</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="n">model</span>
</span><span id="_AgenticLoop.__init__-279"><a href="#_AgenticLoop.__init__-279"><span class="linenos">279</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_agentic_prompt</span> <span class="o">=</span> <span class="n">agentic_prompt</span>
</span><span id="_AgenticLoop.__init__-280"><a href="#_AgenticLoop.__init__-280"><span class="linenos">280</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_debug</span> <span class="o">=</span> <span class="n">debug</span>
</span><span id="_AgenticLoop.__init__-281"><a href="#_AgenticLoop.__init__-281"><span class="linenos">281</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_max_iter</span> <span class="o">=</span> <span class="n">max_iter</span>
</span><span id="_AgenticLoop.__init__-282"><a href="#_AgenticLoop.__init__-282"><span class="linenos">282</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stream_callback</span> <span class="o">=</span> <span class="n">stream_callback</span>
</span><span id="_AgenticLoop.__init__-283"><a href="#_AgenticLoop.__init__-283"><span class="linenos">283</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_human_feedback</span> <span class="o">=</span> <span class="n">human_feedback</span>
</span><span id="_AgenticLoop.__init__-284"><a href="#_AgenticLoop.__init__-284"><span class="linenos">284</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_tools</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="_AgenticLoop.__init__-285"><a href="#_AgenticLoop.__init__-285"><span class="linenos">285</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_mcp_servers</span> <span class="o">=</span> <span class="p">{}</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the agent with model and configuration.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>model</strong> (Any):
AI model instance to use for execution</li>
<li><strong>agentic_prompt</strong> (str, optional):
Custom prompt for the agent (None to use default)</li>
<li><strong>debug</strong> (bool, default False):
Enable debug output and logging</li>
<li><strong>max_iter</strong> (Optional[int], default None):
Maximum number of iterations allowed (None for unlimited)</li>
<li><strong>stream_callback</strong> (Optional[Callable[[str], None]], default None):
Callback function for handling streaming content chunks</li>
<li><strong>human_feedback</strong> (Optional[str], default None):
Human feedback mode for controlling agent execution. Can be:
<ul>
<li>None: No human feedback required</li>
<li>"actions": Pause and request confirmation before executing tool actions</li>
<li>"all": Pause after every step for human review</li>
</ul></li>
</ul>
</div>


                            </div>
                            <div id="_AgenticLoop.register_tools" class="classattr">
                                        <input id="_AgenticLoop.register_tools-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">register_tools</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">tools</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="_AgenticLoop.register_tools-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#_AgenticLoop.register_tools"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="_AgenticLoop.register_tools-287"><a href="#_AgenticLoop.register_tools-287"><span class="linenos">287</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">register_tools</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tools</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="_AgenticLoop.register_tools-288"><a href="#_AgenticLoop.register_tools-288"><span class="linenos">288</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Register tools with the agent.</span>
</span><span id="_AgenticLoop.register_tools-289"><a href="#_AgenticLoop.register_tools-289"><span class="linenos">289</span></a><span class="sd">        </span>
</span><span id="_AgenticLoop.register_tools-290"><a href="#_AgenticLoop.register_tools-290"><span class="linenos">290</span></a><span class="sd">        Parameters</span>
</span><span id="_AgenticLoop.register_tools-291"><a href="#_AgenticLoop.register_tools-291"><span class="linenos">291</span></a><span class="sd">        ----------</span>
</span><span id="_AgenticLoop.register_tools-292"><a href="#_AgenticLoop.register_tools-292"><span class="linenos">292</span></a><span class="sd">        tools : List[Any]</span>
</span><span id="_AgenticLoop.register_tools-293"><a href="#_AgenticLoop.register_tools-293"><span class="linenos">293</span></a><span class="sd">            List of tool functions to register. Each tool must have a</span>
</span><span id="_AgenticLoop.register_tools-294"><a href="#_AgenticLoop.register_tools-294"><span class="linenos">294</span></a><span class="sd">            __name__ attribute for identification.</span>
</span><span id="_AgenticLoop.register_tools-295"><a href="#_AgenticLoop.register_tools-295"><span class="linenos">295</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="_AgenticLoop.register_tools-296"><a href="#_AgenticLoop.register_tools-296"><span class="linenos">296</span></a>        <span class="k">for</span> <span class="n">tool</span> <span class="ow">in</span> <span class="n">tools</span><span class="p">:</span>
</span><span id="_AgenticLoop.register_tools-297"><a href="#_AgenticLoop.register_tools-297"><span class="linenos">297</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_tools</span><span class="p">[</span><span class="n">tool</span><span class="o">.</span><span class="vm">__name__</span><span class="p">]</span> <span class="o">=</span> <span class="n">tool</span>
</span></pre></div>


            <div class="docstring"><p>Register tools with the agent.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>tools</strong> (List[Any]):
List of tool functions to register. Each tool must have a
__name__ attribute for identification.</li>
</ul>
</div>


                            </div>
                            <div id="_AgenticLoop.register_mcp_servers" class="classattr">
                                        <input id="_AgenticLoop.register_mcp_servers-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">register_mcp_servers</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">mcp_servers</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="_AgenticLoop.register_mcp_servers-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#_AgenticLoop.register_mcp_servers"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="_AgenticLoop.register_mcp_servers-300"><a href="#_AgenticLoop.register_mcp_servers-300"><span class="linenos">300</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">register_mcp_servers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mcp_servers</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="_AgenticLoop.register_mcp_servers-301"><a href="#_AgenticLoop.register_mcp_servers-301"><span class="linenos">301</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Register MCP servers with the agent.</span>
</span><span id="_AgenticLoop.register_mcp_servers-302"><a href="#_AgenticLoop.register_mcp_servers-302"><span class="linenos">302</span></a><span class="sd">        </span>
</span><span id="_AgenticLoop.register_mcp_servers-303"><a href="#_AgenticLoop.register_mcp_servers-303"><span class="linenos">303</span></a><span class="sd">        Parameters</span>
</span><span id="_AgenticLoop.register_mcp_servers-304"><a href="#_AgenticLoop.register_mcp_servers-304"><span class="linenos">304</span></a><span class="sd">        ----------</span>
</span><span id="_AgenticLoop.register_mcp_servers-305"><a href="#_AgenticLoop.register_mcp_servers-305"><span class="linenos">305</span></a><span class="sd">        mcp_servers : List[Any]</span>
</span><span id="_AgenticLoop.register_mcp_servers-306"><a href="#_AgenticLoop.register_mcp_servers-306"><span class="linenos">306</span></a><span class="sd">            List of MCP server instances to register.</span>
</span><span id="_AgenticLoop.register_mcp_servers-307"><a href="#_AgenticLoop.register_mcp_servers-307"><span class="linenos">307</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="_AgenticLoop.register_mcp_servers-308"><a href="#_AgenticLoop.register_mcp_servers-308"><span class="linenos">308</span></a>        <span class="n">tools</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="_AgenticLoop.register_mcp_servers-309"><a href="#_AgenticLoop.register_mcp_servers-309"><span class="linenos">309</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_mcp_servers</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="_AgenticLoop.register_mcp_servers-310"><a href="#_AgenticLoop.register_mcp_servers-310"><span class="linenos">310</span></a>        <span class="k">for</span> <span class="n">mcp_server</span> <span class="ow">in</span> <span class="n">mcp_servers</span><span class="p">:</span>
</span><span id="_AgenticLoop.register_mcp_servers-311"><a href="#_AgenticLoop.register_mcp_servers-311"><span class="linenos">311</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_debug_print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connecting to MCP server: </span><span class="si">{</span><span class="n">mcp_server</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="_AgenticLoop.register_mcp_servers-312"><a href="#_AgenticLoop.register_mcp_servers-312"><span class="linenos">312</span></a>                <span class="c1"># Use context manager for proper connection handling</span>
</span><span id="_AgenticLoop.register_mcp_servers-313"><a href="#_AgenticLoop.register_mcp_servers-313"><span class="linenos">313</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_mcp_servers</span><span class="p">[</span><span class="n">mcp_server</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">mcp_server</span>
</span><span id="_AgenticLoop.register_mcp_servers-314"><a href="#_AgenticLoop.register_mcp_servers-314"><span class="linenos">314</span></a>                <span class="n">server_tools</span> <span class="o">=</span>  <span class="n">mcp_server</span><span class="o">.</span><span class="n">get_tools</span><span class="p">()</span>
</span><span id="_AgenticLoop.register_mcp_servers-315"><a href="#_AgenticLoop.register_mcp_servers-315"><span class="linenos">315</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_debug_print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Retrieved </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">server_tools</span><span class="p">)</span><span class="si">}</span><span class="s2"> tools from </span><span class="si">{</span><span class="n">mcp_server</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="_AgenticLoop.register_mcp_servers-316"><a href="#_AgenticLoop.register_mcp_servers-316"><span class="linenos">316</span></a>                <span class="k">for</span> <span class="n">tool</span> <span class="ow">in</span> <span class="n">server_tools</span><span class="p">:</span>
</span><span id="_AgenticLoop.register_mcp_servers-317"><a href="#_AgenticLoop.register_mcp_servers-317"><span class="linenos">317</span></a>                    <span class="c1"># Create a new tool name with MCP prefix</span>
</span><span id="_AgenticLoop.register_mcp_servers-318"><a href="#_AgenticLoop.register_mcp_servers-318"><span class="linenos">318</span></a>                    <span class="n">original_name</span> <span class="o">=</span> <span class="n">tool</span><span class="o">.</span><span class="n">name</span>
</span><span id="_AgenticLoop.register_mcp_servers-319"><a href="#_AgenticLoop.register_mcp_servers-319"><span class="linenos">319</span></a>                    <span class="n">tool</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;mcp_</span><span class="si">{</span><span class="n">mcp_server</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">original_name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="_AgenticLoop.register_mcp_servers-320"><a href="#_AgenticLoop.register_mcp_servers-320"><span class="linenos">320</span></a>                    <span class="n">tools</span><span class="p">[</span><span class="n">tool</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">tool</span>
</span><span id="_AgenticLoop.register_mcp_servers-321"><a href="#_AgenticLoop.register_mcp_servers-321"><span class="linenos">321</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_debug_print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; - </span><span class="si">{</span><span class="n">tool</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="_AgenticLoop.register_mcp_servers-322"><a href="#_AgenticLoop.register_mcp_servers-322"><span class="linenos">322</span></a>                
</span><span id="_AgenticLoop.register_mcp_servers-323"><a href="#_AgenticLoop.register_mcp_servers-323"><span class="linenos">323</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_tools</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">tools</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Register MCP servers with the agent.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>mcp_servers</strong> (List[Any]):
List of MCP server instances to register.</li>
</ul>
</div>


                            </div>
                            <div id="_AgenticLoop.enable_streaming" class="classattr">
                                        <input id="_AgenticLoop.enable_streaming-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">enable_streaming</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">stream_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">],</span> <span class="n">NoneType</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="_AgenticLoop.enable_streaming-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#_AgenticLoop.enable_streaming"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="_AgenticLoop.enable_streaming-326"><a href="#_AgenticLoop.enable_streaming-326"><span class="linenos">326</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">enable_streaming</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="_AgenticLoop.enable_streaming-327"><a href="#_AgenticLoop.enable_streaming-327"><span class="linenos">327</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Enable streaming responses for this agent.</span>
</span><span id="_AgenticLoop.enable_streaming-328"><a href="#_AgenticLoop.enable_streaming-328"><span class="linenos">328</span></a><span class="sd">        </span>
</span><span id="_AgenticLoop.enable_streaming-329"><a href="#_AgenticLoop.enable_streaming-329"><span class="linenos">329</span></a><span class="sd">        When streaming is enabled, the agent will call the provided callback</span>
</span><span id="_AgenticLoop.enable_streaming-330"><a href="#_AgenticLoop.enable_streaming-330"><span class="linenos">330</span></a><span class="sd">        function with each content chunk as it&#39;s generated, allowing for</span>
</span><span id="_AgenticLoop.enable_streaming-331"><a href="#_AgenticLoop.enable_streaming-331"><span class="linenos">331</span></a><span class="sd">        real-time processing and display of the AI&#39;s response.</span>
</span><span id="_AgenticLoop.enable_streaming-332"><a href="#_AgenticLoop.enable_streaming-332"><span class="linenos">332</span></a><span class="sd">        </span>
</span><span id="_AgenticLoop.enable_streaming-333"><a href="#_AgenticLoop.enable_streaming-333"><span class="linenos">333</span></a><span class="sd">        Parameters</span>
</span><span id="_AgenticLoop.enable_streaming-334"><a href="#_AgenticLoop.enable_streaming-334"><span class="linenos">334</span></a><span class="sd">        ----------</span>
</span><span id="_AgenticLoop.enable_streaming-335"><a href="#_AgenticLoop.enable_streaming-335"><span class="linenos">335</span></a><span class="sd">        stream_callback : Optional[Callable[[str], None]], default None</span>
</span><span id="_AgenticLoop.enable_streaming-336"><a href="#_AgenticLoop.enable_streaming-336"><span class="linenos">336</span></a><span class="sd">            Callback function to handle streaming content chunks.</span>
</span><span id="_AgenticLoop.enable_streaming-337"><a href="#_AgenticLoop.enable_streaming-337"><span class="linenos">337</span></a><span class="sd">            If None, uses a default callback that prints content to console.</span>
</span><span id="_AgenticLoop.enable_streaming-338"><a href="#_AgenticLoop.enable_streaming-338"><span class="linenos">338</span></a><span class="sd">            The callback receives plain text content strings.</span>
</span><span id="_AgenticLoop.enable_streaming-339"><a href="#_AgenticLoop.enable_streaming-339"><span class="linenos">339</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="_AgenticLoop.enable_streaming-340"><a href="#_AgenticLoop.enable_streaming-340"><span class="linenos">340</span></a>        <span class="k">if</span> <span class="n">stream_callback</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="_AgenticLoop.enable_streaming-341"><a href="#_AgenticLoop.enable_streaming-341"><span class="linenos">341</span></a>            <span class="k">def</span><span class="w"> </span><span class="nf">default_callback</span><span class="p">(</span><span class="n">content</span><span class="p">):</span>
</span><span id="_AgenticLoop.enable_streaming-342"><a href="#_AgenticLoop.enable_streaming-342"><span class="linenos">342</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="_AgenticLoop.enable_streaming-343"><a href="#_AgenticLoop.enable_streaming-343"><span class="linenos">343</span></a>            
</span><span id="_AgenticLoop.enable_streaming-344"><a href="#_AgenticLoop.enable_streaming-344"><span class="linenos">344</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_stream_callback</span> <span class="o">=</span> <span class="n">default_callback</span>
</span><span id="_AgenticLoop.enable_streaming-345"><a href="#_AgenticLoop.enable_streaming-345"><span class="linenos">345</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="_AgenticLoop.enable_streaming-346"><a href="#_AgenticLoop.enable_streaming-346"><span class="linenos">346</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_stream_callback</span> <span class="o">=</span> <span class="n">stream_callback</span>
</span></pre></div>


            <div class="docstring"><p>Enable streaming responses for this agent.</p>

<p>When streaming is enabled, the agent will call the provided callback
function with each content chunk as it's generated, allowing for
real-time processing and display of the AI's response.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>stream_callback</strong> (Optional[Callable[[str], None]], default None):
Callback function to handle streaming content chunks.
If None, uses a default callback that prints content to console.
The callback receives plain text content strings.</li>
</ul>
</div>


                            </div>
                            <div id="_AgenticLoop.disable_streaming" class="classattr">
                                        <input id="_AgenticLoop.disable_streaming-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">disable_streaming</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="_AgenticLoop.disable_streaming-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#_AgenticLoop.disable_streaming"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="_AgenticLoop.disable_streaming-348"><a href="#_AgenticLoop.disable_streaming-348"><span class="linenos">348</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">disable_streaming</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="_AgenticLoop.disable_streaming-349"><a href="#_AgenticLoop.disable_streaming-349"><span class="linenos">349</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Disable streaming responses for this agent.</span>
</span><span id="_AgenticLoop.disable_streaming-350"><a href="#_AgenticLoop.disable_streaming-350"><span class="linenos">350</span></a><span class="sd">        </span>
</span><span id="_AgenticLoop.disable_streaming-351"><a href="#_AgenticLoop.disable_streaming-351"><span class="linenos">351</span></a><span class="sd">        After calling this method, the agent will use standard (non-streaming)</span>
</span><span id="_AgenticLoop.disable_streaming-352"><a href="#_AgenticLoop.disable_streaming-352"><span class="linenos">352</span></a><span class="sd">        model execution for all subsequent requests.</span>
</span><span id="_AgenticLoop.disable_streaming-353"><a href="#_AgenticLoop.disable_streaming-353"><span class="linenos">353</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="_AgenticLoop.disable_streaming-354"><a href="#_AgenticLoop.disable_streaming-354"><span class="linenos">354</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_stream_callback</span> <span class="o">=</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Disable streaming responses for this agent.</p>

<p>After calling this method, the agent will use standard (non-streaming)
model execution for all subsequent requests.</p>
</div>


                            </div>
                            <div id="_AgenticLoop.create_streaming" class="classattr">
                                        <input id="_AgenticLoop.create_streaming-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-classmethod">@classmethod</div>

        <span class="def">def</span>
        <span class="name">create_streaming</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">cls</span>,</span><span class="param">	<span class="n">model</span><span class="p">:</span> <span class="n">Any</span>,</span><span class="param">	<span class="n">stream_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">],</span> <span class="n">NoneType</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">) -> <span class="n"><a href="#_AgenticLoop">_AgenticLoop</a></span>:</span></span>

                <label class="view-source-button" for="_AgenticLoop.create_streaming-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#_AgenticLoop.create_streaming"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="_AgenticLoop.create_streaming-356"><a href="#_AgenticLoop.create_streaming-356"><span class="linenos">356</span></a>    <span class="nd">@classmethod</span>
</span><span id="_AgenticLoop.create_streaming-357"><a href="#_AgenticLoop.create_streaming-357"><span class="linenos">357</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">create_streaming</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">stream_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
</span><span id="_AgenticLoop.create_streaming-358"><a href="#_AgenticLoop.create_streaming-358"><span class="linenos">358</span></a>                        <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;_AgenticLoop&#39;</span><span class="p">:</span>
</span><span id="_AgenticLoop.create_streaming-359"><a href="#_AgenticLoop.create_streaming-359"><span class="linenos">359</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create an agent instance with streaming enabled.</span>
</span><span id="_AgenticLoop.create_streaming-360"><a href="#_AgenticLoop.create_streaming-360"><span class="linenos">360</span></a><span class="sd">        </span>
</span><span id="_AgenticLoop.create_streaming-361"><a href="#_AgenticLoop.create_streaming-361"><span class="linenos">361</span></a><span class="sd">        This is a convenience class method that creates an agent instance</span>
</span><span id="_AgenticLoop.create_streaming-362"><a href="#_AgenticLoop.create_streaming-362"><span class="linenos">362</span></a><span class="sd">        with streaming already enabled, avoiding the need to call</span>
</span><span id="_AgenticLoop.create_streaming-363"><a href="#_AgenticLoop.create_streaming-363"><span class="linenos">363</span></a><span class="sd">        enable_streaming() separately.</span>
</span><span id="_AgenticLoop.create_streaming-364"><a href="#_AgenticLoop.create_streaming-364"><span class="linenos">364</span></a><span class="sd">        </span>
</span><span id="_AgenticLoop.create_streaming-365"><a href="#_AgenticLoop.create_streaming-365"><span class="linenos">365</span></a><span class="sd">        Parameters</span>
</span><span id="_AgenticLoop.create_streaming-366"><a href="#_AgenticLoop.create_streaming-366"><span class="linenos">366</span></a><span class="sd">        ----------</span>
</span><span id="_AgenticLoop.create_streaming-367"><a href="#_AgenticLoop.create_streaming-367"><span class="linenos">367</span></a><span class="sd">        model : Any</span>
</span><span id="_AgenticLoop.create_streaming-368"><a href="#_AgenticLoop.create_streaming-368"><span class="linenos">368</span></a><span class="sd">            AI model instance to use</span>
</span><span id="_AgenticLoop.create_streaming-369"><a href="#_AgenticLoop.create_streaming-369"><span class="linenos">369</span></a><span class="sd">        stream_callback : Optional[Callable[[str], None]], default None</span>
</span><span id="_AgenticLoop.create_streaming-370"><a href="#_AgenticLoop.create_streaming-370"><span class="linenos">370</span></a><span class="sd">            Callback function for handling streaming content chunks</span>
</span><span id="_AgenticLoop.create_streaming-371"><a href="#_AgenticLoop.create_streaming-371"><span class="linenos">371</span></a><span class="sd">        **kwargs</span>
</span><span id="_AgenticLoop.create_streaming-372"><a href="#_AgenticLoop.create_streaming-372"><span class="linenos">372</span></a><span class="sd">            Additional parameters to pass to the constructor</span>
</span><span id="_AgenticLoop.create_streaming-373"><a href="#_AgenticLoop.create_streaming-373"><span class="linenos">373</span></a><span class="sd">        </span>
</span><span id="_AgenticLoop.create_streaming-374"><a href="#_AgenticLoop.create_streaming-374"><span class="linenos">374</span></a><span class="sd">        Returns</span>
</span><span id="_AgenticLoop.create_streaming-375"><a href="#_AgenticLoop.create_streaming-375"><span class="linenos">375</span></a><span class="sd">        -------</span>
</span><span id="_AgenticLoop.create_streaming-376"><a href="#_AgenticLoop.create_streaming-376"><span class="linenos">376</span></a><span class="sd">        _AgenticLoop</span>
</span><span id="_AgenticLoop.create_streaming-377"><a href="#_AgenticLoop.create_streaming-377"><span class="linenos">377</span></a><span class="sd">            Agent instance with streaming enabled</span>
</span><span id="_AgenticLoop.create_streaming-378"><a href="#_AgenticLoop.create_streaming-378"><span class="linenos">378</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="_AgenticLoop.create_streaming-379"><a href="#_AgenticLoop.create_streaming-379"><span class="linenos">379</span></a>        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">stream_callback</span><span class="o">=</span><span class="n">stream_callback</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Create an agent instance with streaming enabled.</p>

<p>This is a convenience class method that creates an agent instance
with streaming already enabled, avoiding the need to call
enable_streaming() separately.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>model</strong> (Any):
AI model instance to use</li>
<li><strong>stream_callback</strong> (Optional[Callable[[str], None]], default None):
Callback function for handling streaming content chunks</li>
<li><strong>**kwargs</strong>: Additional parameters to pass to the constructor</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>_AgenticLoop</strong>: Agent instance with streaming enabled</li>
</ul>
</div>


                            </div>
                            <div id="_AgenticLoop.start" class="classattr">
                                        <input id="_AgenticLoop.start-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">start</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">query</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="_AgenticLoop.start-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#_AgenticLoop.start"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="_AgenticLoop.start-999"><a href="#_AgenticLoop.start-999"><span class="linenos"> 999</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="_AgenticLoop.start-1000"><a href="#_AgenticLoop.start-1000"><span class="linenos">1000</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Abstract method to start the agentic loop.</span>
</span><span id="_AgenticLoop.start-1001"><a href="#_AgenticLoop.start-1001"><span class="linenos">1001</span></a><span class="sd">        </span>
</span><span id="_AgenticLoop.start-1002"><a href="#_AgenticLoop.start-1002"><span class="linenos">1002</span></a><span class="sd">        This method must be implemented by subclasses to define the specific</span>
</span><span id="_AgenticLoop.start-1003"><a href="#_AgenticLoop.start-1003"><span class="linenos">1003</span></a><span class="sd">        agentic behavior and reasoning pattern.</span>
</span><span id="_AgenticLoop.start-1004"><a href="#_AgenticLoop.start-1004"><span class="linenos">1004</span></a><span class="sd">        </span>
</span><span id="_AgenticLoop.start-1005"><a href="#_AgenticLoop.start-1005"><span class="linenos">1005</span></a><span class="sd">        Parameters</span>
</span><span id="_AgenticLoop.start-1006"><a href="#_AgenticLoop.start-1006"><span class="linenos">1006</span></a><span class="sd">        ----------</span>
</span><span id="_AgenticLoop.start-1007"><a href="#_AgenticLoop.start-1007"><span class="linenos">1007</span></a><span class="sd">        query : str</span>
</span><span id="_AgenticLoop.start-1008"><a href="#_AgenticLoop.start-1008"><span class="linenos">1008</span></a><span class="sd">            User query to process</span>
</span><span id="_AgenticLoop.start-1009"><a href="#_AgenticLoop.start-1009"><span class="linenos">1009</span></a><span class="sd">        </span>
</span><span id="_AgenticLoop.start-1010"><a href="#_AgenticLoop.start-1010"><span class="linenos">1010</span></a><span class="sd">        Returns</span>
</span><span id="_AgenticLoop.start-1011"><a href="#_AgenticLoop.start-1011"><span class="linenos">1011</span></a><span class="sd">        -------</span>
</span><span id="_AgenticLoop.start-1012"><a href="#_AgenticLoop.start-1012"><span class="linenos">1012</span></a><span class="sd">        Dict[str, Any]</span>
</span><span id="_AgenticLoop.start-1013"><a href="#_AgenticLoop.start-1013"><span class="linenos">1013</span></a><span class="sd">            Agent response containing iterations and final result</span>
</span><span id="_AgenticLoop.start-1014"><a href="#_AgenticLoop.start-1014"><span class="linenos">1014</span></a><span class="sd">        </span>
</span><span id="_AgenticLoop.start-1015"><a href="#_AgenticLoop.start-1015"><span class="linenos">1015</span></a><span class="sd">        Raises</span>
</span><span id="_AgenticLoop.start-1016"><a href="#_AgenticLoop.start-1016"><span class="linenos">1016</span></a><span class="sd">        ------</span>
</span><span id="_AgenticLoop.start-1017"><a href="#_AgenticLoop.start-1017"><span class="linenos">1017</span></a><span class="sd">        NotImplementedError</span>
</span><span id="_AgenticLoop.start-1018"><a href="#_AgenticLoop.start-1018"><span class="linenos">1018</span></a><span class="sd">            This method must be implemented by subclasses</span>
</span><span id="_AgenticLoop.start-1019"><a href="#_AgenticLoop.start-1019"><span class="linenos">1019</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="_AgenticLoop.start-1020"><a href="#_AgenticLoop.start-1020"><span class="linenos">1020</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span></pre></div>


            <div class="docstring"><p>Abstract method to start the agentic loop.</p>

<p>This method must be implemented by subclasses to define the specific
agentic behavior and reasoning pattern.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>query</strong> (str):
User query to process</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>Dict[str, Any]</strong>: Agent response containing iterations and final result</li>
</ul>

<h6 id="raises">Raises</h6>

<ul>
<li><strong>NotImplementedError</strong>: This method must be implemented by subclasses</li>
</ul>
</div>


                            </div>
                </section>
                <section id="_FunctionCallingMixin">
                            <input id="_FunctionCallingMixin-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">_FunctionCallingMixin</span>:

                <label class="view-source-button" for="_FunctionCallingMixin-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#_FunctionCallingMixin"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="_FunctionCallingMixin-21"><a href="#_FunctionCallingMixin-21"><span class="linenos">21</span></a><span class="k">class</span><span class="w"> </span><span class="nc">_FunctionCallingMixin</span><span class="p">:</span>
</span><span id="_FunctionCallingMixin-22"><a href="#_FunctionCallingMixin-22"><span class="linenos">22</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Mixin for handling OpenAI function calling tool execution.</span>
</span><span id="_FunctionCallingMixin-23"><a href="#_FunctionCallingMixin-23"><span class="linenos">23</span></a><span class="sd">    </span>
</span><span id="_FunctionCallingMixin-24"><a href="#_FunctionCallingMixin-24"><span class="linenos">24</span></a><span class="sd">    This mixin provides methods for managing tool calls in OpenAI&#39;s native</span>
</span><span id="_FunctionCallingMixin-25"><a href="#_FunctionCallingMixin-25"><span class="linenos">25</span></a><span class="sd">    function calling format, converting tool responses into standardized messages</span>
</span><span id="_FunctionCallingMixin-26"><a href="#_FunctionCallingMixin-26"><span class="linenos">26</span></a><span class="sd">    that can be used in the conversation flow.</span>
</span><span id="_FunctionCallingMixin-27"><a href="#_FunctionCallingMixin-27"><span class="linenos">27</span></a><span class="sd">    </span>
</span><span id="_FunctionCallingMixin-28"><a href="#_FunctionCallingMixin-28"><span class="linenos">28</span></a><span class="sd">    The mixin handles the execution of tools registered with the agent and</span>
</span><span id="_FunctionCallingMixin-29"><a href="#_FunctionCallingMixin-29"><span class="linenos">29</span></a><span class="sd">    formats their responses according to OpenAI&#39;s message format specification.</span>
</span><span id="_FunctionCallingMixin-30"><a href="#_FunctionCallingMixin-30"><span class="linenos">30</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="_FunctionCallingMixin-31"><a href="#_FunctionCallingMixin-31"><span class="linenos">31</span></a>    
</span><span id="_FunctionCallingMixin-32"><a href="#_FunctionCallingMixin-32"><span class="linenos">32</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_call_tool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tool_call</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
</span><span id="_FunctionCallingMixin-33"><a href="#_FunctionCallingMixin-33"><span class="linenos">33</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute a tool call and return the formatted response.</span>
</span><span id="_FunctionCallingMixin-34"><a href="#_FunctionCallingMixin-34"><span class="linenos">34</span></a><span class="sd">        </span>
</span><span id="_FunctionCallingMixin-35"><a href="#_FunctionCallingMixin-35"><span class="linenos">35</span></a><span class="sd">        This method takes a tool call object from the AI model&#39;s response,</span>
</span><span id="_FunctionCallingMixin-36"><a href="#_FunctionCallingMixin-36"><span class="linenos">36</span></a><span class="sd">        executes the corresponding tool function, and returns a properly</span>
</span><span id="_FunctionCallingMixin-37"><a href="#_FunctionCallingMixin-37"><span class="linenos">37</span></a><span class="sd">        formatted message that can be added to the conversation history.</span>
</span><span id="_FunctionCallingMixin-38"><a href="#_FunctionCallingMixin-38"><span class="linenos">38</span></a><span class="sd">        </span>
</span><span id="_FunctionCallingMixin-39"><a href="#_FunctionCallingMixin-39"><span class="linenos">39</span></a><span class="sd">        Parameters</span>
</span><span id="_FunctionCallingMixin-40"><a href="#_FunctionCallingMixin-40"><span class="linenos">40</span></a><span class="sd">        ----------</span>
</span><span id="_FunctionCallingMixin-41"><a href="#_FunctionCallingMixin-41"><span class="linenos">41</span></a><span class="sd">        tool_call : Any</span>
</span><span id="_FunctionCallingMixin-42"><a href="#_FunctionCallingMixin-42"><span class="linenos">42</span></a><span class="sd">            Tool call object containing function execution details.</span>
</span><span id="_FunctionCallingMixin-43"><a href="#_FunctionCallingMixin-43"><span class="linenos">43</span></a><span class="sd">            Must have attributes:</span>
</span><span id="_FunctionCallingMixin-44"><a href="#_FunctionCallingMixin-44"><span class="linenos">44</span></a><span class="sd">            - function.name: Name of the function to call</span>
</span><span id="_FunctionCallingMixin-45"><a href="#_FunctionCallingMixin-45"><span class="linenos">45</span></a><span class="sd">            - function.arguments: JSON string of function arguments</span>
</span><span id="_FunctionCallingMixin-46"><a href="#_FunctionCallingMixin-46"><span class="linenos">46</span></a><span class="sd">            - id: Unique identifier for this tool call</span>
</span><span id="_FunctionCallingMixin-47"><a href="#_FunctionCallingMixin-47"><span class="linenos">47</span></a><span class="sd">        </span>
</span><span id="_FunctionCallingMixin-48"><a href="#_FunctionCallingMixin-48"><span class="linenos">48</span></a><span class="sd">        Returns</span>
</span><span id="_FunctionCallingMixin-49"><a href="#_FunctionCallingMixin-49"><span class="linenos">49</span></a><span class="sd">        -------</span>
</span><span id="_FunctionCallingMixin-50"><a href="#_FunctionCallingMixin-50"><span class="linenos">50</span></a><span class="sd">        Dict[str, str]</span>
</span><span id="_FunctionCallingMixin-51"><a href="#_FunctionCallingMixin-51"><span class="linenos">51</span></a><span class="sd">            Formatted tool response message containing:</span>
</span><span id="_FunctionCallingMixin-52"><a href="#_FunctionCallingMixin-52"><span class="linenos">52</span></a><span class="sd">            - tool_call_id: ID of the original tool call</span>
</span><span id="_FunctionCallingMixin-53"><a href="#_FunctionCallingMixin-53"><span class="linenos">53</span></a><span class="sd">            - role: Message role (always &quot;tool&quot;)</span>
</span><span id="_FunctionCallingMixin-54"><a href="#_FunctionCallingMixin-54"><span class="linenos">54</span></a><span class="sd">            - name: Name of the executed function</span>
</span><span id="_FunctionCallingMixin-55"><a href="#_FunctionCallingMixin-55"><span class="linenos">55</span></a><span class="sd">            - content: Tool execution result as string</span>
</span><span id="_FunctionCallingMixin-56"><a href="#_FunctionCallingMixin-56"><span class="linenos">56</span></a><span class="sd">        </span>
</span><span id="_FunctionCallingMixin-57"><a href="#_FunctionCallingMixin-57"><span class="linenos">57</span></a><span class="sd">        Raises</span>
</span><span id="_FunctionCallingMixin-58"><a href="#_FunctionCallingMixin-58"><span class="linenos">58</span></a><span class="sd">        ------</span>
</span><span id="_FunctionCallingMixin-59"><a href="#_FunctionCallingMixin-59"><span class="linenos">59</span></a><span class="sd">        KeyError</span>
</span><span id="_FunctionCallingMixin-60"><a href="#_FunctionCallingMixin-60"><span class="linenos">60</span></a><span class="sd">            If the tool function is not registered with the agent</span>
</span><span id="_FunctionCallingMixin-61"><a href="#_FunctionCallingMixin-61"><span class="linenos">61</span></a><span class="sd">        json.JSONDecodeError</span>
</span><span id="_FunctionCallingMixin-62"><a href="#_FunctionCallingMixin-62"><span class="linenos">62</span></a><span class="sd">            If the function arguments are not valid JSON</span>
</span><span id="_FunctionCallingMixin-63"><a href="#_FunctionCallingMixin-63"><span class="linenos">63</span></a><span class="sd">        Exception</span>
</span><span id="_FunctionCallingMixin-64"><a href="#_FunctionCallingMixin-64"><span class="linenos">64</span></a><span class="sd">            If the tool function execution fails</span>
</span><span id="_FunctionCallingMixin-65"><a href="#_FunctionCallingMixin-65"><span class="linenos">65</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="_FunctionCallingMixin-66"><a href="#_FunctionCallingMixin-66"><span class="linenos">66</span></a>
</span><span id="_FunctionCallingMixin-67"><a href="#_FunctionCallingMixin-67"><span class="linenos">67</span></a>        <span class="n">function_name</span> <span class="o">=</span> <span class="n">tool_call</span><span class="o">.</span><span class="n">function</span><span class="o">.</span><span class="n">name</span>
</span><span id="_FunctionCallingMixin-68"><a href="#_FunctionCallingMixin-68"><span class="linenos">68</span></a>        <span class="n">function_to_call</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tools</span><span class="p">[</span><span class="n">function_name</span><span class="p">]</span>
</span><span id="_FunctionCallingMixin-69"><a href="#_FunctionCallingMixin-69"><span class="linenos">69</span></a>        <span class="n">function_args</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">tool_call</span><span class="o">.</span><span class="n">function</span><span class="o">.</span><span class="n">arguments</span><span class="p">)</span>                
</span><span id="_FunctionCallingMixin-70"><a href="#_FunctionCallingMixin-70"><span class="linenos">70</span></a>        <span class="n">function_response</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">function_to_call</span><span class="p">(</span><span class="o">**</span><span class="n">function_args</span><span class="p">))</span>
</span><span id="_FunctionCallingMixin-71"><a href="#_FunctionCallingMixin-71"><span class="linenos">71</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="_FunctionCallingMixin-72"><a href="#_FunctionCallingMixin-72"><span class="linenos">72</span></a>            <span class="s2">&quot;tool_call_id&quot;</span><span class="p">:</span> <span class="n">tool_call</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
</span><span id="_FunctionCallingMixin-73"><a href="#_FunctionCallingMixin-73"><span class="linenos">73</span></a>            <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;tool&quot;</span><span class="p">,</span>
</span><span id="_FunctionCallingMixin-74"><a href="#_FunctionCallingMixin-74"><span class="linenos">74</span></a>            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">function_name</span><span class="p">,</span>
</span><span id="_FunctionCallingMixin-75"><a href="#_FunctionCallingMixin-75"><span class="linenos">75</span></a>            <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">function_response</span><span class="p">,</span>
</span><span id="_FunctionCallingMixin-76"><a href="#_FunctionCallingMixin-76"><span class="linenos">76</span></a>        <span class="p">}</span>
</span><span id="_FunctionCallingMixin-77"><a href="#_FunctionCallingMixin-77"><span class="linenos">77</span></a>
</span><span id="_FunctionCallingMixin-78"><a href="#_FunctionCallingMixin-78"><span class="linenos">78</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_call_mcp_tool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tool_call</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="_FunctionCallingMixin-79"><a href="#_FunctionCallingMixin-79"><span class="linenos">79</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute a MCP tool call.&quot;&quot;&quot;</span>
</span><span id="_FunctionCallingMixin-80"><a href="#_FunctionCallingMixin-80"><span class="linenos">80</span></a>        <span class="n">tool_name</span> <span class="o">=</span> <span class="n">tool_call</span><span class="o">.</span><span class="n">function</span><span class="o">.</span><span class="n">name</span>
</span><span id="_FunctionCallingMixin-81"><a href="#_FunctionCallingMixin-81"><span class="linenos">81</span></a>        <span class="n">tool_arguments</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">tool_call</span><span class="o">.</span><span class="n">function</span><span class="o">.</span><span class="n">arguments</span><span class="p">)</span> <span class="k">if</span> <span class="n">tool_call</span><span class="o">.</span><span class="n">function</span><span class="o">.</span><span class="n">arguments</span> <span class="k">else</span> <span class="p">{}</span>
</span><span id="_FunctionCallingMixin-82"><a href="#_FunctionCallingMixin-82"><span class="linenos">82</span></a>        <span class="n">tool_call_id</span> <span class="o">=</span> <span class="n">tool_call</span><span class="o">.</span><span class="n">id</span>
</span><span id="_FunctionCallingMixin-83"><a href="#_FunctionCallingMixin-83"><span class="linenos">83</span></a>        
</span><span id="_FunctionCallingMixin-84"><a href="#_FunctionCallingMixin-84"><span class="linenos">84</span></a>        <span class="c1"># Get server name from tool name (format: mcp_servername_toolname)</span>
</span><span id="_FunctionCallingMixin-85"><a href="#_FunctionCallingMixin-85"><span class="linenos">85</span></a>        <span class="n">server_name</span> <span class="o">=</span> <span class="n">tool_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="_FunctionCallingMixin-86"><a href="#_FunctionCallingMixin-86"><span class="linenos">86</span></a>        <span class="k">if</span> <span class="n">server_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mcp_servers</span><span class="p">:</span>
</span><span id="_FunctionCallingMixin-87"><a href="#_FunctionCallingMixin-87"><span class="linenos">87</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MCP server &#39;</span><span class="si">{</span><span class="n">server_name</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">)</span>
</span><span id="_FunctionCallingMixin-88"><a href="#_FunctionCallingMixin-88"><span class="linenos">88</span></a>        <span class="c1"># Simple approach: just return an error for now since MCP is not working</span>
</span><span id="_FunctionCallingMixin-89"><a href="#_FunctionCallingMixin-89"><span class="linenos">89</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="_FunctionCallingMixin-90"><a href="#_FunctionCallingMixin-90"><span class="linenos">90</span></a>            <span class="s2">&quot;tool_call_id&quot;</span><span class="p">:</span> <span class="n">tool_call_id</span><span class="p">,</span>
</span><span id="_FunctionCallingMixin-91"><a href="#_FunctionCallingMixin-91"><span class="linenos">91</span></a>            <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;tool&quot;</span><span class="p">,</span>
</span><span id="_FunctionCallingMixin-92"><a href="#_FunctionCallingMixin-92"><span class="linenos">92</span></a>            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">tool_name</span><span class="p">,</span>
</span><span id="_FunctionCallingMixin-93"><a href="#_FunctionCallingMixin-93"><span class="linenos">93</span></a>            <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mcp_servers</span><span class="p">[</span><span class="n">server_name</span><span class="p">]</span><span class="o">.</span><span class="n">call_tool</span><span class="p">(</span><span class="n">tool_name</span><span class="p">,</span> <span class="n">tool_arguments</span><span class="p">))</span>
</span><span id="_FunctionCallingMixin-94"><a href="#_FunctionCallingMixin-94"><span class="linenos">94</span></a>        <span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Mixin for handling OpenAI function calling tool execution.</p>

<p>This mixin provides methods for managing tool calls in OpenAI's native
function calling format, converting tool responses into standardized messages
that can be used in the conversation flow.</p>

<p>The mixin handles the execution of tools registered with the agent and
formats their responses according to OpenAI's message format specification.</p>
</div>


                </section>
                <section id="_ReactMixin">
                            <input id="_ReactMixin-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">_ReactMixin</span>:

                <label class="view-source-button" for="_ReactMixin-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#_ReactMixin"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="_ReactMixin-98"><a href="#_ReactMixin-98"><span class="linenos"> 98</span></a><span class="k">class</span><span class="w"> </span><span class="nc">_ReactMixin</span><span class="p">:</span>
</span><span id="_ReactMixin-99"><a href="#_ReactMixin-99"><span class="linenos"> 99</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Mixin for handling ReAct-style tool calls with JSON format.</span>
</span><span id="_ReactMixin-100"><a href="#_ReactMixin-100"><span class="linenos">100</span></a><span class="sd">    </span>
</span><span id="_ReactMixin-101"><a href="#_ReactMixin-101"><span class="linenos">101</span></a><span class="sd">    This mixin provides methods for managing tool calls in structured JSON format,</span>
</span><span id="_ReactMixin-102"><a href="#_ReactMixin-102"><span class="linenos">102</span></a><span class="sd">    typical of ReAct-style approaches for AI agents. It handles the encoding</span>
</span><span id="_ReactMixin-103"><a href="#_ReactMixin-103"><span class="linenos">103</span></a><span class="sd">    of tool functions and execution of tool calls based on parsed JSON responses.</span>
</span><span id="_ReactMixin-104"><a href="#_ReactMixin-104"><span class="linenos">104</span></a><span class="sd">    </span>
</span><span id="_ReactMixin-105"><a href="#_ReactMixin-105"><span class="linenos">105</span></a><span class="sd">    The ReAct (Reasoning and Acting) pattern allows agents to reason about</span>
</span><span id="_ReactMixin-106"><a href="#_ReactMixin-106"><span class="linenos">106</span></a><span class="sd">    problems step-by-step and take actions using tools when needed.</span>
</span><span id="_ReactMixin-107"><a href="#_ReactMixin-107"><span class="linenos">107</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="_ReactMixin-108"><a href="#_ReactMixin-108"><span class="linenos">108</span></a>    
</span><span id="_ReactMixin-109"><a href="#_ReactMixin-109"><span class="linenos">109</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_encode_tool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="_ReactMixin-110"><a href="#_ReactMixin-110"><span class="linenos">110</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Encode a function into a descriptive string format.</span>
</span><span id="_ReactMixin-111"><a href="#_ReactMixin-111"><span class="linenos">111</span></a><span class="sd">        </span>
</span><span id="_ReactMixin-112"><a href="#_ReactMixin-112"><span class="linenos">112</span></a><span class="sd">        This method creates a human-readable description of a tool function</span>
</span><span id="_ReactMixin-113"><a href="#_ReactMixin-113"><span class="linenos">113</span></a><span class="sd">        that can be included in prompts to help the AI model understand</span>
</span><span id="_ReactMixin-114"><a href="#_ReactMixin-114"><span class="linenos">114</span></a><span class="sd">        what tools are available and how to use them.</span>
</span><span id="_ReactMixin-115"><a href="#_ReactMixin-115"><span class="linenos">115</span></a><span class="sd">        </span>
</span><span id="_ReactMixin-116"><a href="#_ReactMixin-116"><span class="linenos">116</span></a><span class="sd">        Parameters</span>
</span><span id="_ReactMixin-117"><a href="#_ReactMixin-117"><span class="linenos">117</span></a><span class="sd">        ----------</span>
</span><span id="_ReactMixin-118"><a href="#_ReactMixin-118"><span class="linenos">118</span></a><span class="sd">        func : Any</span>
</span><span id="_ReactMixin-119"><a href="#_ReactMixin-119"><span class="linenos">119</span></a><span class="sd">            Function to encode. Must have attributes:</span>
</span><span id="_ReactMixin-120"><a href="#_ReactMixin-120"><span class="linenos">120</span></a><span class="sd">            - __name__: Function name</span>
</span><span id="_ReactMixin-121"><a href="#_ReactMixin-121"><span class="linenos">121</span></a><span class="sd">            - __doc__: Function documentation</span>
</span><span id="_ReactMixin-122"><a href="#_ReactMixin-122"><span class="linenos">122</span></a><span class="sd">        </span>
</span><span id="_ReactMixin-123"><a href="#_ReactMixin-123"><span class="linenos">123</span></a><span class="sd">        Returns</span>
</span><span id="_ReactMixin-124"><a href="#_ReactMixin-124"><span class="linenos">124</span></a><span class="sd">        -------</span>
</span><span id="_ReactMixin-125"><a href="#_ReactMixin-125"><span class="linenos">125</span></a><span class="sd">        str</span>
</span><span id="_ReactMixin-126"><a href="#_ReactMixin-126"><span class="linenos">126</span></a><span class="sd">            Descriptive string in the format:</span>
</span><span id="_ReactMixin-127"><a href="#_ReactMixin-127"><span class="linenos">127</span></a><span class="sd">            &quot;function_name(signature): documentation&quot;</span>
</span><span id="_ReactMixin-128"><a href="#_ReactMixin-128"><span class="linenos">128</span></a><span class="sd">            Newlines are replaced with spaces for single-line format.</span>
</span><span id="_ReactMixin-129"><a href="#_ReactMixin-129"><span class="linenos">129</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="_ReactMixin-130"><a href="#_ReactMixin-130"><span class="linenos">130</span></a>        <span class="n">sig</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
</span><span id="_ReactMixin-131"><a href="#_ReactMixin-131"><span class="linenos">131</span></a>        <span class="n">doc</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getdoc</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
</span><span id="_ReactMixin-132"><a href="#_ReactMixin-132"><span class="linenos">132</span></a>        <span class="n">encoded</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sig</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="n">doc</span>
</span><span id="_ReactMixin-133"><a href="#_ReactMixin-133"><span class="linenos">133</span></a>        <span class="n">encoded</span> <span class="o">=</span> <span class="n">encoded</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>
</span><span id="_ReactMixin-134"><a href="#_ReactMixin-134"><span class="linenos">134</span></a>        <span class="k">return</span> <span class="n">encoded</span>
</span><span id="_ReactMixin-135"><a href="#_ReactMixin-135"><span class="linenos">135</span></a>    
</span><span id="_ReactMixin-136"><a href="#_ReactMixin-136"><span class="linenos">136</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_encode_mcp_tool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tool</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="_ReactMixin-137"><a href="#_ReactMixin-137"><span class="linenos">137</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Converte uno schema tipo JSON Schema in sezione Args Google style.&quot;&quot;&quot;</span>
</span><span id="_ReactMixin-138"><a href="#_ReactMixin-138"><span class="linenos">138</span></a>        <span class="n">schema</span> <span class="o">=</span> <span class="n">tool</span><span class="o">.</span><span class="n">inputSchema</span>
</span><span id="_ReactMixin-139"><a href="#_ReactMixin-139"><span class="linenos">139</span></a>        <span class="k">if</span> <span class="n">schema</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">&quot;object&quot;</span><span class="p">:</span>
</span><span id="_ReactMixin-140"><a href="#_ReactMixin-140"><span class="linenos">140</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Lo schema radice deve avere type=object&quot;</span><span class="p">)</span>
</span><span id="_ReactMixin-141"><a href="#_ReactMixin-141"><span class="linenos">141</span></a>
</span><span id="_ReactMixin-142"><a href="#_ReactMixin-142"><span class="linenos">142</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="_ReactMixin-143"><a href="#_ReactMixin-143"><span class="linenos">143</span></a>        <span class="n">args_doc</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Args:&quot;</span><span class="p">]</span>
</span><span id="_ReactMixin-144"><a href="#_ReactMixin-144"><span class="linenos">144</span></a>        <span class="n">properties</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;properties&quot;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="_ReactMixin-145"><a href="#_ReactMixin-145"><span class="linenos">145</span></a>        <span class="n">required</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">schema</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;required&quot;</span><span class="p">,</span> <span class="p">[]))</span>
</span><span id="_ReactMixin-146"><a href="#_ReactMixin-146"><span class="linenos">146</span></a>
</span><span id="_ReactMixin-147"><a href="#_ReactMixin-147"><span class="linenos">147</span></a>        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">spec</span> <span class="ow">in</span> <span class="n">properties</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="_ReactMixin-148"><a href="#_ReactMixin-148"><span class="linenos">148</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span><span id="_ReactMixin-149"><a href="#_ReactMixin-149"><span class="linenos">149</span></a>            <span class="n">typ</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;Any&quot;</span><span class="p">)</span>
</span><span id="_ReactMixin-150"><a href="#_ReactMixin-150"><span class="linenos">150</span></a>            <span class="n">desc</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>
</span><span id="_ReactMixin-151"><a href="#_ReactMixin-151"><span class="linenos">151</span></a>            <span class="n">title</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="_ReactMixin-152"><a href="#_ReactMixin-152"><span class="linenos">152</span></a>            <span class="n">default_info</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">required</span> <span class="k">else</span> <span class="s2">&quot; Defaults to None.&quot;</span>
</span><span id="_ReactMixin-153"><a href="#_ReactMixin-153"><span class="linenos">153</span></a>
</span><span id="_ReactMixin-154"><a href="#_ReactMixin-154"><span class="linenos">154</span></a>            <span class="n">arg_line</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">typ</span><span class="si">}</span><span class="s2">): </span><span class="si">{</span><span class="n">desc</span><span class="si">}{</span><span class="n">default_info</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="_ReactMixin-155"><a href="#_ReactMixin-155"><span class="linenos">155</span></a>            <span class="k">if</span> <span class="n">title</span><span class="p">:</span>
</span><span id="_ReactMixin-156"><a href="#_ReactMixin-156"><span class="linenos">156</span></a>                <span class="n">arg_line</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">typ</span><span class="si">}</span><span class="s2">): </span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">desc</span><span class="si">}{</span><span class="n">default_info</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="_ReactMixin-157"><a href="#_ReactMixin-157"><span class="linenos">157</span></a>            <span class="n">args_doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg_line</span><span class="p">)</span>
</span><span id="_ReactMixin-158"><a href="#_ReactMixin-158"><span class="linenos">158</span></a>
</span><span id="_ReactMixin-159"><a href="#_ReactMixin-159"><span class="linenos">159</span></a>        <span class="n">encoded</span> <span class="o">=</span> <span class="n">tool</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;(&quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;): &quot;</span>
</span><span id="_ReactMixin-160"><a href="#_ReactMixin-160"><span class="linenos">160</span></a>        <span class="n">encoded</span> <span class="o">+=</span> <span class="n">tool</span><span class="o">.</span><span class="n">description</span>
</span><span id="_ReactMixin-161"><a href="#_ReactMixin-161"><span class="linenos">161</span></a>        <span class="n">encoded</span> <span class="o">+=</span> <span class="s2">&quot;. &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">args_doc</span><span class="p">)</span>
</span><span id="_ReactMixin-162"><a href="#_ReactMixin-162"><span class="linenos">162</span></a>        <span class="k">return</span> <span class="n">encoded</span>
</span><span id="_ReactMixin-163"><a href="#_ReactMixin-163"><span class="linenos">163</span></a>
</span><span id="_ReactMixin-164"><a href="#_ReactMixin-164"><span class="linenos">164</span></a>    
</span><span id="_ReactMixin-165"><a href="#_ReactMixin-165"><span class="linenos">165</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_call_tool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tool_call</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="_ReactMixin-166"><a href="#_ReactMixin-166"><span class="linenos">166</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute a tool call in ReAct format.</span>
</span><span id="_ReactMixin-167"><a href="#_ReactMixin-167"><span class="linenos">167</span></a><span class="sd">        </span>
</span><span id="_ReactMixin-168"><a href="#_ReactMixin-168"><span class="linenos">168</span></a><span class="sd">        This method executes a tool call based on a structured dictionary</span>
</span><span id="_ReactMixin-169"><a href="#_ReactMixin-169"><span class="linenos">169</span></a><span class="sd">        containing the tool name and arguments. It&#39;s designed to work with</span>
</span><span id="_ReactMixin-170"><a href="#_ReactMixin-170"><span class="linenos">170</span></a><span class="sd">        the ReAct pattern where tools are called through JSON-formatted</span>
</span><span id="_ReactMixin-171"><a href="#_ReactMixin-171"><span class="linenos">171</span></a><span class="sd">        action specifications.</span>
</span><span id="_ReactMixin-172"><a href="#_ReactMixin-172"><span class="linenos">172</span></a><span class="sd">        </span>
</span><span id="_ReactMixin-173"><a href="#_ReactMixin-173"><span class="linenos">173</span></a><span class="sd">        Parameters</span>
</span><span id="_ReactMixin-174"><a href="#_ReactMixin-174"><span class="linenos">174</span></a><span class="sd">        ----------</span>
</span><span id="_ReactMixin-175"><a href="#_ReactMixin-175"><span class="linenos">175</span></a><span class="sd">        tool_call : Dict[str, Any]</span>
</span><span id="_ReactMixin-176"><a href="#_ReactMixin-176"><span class="linenos">176</span></a><span class="sd">            Tool call specification containing:</span>
</span><span id="_ReactMixin-177"><a href="#_ReactMixin-177"><span class="linenos">177</span></a><span class="sd">            - name: Name of the tool to call</span>
</span><span id="_ReactMixin-178"><a href="#_ReactMixin-178"><span class="linenos">178</span></a><span class="sd">            - arguments: Dictionary of tool arguments</span>
</span><span id="_ReactMixin-179"><a href="#_ReactMixin-179"><span class="linenos">179</span></a><span class="sd">        </span>
</span><span id="_ReactMixin-180"><a href="#_ReactMixin-180"><span class="linenos">180</span></a><span class="sd">        Returns</span>
</span><span id="_ReactMixin-181"><a href="#_ReactMixin-181"><span class="linenos">181</span></a><span class="sd">        -------</span>
</span><span id="_ReactMixin-182"><a href="#_ReactMixin-182"><span class="linenos">182</span></a><span class="sd">        Any</span>
</span><span id="_ReactMixin-183"><a href="#_ReactMixin-183"><span class="linenos">183</span></a><span class="sd">            Result of the tool execution</span>
</span><span id="_ReactMixin-184"><a href="#_ReactMixin-184"><span class="linenos">184</span></a><span class="sd">        </span>
</span><span id="_ReactMixin-185"><a href="#_ReactMixin-185"><span class="linenos">185</span></a><span class="sd">        Raises</span>
</span><span id="_ReactMixin-186"><a href="#_ReactMixin-186"><span class="linenos">186</span></a><span class="sd">        ------</span>
</span><span id="_ReactMixin-187"><a href="#_ReactMixin-187"><span class="linenos">187</span></a><span class="sd">        KeyError</span>
</span><span id="_ReactMixin-188"><a href="#_ReactMixin-188"><span class="linenos">188</span></a><span class="sd">            If the tool is not registered with the agent</span>
</span><span id="_ReactMixin-189"><a href="#_ReactMixin-189"><span class="linenos">189</span></a><span class="sd">        TypeError</span>
</span><span id="_ReactMixin-190"><a href="#_ReactMixin-190"><span class="linenos">190</span></a><span class="sd">            If the tool arguments don&#39;t match the function signature</span>
</span><span id="_ReactMixin-191"><a href="#_ReactMixin-191"><span class="linenos">191</span></a><span class="sd">        Exception</span>
</span><span id="_ReactMixin-192"><a href="#_ReactMixin-192"><span class="linenos">192</span></a><span class="sd">            If the tool execution fails</span>
</span><span id="_ReactMixin-193"><a href="#_ReactMixin-193"><span class="linenos">193</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="_ReactMixin-194"><a href="#_ReactMixin-194"><span class="linenos">194</span></a>        <span class="n">tool</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tools</span><span class="p">[</span><span class="n">tool_call</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]]</span>
</span><span id="_ReactMixin-195"><a href="#_ReactMixin-195"><span class="linenos">195</span></a>        <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">tool_call</span><span class="p">[</span><span class="s2">&quot;arguments&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</span><span id="_ReactMixin-196"><a href="#_ReactMixin-196"><span class="linenos">196</span></a>        <span class="k">return</span> <span class="n">tool</span><span class="p">(</span><span class="o">*</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="_ReactMixin-197"><a href="#_ReactMixin-197"><span class="linenos">197</span></a>
</span><span id="_ReactMixin-198"><a href="#_ReactMixin-198"><span class="linenos">198</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_call_mcp_tool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tool_call</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="_ReactMixin-199"><a href="#_ReactMixin-199"><span class="linenos">199</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute a MCP tool call.</span>
</span><span id="_ReactMixin-200"><a href="#_ReactMixin-200"><span class="linenos">200</span></a><span class="sd">        </span>
</span><span id="_ReactMixin-201"><a href="#_ReactMixin-201"><span class="linenos">201</span></a><span class="sd">        This method executes a MCP tool call based on a structured dictionary</span>
</span><span id="_ReactMixin-202"><a href="#_ReactMixin-202"><span class="linenos">202</span></a><span class="sd">        containing the tool name and arguments.</span>
</span><span id="_ReactMixin-203"><a href="#_ReactMixin-203"><span class="linenos">203</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="_ReactMixin-204"><a href="#_ReactMixin-204"><span class="linenos">204</span></a>        <span class="c1"># Extract server name from tool name (format: mcp_servername_toolname)</span>
</span><span id="_ReactMixin-205"><a href="#_ReactMixin-205"><span class="linenos">205</span></a>        <span class="n">tool_name_parts</span> <span class="o">=</span> <span class="n">tool_call</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="_ReactMixin-206"><a href="#_ReactMixin-206"><span class="linenos">206</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tool_name_parts</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="_ReactMixin-207"><a href="#_ReactMixin-207"><span class="linenos">207</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid MCP tool name format: </span><span class="si">{</span><span class="n">tool_call</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="_ReactMixin-208"><a href="#_ReactMixin-208"><span class="linenos">208</span></a>        
</span><span id="_ReactMixin-209"><a href="#_ReactMixin-209"><span class="linenos">209</span></a>        <span class="n">server_name</span> <span class="o">=</span> <span class="n">tool_name_parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="_ReactMixin-210"><a href="#_ReactMixin-210"><span class="linenos">210</span></a>        <span class="n">tool_name</span> <span class="o">=</span> <span class="n">tool_name_parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="_ReactMixin-211"><a href="#_ReactMixin-211"><span class="linenos">211</span></a>        <span class="k">if</span> <span class="n">server_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mcp_servers</span><span class="p">:</span>
</span><span id="_ReactMixin-212"><a href="#_ReactMixin-212"><span class="linenos">212</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MCP server &#39;</span><span class="si">{</span><span class="n">server_name</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">)</span>
</span><span id="_ReactMixin-213"><a href="#_ReactMixin-213"><span class="linenos">213</span></a>
</span><span id="_ReactMixin-214"><a href="#_ReactMixin-214"><span class="linenos">214</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="_ReactMixin-215"><a href="#_ReactMixin-215"><span class="linenos">215</span></a>            <span class="s2">&quot;tool_call_id&quot;</span><span class="p">:</span> <span class="n">tool_name</span><span class="p">,</span>
</span><span id="_ReactMixin-216"><a href="#_ReactMixin-216"><span class="linenos">216</span></a>            <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;tool&quot;</span><span class="p">,</span>
</span><span id="_ReactMixin-217"><a href="#_ReactMixin-217"><span class="linenos">217</span></a>            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">tool_name</span><span class="p">,</span>
</span><span id="_ReactMixin-218"><a href="#_ReactMixin-218"><span class="linenos">218</span></a>            <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mcp_servers</span><span class="p">[</span><span class="n">server_name</span><span class="p">]</span><span class="o">.</span><span class="n">call_tool</span><span class="p">(</span><span class="n">tool_name</span><span class="p">,</span> <span class="n">tool_call</span><span class="p">[</span><span class="s2">&quot;arguments&quot;</span><span class="p">]))</span>
</span><span id="_ReactMixin-219"><a href="#_ReactMixin-219"><span class="linenos">219</span></a>        <span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Mixin for handling ReAct-style tool calls with JSON format.</p>

<p>This mixin provides methods for managing tool calls in structured JSON format,
typical of ReAct-style approaches for AI agents. It handles the encoding
of tool functions and execution of tool calls based on parsed JSON responses.</p>

<p>The ReAct (Reasoning and Acting) pattern allows agents to reason about
problems step-by-step and take actions using tools when needed.</p>
</div>


                </section>
                <section id="_BaseReactLoop">
                            <input id="_BaseReactLoop-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">_BaseReactLoop</span><wbr>(<span class="base"><a href="#_AgenticLoop">monoai.agents._AgenticLoop</a></span>, <span class="base"><a href="#_ReactMixin">monoai.agents._ReactMixin</a></span>):

                <label class="view-source-button" for="_BaseReactLoop-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#_BaseReactLoop"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="_BaseReactLoop-14"><a href="#_BaseReactLoop-14"><span class="linenos"> 14</span></a><span class="k">class</span><span class="w"> </span><span class="nc">_BaseReactLoop</span><span class="p">(</span><span class="n">_AgenticLoop</span><span class="p">,</span> <span class="n">_ReactMixin</span><span class="p">):</span>
</span><span id="_BaseReactLoop-15"><a href="#_BaseReactLoop-15"><span class="linenos"> 15</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for all ReAct-style agents.</span>
</span><span id="_BaseReactLoop-16"><a href="#_BaseReactLoop-16"><span class="linenos"> 16</span></a><span class="sd">    </span>
</span><span id="_BaseReactLoop-17"><a href="#_BaseReactLoop-17"><span class="linenos"> 17</span></a><span class="sd">    This class implements the standard loop for agents that use a ReAct-style</span>
</span><span id="_BaseReactLoop-18"><a href="#_BaseReactLoop-18"><span class="linenos"> 18</span></a><span class="sd">    approach, where the model produces structured JSON responses that are</span>
</span><span id="_BaseReactLoop-19"><a href="#_BaseReactLoop-19"><span class="linenos"> 19</span></a><span class="sd">    parsed and handled iteratively. The ReAct pattern combines reasoning</span>
</span><span id="_BaseReactLoop-20"><a href="#_BaseReactLoop-20"><span class="linenos"> 20</span></a><span class="sd">    and acting in a step-by-step manner.</span>
</span><span id="_BaseReactLoop-21"><a href="#_BaseReactLoop-21"><span class="linenos"> 21</span></a><span class="sd">    </span>
</span><span id="_BaseReactLoop-22"><a href="#_BaseReactLoop-22"><span class="linenos"> 22</span></a><span class="sd">    The base loop handles:</span>
</span><span id="_BaseReactLoop-23"><a href="#_BaseReactLoop-23"><span class="linenos"> 23</span></a><span class="sd">    - Step-based reasoning format parsing</span>
</span><span id="_BaseReactLoop-24"><a href="#_BaseReactLoop-24"><span class="linenos"> 24</span></a><span class="sd">    - Tool action execution and observation</span>
</span><span id="_BaseReactLoop-25"><a href="#_BaseReactLoop-25"><span class="linenos"> 25</span></a><span class="sd">    - Final answer detection</span>
</span><span id="_BaseReactLoop-26"><a href="#_BaseReactLoop-26"><span class="linenos"> 26</span></a><span class="sd">    - Custom iteration handlers</span>
</span><span id="_BaseReactLoop-27"><a href="#_BaseReactLoop-27"><span class="linenos"> 27</span></a><span class="sd">    - Error handling and fallbacks</span>
</span><span id="_BaseReactLoop-28"><a href="#_BaseReactLoop-28"><span class="linenos"> 28</span></a><span class="sd">    </span>
</span><span id="_BaseReactLoop-29"><a href="#_BaseReactLoop-29"><span class="linenos"> 29</span></a><span class="sd">    Attributes</span>
</span><span id="_BaseReactLoop-30"><a href="#_BaseReactLoop-30"><span class="linenos"> 30</span></a><span class="sd">    ----------</span>
</span><span id="_BaseReactLoop-31"><a href="#_BaseReactLoop-31"><span class="linenos"> 31</span></a><span class="sd">    _max_iter : Optional[int]</span>
</span><span id="_BaseReactLoop-32"><a href="#_BaseReactLoop-32"><span class="linenos"> 32</span></a><span class="sd">        Maximum number of iterations allowed</span>
</span><span id="_BaseReactLoop-33"><a href="#_BaseReactLoop-33"><span class="linenos"> 33</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="_BaseReactLoop-34"><a href="#_BaseReactLoop-34"><span class="linenos"> 34</span></a>    
</span><span id="_BaseReactLoop-35"><a href="#_BaseReactLoop-35"><span class="linenos"> 35</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_run_react_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">agent_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
</span><span id="_BaseReactLoop-36"><a href="#_BaseReactLoop-36"><span class="linenos"> 36</span></a>                        <span class="n">custom_handlers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="_BaseReactLoop-37"><a href="#_BaseReactLoop-37"><span class="linenos"> 37</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute the standard ReAct loop.</span>
</span><span id="_BaseReactLoop-38"><a href="#_BaseReactLoop-38"><span class="linenos"> 38</span></a><span class="sd">        </span>
</span><span id="_BaseReactLoop-39"><a href="#_BaseReactLoop-39"><span class="linenos"> 39</span></a><span class="sd">        This method implements the core ReAct reasoning pattern where the</span>
</span><span id="_BaseReactLoop-40"><a href="#_BaseReactLoop-40"><span class="linenos"> 40</span></a><span class="sd">        agent alternates between thinking, acting, and observing until it</span>
</span><span id="_BaseReactLoop-41"><a href="#_BaseReactLoop-41"><span class="linenos"> 41</span></a><span class="sd">        reaches a final answer or hits iteration limits.</span>
</span><span id="_BaseReactLoop-42"><a href="#_BaseReactLoop-42"><span class="linenos"> 42</span></a><span class="sd">        </span>
</span><span id="_BaseReactLoop-43"><a href="#_BaseReactLoop-43"><span class="linenos"> 43</span></a><span class="sd">        Parameters</span>
</span><span id="_BaseReactLoop-44"><a href="#_BaseReactLoop-44"><span class="linenos"> 44</span></a><span class="sd">        ----------</span>
</span><span id="_BaseReactLoop-45"><a href="#_BaseReactLoop-45"><span class="linenos"> 45</span></a><span class="sd">        query : str</span>
</span><span id="_BaseReactLoop-46"><a href="#_BaseReactLoop-46"><span class="linenos"> 46</span></a><span class="sd">            User query to process</span>
</span><span id="_BaseReactLoop-47"><a href="#_BaseReactLoop-47"><span class="linenos"> 47</span></a><span class="sd">        agent_type : str</span>
</span><span id="_BaseReactLoop-48"><a href="#_BaseReactLoop-48"><span class="linenos"> 48</span></a><span class="sd">            Type of agent to determine which prompt template to use</span>
</span><span id="_BaseReactLoop-49"><a href="#_BaseReactLoop-49"><span class="linenos"> 49</span></a><span class="sd">        custom_handlers : Optional[Dict[str, Callable]], optional</span>
</span><span id="_BaseReactLoop-50"><a href="#_BaseReactLoop-50"><span class="linenos"> 50</span></a><span class="sd">            Dictionary of custom handlers for specific iteration types.</span>
</span><span id="_BaseReactLoop-51"><a href="#_BaseReactLoop-51"><span class="linenos"> 51</span></a><span class="sd">            Keys are field names in the iteration, values are functions</span>
</span><span id="_BaseReactLoop-52"><a href="#_BaseReactLoop-52"><span class="linenos"> 52</span></a><span class="sd">            that handle those iterations.</span>
</span><span id="_BaseReactLoop-53"><a href="#_BaseReactLoop-53"><span class="linenos"> 53</span></a><span class="sd">        </span>
</span><span id="_BaseReactLoop-54"><a href="#_BaseReactLoop-54"><span class="linenos"> 54</span></a><span class="sd">        Returns</span>
</span><span id="_BaseReactLoop-55"><a href="#_BaseReactLoop-55"><span class="linenos"> 55</span></a><span class="sd">        -------</span>
</span><span id="_BaseReactLoop-56"><a href="#_BaseReactLoop-56"><span class="linenos"> 56</span></a><span class="sd">        Dict[str, Any]</span>
</span><span id="_BaseReactLoop-57"><a href="#_BaseReactLoop-57"><span class="linenos"> 57</span></a><span class="sd">            Agent response containing:</span>
</span><span id="_BaseReactLoop-58"><a href="#_BaseReactLoop-58"><span class="linenos"> 58</span></a><span class="sd">            - prompt: Original user query</span>
</span><span id="_BaseReactLoop-59"><a href="#_BaseReactLoop-59"><span class="linenos"> 59</span></a><span class="sd">            - iterations: List of processed iterations</span>
</span><span id="_BaseReactLoop-60"><a href="#_BaseReactLoop-60"><span class="linenos"> 60</span></a><span class="sd">            - response: Final response (if present)</span>
</span><span id="_BaseReactLoop-61"><a href="#_BaseReactLoop-61"><span class="linenos"> 61</span></a><span class="sd">        </span>
</span><span id="_BaseReactLoop-62"><a href="#_BaseReactLoop-62"><span class="linenos"> 62</span></a><span class="sd">        Notes</span>
</span><span id="_BaseReactLoop-63"><a href="#_BaseReactLoop-63"><span class="linenos"> 63</span></a><span class="sd">        -----</span>
</span><span id="_BaseReactLoop-64"><a href="#_BaseReactLoop-64"><span class="linenos"> 64</span></a><span class="sd">        This method automatically handles:</span>
</span><span id="_BaseReactLoop-65"><a href="#_BaseReactLoop-65"><span class="linenos"> 65</span></a><span class="sd">        - Final answers (final_answer)</span>
</span><span id="_BaseReactLoop-66"><a href="#_BaseReactLoop-66"><span class="linenos"> 66</span></a><span class="sd">        - Tool actions (action)</span>
</span><span id="_BaseReactLoop-67"><a href="#_BaseReactLoop-67"><span class="linenos"> 67</span></a><span class="sd">        - Custom cases via custom_handlers</span>
</span><span id="_BaseReactLoop-68"><a href="#_BaseReactLoop-68"><span class="linenos"> 68</span></a><span class="sd">        - Default cases for unhandled iterations</span>
</span><span id="_BaseReactLoop-69"><a href="#_BaseReactLoop-69"><span class="linenos"> 69</span></a><span class="sd">        - JSON error handling</span>
</span><span id="_BaseReactLoop-70"><a href="#_BaseReactLoop-70"><span class="linenos"> 70</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="_BaseReactLoop-71"><a href="#_BaseReactLoop-71"><span class="linenos"> 71</span></a>        <span class="n">messages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_base_messages</span><span class="p">(</span><span class="n">agent_type</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span>
</span><span id="_BaseReactLoop-72"><a href="#_BaseReactLoop-72"><span class="linenos"> 72</span></a>
</span><span id="_BaseReactLoop-73"><a href="#_BaseReactLoop-73"><span class="linenos"> 73</span></a>        <span class="n">current_iter</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="_BaseReactLoop-74"><a href="#_BaseReactLoop-74"><span class="linenos"> 74</span></a>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_base_response</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</span><span id="_BaseReactLoop-75"><a href="#_BaseReactLoop-75"><span class="linenos"> 75</span></a>        
</span><span id="_BaseReactLoop-76"><a href="#_BaseReactLoop-76"><span class="linenos"> 76</span></a>        <span class="c1"># Handler personalizzati per casi speciali</span>
</span><span id="_BaseReactLoop-77"><a href="#_BaseReactLoop-77"><span class="linenos"> 77</span></a>        <span class="n">custom_handlers</span> <span class="o">=</span> <span class="n">custom_handlers</span> <span class="ow">or</span> <span class="p">{}</span>
</span><span id="_BaseReactLoop-78"><a href="#_BaseReactLoop-78"><span class="linenos"> 78</span></a>
</span><span id="_BaseReactLoop-79"><a href="#_BaseReactLoop-79"><span class="linenos"> 79</span></a>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="_BaseReactLoop-80"><a href="#_BaseReactLoop-80"><span class="linenos"> 80</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_iter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">current_iter</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_iter</span><span class="p">:</span>
</span><span id="_BaseReactLoop-81"><a href="#_BaseReactLoop-81"><span class="linenos"> 81</span></a>                <span class="k">break</span>
</span><span id="_BaseReactLoop-82"><a href="#_BaseReactLoop-82"><span class="linenos"> 82</span></a>            
</span><span id="_BaseReactLoop-83"><a href="#_BaseReactLoop-83"><span class="linenos"> 83</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stream_callback</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="_BaseReactLoop-84"><a href="#_BaseReactLoop-84"><span class="linenos"> 84</span></a>                <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_model_step</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span>
</span><span id="_BaseReactLoop-85"><a href="#_BaseReactLoop-85"><span class="linenos"> 85</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="_BaseReactLoop-86"><a href="#_BaseReactLoop-86"><span class="linenos"> 86</span></a>                <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_model_step_stream</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span>
</span><span id="_BaseReactLoop-87"><a href="#_BaseReactLoop-87"><span class="linenos"> 87</span></a>
</span><span id="_BaseReactLoop-88"><a href="#_BaseReactLoop-88"><span class="linenos"> 88</span></a>            <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
</span><span id="_BaseReactLoop-89"><a href="#_BaseReactLoop-89"><span class="linenos"> 89</span></a>            <span class="n">content</span> <span class="o">=</span> <span class="n">resp</span><span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">]</span>
</span><span id="_BaseReactLoop-90"><a href="#_BaseReactLoop-90"><span class="linenos"> 90</span></a>        
</span><span id="_BaseReactLoop-91"><a href="#_BaseReactLoop-91"><span class="linenos"> 91</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_debug_print</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</span><span id="_BaseReactLoop-92"><a href="#_BaseReactLoop-92"><span class="linenos"> 92</span></a>
</span><span id="_BaseReactLoop-93"><a href="#_BaseReactLoop-93"><span class="linenos"> 93</span></a>            <span class="c1"># Update usage for this iteration</span>
</span><span id="_BaseReactLoop-94"><a href="#_BaseReactLoop-94"><span class="linenos"> 94</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_usage</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">resp</span><span class="p">)</span>
</span><span id="_BaseReactLoop-95"><a href="#_BaseReactLoop-95"><span class="linenos"> 95</span></a>
</span><span id="_BaseReactLoop-96"><a href="#_BaseReactLoop-96"><span class="linenos"> 96</span></a>            <span class="k">if</span> <span class="n">content</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="_BaseReactLoop-97"><a href="#_BaseReactLoop-97"><span class="linenos"> 97</span></a>                <span class="n">iteration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_step_format</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</span><span id="_BaseReactLoop-98"><a href="#_BaseReactLoop-98"><span class="linenos"> 98</span></a>                <span class="k">if</span> <span class="n">iteration</span><span class="p">:</span>
</span><span id="_BaseReactLoop-99"><a href="#_BaseReactLoop-99"><span class="linenos"> 99</span></a>                    <span class="c1"># Add usage information to the iteration</span>
</span><span id="_BaseReactLoop-100"><a href="#_BaseReactLoop-100"><span class="linenos">100</span></a>                    <span class="k">if</span> <span class="s2">&quot;usage&quot;</span> <span class="ow">in</span> <span class="n">resp</span><span class="p">:</span>
</span><span id="_BaseReactLoop-101"><a href="#_BaseReactLoop-101"><span class="linenos">101</span></a>                        <span class="n">iteration</span><span class="p">[</span><span class="s2">&quot;usage&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">resp</span><span class="p">[</span><span class="s2">&quot;usage&quot;</span><span class="p">]</span>
</span><span id="_BaseReactLoop-102"><a href="#_BaseReactLoop-102"><span class="linenos">102</span></a>                    
</span><span id="_BaseReactLoop-103"><a href="#_BaseReactLoop-103"><span class="linenos">103</span></a>                    <span class="c1"># Check if human feedback is required for all steps</span>
</span><span id="_BaseReactLoop-104"><a href="#_BaseReactLoop-104"><span class="linenos">104</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_human_feedback</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
</span><span id="_BaseReactLoop-105"><a href="#_BaseReactLoop-105"><span class="linenos">105</span></a>                        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request_human_feedback</span><span class="p">(</span><span class="n">iteration</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;step_type&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">),</span> 
</span><span id="_BaseReactLoop-106"><a href="#_BaseReactLoop-106"><span class="linenos">106</span></a>                                                          <span class="n">iteration</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;content&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span> 
</span><span id="_BaseReactLoop-107"><a href="#_BaseReactLoop-107"><span class="linenos">107</span></a>                                                          <span class="n">iteration</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;action&quot;</span><span class="p">)):</span>
</span><span id="_BaseReactLoop-108"><a href="#_BaseReactLoop-108"><span class="linenos">108</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Execution stopped by user.&quot;</span><span class="p">)</span>
</span><span id="_BaseReactLoop-109"><a href="#_BaseReactLoop-109"><span class="linenos">109</span></a>                            <span class="k">break</span>
</span><span id="_BaseReactLoop-110"><a href="#_BaseReactLoop-110"><span class="linenos">110</span></a>                    
</span><span id="_BaseReactLoop-111"><a href="#_BaseReactLoop-111"><span class="linenos">111</span></a>                    <span class="c1"># Gestione risposta finale</span>
</span><span id="_BaseReactLoop-112"><a href="#_BaseReactLoop-112"><span class="linenos">112</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_final_answer</span><span class="p">(</span><span class="n">iteration</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
</span><span id="_BaseReactLoop-113"><a href="#_BaseReactLoop-113"><span class="linenos">113</span></a>                        <span class="k">break</span>
</span><span id="_BaseReactLoop-114"><a href="#_BaseReactLoop-114"><span class="linenos">114</span></a>                    
</span><span id="_BaseReactLoop-115"><a href="#_BaseReactLoop-115"><span class="linenos">115</span></a>                    <span class="c1"># Gestione azioni di tool</span>
</span><span id="_BaseReactLoop-116"><a href="#_BaseReactLoop-116"><span class="linenos">116</span></a>                    <span class="k">if</span> <span class="n">iteration</span><span class="p">[</span><span class="s2">&quot;step_type&quot;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;action&quot;</span><span class="p">:</span>
</span><span id="_BaseReactLoop-117"><a href="#_BaseReactLoop-117"><span class="linenos">117</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_handle_tool_action</span><span class="p">(</span><span class="n">iteration</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">messages</span><span class="p">)</span>
</span><span id="_BaseReactLoop-118"><a href="#_BaseReactLoop-118"><span class="linenos">118</span></a>                        <span class="k">continue</span>
</span><span id="_BaseReactLoop-119"><a href="#_BaseReactLoop-119"><span class="linenos">119</span></a>                    
</span><span id="_BaseReactLoop-120"><a href="#_BaseReactLoop-120"><span class="linenos">120</span></a>                    <span class="c1"># Gestione casi personalizzati</span>
</span><span id="_BaseReactLoop-121"><a href="#_BaseReactLoop-121"><span class="linenos">121</span></a>                    <span class="n">handled</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="_BaseReactLoop-122"><a href="#_BaseReactLoop-122"><span class="linenos">122</span></a>                    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">handler</span> <span class="ow">in</span> <span class="n">custom_handlers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="_BaseReactLoop-123"><a href="#_BaseReactLoop-123"><span class="linenos">123</span></a>                        <span class="k">if</span> <span class="n">iteration</span><span class="p">[</span><span class="s2">&quot;step_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
</span><span id="_BaseReactLoop-124"><a href="#_BaseReactLoop-124"><span class="linenos">124</span></a>                            <span class="n">handler</span><span class="p">(</span><span class="n">iteration</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">messages</span><span class="p">)</span>
</span><span id="_BaseReactLoop-125"><a href="#_BaseReactLoop-125"><span class="linenos">125</span></a>                            <span class="n">handled</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="_BaseReactLoop-126"><a href="#_BaseReactLoop-126"><span class="linenos">126</span></a>                            <span class="k">break</span>
</span><span id="_BaseReactLoop-127"><a href="#_BaseReactLoop-127"><span class="linenos">127</span></a>                    
</span><span id="_BaseReactLoop-128"><a href="#_BaseReactLoop-128"><span class="linenos">128</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">handled</span><span class="p">:</span>
</span><span id="_BaseReactLoop-129"><a href="#_BaseReactLoop-129"><span class="linenos">129</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_handle_default</span><span class="p">(</span><span class="n">iteration</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">messages</span><span class="p">)</span>
</span><span id="_BaseReactLoop-130"><a href="#_BaseReactLoop-130"><span class="linenos">130</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="_BaseReactLoop-131"><a href="#_BaseReactLoop-131"><span class="linenos">131</span></a>                    <span class="c1"># Se non riesce a parsare, aggiungi come messaggio utente</span>
</span><span id="_BaseReactLoop-132"><a href="#_BaseReactLoop-132"><span class="linenos">132</span></a>                    <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">content</span><span class="p">})</span>
</span><span id="_BaseReactLoop-133"><a href="#_BaseReactLoop-133"><span class="linenos">133</span></a>
</span><span id="_BaseReactLoop-134"><a href="#_BaseReactLoop-134"><span class="linenos">134</span></a>            <span class="n">current_iter</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="_BaseReactLoop-135"><a href="#_BaseReactLoop-135"><span class="linenos">135</span></a>
</span><span id="_BaseReactLoop-136"><a href="#_BaseReactLoop-136"><span class="linenos">136</span></a>        <span class="k">return</span> <span class="n">response</span>
</span></pre></div>


            <div class="docstring"><p>Base class for all ReAct-style agents.</p>

<p>This class implements the standard loop for agents that use a ReAct-style
approach, where the model produces structured JSON responses that are
parsed and handled iteratively. The ReAct pattern combines reasoning
and acting in a step-by-step manner.</p>

<p>The base loop handles:</p>

<ul>
<li>Step-based reasoning format parsing</li>
<li>Tool action execution and observation</li>
<li>Final answer detection</li>
<li>Custom iteration handlers</li>
<li>Error handling and fallbacks</li>
</ul>

<h6 id="attributes">Attributes</h6>

<ul>
<li><strong>_max_iter</strong> (Optional[int]):
Maximum number of iterations allowed</li>
</ul>
</div>


                </section>
                <section id="FunctionCallingAgenticLoop">
                            <input id="FunctionCallingAgenticLoop-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">FunctionCallingAgenticLoop</span><wbr>(<span class="base"><a href="#_AgenticLoop">monoai.agents._AgenticLoop</a></span>, <span class="base"><a href="#_FunctionCallingMixin">monoai.agents._FunctionCallingMixin</a></span>):

                <label class="view-source-button" for="FunctionCallingAgenticLoop-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FunctionCallingAgenticLoop"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FunctionCallingAgenticLoop-15"><a href="#FunctionCallingAgenticLoop-15"><span class="linenos"> 15</span></a><span class="k">class</span><span class="w"> </span><span class="nc">FunctionCallingAgenticLoop</span><span class="p">(</span><span class="n">_AgenticLoop</span><span class="p">,</span> <span class="n">_FunctionCallingMixin</span><span class="p">):</span>
</span><span id="FunctionCallingAgenticLoop-16"><a href="#FunctionCallingAgenticLoop-16"><span class="linenos"> 16</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Agent that uses OpenAI&#39;s native function calling.</span>
</span><span id="FunctionCallingAgenticLoop-17"><a href="#FunctionCallingAgenticLoop-17"><span class="linenos"> 17</span></a><span class="sd">    </span>
</span><span id="FunctionCallingAgenticLoop-18"><a href="#FunctionCallingAgenticLoop-18"><span class="linenos"> 18</span></a><span class="sd">    This agent implements a loop that leverages OpenAI&#39;s native function calling</span>
</span><span id="FunctionCallingAgenticLoop-19"><a href="#FunctionCallingAgenticLoop-19"><span class="linenos"> 19</span></a><span class="sd">    system, allowing the model to directly call available functions without</span>
</span><span id="FunctionCallingAgenticLoop-20"><a href="#FunctionCallingAgenticLoop-20"><span class="linenos"> 20</span></a><span class="sd">    manual response parsing. This approach is more reliable and efficient</span>
</span><span id="FunctionCallingAgenticLoop-21"><a href="#FunctionCallingAgenticLoop-21"><span class="linenos"> 21</span></a><span class="sd">    than text-based tool calling.</span>
</span><span id="FunctionCallingAgenticLoop-22"><a href="#FunctionCallingAgenticLoop-22"><span class="linenos"> 22</span></a><span class="sd">    </span>
</span><span id="FunctionCallingAgenticLoop-23"><a href="#FunctionCallingAgenticLoop-23"><span class="linenos"> 23</span></a><span class="sd">    The agent automatically handles:</span>
</span><span id="FunctionCallingAgenticLoop-24"><a href="#FunctionCallingAgenticLoop-24"><span class="linenos"> 24</span></a><span class="sd">    - Function call detection and execution</span>
</span><span id="FunctionCallingAgenticLoop-25"><a href="#FunctionCallingAgenticLoop-25"><span class="linenos"> 25</span></a><span class="sd">    - Tool result integration into conversation</span>
</span><span id="FunctionCallingAgenticLoop-26"><a href="#FunctionCallingAgenticLoop-26"><span class="linenos"> 26</span></a><span class="sd">    - Iteration limits to prevent infinite loops</span>
</span><span id="FunctionCallingAgenticLoop-27"><a href="#FunctionCallingAgenticLoop-27"><span class="linenos"> 27</span></a><span class="sd">    - Streaming support for real-time responses</span>
</span><span id="FunctionCallingAgenticLoop-28"><a href="#FunctionCallingAgenticLoop-28"><span class="linenos"> 28</span></a><span class="sd">    </span>
</span><span id="FunctionCallingAgenticLoop-29"><a href="#FunctionCallingAgenticLoop-29"><span class="linenos"> 29</span></a><span class="sd">    Attributes</span>
</span><span id="FunctionCallingAgenticLoop-30"><a href="#FunctionCallingAgenticLoop-30"><span class="linenos"> 30</span></a><span class="sd">    ----------</span>
</span><span id="FunctionCallingAgenticLoop-31"><a href="#FunctionCallingAgenticLoop-31"><span class="linenos"> 31</span></a><span class="sd">    _model : Any</span>
</span><span id="FunctionCallingAgenticLoop-32"><a href="#FunctionCallingAgenticLoop-32"><span class="linenos"> 32</span></a><span class="sd">        OpenAI model with function calling support</span>
</span><span id="FunctionCallingAgenticLoop-33"><a href="#FunctionCallingAgenticLoop-33"><span class="linenos"> 33</span></a><span class="sd">    _tools : Dict[str, Any]</span>
</span><span id="FunctionCallingAgenticLoop-34"><a href="#FunctionCallingAgenticLoop-34"><span class="linenos"> 34</span></a><span class="sd">        Available tools for the agent</span>
</span><span id="FunctionCallingAgenticLoop-35"><a href="#FunctionCallingAgenticLoop-35"><span class="linenos"> 35</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="FunctionCallingAgenticLoop-36"><a href="#FunctionCallingAgenticLoop-36"><span class="linenos"> 36</span></a>    
</span><span id="FunctionCallingAgenticLoop-37"><a href="#FunctionCallingAgenticLoop-37"><span class="linenos"> 37</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_base_messages</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="FunctionCallingAgenticLoop-38"><a href="#FunctionCallingAgenticLoop-38"><span class="linenos"> 38</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate base messages for the specific agent type.</span>
</span><span id="FunctionCallingAgenticLoop-39"><a href="#FunctionCallingAgenticLoop-39"><span class="linenos"> 39</span></a><span class="sd">        </span>
</span><span id="FunctionCallingAgenticLoop-40"><a href="#FunctionCallingAgenticLoop-40"><span class="linenos"> 40</span></a><span class="sd">        This method creates the initial message structure for the agent,</span>
</span><span id="FunctionCallingAgenticLoop-41"><a href="#FunctionCallingAgenticLoop-41"><span class="linenos"> 41</span></a><span class="sd">        including the appropriate prompt template and user query. The</span>
</span><span id="FunctionCallingAgenticLoop-42"><a href="#FunctionCallingAgenticLoop-42"><span class="linenos"> 42</span></a><span class="sd">        prompt template is selected based on the agent type and includes</span>
</span><span id="FunctionCallingAgenticLoop-43"><a href="#FunctionCallingAgenticLoop-43"><span class="linenos"> 43</span></a><span class="sd">        information about available tools.</span>
</span><span id="FunctionCallingAgenticLoop-44"><a href="#FunctionCallingAgenticLoop-44"><span class="linenos"> 44</span></a><span class="sd">        </span>
</span><span id="FunctionCallingAgenticLoop-45"><a href="#FunctionCallingAgenticLoop-45"><span class="linenos"> 45</span></a><span class="sd">        Parameters</span>
</span><span id="FunctionCallingAgenticLoop-46"><a href="#FunctionCallingAgenticLoop-46"><span class="linenos"> 46</span></a><span class="sd">        ----------</span>
</span><span id="FunctionCallingAgenticLoop-47"><a href="#FunctionCallingAgenticLoop-47"><span class="linenos"> 47</span></a><span class="sd">        query : str</span>
</span><span id="FunctionCallingAgenticLoop-48"><a href="#FunctionCallingAgenticLoop-48"><span class="linenos"> 48</span></a><span class="sd">            User query to include in the prompt</span>
</span><span id="FunctionCallingAgenticLoop-49"><a href="#FunctionCallingAgenticLoop-49"><span class="linenos"> 49</span></a><span class="sd">        </span>
</span><span id="FunctionCallingAgenticLoop-50"><a href="#FunctionCallingAgenticLoop-50"><span class="linenos"> 50</span></a><span class="sd">        Returns</span>
</span><span id="FunctionCallingAgenticLoop-51"><a href="#FunctionCallingAgenticLoop-51"><span class="linenos"> 51</span></a><span class="sd">        -------</span>
</span><span id="FunctionCallingAgenticLoop-52"><a href="#FunctionCallingAgenticLoop-52"><span class="linenos"> 52</span></a><span class="sd">        List[Dict[str, Any]]</span>
</span><span id="FunctionCallingAgenticLoop-53"><a href="#FunctionCallingAgenticLoop-53"><span class="linenos"> 53</span></a><span class="sd">            List of base messages for the agent, including the prompt and query</span>
</span><span id="FunctionCallingAgenticLoop-54"><a href="#FunctionCallingAgenticLoop-54"><span class="linenos"> 54</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="FunctionCallingAgenticLoop-55"><a href="#FunctionCallingAgenticLoop-55"><span class="linenos"> 55</span></a>        <span class="n">messages</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="FunctionCallingAgenticLoop-56"><a href="#FunctionCallingAgenticLoop-56"><span class="linenos"> 56</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agentic_prompt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="FunctionCallingAgenticLoop-57"><a href="#FunctionCallingAgenticLoop-57"><span class="linenos"> 57</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_agentic_prompt</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="FunctionCallingAgenticLoop-58"><a href="#FunctionCallingAgenticLoop-58"><span class="linenos"> 58</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agentic_prompt</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.prompt&quot;</span><span class="p">):</span>
</span><span id="FunctionCallingAgenticLoop-59"><a href="#FunctionCallingAgenticLoop-59"><span class="linenos"> 59</span></a>                    <span class="n">agentic_prompt</span> <span class="o">=</span> <span class="n">Prompt</span><span class="p">(</span><span class="n">prompt_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_agentic_prompt</span><span class="p">,</span> <span class="n">is_system</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="FunctionCallingAgenticLoop-60"><a href="#FunctionCallingAgenticLoop-60"><span class="linenos"> 60</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="FunctionCallingAgenticLoop-61"><a href="#FunctionCallingAgenticLoop-61"><span class="linenos"> 61</span></a>                    <span class="n">agentic_prompt</span> <span class="o">=</span> <span class="n">Prompt</span><span class="p">(</span><span class="n">prompt</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_agentic_prompt</span><span class="p">,</span> <span class="n">is_system</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="FunctionCallingAgenticLoop-62"><a href="#FunctionCallingAgenticLoop-62"><span class="linenos"> 62</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="FunctionCallingAgenticLoop-63"><a href="#FunctionCallingAgenticLoop-63"><span class="linenos"> 63</span></a>                <span class="n">agentic_prompt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agentic_prompt</span>
</span><span id="FunctionCallingAgenticLoop-64"><a href="#FunctionCallingAgenticLoop-64"><span class="linenos"> 64</span></a>            <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">agentic_prompt</span><span class="o">.</span><span class="n">as_dict</span><span class="p">())</span>
</span><span id="FunctionCallingAgenticLoop-65"><a href="#FunctionCallingAgenticLoop-65"><span class="linenos"> 65</span></a>                    
</span><span id="FunctionCallingAgenticLoop-66"><a href="#FunctionCallingAgenticLoop-66"><span class="linenos"> 66</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">Prompt</span><span class="p">):</span>
</span><span id="FunctionCallingAgenticLoop-67"><a href="#FunctionCallingAgenticLoop-67"><span class="linenos"> 67</span></a>            <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">as_dict</span><span class="p">())</span>
</span><span id="FunctionCallingAgenticLoop-68"><a href="#FunctionCallingAgenticLoop-68"><span class="linenos"> 68</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="FunctionCallingAgenticLoop-69"><a href="#FunctionCallingAgenticLoop-69"><span class="linenos"> 69</span></a>            <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">query</span><span class="p">})</span>
</span><span id="FunctionCallingAgenticLoop-70"><a href="#FunctionCallingAgenticLoop-70"><span class="linenos"> 70</span></a>
</span><span id="FunctionCallingAgenticLoop-71"><a href="#FunctionCallingAgenticLoop-71"><span class="linenos"> 71</span></a>        <span class="k">return</span> <span class="n">messages</span>
</span><span id="FunctionCallingAgenticLoop-72"><a href="#FunctionCallingAgenticLoop-72"><span class="linenos"> 72</span></a>
</span><span id="FunctionCallingAgenticLoop-73"><a href="#FunctionCallingAgenticLoop-73"><span class="linenos"> 73</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="FunctionCallingAgenticLoop-74"><a href="#FunctionCallingAgenticLoop-74"><span class="linenos"> 74</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Start the agentic loop using function calling.</span>
</span><span id="FunctionCallingAgenticLoop-75"><a href="#FunctionCallingAgenticLoop-75"><span class="linenos"> 75</span></a><span class="sd">        </span>
</span><span id="FunctionCallingAgenticLoop-76"><a href="#FunctionCallingAgenticLoop-76"><span class="linenos"> 76</span></a><span class="sd">        This method processes user queries through OpenAI&#39;s function calling</span>
</span><span id="FunctionCallingAgenticLoop-77"><a href="#FunctionCallingAgenticLoop-77"><span class="linenos"> 77</span></a><span class="sd">        system, automatically executing tools when the model determines</span>
</span><span id="FunctionCallingAgenticLoop-78"><a href="#FunctionCallingAgenticLoop-78"><span class="linenos"> 78</span></a><span class="sd">        they are needed.</span>
</span><span id="FunctionCallingAgenticLoop-79"><a href="#FunctionCallingAgenticLoop-79"><span class="linenos"> 79</span></a><span class="sd">        </span>
</span><span id="FunctionCallingAgenticLoop-80"><a href="#FunctionCallingAgenticLoop-80"><span class="linenos"> 80</span></a><span class="sd">        Parameters</span>
</span><span id="FunctionCallingAgenticLoop-81"><a href="#FunctionCallingAgenticLoop-81"><span class="linenos"> 81</span></a><span class="sd">        ----------</span>
</span><span id="FunctionCallingAgenticLoop-82"><a href="#FunctionCallingAgenticLoop-82"><span class="linenos"> 82</span></a><span class="sd">        query : str</span>
</span><span id="FunctionCallingAgenticLoop-83"><a href="#FunctionCallingAgenticLoop-83"><span class="linenos"> 83</span></a><span class="sd">            User query to process</span>
</span><span id="FunctionCallingAgenticLoop-84"><a href="#FunctionCallingAgenticLoop-84"><span class="linenos"> 84</span></a><span class="sd">        </span>
</span><span id="FunctionCallingAgenticLoop-85"><a href="#FunctionCallingAgenticLoop-85"><span class="linenos"> 85</span></a><span class="sd">        Returns</span>
</span><span id="FunctionCallingAgenticLoop-86"><a href="#FunctionCallingAgenticLoop-86"><span class="linenos"> 86</span></a><span class="sd">        -------</span>
</span><span id="FunctionCallingAgenticLoop-87"><a href="#FunctionCallingAgenticLoop-87"><span class="linenos"> 87</span></a><span class="sd">        Dict[str, Any]</span>
</span><span id="FunctionCallingAgenticLoop-88"><a href="#FunctionCallingAgenticLoop-88"><span class="linenos"> 88</span></a><span class="sd">            Agent response containing:</span>
</span><span id="FunctionCallingAgenticLoop-89"><a href="#FunctionCallingAgenticLoop-89"><span class="linenos"> 89</span></a><span class="sd">            - prompt: Original user query</span>
</span><span id="FunctionCallingAgenticLoop-90"><a href="#FunctionCallingAgenticLoop-90"><span class="linenos"> 90</span></a><span class="sd">            - iterations: List of tool calls executed</span>
</span><span id="FunctionCallingAgenticLoop-91"><a href="#FunctionCallingAgenticLoop-91"><span class="linenos"> 91</span></a><span class="sd">            - response: Final model response</span>
</span><span id="FunctionCallingAgenticLoop-92"><a href="#FunctionCallingAgenticLoop-92"><span class="linenos"> 92</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="FunctionCallingAgenticLoop-93"><a href="#FunctionCallingAgenticLoop-93"><span class="linenos"> 93</span></a>        <span class="c1"># Add all tools to the model</span>
</span><span id="FunctionCallingAgenticLoop-94"><a href="#FunctionCallingAgenticLoop-94"><span class="linenos"> 94</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">_add_tools</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tools</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
</span><span id="FunctionCallingAgenticLoop-95"><a href="#FunctionCallingAgenticLoop-95"><span class="linenos"> 95</span></a>        <span class="n">messages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_base_messages</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</span><span id="FunctionCallingAgenticLoop-96"><a href="#FunctionCallingAgenticLoop-96"><span class="linenos"> 96</span></a>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_base_response</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</span><span id="FunctionCallingAgenticLoop-97"><a href="#FunctionCallingAgenticLoop-97"><span class="linenos"> 97</span></a>        <span class="n">current_iter</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="FunctionCallingAgenticLoop-98"><a href="#FunctionCallingAgenticLoop-98"><span class="linenos"> 98</span></a>        <span class="n">max_iterations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_iter</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_iter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">10</span>  <span class="c1"># Limite di sicurezza</span>
</span><span id="FunctionCallingAgenticLoop-99"><a href="#FunctionCallingAgenticLoop-99"><span class="linenos"> 99</span></a>        
</span><span id="FunctionCallingAgenticLoop-100"><a href="#FunctionCallingAgenticLoop-100"><span class="linenos">100</span></a>        <span class="k">while</span> <span class="n">current_iter</span> <span class="o">&lt;</span> <span class="n">max_iterations</span><span class="p">:</span>
</span><span id="FunctionCallingAgenticLoop-101"><a href="#FunctionCallingAgenticLoop-101"><span class="linenos">101</span></a>            
</span><span id="FunctionCallingAgenticLoop-102"><a href="#FunctionCallingAgenticLoop-102"><span class="linenos">102</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stream_callback</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="FunctionCallingAgenticLoop-103"><a href="#FunctionCallingAgenticLoop-103"><span class="linenos">103</span></a>                <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_model_step</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span>
</span><span id="FunctionCallingAgenticLoop-104"><a href="#FunctionCallingAgenticLoop-104"><span class="linenos">104</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="FunctionCallingAgenticLoop-105"><a href="#FunctionCallingAgenticLoop-105"><span class="linenos">105</span></a>                <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_model_step_stream</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span>
</span><span id="FunctionCallingAgenticLoop-106"><a href="#FunctionCallingAgenticLoop-106"><span class="linenos">106</span></a>
</span><span id="FunctionCallingAgenticLoop-107"><a href="#FunctionCallingAgenticLoop-107"><span class="linenos">107</span></a>            <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
</span><span id="FunctionCallingAgenticLoop-108"><a href="#FunctionCallingAgenticLoop-108"><span class="linenos">108</span></a>            <span class="n">content</span> <span class="o">=</span> <span class="n">resp</span><span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">]</span>
</span><span id="FunctionCallingAgenticLoop-109"><a href="#FunctionCallingAgenticLoop-109"><span class="linenos">109</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_debug_print</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</span><span id="FunctionCallingAgenticLoop-110"><a href="#FunctionCallingAgenticLoop-110"><span class="linenos">110</span></a>            
</span><span id="FunctionCallingAgenticLoop-111"><a href="#FunctionCallingAgenticLoop-111"><span class="linenos">111</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_usage</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">resp</span><span class="p">)</span>
</span><span id="FunctionCallingAgenticLoop-112"><a href="#FunctionCallingAgenticLoop-112"><span class="linenos">112</span></a>            
</span><span id="FunctionCallingAgenticLoop-113"><a href="#FunctionCallingAgenticLoop-113"><span class="linenos">113</span></a>            <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tool_calls&quot;</span><span class="p">):</span>
</span><span id="FunctionCallingAgenticLoop-114"><a href="#FunctionCallingAgenticLoop-114"><span class="linenos">114</span></a>                <span class="k">for</span> <span class="n">tool_call</span> <span class="ow">in</span> <span class="n">resp</span><span class="p">[</span><span class="s2">&quot;tool_calls&quot;</span><span class="p">]:</span>
</span><span id="FunctionCallingAgenticLoop-115"><a href="#FunctionCallingAgenticLoop-115"><span class="linenos">115</span></a>                    <span class="c1"># Check if human feedback is required for actions</span>
</span><span id="FunctionCallingAgenticLoop-116"><a href="#FunctionCallingAgenticLoop-116"><span class="linenos">116</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_human_feedback</span> <span class="o">==</span> <span class="s2">&quot;actions&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_human_feedback</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
</span><span id="FunctionCallingAgenticLoop-117"><a href="#FunctionCallingAgenticLoop-117"><span class="linenos">117</span></a>                        <span class="n">action_data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="FunctionCallingAgenticLoop-118"><a href="#FunctionCallingAgenticLoop-118"><span class="linenos">118</span></a>                            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">tool_call</span><span class="o">.</span><span class="n">function</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="FunctionCallingAgenticLoop-119"><a href="#FunctionCallingAgenticLoop-119"><span class="linenos">119</span></a>                            <span class="s2">&quot;arguments&quot;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">tool_call</span><span class="o">.</span><span class="n">function</span><span class="o">.</span><span class="n">arguments</span><span class="p">)</span> <span class="k">if</span> <span class="n">tool_call</span><span class="o">.</span><span class="n">function</span><span class="o">.</span><span class="n">arguments</span> <span class="k">else</span> <span class="p">{}</span>
</span><span id="FunctionCallingAgenticLoop-120"><a href="#FunctionCallingAgenticLoop-120"><span class="linenos">120</span></a>                        <span class="p">}</span>
</span><span id="FunctionCallingAgenticLoop-121"><a href="#FunctionCallingAgenticLoop-121"><span class="linenos">121</span></a>                        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request_human_feedback</span><span class="p">(</span><span class="s2">&quot;action&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Function call: </span><span class="si">{</span><span class="n">tool_call</span><span class="o">.</span><span class="n">function</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">action_data</span><span class="p">):</span>
</span><span id="FunctionCallingAgenticLoop-122"><a href="#FunctionCallingAgenticLoop-122"><span class="linenos">122</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Execution stopped by user.&quot;</span><span class="p">)</span>
</span><span id="FunctionCallingAgenticLoop-123"><a href="#FunctionCallingAgenticLoop-123"><span class="linenos">123</span></a>                            <span class="k">return</span> <span class="n">response</span>
</span><span id="FunctionCallingAgenticLoop-124"><a href="#FunctionCallingAgenticLoop-124"><span class="linenos">124</span></a>                    
</span><span id="FunctionCallingAgenticLoop-125"><a href="#FunctionCallingAgenticLoop-125"><span class="linenos">125</span></a>                    <span class="k">if</span> <span class="n">tool_call</span><span class="o">.</span><span class="n">function</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;mcp_&quot;</span><span class="p">):</span>
</span><span id="FunctionCallingAgenticLoop-126"><a href="#FunctionCallingAgenticLoop-126"><span class="linenos">126</span></a>                        <span class="n">tool_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_mcp_tool</span><span class="p">(</span><span class="n">tool_call</span><span class="p">)</span>
</span><span id="FunctionCallingAgenticLoop-127"><a href="#FunctionCallingAgenticLoop-127"><span class="linenos">127</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="FunctionCallingAgenticLoop-128"><a href="#FunctionCallingAgenticLoop-128"><span class="linenos">128</span></a>                        <span class="n">tool_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_tool</span><span class="p">(</span><span class="n">tool_call</span><span class="p">)</span>
</span><span id="FunctionCallingAgenticLoop-129"><a href="#FunctionCallingAgenticLoop-129"><span class="linenos">129</span></a>                    <span class="n">iteration_data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="FunctionCallingAgenticLoop-130"><a href="#FunctionCallingAgenticLoop-130"><span class="linenos">130</span></a>                        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">tool_call</span><span class="o">.</span><span class="n">function</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="FunctionCallingAgenticLoop-131"><a href="#FunctionCallingAgenticLoop-131"><span class="linenos">131</span></a>                        <span class="s2">&quot;arguments&quot;</span><span class="p">:</span> <span class="n">tool_call</span><span class="o">.</span><span class="n">function</span><span class="o">.</span><span class="n">arguments</span><span class="p">,</span>
</span><span id="FunctionCallingAgenticLoop-132"><a href="#FunctionCallingAgenticLoop-132"><span class="linenos">132</span></a>                        <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="n">tool_result</span><span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">]</span>
</span><span id="FunctionCallingAgenticLoop-133"><a href="#FunctionCallingAgenticLoop-133"><span class="linenos">133</span></a>                    <span class="p">}</span>
</span><span id="FunctionCallingAgenticLoop-134"><a href="#FunctionCallingAgenticLoop-134"><span class="linenos">134</span></a>                    
</span><span id="FunctionCallingAgenticLoop-135"><a href="#FunctionCallingAgenticLoop-135"><span class="linenos">135</span></a>                    <span class="c1"># Add usage information to the iteration</span>
</span><span id="FunctionCallingAgenticLoop-136"><a href="#FunctionCallingAgenticLoop-136"><span class="linenos">136</span></a>                    <span class="k">if</span> <span class="s2">&quot;usage&quot;</span> <span class="ow">in</span> <span class="n">resp</span><span class="p">:</span>
</span><span id="FunctionCallingAgenticLoop-137"><a href="#FunctionCallingAgenticLoop-137"><span class="linenos">137</span></a>                        <span class="n">iteration_data</span><span class="p">[</span><span class="s2">&quot;usage&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">resp</span><span class="p">[</span><span class="s2">&quot;usage&quot;</span><span class="p">]</span>
</span><span id="FunctionCallingAgenticLoop-138"><a href="#FunctionCallingAgenticLoop-138"><span class="linenos">138</span></a>                    
</span><span id="FunctionCallingAgenticLoop-139"><a href="#FunctionCallingAgenticLoop-139"><span class="linenos">139</span></a>                    <span class="n">response</span><span class="p">[</span><span class="s2">&quot;iterations&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iteration_data</span><span class="p">)</span>
</span><span id="FunctionCallingAgenticLoop-140"><a href="#FunctionCallingAgenticLoop-140"><span class="linenos">140</span></a>                    <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tool_result</span><span class="p">)</span>
</span><span id="FunctionCallingAgenticLoop-141"><a href="#FunctionCallingAgenticLoop-141"><span class="linenos">141</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="FunctionCallingAgenticLoop-142"><a href="#FunctionCallingAgenticLoop-142"><span class="linenos">142</span></a>                <span class="c1"># Check if human feedback is required for all steps (non-action responses)</span>
</span><span id="FunctionCallingAgenticLoop-143"><a href="#FunctionCallingAgenticLoop-143"><span class="linenos">143</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_human_feedback</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
</span><span id="FunctionCallingAgenticLoop-144"><a href="#FunctionCallingAgenticLoop-144"><span class="linenos">144</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request_human_feedback</span><span class="p">(</span><span class="s2">&quot;response&quot;</span><span class="p">,</span> <span class="n">content</span><span class="p">):</span>
</span><span id="FunctionCallingAgenticLoop-145"><a href="#FunctionCallingAgenticLoop-145"><span class="linenos">145</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Execution stopped by user.&quot;</span><span class="p">)</span>
</span><span id="FunctionCallingAgenticLoop-146"><a href="#FunctionCallingAgenticLoop-146"><span class="linenos">146</span></a>                        <span class="k">return</span> <span class="n">response</span>
</span><span id="FunctionCallingAgenticLoop-147"><a href="#FunctionCallingAgenticLoop-147"><span class="linenos">147</span></a>                
</span><span id="FunctionCallingAgenticLoop-148"><a href="#FunctionCallingAgenticLoop-148"><span class="linenos">148</span></a>                <span class="n">response</span><span class="p">[</span><span class="s2">&quot;response&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">content</span>
</span><span id="FunctionCallingAgenticLoop-149"><a href="#FunctionCallingAgenticLoop-149"><span class="linenos">149</span></a>                <span class="k">break</span>
</span><span id="FunctionCallingAgenticLoop-150"><a href="#FunctionCallingAgenticLoop-150"><span class="linenos">150</span></a>            
</span><span id="FunctionCallingAgenticLoop-151"><a href="#FunctionCallingAgenticLoop-151"><span class="linenos">151</span></a>            <span class="n">current_iter</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="FunctionCallingAgenticLoop-152"><a href="#FunctionCallingAgenticLoop-152"><span class="linenos">152</span></a>        
</span><span id="FunctionCallingAgenticLoop-153"><a href="#FunctionCallingAgenticLoop-153"><span class="linenos">153</span></a>        <span class="c1"># Se arriviamo qui, abbiamo raggiunto il limite di iterazioni</span>
</span><span id="FunctionCallingAgenticLoop-154"><a href="#FunctionCallingAgenticLoop-154"><span class="linenos">154</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_debug</span><span class="p">:</span>
</span><span id="FunctionCallingAgenticLoop-155"><a href="#FunctionCallingAgenticLoop-155"><span class="linenos">155</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Raggiunto limite di iterazioni (</span><span class="si">{</span><span class="n">max_iterations</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</span><span id="FunctionCallingAgenticLoop-156"><a href="#FunctionCallingAgenticLoop-156"><span class="linenos">156</span></a>        
</span><span id="FunctionCallingAgenticLoop-157"><a href="#FunctionCallingAgenticLoop-157"><span class="linenos">157</span></a>        <span class="k">return</span> <span class="n">response</span>
</span></pre></div>


            <div class="docstring"><p>Agent that uses OpenAI's native function calling.</p>

<p>This agent implements a loop that leverages OpenAI's native function calling
system, allowing the model to directly call available functions without
manual response parsing. This approach is more reliable and efficient
than text-based tool calling.</p>

<p>The agent automatically handles:</p>

<ul>
<li>Function call detection and execution</li>
<li>Tool result integration into conversation</li>
<li>Iteration limits to prevent infinite loops</li>
<li>Streaming support for real-time responses</li>
</ul>

<h6 id="attributes">Attributes</h6>

<ul>
<li><strong>_model</strong> (Any):
OpenAI model with function calling support</li>
<li><strong>_tools</strong> (Dict[str, Any]):
Available tools for the agent</li>
</ul>
</div>


                            <div id="FunctionCallingAgenticLoop.start" class="classattr">
                                        <input id="FunctionCallingAgenticLoop.start-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">start</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">query</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="FunctionCallingAgenticLoop.start-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FunctionCallingAgenticLoop.start"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FunctionCallingAgenticLoop.start-73"><a href="#FunctionCallingAgenticLoop.start-73"><span class="linenos"> 73</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="FunctionCallingAgenticLoop.start-74"><a href="#FunctionCallingAgenticLoop.start-74"><span class="linenos"> 74</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Start the agentic loop using function calling.</span>
</span><span id="FunctionCallingAgenticLoop.start-75"><a href="#FunctionCallingAgenticLoop.start-75"><span class="linenos"> 75</span></a><span class="sd">        </span>
</span><span id="FunctionCallingAgenticLoop.start-76"><a href="#FunctionCallingAgenticLoop.start-76"><span class="linenos"> 76</span></a><span class="sd">        This method processes user queries through OpenAI&#39;s function calling</span>
</span><span id="FunctionCallingAgenticLoop.start-77"><a href="#FunctionCallingAgenticLoop.start-77"><span class="linenos"> 77</span></a><span class="sd">        system, automatically executing tools when the model determines</span>
</span><span id="FunctionCallingAgenticLoop.start-78"><a href="#FunctionCallingAgenticLoop.start-78"><span class="linenos"> 78</span></a><span class="sd">        they are needed.</span>
</span><span id="FunctionCallingAgenticLoop.start-79"><a href="#FunctionCallingAgenticLoop.start-79"><span class="linenos"> 79</span></a><span class="sd">        </span>
</span><span id="FunctionCallingAgenticLoop.start-80"><a href="#FunctionCallingAgenticLoop.start-80"><span class="linenos"> 80</span></a><span class="sd">        Parameters</span>
</span><span id="FunctionCallingAgenticLoop.start-81"><a href="#FunctionCallingAgenticLoop.start-81"><span class="linenos"> 81</span></a><span class="sd">        ----------</span>
</span><span id="FunctionCallingAgenticLoop.start-82"><a href="#FunctionCallingAgenticLoop.start-82"><span class="linenos"> 82</span></a><span class="sd">        query : str</span>
</span><span id="FunctionCallingAgenticLoop.start-83"><a href="#FunctionCallingAgenticLoop.start-83"><span class="linenos"> 83</span></a><span class="sd">            User query to process</span>
</span><span id="FunctionCallingAgenticLoop.start-84"><a href="#FunctionCallingAgenticLoop.start-84"><span class="linenos"> 84</span></a><span class="sd">        </span>
</span><span id="FunctionCallingAgenticLoop.start-85"><a href="#FunctionCallingAgenticLoop.start-85"><span class="linenos"> 85</span></a><span class="sd">        Returns</span>
</span><span id="FunctionCallingAgenticLoop.start-86"><a href="#FunctionCallingAgenticLoop.start-86"><span class="linenos"> 86</span></a><span class="sd">        -------</span>
</span><span id="FunctionCallingAgenticLoop.start-87"><a href="#FunctionCallingAgenticLoop.start-87"><span class="linenos"> 87</span></a><span class="sd">        Dict[str, Any]</span>
</span><span id="FunctionCallingAgenticLoop.start-88"><a href="#FunctionCallingAgenticLoop.start-88"><span class="linenos"> 88</span></a><span class="sd">            Agent response containing:</span>
</span><span id="FunctionCallingAgenticLoop.start-89"><a href="#FunctionCallingAgenticLoop.start-89"><span class="linenos"> 89</span></a><span class="sd">            - prompt: Original user query</span>
</span><span id="FunctionCallingAgenticLoop.start-90"><a href="#FunctionCallingAgenticLoop.start-90"><span class="linenos"> 90</span></a><span class="sd">            - iterations: List of tool calls executed</span>
</span><span id="FunctionCallingAgenticLoop.start-91"><a href="#FunctionCallingAgenticLoop.start-91"><span class="linenos"> 91</span></a><span class="sd">            - response: Final model response</span>
</span><span id="FunctionCallingAgenticLoop.start-92"><a href="#FunctionCallingAgenticLoop.start-92"><span class="linenos"> 92</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="FunctionCallingAgenticLoop.start-93"><a href="#FunctionCallingAgenticLoop.start-93"><span class="linenos"> 93</span></a>        <span class="c1"># Add all tools to the model</span>
</span><span id="FunctionCallingAgenticLoop.start-94"><a href="#FunctionCallingAgenticLoop.start-94"><span class="linenos"> 94</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">_add_tools</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tools</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
</span><span id="FunctionCallingAgenticLoop.start-95"><a href="#FunctionCallingAgenticLoop.start-95"><span class="linenos"> 95</span></a>        <span class="n">messages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_base_messages</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</span><span id="FunctionCallingAgenticLoop.start-96"><a href="#FunctionCallingAgenticLoop.start-96"><span class="linenos"> 96</span></a>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_base_response</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</span><span id="FunctionCallingAgenticLoop.start-97"><a href="#FunctionCallingAgenticLoop.start-97"><span class="linenos"> 97</span></a>        <span class="n">current_iter</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="FunctionCallingAgenticLoop.start-98"><a href="#FunctionCallingAgenticLoop.start-98"><span class="linenos"> 98</span></a>        <span class="n">max_iterations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_iter</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_iter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">10</span>  <span class="c1"># Limite di sicurezza</span>
</span><span id="FunctionCallingAgenticLoop.start-99"><a href="#FunctionCallingAgenticLoop.start-99"><span class="linenos"> 99</span></a>        
</span><span id="FunctionCallingAgenticLoop.start-100"><a href="#FunctionCallingAgenticLoop.start-100"><span class="linenos">100</span></a>        <span class="k">while</span> <span class="n">current_iter</span> <span class="o">&lt;</span> <span class="n">max_iterations</span><span class="p">:</span>
</span><span id="FunctionCallingAgenticLoop.start-101"><a href="#FunctionCallingAgenticLoop.start-101"><span class="linenos">101</span></a>            
</span><span id="FunctionCallingAgenticLoop.start-102"><a href="#FunctionCallingAgenticLoop.start-102"><span class="linenos">102</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stream_callback</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="FunctionCallingAgenticLoop.start-103"><a href="#FunctionCallingAgenticLoop.start-103"><span class="linenos">103</span></a>                <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_model_step</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span>
</span><span id="FunctionCallingAgenticLoop.start-104"><a href="#FunctionCallingAgenticLoop.start-104"><span class="linenos">104</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="FunctionCallingAgenticLoop.start-105"><a href="#FunctionCallingAgenticLoop.start-105"><span class="linenos">105</span></a>                <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_model_step_stream</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span>
</span><span id="FunctionCallingAgenticLoop.start-106"><a href="#FunctionCallingAgenticLoop.start-106"><span class="linenos">106</span></a>
</span><span id="FunctionCallingAgenticLoop.start-107"><a href="#FunctionCallingAgenticLoop.start-107"><span class="linenos">107</span></a>            <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
</span><span id="FunctionCallingAgenticLoop.start-108"><a href="#FunctionCallingAgenticLoop.start-108"><span class="linenos">108</span></a>            <span class="n">content</span> <span class="o">=</span> <span class="n">resp</span><span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">]</span>
</span><span id="FunctionCallingAgenticLoop.start-109"><a href="#FunctionCallingAgenticLoop.start-109"><span class="linenos">109</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_debug_print</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</span><span id="FunctionCallingAgenticLoop.start-110"><a href="#FunctionCallingAgenticLoop.start-110"><span class="linenos">110</span></a>            
</span><span id="FunctionCallingAgenticLoop.start-111"><a href="#FunctionCallingAgenticLoop.start-111"><span class="linenos">111</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_usage</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">resp</span><span class="p">)</span>
</span><span id="FunctionCallingAgenticLoop.start-112"><a href="#FunctionCallingAgenticLoop.start-112"><span class="linenos">112</span></a>            
</span><span id="FunctionCallingAgenticLoop.start-113"><a href="#FunctionCallingAgenticLoop.start-113"><span class="linenos">113</span></a>            <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tool_calls&quot;</span><span class="p">):</span>
</span><span id="FunctionCallingAgenticLoop.start-114"><a href="#FunctionCallingAgenticLoop.start-114"><span class="linenos">114</span></a>                <span class="k">for</span> <span class="n">tool_call</span> <span class="ow">in</span> <span class="n">resp</span><span class="p">[</span><span class="s2">&quot;tool_calls&quot;</span><span class="p">]:</span>
</span><span id="FunctionCallingAgenticLoop.start-115"><a href="#FunctionCallingAgenticLoop.start-115"><span class="linenos">115</span></a>                    <span class="c1"># Check if human feedback is required for actions</span>
</span><span id="FunctionCallingAgenticLoop.start-116"><a href="#FunctionCallingAgenticLoop.start-116"><span class="linenos">116</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_human_feedback</span> <span class="o">==</span> <span class="s2">&quot;actions&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_human_feedback</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
</span><span id="FunctionCallingAgenticLoop.start-117"><a href="#FunctionCallingAgenticLoop.start-117"><span class="linenos">117</span></a>                        <span class="n">action_data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="FunctionCallingAgenticLoop.start-118"><a href="#FunctionCallingAgenticLoop.start-118"><span class="linenos">118</span></a>                            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">tool_call</span><span class="o">.</span><span class="n">function</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="FunctionCallingAgenticLoop.start-119"><a href="#FunctionCallingAgenticLoop.start-119"><span class="linenos">119</span></a>                            <span class="s2">&quot;arguments&quot;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">tool_call</span><span class="o">.</span><span class="n">function</span><span class="o">.</span><span class="n">arguments</span><span class="p">)</span> <span class="k">if</span> <span class="n">tool_call</span><span class="o">.</span><span class="n">function</span><span class="o">.</span><span class="n">arguments</span> <span class="k">else</span> <span class="p">{}</span>
</span><span id="FunctionCallingAgenticLoop.start-120"><a href="#FunctionCallingAgenticLoop.start-120"><span class="linenos">120</span></a>                        <span class="p">}</span>
</span><span id="FunctionCallingAgenticLoop.start-121"><a href="#FunctionCallingAgenticLoop.start-121"><span class="linenos">121</span></a>                        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request_human_feedback</span><span class="p">(</span><span class="s2">&quot;action&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Function call: </span><span class="si">{</span><span class="n">tool_call</span><span class="o">.</span><span class="n">function</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">action_data</span><span class="p">):</span>
</span><span id="FunctionCallingAgenticLoop.start-122"><a href="#FunctionCallingAgenticLoop.start-122"><span class="linenos">122</span></a>                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Execution stopped by user.&quot;</span><span class="p">)</span>
</span><span id="FunctionCallingAgenticLoop.start-123"><a href="#FunctionCallingAgenticLoop.start-123"><span class="linenos">123</span></a>                            <span class="k">return</span> <span class="n">response</span>
</span><span id="FunctionCallingAgenticLoop.start-124"><a href="#FunctionCallingAgenticLoop.start-124"><span class="linenos">124</span></a>                    
</span><span id="FunctionCallingAgenticLoop.start-125"><a href="#FunctionCallingAgenticLoop.start-125"><span class="linenos">125</span></a>                    <span class="k">if</span> <span class="n">tool_call</span><span class="o">.</span><span class="n">function</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;mcp_&quot;</span><span class="p">):</span>
</span><span id="FunctionCallingAgenticLoop.start-126"><a href="#FunctionCallingAgenticLoop.start-126"><span class="linenos">126</span></a>                        <span class="n">tool_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_mcp_tool</span><span class="p">(</span><span class="n">tool_call</span><span class="p">)</span>
</span><span id="FunctionCallingAgenticLoop.start-127"><a href="#FunctionCallingAgenticLoop.start-127"><span class="linenos">127</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="FunctionCallingAgenticLoop.start-128"><a href="#FunctionCallingAgenticLoop.start-128"><span class="linenos">128</span></a>                        <span class="n">tool_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_tool</span><span class="p">(</span><span class="n">tool_call</span><span class="p">)</span>
</span><span id="FunctionCallingAgenticLoop.start-129"><a href="#FunctionCallingAgenticLoop.start-129"><span class="linenos">129</span></a>                    <span class="n">iteration_data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="FunctionCallingAgenticLoop.start-130"><a href="#FunctionCallingAgenticLoop.start-130"><span class="linenos">130</span></a>                        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">tool_call</span><span class="o">.</span><span class="n">function</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
</span><span id="FunctionCallingAgenticLoop.start-131"><a href="#FunctionCallingAgenticLoop.start-131"><span class="linenos">131</span></a>                        <span class="s2">&quot;arguments&quot;</span><span class="p">:</span> <span class="n">tool_call</span><span class="o">.</span><span class="n">function</span><span class="o">.</span><span class="n">arguments</span><span class="p">,</span>
</span><span id="FunctionCallingAgenticLoop.start-132"><a href="#FunctionCallingAgenticLoop.start-132"><span class="linenos">132</span></a>                        <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="n">tool_result</span><span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">]</span>
</span><span id="FunctionCallingAgenticLoop.start-133"><a href="#FunctionCallingAgenticLoop.start-133"><span class="linenos">133</span></a>                    <span class="p">}</span>
</span><span id="FunctionCallingAgenticLoop.start-134"><a href="#FunctionCallingAgenticLoop.start-134"><span class="linenos">134</span></a>                    
</span><span id="FunctionCallingAgenticLoop.start-135"><a href="#FunctionCallingAgenticLoop.start-135"><span class="linenos">135</span></a>                    <span class="c1"># Add usage information to the iteration</span>
</span><span id="FunctionCallingAgenticLoop.start-136"><a href="#FunctionCallingAgenticLoop.start-136"><span class="linenos">136</span></a>                    <span class="k">if</span> <span class="s2">&quot;usage&quot;</span> <span class="ow">in</span> <span class="n">resp</span><span class="p">:</span>
</span><span id="FunctionCallingAgenticLoop.start-137"><a href="#FunctionCallingAgenticLoop.start-137"><span class="linenos">137</span></a>                        <span class="n">iteration_data</span><span class="p">[</span><span class="s2">&quot;usage&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">resp</span><span class="p">[</span><span class="s2">&quot;usage&quot;</span><span class="p">]</span>
</span><span id="FunctionCallingAgenticLoop.start-138"><a href="#FunctionCallingAgenticLoop.start-138"><span class="linenos">138</span></a>                    
</span><span id="FunctionCallingAgenticLoop.start-139"><a href="#FunctionCallingAgenticLoop.start-139"><span class="linenos">139</span></a>                    <span class="n">response</span><span class="p">[</span><span class="s2">&quot;iterations&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iteration_data</span><span class="p">)</span>
</span><span id="FunctionCallingAgenticLoop.start-140"><a href="#FunctionCallingAgenticLoop.start-140"><span class="linenos">140</span></a>                    <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tool_result</span><span class="p">)</span>
</span><span id="FunctionCallingAgenticLoop.start-141"><a href="#FunctionCallingAgenticLoop.start-141"><span class="linenos">141</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="FunctionCallingAgenticLoop.start-142"><a href="#FunctionCallingAgenticLoop.start-142"><span class="linenos">142</span></a>                <span class="c1"># Check if human feedback is required for all steps (non-action responses)</span>
</span><span id="FunctionCallingAgenticLoop.start-143"><a href="#FunctionCallingAgenticLoop.start-143"><span class="linenos">143</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_human_feedback</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
</span><span id="FunctionCallingAgenticLoop.start-144"><a href="#FunctionCallingAgenticLoop.start-144"><span class="linenos">144</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_request_human_feedback</span><span class="p">(</span><span class="s2">&quot;response&quot;</span><span class="p">,</span> <span class="n">content</span><span class="p">):</span>
</span><span id="FunctionCallingAgenticLoop.start-145"><a href="#FunctionCallingAgenticLoop.start-145"><span class="linenos">145</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Execution stopped by user.&quot;</span><span class="p">)</span>
</span><span id="FunctionCallingAgenticLoop.start-146"><a href="#FunctionCallingAgenticLoop.start-146"><span class="linenos">146</span></a>                        <span class="k">return</span> <span class="n">response</span>
</span><span id="FunctionCallingAgenticLoop.start-147"><a href="#FunctionCallingAgenticLoop.start-147"><span class="linenos">147</span></a>                
</span><span id="FunctionCallingAgenticLoop.start-148"><a href="#FunctionCallingAgenticLoop.start-148"><span class="linenos">148</span></a>                <span class="n">response</span><span class="p">[</span><span class="s2">&quot;response&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">content</span>
</span><span id="FunctionCallingAgenticLoop.start-149"><a href="#FunctionCallingAgenticLoop.start-149"><span class="linenos">149</span></a>                <span class="k">break</span>
</span><span id="FunctionCallingAgenticLoop.start-150"><a href="#FunctionCallingAgenticLoop.start-150"><span class="linenos">150</span></a>            
</span><span id="FunctionCallingAgenticLoop.start-151"><a href="#FunctionCallingAgenticLoop.start-151"><span class="linenos">151</span></a>            <span class="n">current_iter</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="FunctionCallingAgenticLoop.start-152"><a href="#FunctionCallingAgenticLoop.start-152"><span class="linenos">152</span></a>        
</span><span id="FunctionCallingAgenticLoop.start-153"><a href="#FunctionCallingAgenticLoop.start-153"><span class="linenos">153</span></a>        <span class="c1"># Se arriviamo qui, abbiamo raggiunto il limite di iterazioni</span>
</span><span id="FunctionCallingAgenticLoop.start-154"><a href="#FunctionCallingAgenticLoop.start-154"><span class="linenos">154</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_debug</span><span class="p">:</span>
</span><span id="FunctionCallingAgenticLoop.start-155"><a href="#FunctionCallingAgenticLoop.start-155"><span class="linenos">155</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Raggiunto limite di iterazioni (</span><span class="si">{</span><span class="n">max_iterations</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</span><span id="FunctionCallingAgenticLoop.start-156"><a href="#FunctionCallingAgenticLoop.start-156"><span class="linenos">156</span></a>        
</span><span id="FunctionCallingAgenticLoop.start-157"><a href="#FunctionCallingAgenticLoop.start-157"><span class="linenos">157</span></a>        <span class="k">return</span> <span class="n">response</span>
</span></pre></div>


            <div class="docstring"><p>Start the agentic loop using function calling.</p>

<p>This method processes user queries through OpenAI's function calling
system, automatically executing tools when the model determines
they are needed.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>query</strong> (str):
User query to process</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>Dict[str, Any]</strong>: Agent response containing:
<ul>
<li>prompt: Original user query</li>
<li>iterations: List of tool calls executed</li>
<li>response: Final model response</li>
</ul></li>
</ul>
</div>


                            </div>
                </section>
                <section id="ReactAgenticLoop">
                            <input id="ReactAgenticLoop-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ReactAgenticLoop</span><wbr>(<span class="base"><a href="#_BaseReactLoop">monoai.agents._BaseReactLoop</a></span>):

                <label class="view-source-button" for="ReactAgenticLoop-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ReactAgenticLoop"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ReactAgenticLoop-139"><a href="#ReactAgenticLoop-139"><span class="linenos">139</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ReactAgenticLoop</span><span class="p">(</span><span class="n">_BaseReactLoop</span><span class="p">):</span>
</span><span id="ReactAgenticLoop-140"><a href="#ReactAgenticLoop-140"><span class="linenos">140</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Standard ReAct agent.</span>
</span><span id="ReactAgenticLoop-141"><a href="#ReactAgenticLoop-141"><span class="linenos">141</span></a><span class="sd">    </span>
</span><span id="ReactAgenticLoop-142"><a href="#ReactAgenticLoop-142"><span class="linenos">142</span></a><span class="sd">    This agent implements the standard ReAct pattern, where the model</span>
</span><span id="ReactAgenticLoop-143"><a href="#ReactAgenticLoop-143"><span class="linenos">143</span></a><span class="sd">    produces JSON responses that are parsed and handled iteratively.</span>
</span><span id="ReactAgenticLoop-144"><a href="#ReactAgenticLoop-144"><span class="linenos">144</span></a><span class="sd">    The ReAct pattern combines reasoning and acting in a structured way.</span>
</span><span id="ReactAgenticLoop-145"><a href="#ReactAgenticLoop-145"><span class="linenos">145</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="ReactAgenticLoop-146"><a href="#ReactAgenticLoop-146"><span class="linenos">146</span></a>    
</span><span id="ReactAgenticLoop-147"><a href="#ReactAgenticLoop-147"><span class="linenos">147</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="ReactAgenticLoop-148"><a href="#ReactAgenticLoop-148"><span class="linenos">148</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Start the ReAct agentic loop.</span>
</span><span id="ReactAgenticLoop-149"><a href="#ReactAgenticLoop-149"><span class="linenos">149</span></a><span class="sd">        </span>
</span><span id="ReactAgenticLoop-150"><a href="#ReactAgenticLoop-150"><span class="linenos">150</span></a><span class="sd">        Parameters</span>
</span><span id="ReactAgenticLoop-151"><a href="#ReactAgenticLoop-151"><span class="linenos">151</span></a><span class="sd">        ----------</span>
</span><span id="ReactAgenticLoop-152"><a href="#ReactAgenticLoop-152"><span class="linenos">152</span></a><span class="sd">        query : str</span>
</span><span id="ReactAgenticLoop-153"><a href="#ReactAgenticLoop-153"><span class="linenos">153</span></a><span class="sd">            User query to process</span>
</span><span id="ReactAgenticLoop-154"><a href="#ReactAgenticLoop-154"><span class="linenos">154</span></a><span class="sd">        </span>
</span><span id="ReactAgenticLoop-155"><a href="#ReactAgenticLoop-155"><span class="linenos">155</span></a><span class="sd">        Returns</span>
</span><span id="ReactAgenticLoop-156"><a href="#ReactAgenticLoop-156"><span class="linenos">156</span></a><span class="sd">        -------</span>
</span><span id="ReactAgenticLoop-157"><a href="#ReactAgenticLoop-157"><span class="linenos">157</span></a><span class="sd">        Dict[str, Any]</span>
</span><span id="ReactAgenticLoop-158"><a href="#ReactAgenticLoop-158"><span class="linenos">158</span></a><span class="sd">            Agent response processed through the ReAct loop</span>
</span><span id="ReactAgenticLoop-159"><a href="#ReactAgenticLoop-159"><span class="linenos">159</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ReactAgenticLoop-160"><a href="#ReactAgenticLoop-160"><span class="linenos">160</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_react_loop</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="s2">&quot;react&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Standard ReAct agent.</p>

<p>This agent implements the standard ReAct pattern, where the model
produces JSON responses that are parsed and handled iteratively.
The ReAct pattern combines reasoning and acting in a structured way.</p>
</div>


                            <div id="ReactAgenticLoop.start" class="classattr">
                                        <input id="ReactAgenticLoop.start-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">start</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">query</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="ReactAgenticLoop.start-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ReactAgenticLoop.start"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ReactAgenticLoop.start-147"><a href="#ReactAgenticLoop.start-147"><span class="linenos">147</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="ReactAgenticLoop.start-148"><a href="#ReactAgenticLoop.start-148"><span class="linenos">148</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Start the ReAct agentic loop.</span>
</span><span id="ReactAgenticLoop.start-149"><a href="#ReactAgenticLoop.start-149"><span class="linenos">149</span></a><span class="sd">        </span>
</span><span id="ReactAgenticLoop.start-150"><a href="#ReactAgenticLoop.start-150"><span class="linenos">150</span></a><span class="sd">        Parameters</span>
</span><span id="ReactAgenticLoop.start-151"><a href="#ReactAgenticLoop.start-151"><span class="linenos">151</span></a><span class="sd">        ----------</span>
</span><span id="ReactAgenticLoop.start-152"><a href="#ReactAgenticLoop.start-152"><span class="linenos">152</span></a><span class="sd">        query : str</span>
</span><span id="ReactAgenticLoop.start-153"><a href="#ReactAgenticLoop.start-153"><span class="linenos">153</span></a><span class="sd">            User query to process</span>
</span><span id="ReactAgenticLoop.start-154"><a href="#ReactAgenticLoop.start-154"><span class="linenos">154</span></a><span class="sd">        </span>
</span><span id="ReactAgenticLoop.start-155"><a href="#ReactAgenticLoop.start-155"><span class="linenos">155</span></a><span class="sd">        Returns</span>
</span><span id="ReactAgenticLoop.start-156"><a href="#ReactAgenticLoop.start-156"><span class="linenos">156</span></a><span class="sd">        -------</span>
</span><span id="ReactAgenticLoop.start-157"><a href="#ReactAgenticLoop.start-157"><span class="linenos">157</span></a><span class="sd">        Dict[str, Any]</span>
</span><span id="ReactAgenticLoop.start-158"><a href="#ReactAgenticLoop.start-158"><span class="linenos">158</span></a><span class="sd">            Agent response processed through the ReAct loop</span>
</span><span id="ReactAgenticLoop.start-159"><a href="#ReactAgenticLoop.start-159"><span class="linenos">159</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ReactAgenticLoop.start-160"><a href="#ReactAgenticLoop.start-160"><span class="linenos">160</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_react_loop</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="s2">&quot;react&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Start the ReAct agentic loop.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>query</strong> (str):
User query to process</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>Dict[str, Any]</strong>: Agent response processed through the ReAct loop</li>
</ul>
</div>


                            </div>
                </section>
                <section id="ReactWithFCAgenticLoop">
                            <input id="ReactWithFCAgenticLoop-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ReactWithFCAgenticLoop</span><wbr>(<span class="base"><a href="#_AgenticLoop">monoai.agents._AgenticLoop</a></span>, <span class="base"><a href="#_FunctionCallingMixin">monoai.agents._FunctionCallingMixin</a></span>):

                <label class="view-source-button" for="ReactWithFCAgenticLoop-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ReactWithFCAgenticLoop"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ReactWithFCAgenticLoop-163"><a href="#ReactWithFCAgenticLoop-163"><span class="linenos">163</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ReactWithFCAgenticLoop</span><span class="p">(</span><span class="n">_AgenticLoop</span><span class="p">,</span> <span class="n">_FunctionCallingMixin</span><span class="p">):</span>
</span><span id="ReactWithFCAgenticLoop-164"><a href="#ReactWithFCAgenticLoop-164"><span class="linenos">164</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Agent that combines ReAct and Function Calling.</span>
</span><span id="ReactWithFCAgenticLoop-165"><a href="#ReactWithFCAgenticLoop-165"><span class="linenos">165</span></a><span class="sd">    </span>
</span><span id="ReactWithFCAgenticLoop-166"><a href="#ReactWithFCAgenticLoop-166"><span class="linenos">166</span></a><span class="sd">    This agent combines the ReAct approach with OpenAI&#39;s native function</span>
</span><span id="ReactWithFCAgenticLoop-167"><a href="#ReactWithFCAgenticLoop-167"><span class="linenos">167</span></a><span class="sd">    calling, allowing for hybrid tool call management. This provides</span>
</span><span id="ReactWithFCAgenticLoop-168"><a href="#ReactWithFCAgenticLoop-168"><span class="linenos">168</span></a><span class="sd">    the flexibility of ReAct reasoning with the reliability of function calling.</span>
</span><span id="ReactWithFCAgenticLoop-169"><a href="#ReactWithFCAgenticLoop-169"><span class="linenos">169</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="ReactWithFCAgenticLoop-170"><a href="#ReactWithFCAgenticLoop-170"><span class="linenos">170</span></a>    
</span><span id="ReactWithFCAgenticLoop-171"><a href="#ReactWithFCAgenticLoop-171"><span class="linenos">171</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="ReactWithFCAgenticLoop-172"><a href="#ReactWithFCAgenticLoop-172"><span class="linenos">172</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Start the hybrid ReAct + Function Calling agentic loop.</span>
</span><span id="ReactWithFCAgenticLoop-173"><a href="#ReactWithFCAgenticLoop-173"><span class="linenos">173</span></a><span class="sd">        </span>
</span><span id="ReactWithFCAgenticLoop-174"><a href="#ReactWithFCAgenticLoop-174"><span class="linenos">174</span></a><span class="sd">        Parameters</span>
</span><span id="ReactWithFCAgenticLoop-175"><a href="#ReactWithFCAgenticLoop-175"><span class="linenos">175</span></a><span class="sd">        ----------</span>
</span><span id="ReactWithFCAgenticLoop-176"><a href="#ReactWithFCAgenticLoop-176"><span class="linenos">176</span></a><span class="sd">        query : str</span>
</span><span id="ReactWithFCAgenticLoop-177"><a href="#ReactWithFCAgenticLoop-177"><span class="linenos">177</span></a><span class="sd">            User query to process</span>
</span><span id="ReactWithFCAgenticLoop-178"><a href="#ReactWithFCAgenticLoop-178"><span class="linenos">178</span></a><span class="sd">        </span>
</span><span id="ReactWithFCAgenticLoop-179"><a href="#ReactWithFCAgenticLoop-179"><span class="linenos">179</span></a><span class="sd">        Returns</span>
</span><span id="ReactWithFCAgenticLoop-180"><a href="#ReactWithFCAgenticLoop-180"><span class="linenos">180</span></a><span class="sd">        -------</span>
</span><span id="ReactWithFCAgenticLoop-181"><a href="#ReactWithFCAgenticLoop-181"><span class="linenos">181</span></a><span class="sd">        Dict[str, Any]</span>
</span><span id="ReactWithFCAgenticLoop-182"><a href="#ReactWithFCAgenticLoop-182"><span class="linenos">182</span></a><span class="sd">            Agent response (to be implemented)</span>
</span><span id="ReactWithFCAgenticLoop-183"><a href="#ReactWithFCAgenticLoop-183"><span class="linenos">183</span></a><span class="sd">        </span>
</span><span id="ReactWithFCAgenticLoop-184"><a href="#ReactWithFCAgenticLoop-184"><span class="linenos">184</span></a><span class="sd">        Notes</span>
</span><span id="ReactWithFCAgenticLoop-185"><a href="#ReactWithFCAgenticLoop-185"><span class="linenos">185</span></a><span class="sd">        -----</span>
</span><span id="ReactWithFCAgenticLoop-186"><a href="#ReactWithFCAgenticLoop-186"><span class="linenos">186</span></a><span class="sd">        TODO: Implement combination of ReAct and Function Calling</span>
</span><span id="ReactWithFCAgenticLoop-187"><a href="#ReactWithFCAgenticLoop-187"><span class="linenos">187</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ReactWithFCAgenticLoop-188"><a href="#ReactWithFCAgenticLoop-188"><span class="linenos">188</span></a>        <span class="c1"># TODO: Implement combination of ReAct and Function Calling</span>
</span><span id="ReactWithFCAgenticLoop-189"><a href="#ReactWithFCAgenticLoop-189"><span class="linenos">189</span></a>        <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p>Agent that combines ReAct and Function Calling.</p>

<p>This agent combines the ReAct approach with OpenAI's native function
calling, allowing for hybrid tool call management. This provides
the flexibility of ReAct reasoning with the reliability of function calling.</p>
</div>


                            <div id="ReactWithFCAgenticLoop.start" class="classattr">
                                        <input id="ReactWithFCAgenticLoop.start-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">start</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">query</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="ReactWithFCAgenticLoop.start-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ReactWithFCAgenticLoop.start"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ReactWithFCAgenticLoop.start-171"><a href="#ReactWithFCAgenticLoop.start-171"><span class="linenos">171</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="ReactWithFCAgenticLoop.start-172"><a href="#ReactWithFCAgenticLoop.start-172"><span class="linenos">172</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Start the hybrid ReAct + Function Calling agentic loop.</span>
</span><span id="ReactWithFCAgenticLoop.start-173"><a href="#ReactWithFCAgenticLoop.start-173"><span class="linenos">173</span></a><span class="sd">        </span>
</span><span id="ReactWithFCAgenticLoop.start-174"><a href="#ReactWithFCAgenticLoop.start-174"><span class="linenos">174</span></a><span class="sd">        Parameters</span>
</span><span id="ReactWithFCAgenticLoop.start-175"><a href="#ReactWithFCAgenticLoop.start-175"><span class="linenos">175</span></a><span class="sd">        ----------</span>
</span><span id="ReactWithFCAgenticLoop.start-176"><a href="#ReactWithFCAgenticLoop.start-176"><span class="linenos">176</span></a><span class="sd">        query : str</span>
</span><span id="ReactWithFCAgenticLoop.start-177"><a href="#ReactWithFCAgenticLoop.start-177"><span class="linenos">177</span></a><span class="sd">            User query to process</span>
</span><span id="ReactWithFCAgenticLoop.start-178"><a href="#ReactWithFCAgenticLoop.start-178"><span class="linenos">178</span></a><span class="sd">        </span>
</span><span id="ReactWithFCAgenticLoop.start-179"><a href="#ReactWithFCAgenticLoop.start-179"><span class="linenos">179</span></a><span class="sd">        Returns</span>
</span><span id="ReactWithFCAgenticLoop.start-180"><a href="#ReactWithFCAgenticLoop.start-180"><span class="linenos">180</span></a><span class="sd">        -------</span>
</span><span id="ReactWithFCAgenticLoop.start-181"><a href="#ReactWithFCAgenticLoop.start-181"><span class="linenos">181</span></a><span class="sd">        Dict[str, Any]</span>
</span><span id="ReactWithFCAgenticLoop.start-182"><a href="#ReactWithFCAgenticLoop.start-182"><span class="linenos">182</span></a><span class="sd">            Agent response (to be implemented)</span>
</span><span id="ReactWithFCAgenticLoop.start-183"><a href="#ReactWithFCAgenticLoop.start-183"><span class="linenos">183</span></a><span class="sd">        </span>
</span><span id="ReactWithFCAgenticLoop.start-184"><a href="#ReactWithFCAgenticLoop.start-184"><span class="linenos">184</span></a><span class="sd">        Notes</span>
</span><span id="ReactWithFCAgenticLoop.start-185"><a href="#ReactWithFCAgenticLoop.start-185"><span class="linenos">185</span></a><span class="sd">        -----</span>
</span><span id="ReactWithFCAgenticLoop.start-186"><a href="#ReactWithFCAgenticLoop.start-186"><span class="linenos">186</span></a><span class="sd">        TODO: Implement combination of ReAct and Function Calling</span>
</span><span id="ReactWithFCAgenticLoop.start-187"><a href="#ReactWithFCAgenticLoop.start-187"><span class="linenos">187</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ReactWithFCAgenticLoop.start-188"><a href="#ReactWithFCAgenticLoop.start-188"><span class="linenos">188</span></a>        <span class="c1"># TODO: Implement combination of ReAct and Function Calling</span>
</span><span id="ReactWithFCAgenticLoop.start-189"><a href="#ReactWithFCAgenticLoop.start-189"><span class="linenos">189</span></a>        <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p>Start the hybrid ReAct + Function Calling agentic loop.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>query</strong> (str):
User query to process</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>Dict[str, Any]</strong>: Agent response (to be implemented)</li>
</ul>

<h6 id="notes">Notes</h6>

<p>TODO: Implement combination of ReAct and Function Calling</p>
</div>


                            </div>
                </section>
                <section id="ProgrammaticAgenticLoop">
                            <input id="ProgrammaticAgenticLoop-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ProgrammaticAgenticLoop</span><wbr>(<span class="base"><a href="#_BaseReactLoop">monoai.agents._BaseReactLoop</a></span>):

                <label class="view-source-button" for="ProgrammaticAgenticLoop-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ProgrammaticAgenticLoop"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ProgrammaticAgenticLoop-15"><a href="#ProgrammaticAgenticLoop-15"><span class="linenos">15</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ProgrammaticAgenticLoop</span><span class="p">(</span><span class="n">_BaseReactLoop</span><span class="p">):</span>
</span><span id="ProgrammaticAgenticLoop-16"><a href="#ProgrammaticAgenticLoop-16"><span class="linenos">16</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Programmatic agent.</span>
</span><span id="ProgrammaticAgenticLoop-17"><a href="#ProgrammaticAgenticLoop-17"><span class="linenos">17</span></a><span class="sd">    </span>
</span><span id="ProgrammaticAgenticLoop-18"><a href="#ProgrammaticAgenticLoop-18"><span class="linenos">18</span></a><span class="sd">    This agent implements a programmatic approach where the model</span>
</span><span id="ProgrammaticAgenticLoop-19"><a href="#ProgrammaticAgenticLoop-19"><span class="linenos">19</span></a><span class="sd">    produces code or structured instructions that are executed.</span>
</span><span id="ProgrammaticAgenticLoop-20"><a href="#ProgrammaticAgenticLoop-20"><span class="linenos">20</span></a><span class="sd">    It&#39;s designed for tasks that require code generation and execution.</span>
</span><span id="ProgrammaticAgenticLoop-21"><a href="#ProgrammaticAgenticLoop-21"><span class="linenos">21</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="ProgrammaticAgenticLoop-22"><a href="#ProgrammaticAgenticLoop-22"><span class="linenos">22</span></a>    
</span><span id="ProgrammaticAgenticLoop-23"><a href="#ProgrammaticAgenticLoop-23"><span class="linenos">23</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="ProgrammaticAgenticLoop-24"><a href="#ProgrammaticAgenticLoop-24"><span class="linenos">24</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Start the programmatic agentic loop.</span>
</span><span id="ProgrammaticAgenticLoop-25"><a href="#ProgrammaticAgenticLoop-25"><span class="linenos">25</span></a><span class="sd">        </span>
</span><span id="ProgrammaticAgenticLoop-26"><a href="#ProgrammaticAgenticLoop-26"><span class="linenos">26</span></a><span class="sd">        Parameters</span>
</span><span id="ProgrammaticAgenticLoop-27"><a href="#ProgrammaticAgenticLoop-27"><span class="linenos">27</span></a><span class="sd">        ----------</span>
</span><span id="ProgrammaticAgenticLoop-28"><a href="#ProgrammaticAgenticLoop-28"><span class="linenos">28</span></a><span class="sd">        query : str</span>
</span><span id="ProgrammaticAgenticLoop-29"><a href="#ProgrammaticAgenticLoop-29"><span class="linenos">29</span></a><span class="sd">            User query to process</span>
</span><span id="ProgrammaticAgenticLoop-30"><a href="#ProgrammaticAgenticLoop-30"><span class="linenos">30</span></a><span class="sd">        </span>
</span><span id="ProgrammaticAgenticLoop-31"><a href="#ProgrammaticAgenticLoop-31"><span class="linenos">31</span></a><span class="sd">        Returns</span>
</span><span id="ProgrammaticAgenticLoop-32"><a href="#ProgrammaticAgenticLoop-32"><span class="linenos">32</span></a><span class="sd">        -------</span>
</span><span id="ProgrammaticAgenticLoop-33"><a href="#ProgrammaticAgenticLoop-33"><span class="linenos">33</span></a><span class="sd">        Dict[str, Any]</span>
</span><span id="ProgrammaticAgenticLoop-34"><a href="#ProgrammaticAgenticLoop-34"><span class="linenos">34</span></a><span class="sd">            Agent response processed through the programmatic loop</span>
</span><span id="ProgrammaticAgenticLoop-35"><a href="#ProgrammaticAgenticLoop-35"><span class="linenos">35</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ProgrammaticAgenticLoop-36"><a href="#ProgrammaticAgenticLoop-36"><span class="linenos">36</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_react_loop</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="s2">&quot;programmatic&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Programmatic agent.</p>

<p>This agent implements a programmatic approach where the model
produces code or structured instructions that are executed.
It's designed for tasks that require code generation and execution.</p>
</div>


                            <div id="ProgrammaticAgenticLoop.start" class="classattr">
                                        <input id="ProgrammaticAgenticLoop.start-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">start</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">query</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="ProgrammaticAgenticLoop.start-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ProgrammaticAgenticLoop.start"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ProgrammaticAgenticLoop.start-23"><a href="#ProgrammaticAgenticLoop.start-23"><span class="linenos">23</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="ProgrammaticAgenticLoop.start-24"><a href="#ProgrammaticAgenticLoop.start-24"><span class="linenos">24</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Start the programmatic agentic loop.</span>
</span><span id="ProgrammaticAgenticLoop.start-25"><a href="#ProgrammaticAgenticLoop.start-25"><span class="linenos">25</span></a><span class="sd">        </span>
</span><span id="ProgrammaticAgenticLoop.start-26"><a href="#ProgrammaticAgenticLoop.start-26"><span class="linenos">26</span></a><span class="sd">        Parameters</span>
</span><span id="ProgrammaticAgenticLoop.start-27"><a href="#ProgrammaticAgenticLoop.start-27"><span class="linenos">27</span></a><span class="sd">        ----------</span>
</span><span id="ProgrammaticAgenticLoop.start-28"><a href="#ProgrammaticAgenticLoop.start-28"><span class="linenos">28</span></a><span class="sd">        query : str</span>
</span><span id="ProgrammaticAgenticLoop.start-29"><a href="#ProgrammaticAgenticLoop.start-29"><span class="linenos">29</span></a><span class="sd">            User query to process</span>
</span><span id="ProgrammaticAgenticLoop.start-30"><a href="#ProgrammaticAgenticLoop.start-30"><span class="linenos">30</span></a><span class="sd">        </span>
</span><span id="ProgrammaticAgenticLoop.start-31"><a href="#ProgrammaticAgenticLoop.start-31"><span class="linenos">31</span></a><span class="sd">        Returns</span>
</span><span id="ProgrammaticAgenticLoop.start-32"><a href="#ProgrammaticAgenticLoop.start-32"><span class="linenos">32</span></a><span class="sd">        -------</span>
</span><span id="ProgrammaticAgenticLoop.start-33"><a href="#ProgrammaticAgenticLoop.start-33"><span class="linenos">33</span></a><span class="sd">        Dict[str, Any]</span>
</span><span id="ProgrammaticAgenticLoop.start-34"><a href="#ProgrammaticAgenticLoop.start-34"><span class="linenos">34</span></a><span class="sd">            Agent response processed through the programmatic loop</span>
</span><span id="ProgrammaticAgenticLoop.start-35"><a href="#ProgrammaticAgenticLoop.start-35"><span class="linenos">35</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ProgrammaticAgenticLoop.start-36"><a href="#ProgrammaticAgenticLoop.start-36"><span class="linenos">36</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_react_loop</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="s2">&quot;programmatic&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Start the programmatic agentic loop.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>query</strong> (str):
User query to process</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>Dict[str, Any]</strong>: Agent response processed through the programmatic loop</li>
</ul>
</div>


                            </div>
                </section>
                <section id="PlanAndExecuteAgenticLoop">
                            <input id="PlanAndExecuteAgenticLoop-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">PlanAndExecuteAgenticLoop</span><wbr>(<span class="base"><a href="#_BaseReactLoop">monoai.agents._BaseReactLoop</a></span>):

                <label class="view-source-button" for="PlanAndExecuteAgenticLoop-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PlanAndExecuteAgenticLoop"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PlanAndExecuteAgenticLoop-39"><a href="#PlanAndExecuteAgenticLoop-39"><span class="linenos">39</span></a><span class="k">class</span><span class="w"> </span><span class="nc">PlanAndExecuteAgenticLoop</span><span class="p">(</span><span class="n">_BaseReactLoop</span><span class="p">):</span>
</span><span id="PlanAndExecuteAgenticLoop-40"><a href="#PlanAndExecuteAgenticLoop-40"><span class="linenos">40</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Plan-and-execute agent.</span>
</span><span id="PlanAndExecuteAgenticLoop-41"><a href="#PlanAndExecuteAgenticLoop-41"><span class="linenos">41</span></a><span class="sd">    </span>
</span><span id="PlanAndExecuteAgenticLoop-42"><a href="#PlanAndExecuteAgenticLoop-42"><span class="linenos">42</span></a><span class="sd">    This agent implements the plan-and-execute pattern, where the model</span>
</span><span id="PlanAndExecuteAgenticLoop-43"><a href="#PlanAndExecuteAgenticLoop-43"><span class="linenos">43</span></a><span class="sd">    first plans the actions and then executes them sequentially.</span>
</span><span id="PlanAndExecuteAgenticLoop-44"><a href="#PlanAndExecuteAgenticLoop-44"><span class="linenos">44</span></a><span class="sd">    This approach is useful for complex tasks that require careful planning.</span>
</span><span id="PlanAndExecuteAgenticLoop-45"><a href="#PlanAndExecuteAgenticLoop-45"><span class="linenos">45</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="PlanAndExecuteAgenticLoop-46"><a href="#PlanAndExecuteAgenticLoop-46"><span class="linenos">46</span></a>    
</span><span id="PlanAndExecuteAgenticLoop-47"><a href="#PlanAndExecuteAgenticLoop-47"><span class="linenos">47</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="PlanAndExecuteAgenticLoop-48"><a href="#PlanAndExecuteAgenticLoop-48"><span class="linenos">48</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Start the plan-and-execute agentic loop.</span>
</span><span id="PlanAndExecuteAgenticLoop-49"><a href="#PlanAndExecuteAgenticLoop-49"><span class="linenos">49</span></a><span class="sd">        </span>
</span><span id="PlanAndExecuteAgenticLoop-50"><a href="#PlanAndExecuteAgenticLoop-50"><span class="linenos">50</span></a><span class="sd">        Parameters</span>
</span><span id="PlanAndExecuteAgenticLoop-51"><a href="#PlanAndExecuteAgenticLoop-51"><span class="linenos">51</span></a><span class="sd">        ----------</span>
</span><span id="PlanAndExecuteAgenticLoop-52"><a href="#PlanAndExecuteAgenticLoop-52"><span class="linenos">52</span></a><span class="sd">        query : str</span>
</span><span id="PlanAndExecuteAgenticLoop-53"><a href="#PlanAndExecuteAgenticLoop-53"><span class="linenos">53</span></a><span class="sd">            User query to process</span>
</span><span id="PlanAndExecuteAgenticLoop-54"><a href="#PlanAndExecuteAgenticLoop-54"><span class="linenos">54</span></a><span class="sd">        </span>
</span><span id="PlanAndExecuteAgenticLoop-55"><a href="#PlanAndExecuteAgenticLoop-55"><span class="linenos">55</span></a><span class="sd">        Returns</span>
</span><span id="PlanAndExecuteAgenticLoop-56"><a href="#PlanAndExecuteAgenticLoop-56"><span class="linenos">56</span></a><span class="sd">        -------</span>
</span><span id="PlanAndExecuteAgenticLoop-57"><a href="#PlanAndExecuteAgenticLoop-57"><span class="linenos">57</span></a><span class="sd">        Dict[str, Any]</span>
</span><span id="PlanAndExecuteAgenticLoop-58"><a href="#PlanAndExecuteAgenticLoop-58"><span class="linenos">58</span></a><span class="sd">            Agent response processed through the plan-and-execute loop</span>
</span><span id="PlanAndExecuteAgenticLoop-59"><a href="#PlanAndExecuteAgenticLoop-59"><span class="linenos">59</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PlanAndExecuteAgenticLoop-60"><a href="#PlanAndExecuteAgenticLoop-60"><span class="linenos">60</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_react_loop</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="s2">&quot;plan_and_execute&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Plan-and-execute agent.</p>

<p>This agent implements the plan-and-execute pattern, where the model
first plans the actions and then executes them sequentially.
This approach is useful for complex tasks that require careful planning.</p>
</div>


                            <div id="PlanAndExecuteAgenticLoop.start" class="classattr">
                                        <input id="PlanAndExecuteAgenticLoop.start-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">start</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">query</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="PlanAndExecuteAgenticLoop.start-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PlanAndExecuteAgenticLoop.start"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PlanAndExecuteAgenticLoop.start-47"><a href="#PlanAndExecuteAgenticLoop.start-47"><span class="linenos">47</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="PlanAndExecuteAgenticLoop.start-48"><a href="#PlanAndExecuteAgenticLoop.start-48"><span class="linenos">48</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Start the plan-and-execute agentic loop.</span>
</span><span id="PlanAndExecuteAgenticLoop.start-49"><a href="#PlanAndExecuteAgenticLoop.start-49"><span class="linenos">49</span></a><span class="sd">        </span>
</span><span id="PlanAndExecuteAgenticLoop.start-50"><a href="#PlanAndExecuteAgenticLoop.start-50"><span class="linenos">50</span></a><span class="sd">        Parameters</span>
</span><span id="PlanAndExecuteAgenticLoop.start-51"><a href="#PlanAndExecuteAgenticLoop.start-51"><span class="linenos">51</span></a><span class="sd">        ----------</span>
</span><span id="PlanAndExecuteAgenticLoop.start-52"><a href="#PlanAndExecuteAgenticLoop.start-52"><span class="linenos">52</span></a><span class="sd">        query : str</span>
</span><span id="PlanAndExecuteAgenticLoop.start-53"><a href="#PlanAndExecuteAgenticLoop.start-53"><span class="linenos">53</span></a><span class="sd">            User query to process</span>
</span><span id="PlanAndExecuteAgenticLoop.start-54"><a href="#PlanAndExecuteAgenticLoop.start-54"><span class="linenos">54</span></a><span class="sd">        </span>
</span><span id="PlanAndExecuteAgenticLoop.start-55"><a href="#PlanAndExecuteAgenticLoop.start-55"><span class="linenos">55</span></a><span class="sd">        Returns</span>
</span><span id="PlanAndExecuteAgenticLoop.start-56"><a href="#PlanAndExecuteAgenticLoop.start-56"><span class="linenos">56</span></a><span class="sd">        -------</span>
</span><span id="PlanAndExecuteAgenticLoop.start-57"><a href="#PlanAndExecuteAgenticLoop.start-57"><span class="linenos">57</span></a><span class="sd">        Dict[str, Any]</span>
</span><span id="PlanAndExecuteAgenticLoop.start-58"><a href="#PlanAndExecuteAgenticLoop.start-58"><span class="linenos">58</span></a><span class="sd">            Agent response processed through the plan-and-execute loop</span>
</span><span id="PlanAndExecuteAgenticLoop.start-59"><a href="#PlanAndExecuteAgenticLoop.start-59"><span class="linenos">59</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PlanAndExecuteAgenticLoop.start-60"><a href="#PlanAndExecuteAgenticLoop.start-60"><span class="linenos">60</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_react_loop</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="s2">&quot;plan_and_execute&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Start the plan-and-execute agentic loop.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>query</strong> (str):
User query to process</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>Dict[str, Any]</strong>: Agent response processed through the plan-and-execute loop</li>
</ul>
</div>


                            </div>
                </section>
                <section id="ReflexionAgenticLoop">
                            <input id="ReflexionAgenticLoop-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ReflexionAgenticLoop</span><wbr>(<span class="base"><a href="#_BaseReactLoop">monoai.agents._BaseReactLoop</a></span>):

                <label class="view-source-button" for="ReflexionAgenticLoop-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ReflexionAgenticLoop"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ReflexionAgenticLoop-63"><a href="#ReflexionAgenticLoop-63"><span class="linenos">63</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ReflexionAgenticLoop</span><span class="p">(</span><span class="n">_BaseReactLoop</span><span class="p">):</span>
</span><span id="ReflexionAgenticLoop-64"><a href="#ReflexionAgenticLoop-64"><span class="linenos">64</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Agent with reflection capabilities.</span>
</span><span id="ReflexionAgenticLoop-65"><a href="#ReflexionAgenticLoop-65"><span class="linenos">65</span></a><span class="sd">    </span>
</span><span id="ReflexionAgenticLoop-66"><a href="#ReflexionAgenticLoop-66"><span class="linenos">66</span></a><span class="sd">    This agent implements the reflexion pattern, where the model</span>
</span><span id="ReflexionAgenticLoop-67"><a href="#ReflexionAgenticLoop-67"><span class="linenos">67</span></a><span class="sd">    reflects on its own actions and decisions to improve performance.</span>
</span><span id="ReflexionAgenticLoop-68"><a href="#ReflexionAgenticLoop-68"><span class="linenos">68</span></a><span class="sd">    This self-reflective approach helps the agent learn from mistakes</span>
</span><span id="ReflexionAgenticLoop-69"><a href="#ReflexionAgenticLoop-69"><span class="linenos">69</span></a><span class="sd">    and improve its reasoning over time.</span>
</span><span id="ReflexionAgenticLoop-70"><a href="#ReflexionAgenticLoop-70"><span class="linenos">70</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="ReflexionAgenticLoop-71"><a href="#ReflexionAgenticLoop-71"><span class="linenos">71</span></a>    
</span><span id="ReflexionAgenticLoop-72"><a href="#ReflexionAgenticLoop-72"><span class="linenos">72</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="ReflexionAgenticLoop-73"><a href="#ReflexionAgenticLoop-73"><span class="linenos">73</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Start the reflexion agentic loop.</span>
</span><span id="ReflexionAgenticLoop-74"><a href="#ReflexionAgenticLoop-74"><span class="linenos">74</span></a><span class="sd">        </span>
</span><span id="ReflexionAgenticLoop-75"><a href="#ReflexionAgenticLoop-75"><span class="linenos">75</span></a><span class="sd">        Parameters</span>
</span><span id="ReflexionAgenticLoop-76"><a href="#ReflexionAgenticLoop-76"><span class="linenos">76</span></a><span class="sd">        ----------</span>
</span><span id="ReflexionAgenticLoop-77"><a href="#ReflexionAgenticLoop-77"><span class="linenos">77</span></a><span class="sd">        query : str</span>
</span><span id="ReflexionAgenticLoop-78"><a href="#ReflexionAgenticLoop-78"><span class="linenos">78</span></a><span class="sd">            User query to process</span>
</span><span id="ReflexionAgenticLoop-79"><a href="#ReflexionAgenticLoop-79"><span class="linenos">79</span></a><span class="sd">        </span>
</span><span id="ReflexionAgenticLoop-80"><a href="#ReflexionAgenticLoop-80"><span class="linenos">80</span></a><span class="sd">        Returns</span>
</span><span id="ReflexionAgenticLoop-81"><a href="#ReflexionAgenticLoop-81"><span class="linenos">81</span></a><span class="sd">        -------</span>
</span><span id="ReflexionAgenticLoop-82"><a href="#ReflexionAgenticLoop-82"><span class="linenos">82</span></a><span class="sd">        Dict[str, Any]</span>
</span><span id="ReflexionAgenticLoop-83"><a href="#ReflexionAgenticLoop-83"><span class="linenos">83</span></a><span class="sd">            Agent response processed through the reflexion loop</span>
</span><span id="ReflexionAgenticLoop-84"><a href="#ReflexionAgenticLoop-84"><span class="linenos">84</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ReflexionAgenticLoop-85"><a href="#ReflexionAgenticLoop-85"><span class="linenos">85</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_react_loop</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="s2">&quot;reflexion&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Agent with reflection capabilities.</p>

<p>This agent implements the reflexion pattern, where the model
reflects on its own actions and decisions to improve performance.
This self-reflective approach helps the agent learn from mistakes
and improve its reasoning over time.</p>
</div>


                            <div id="ReflexionAgenticLoop.start" class="classattr">
                                        <input id="ReflexionAgenticLoop.start-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">start</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">query</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="ReflexionAgenticLoop.start-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ReflexionAgenticLoop.start"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ReflexionAgenticLoop.start-72"><a href="#ReflexionAgenticLoop.start-72"><span class="linenos">72</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="ReflexionAgenticLoop.start-73"><a href="#ReflexionAgenticLoop.start-73"><span class="linenos">73</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Start the reflexion agentic loop.</span>
</span><span id="ReflexionAgenticLoop.start-74"><a href="#ReflexionAgenticLoop.start-74"><span class="linenos">74</span></a><span class="sd">        </span>
</span><span id="ReflexionAgenticLoop.start-75"><a href="#ReflexionAgenticLoop.start-75"><span class="linenos">75</span></a><span class="sd">        Parameters</span>
</span><span id="ReflexionAgenticLoop.start-76"><a href="#ReflexionAgenticLoop.start-76"><span class="linenos">76</span></a><span class="sd">        ----------</span>
</span><span id="ReflexionAgenticLoop.start-77"><a href="#ReflexionAgenticLoop.start-77"><span class="linenos">77</span></a><span class="sd">        query : str</span>
</span><span id="ReflexionAgenticLoop.start-78"><a href="#ReflexionAgenticLoop.start-78"><span class="linenos">78</span></a><span class="sd">            User query to process</span>
</span><span id="ReflexionAgenticLoop.start-79"><a href="#ReflexionAgenticLoop.start-79"><span class="linenos">79</span></a><span class="sd">        </span>
</span><span id="ReflexionAgenticLoop.start-80"><a href="#ReflexionAgenticLoop.start-80"><span class="linenos">80</span></a><span class="sd">        Returns</span>
</span><span id="ReflexionAgenticLoop.start-81"><a href="#ReflexionAgenticLoop.start-81"><span class="linenos">81</span></a><span class="sd">        -------</span>
</span><span id="ReflexionAgenticLoop.start-82"><a href="#ReflexionAgenticLoop.start-82"><span class="linenos">82</span></a><span class="sd">        Dict[str, Any]</span>
</span><span id="ReflexionAgenticLoop.start-83"><a href="#ReflexionAgenticLoop.start-83"><span class="linenos">83</span></a><span class="sd">            Agent response processed through the reflexion loop</span>
</span><span id="ReflexionAgenticLoop.start-84"><a href="#ReflexionAgenticLoop.start-84"><span class="linenos">84</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ReflexionAgenticLoop.start-85"><a href="#ReflexionAgenticLoop.start-85"><span class="linenos">85</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_react_loop</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="s2">&quot;reflexion&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Start the reflexion agentic loop.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>query</strong> (str):
User query to process</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>Dict[str, Any]</strong>: Agent response processed through the reflexion loop</li>
</ul>
</div>


                            </div>
                </section>
                <section id="SelfAskAgenticLoop">
                            <input id="SelfAskAgenticLoop-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">SelfAskAgenticLoop</span><wbr>(<span class="base"><a href="#_BaseReactLoop">monoai.agents._BaseReactLoop</a></span>):

                <label class="view-source-button" for="SelfAskAgenticLoop-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SelfAskAgenticLoop"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SelfAskAgenticLoop-88"><a href="#SelfAskAgenticLoop-88"><span class="linenos"> 88</span></a><span class="k">class</span><span class="w"> </span><span class="nc">SelfAskAgenticLoop</span><span class="p">(</span><span class="n">_BaseReactLoop</span><span class="p">):</span>
</span><span id="SelfAskAgenticLoop-89"><a href="#SelfAskAgenticLoop-89"><span class="linenos"> 89</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Self-ask agent.</span>
</span><span id="SelfAskAgenticLoop-90"><a href="#SelfAskAgenticLoop-90"><span class="linenos"> 90</span></a><span class="sd">    </span>
</span><span id="SelfAskAgenticLoop-91"><a href="#SelfAskAgenticLoop-91"><span class="linenos"> 91</span></a><span class="sd">    This agent implements the self-ask pattern, where the model</span>
</span><span id="SelfAskAgenticLoop-92"><a href="#SelfAskAgenticLoop-92"><span class="linenos"> 92</span></a><span class="sd">    asks itself questions to guide the reasoning process.</span>
</span><span id="SelfAskAgenticLoop-93"><a href="#SelfAskAgenticLoop-93"><span class="linenos"> 93</span></a><span class="sd">    This approach helps break down complex problems into smaller,</span>
</span><span id="SelfAskAgenticLoop-94"><a href="#SelfAskAgenticLoop-94"><span class="linenos"> 94</span></a><span class="sd">    more manageable questions.</span>
</span><span id="SelfAskAgenticLoop-95"><a href="#SelfAskAgenticLoop-95"><span class="linenos"> 95</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="SelfAskAgenticLoop-96"><a href="#SelfAskAgenticLoop-96"><span class="linenos"> 96</span></a>    
</span><span id="SelfAskAgenticLoop-97"><a href="#SelfAskAgenticLoop-97"><span class="linenos"> 97</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="SelfAskAgenticLoop-98"><a href="#SelfAskAgenticLoop-98"><span class="linenos"> 98</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Start the self-ask agentic loop.</span>
</span><span id="SelfAskAgenticLoop-99"><a href="#SelfAskAgenticLoop-99"><span class="linenos"> 99</span></a><span class="sd">        </span>
</span><span id="SelfAskAgenticLoop-100"><a href="#SelfAskAgenticLoop-100"><span class="linenos">100</span></a><span class="sd">        Parameters</span>
</span><span id="SelfAskAgenticLoop-101"><a href="#SelfAskAgenticLoop-101"><span class="linenos">101</span></a><span class="sd">        ----------</span>
</span><span id="SelfAskAgenticLoop-102"><a href="#SelfAskAgenticLoop-102"><span class="linenos">102</span></a><span class="sd">        query : str</span>
</span><span id="SelfAskAgenticLoop-103"><a href="#SelfAskAgenticLoop-103"><span class="linenos">103</span></a><span class="sd">            User query to process</span>
</span><span id="SelfAskAgenticLoop-104"><a href="#SelfAskAgenticLoop-104"><span class="linenos">104</span></a><span class="sd">        </span>
</span><span id="SelfAskAgenticLoop-105"><a href="#SelfAskAgenticLoop-105"><span class="linenos">105</span></a><span class="sd">        Returns</span>
</span><span id="SelfAskAgenticLoop-106"><a href="#SelfAskAgenticLoop-106"><span class="linenos">106</span></a><span class="sd">        -------</span>
</span><span id="SelfAskAgenticLoop-107"><a href="#SelfAskAgenticLoop-107"><span class="linenos">107</span></a><span class="sd">        Dict[str, Any]</span>
</span><span id="SelfAskAgenticLoop-108"><a href="#SelfAskAgenticLoop-108"><span class="linenos">108</span></a><span class="sd">            Agent response processed through the self-ask loop</span>
</span><span id="SelfAskAgenticLoop-109"><a href="#SelfAskAgenticLoop-109"><span class="linenos">109</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SelfAskAgenticLoop-110"><a href="#SelfAskAgenticLoop-110"><span class="linenos">110</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_react_loop</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="s2">&quot;self_ask&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Self-ask agent.</p>

<p>This agent implements the self-ask pattern, where the model
asks itself questions to guide the reasoning process.
This approach helps break down complex problems into smaller,
more manageable questions.</p>
</div>


                            <div id="SelfAskAgenticLoop.start" class="classattr">
                                        <input id="SelfAskAgenticLoop.start-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">start</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">query</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="SelfAskAgenticLoop.start-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SelfAskAgenticLoop.start"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SelfAskAgenticLoop.start-97"><a href="#SelfAskAgenticLoop.start-97"><span class="linenos"> 97</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="SelfAskAgenticLoop.start-98"><a href="#SelfAskAgenticLoop.start-98"><span class="linenos"> 98</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Start the self-ask agentic loop.</span>
</span><span id="SelfAskAgenticLoop.start-99"><a href="#SelfAskAgenticLoop.start-99"><span class="linenos"> 99</span></a><span class="sd">        </span>
</span><span id="SelfAskAgenticLoop.start-100"><a href="#SelfAskAgenticLoop.start-100"><span class="linenos">100</span></a><span class="sd">        Parameters</span>
</span><span id="SelfAskAgenticLoop.start-101"><a href="#SelfAskAgenticLoop.start-101"><span class="linenos">101</span></a><span class="sd">        ----------</span>
</span><span id="SelfAskAgenticLoop.start-102"><a href="#SelfAskAgenticLoop.start-102"><span class="linenos">102</span></a><span class="sd">        query : str</span>
</span><span id="SelfAskAgenticLoop.start-103"><a href="#SelfAskAgenticLoop.start-103"><span class="linenos">103</span></a><span class="sd">            User query to process</span>
</span><span id="SelfAskAgenticLoop.start-104"><a href="#SelfAskAgenticLoop.start-104"><span class="linenos">104</span></a><span class="sd">        </span>
</span><span id="SelfAskAgenticLoop.start-105"><a href="#SelfAskAgenticLoop.start-105"><span class="linenos">105</span></a><span class="sd">        Returns</span>
</span><span id="SelfAskAgenticLoop.start-106"><a href="#SelfAskAgenticLoop.start-106"><span class="linenos">106</span></a><span class="sd">        -------</span>
</span><span id="SelfAskAgenticLoop.start-107"><a href="#SelfAskAgenticLoop.start-107"><span class="linenos">107</span></a><span class="sd">        Dict[str, Any]</span>
</span><span id="SelfAskAgenticLoop.start-108"><a href="#SelfAskAgenticLoop.start-108"><span class="linenos">108</span></a><span class="sd">            Agent response processed through the self-ask loop</span>
</span><span id="SelfAskAgenticLoop.start-109"><a href="#SelfAskAgenticLoop.start-109"><span class="linenos">109</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SelfAskAgenticLoop.start-110"><a href="#SelfAskAgenticLoop.start-110"><span class="linenos">110</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_react_loop</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="s2">&quot;self_ask&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Start the self-ask agentic loop.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>query</strong> (str):
User query to process</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>Dict[str, Any]</strong>: Agent response processed through the self-ask loop</li>
</ul>
</div>


                            </div>
                </section>
                <section id="SelfAskWithSearchLoop">
                            <input id="SelfAskWithSearchLoop-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">SelfAskWithSearchLoop</span><wbr>(<span class="base"><a href="#_BaseReactLoop">monoai.agents._BaseReactLoop</a></span>):

                <label class="view-source-button" for="SelfAskWithSearchLoop-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SelfAskWithSearchLoop"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SelfAskWithSearchLoop-113"><a href="#SelfAskWithSearchLoop-113"><span class="linenos">113</span></a><span class="k">class</span><span class="w"> </span><span class="nc">SelfAskWithSearchLoop</span><span class="p">(</span><span class="n">_BaseReactLoop</span><span class="p">):</span>
</span><span id="SelfAskWithSearchLoop-114"><a href="#SelfAskWithSearchLoop-114"><span class="linenos">114</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Self-ask agent with web search capabilities.</span>
</span><span id="SelfAskWithSearchLoop-115"><a href="#SelfAskWithSearchLoop-115"><span class="linenos">115</span></a><span class="sd">    </span>
</span><span id="SelfAskWithSearchLoop-116"><a href="#SelfAskWithSearchLoop-116"><span class="linenos">116</span></a><span class="sd">    This agent extends the self-ask pattern with the ability to</span>
</span><span id="SelfAskWithSearchLoop-117"><a href="#SelfAskWithSearchLoop-117"><span class="linenos">117</span></a><span class="sd">    perform web searches to obtain additional information.</span>
</span><span id="SelfAskWithSearchLoop-118"><a href="#SelfAskWithSearchLoop-118"><span class="linenos">118</span></a><span class="sd">    It&#39;s particularly useful for questions that require current</span>
</span><span id="SelfAskWithSearchLoop-119"><a href="#SelfAskWithSearchLoop-119"><span class="linenos">119</span></a><span class="sd">    or factual information not available in the model&#39;s training data.</span>
</span><span id="SelfAskWithSearchLoop-120"><a href="#SelfAskWithSearchLoop-120"><span class="linenos">120</span></a><span class="sd">    </span>
</span><span id="SelfAskWithSearchLoop-121"><a href="#SelfAskWithSearchLoop-121"><span class="linenos">121</span></a><span class="sd">    Attributes</span>
</span><span id="SelfAskWithSearchLoop-122"><a href="#SelfAskWithSearchLoop-122"><span class="linenos">122</span></a><span class="sd">    ----------</span>
</span><span id="SelfAskWithSearchLoop-123"><a href="#SelfAskWithSearchLoop-123"><span class="linenos">123</span></a><span class="sd">    _handle_search_query : callable</span>
</span><span id="SelfAskWithSearchLoop-124"><a href="#SelfAskWithSearchLoop-124"><span class="linenos">124</span></a><span class="sd">        Method for handling web search queries</span>
</span><span id="SelfAskWithSearchLoop-125"><a href="#SelfAskWithSearchLoop-125"><span class="linenos">125</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="SelfAskWithSearchLoop-126"><a href="#SelfAskWithSearchLoop-126"><span class="linenos">126</span></a>    
</span><span id="SelfAskWithSearchLoop-127"><a href="#SelfAskWithSearchLoop-127"><span class="linenos">127</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_handle_search_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iteration</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">response</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">messages</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SelfAskWithSearchLoop-128"><a href="#SelfAskWithSearchLoop-128"><span class="linenos">128</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle web search queries.</span>
</span><span id="SelfAskWithSearchLoop-129"><a href="#SelfAskWithSearchLoop-129"><span class="linenos">129</span></a><span class="sd">        </span>
</span><span id="SelfAskWithSearchLoop-130"><a href="#SelfAskWithSearchLoop-130"><span class="linenos">130</span></a><span class="sd">        This method processes search queries by executing web searches</span>
</span><span id="SelfAskWithSearchLoop-131"><a href="#SelfAskWithSearchLoop-131"><span class="linenos">131</span></a><span class="sd">        using the Tavily search engine and integrating the results</span>
</span><span id="SelfAskWithSearchLoop-132"><a href="#SelfAskWithSearchLoop-132"><span class="linenos">132</span></a><span class="sd">        into the conversation flow.</span>
</span><span id="SelfAskWithSearchLoop-133"><a href="#SelfAskWithSearchLoop-133"><span class="linenos">133</span></a><span class="sd">        </span>
</span><span id="SelfAskWithSearchLoop-134"><a href="#SelfAskWithSearchLoop-134"><span class="linenos">134</span></a><span class="sd">        Parameters</span>
</span><span id="SelfAskWithSearchLoop-135"><a href="#SelfAskWithSearchLoop-135"><span class="linenos">135</span></a><span class="sd">        ----------</span>
</span><span id="SelfAskWithSearchLoop-136"><a href="#SelfAskWithSearchLoop-136"><span class="linenos">136</span></a><span class="sd">        iteration : Dict[str, Any]</span>
</span><span id="SelfAskWithSearchLoop-137"><a href="#SelfAskWithSearchLoop-137"><span class="linenos">137</span></a><span class="sd">            Current iteration containing the search query</span>
</span><span id="SelfAskWithSearchLoop-138"><a href="#SelfAskWithSearchLoop-138"><span class="linenos">138</span></a><span class="sd">        response : Dict[str, Any]</span>
</span><span id="SelfAskWithSearchLoop-139"><a href="#SelfAskWithSearchLoop-139"><span class="linenos">139</span></a><span class="sd">            Response dictionary to update</span>
</span><span id="SelfAskWithSearchLoop-140"><a href="#SelfAskWithSearchLoop-140"><span class="linenos">140</span></a><span class="sd">        messages : List[Dict[str, Any]]</span>
</span><span id="SelfAskWithSearchLoop-141"><a href="#SelfAskWithSearchLoop-141"><span class="linenos">141</span></a><span class="sd">            Message list to update with search results</span>
</span><span id="SelfAskWithSearchLoop-142"><a href="#SelfAskWithSearchLoop-142"><span class="linenos">142</span></a><span class="sd">        </span>
</span><span id="SelfAskWithSearchLoop-143"><a href="#SelfAskWithSearchLoop-143"><span class="linenos">143</span></a><span class="sd">        Notes</span>
</span><span id="SelfAskWithSearchLoop-144"><a href="#SelfAskWithSearchLoop-144"><span class="linenos">144</span></a><span class="sd">        -----</span>
</span><span id="SelfAskWithSearchLoop-145"><a href="#SelfAskWithSearchLoop-145"><span class="linenos">145</span></a><span class="sd">        This method modifies the response and messages objects directly.</span>
</span><span id="SelfAskWithSearchLoop-146"><a href="#SelfAskWithSearchLoop-146"><span class="linenos">146</span></a><span class="sd">        Uses the Tavily search engine for web searches.</span>
</span><span id="SelfAskWithSearchLoop-147"><a href="#SelfAskWithSearchLoop-147"><span class="linenos">147</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SelfAskWithSearchLoop-148"><a href="#SelfAskWithSearchLoop-148"><span class="linenos">148</span></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">...tools.websearch</span><span class="w"> </span><span class="kn">import</span> <span class="n">search_web</span>
</span><span id="SelfAskWithSearchLoop-149"><a href="#SelfAskWithSearchLoop-149"><span class="linenos">149</span></a>        
</span><span id="SelfAskWithSearchLoop-150"><a href="#SelfAskWithSearchLoop-150"><span class="linenos">150</span></a>        <span class="n">query</span> <span class="o">=</span> <span class="n">iteration</span><span class="p">[</span><span class="s2">&quot;search_query&quot;</span><span class="p">]</span>
</span><span id="SelfAskWithSearchLoop-151"><a href="#SelfAskWithSearchLoop-151"><span class="linenos">151</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">search_web</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;tavily&quot;</span><span class="p">)[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span>
</span><span id="SelfAskWithSearchLoop-152"><a href="#SelfAskWithSearchLoop-152"><span class="linenos">152</span></a>        <span class="n">iteration</span><span class="p">[</span><span class="s2">&quot;search_result&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>
</span><span id="SelfAskWithSearchLoop-153"><a href="#SelfAskWithSearchLoop-153"><span class="linenos">153</span></a>        
</span><span id="SelfAskWithSearchLoop-154"><a href="#SelfAskWithSearchLoop-154"><span class="linenos">154</span></a>        <span class="n">msg</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s2">&quot;query_results&quot;</span><span class="p">:</span> <span class="n">result</span><span class="p">})</span>
</span><span id="SelfAskWithSearchLoop-155"><a href="#SelfAskWithSearchLoop-155"><span class="linenos">155</span></a>        <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">msg</span><span class="p">})</span>
</span><span id="SelfAskWithSearchLoop-156"><a href="#SelfAskWithSearchLoop-156"><span class="linenos">156</span></a>        <span class="n">response</span><span class="p">[</span><span class="s2">&quot;iterations&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iteration</span><span class="p">)</span>
</span><span id="SelfAskWithSearchLoop-157"><a href="#SelfAskWithSearchLoop-157"><span class="linenos">157</span></a>    
</span><span id="SelfAskWithSearchLoop-158"><a href="#SelfAskWithSearchLoop-158"><span class="linenos">158</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="SelfAskWithSearchLoop-159"><a href="#SelfAskWithSearchLoop-159"><span class="linenos">159</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Start the self-ask with search agentic loop.</span>
</span><span id="SelfAskWithSearchLoop-160"><a href="#SelfAskWithSearchLoop-160"><span class="linenos">160</span></a><span class="sd">        </span>
</span><span id="SelfAskWithSearchLoop-161"><a href="#SelfAskWithSearchLoop-161"><span class="linenos">161</span></a><span class="sd">        Parameters</span>
</span><span id="SelfAskWithSearchLoop-162"><a href="#SelfAskWithSearchLoop-162"><span class="linenos">162</span></a><span class="sd">        ----------</span>
</span><span id="SelfAskWithSearchLoop-163"><a href="#SelfAskWithSearchLoop-163"><span class="linenos">163</span></a><span class="sd">        query : str</span>
</span><span id="SelfAskWithSearchLoop-164"><a href="#SelfAskWithSearchLoop-164"><span class="linenos">164</span></a><span class="sd">            User query to process</span>
</span><span id="SelfAskWithSearchLoop-165"><a href="#SelfAskWithSearchLoop-165"><span class="linenos">165</span></a><span class="sd">        </span>
</span><span id="SelfAskWithSearchLoop-166"><a href="#SelfAskWithSearchLoop-166"><span class="linenos">166</span></a><span class="sd">        Returns</span>
</span><span id="SelfAskWithSearchLoop-167"><a href="#SelfAskWithSearchLoop-167"><span class="linenos">167</span></a><span class="sd">        -------</span>
</span><span id="SelfAskWithSearchLoop-168"><a href="#SelfAskWithSearchLoop-168"><span class="linenos">168</span></a><span class="sd">        Dict[str, Any]</span>
</span><span id="SelfAskWithSearchLoop-169"><a href="#SelfAskWithSearchLoop-169"><span class="linenos">169</span></a><span class="sd">            Agent response processed through the self-ask with search loop</span>
</span><span id="SelfAskWithSearchLoop-170"><a href="#SelfAskWithSearchLoop-170"><span class="linenos">170</span></a><span class="sd">        </span>
</span><span id="SelfAskWithSearchLoop-171"><a href="#SelfAskWithSearchLoop-171"><span class="linenos">171</span></a><span class="sd">        Notes</span>
</span><span id="SelfAskWithSearchLoop-172"><a href="#SelfAskWithSearchLoop-172"><span class="linenos">172</span></a><span class="sd">        -----</span>
</span><span id="SelfAskWithSearchLoop-173"><a href="#SelfAskWithSearchLoop-173"><span class="linenos">173</span></a><span class="sd">        This agent uses a custom handler for web search queries, allowing</span>
</span><span id="SelfAskWithSearchLoop-174"><a href="#SelfAskWithSearchLoop-174"><span class="linenos">174</span></a><span class="sd">        the model to obtain up-to-date information during the process.</span>
</span><span id="SelfAskWithSearchLoop-175"><a href="#SelfAskWithSearchLoop-175"><span class="linenos">175</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SelfAskWithSearchLoop-176"><a href="#SelfAskWithSearchLoop-176"><span class="linenos">176</span></a>        <span class="n">custom_handlers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;search_query&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_search_query</span><span class="p">}</span>
</span><span id="SelfAskWithSearchLoop-177"><a href="#SelfAskWithSearchLoop-177"><span class="linenos">177</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_react_loop</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="s2">&quot;self_ask_with_search&quot;</span><span class="p">,</span> <span class="n">custom_handlers</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Self-ask agent with web search capabilities.</p>

<p>This agent extends the self-ask pattern with the ability to
perform web searches to obtain additional information.
It's particularly useful for questions that require current
or factual information not available in the model's training data.</p>

<h6 id="attributes">Attributes</h6>

<ul>
<li><strong>_handle_search_query</strong> (callable):
Method for handling web search queries</li>
</ul>
</div>


                            <div id="SelfAskWithSearchLoop.start" class="classattr">
                                        <input id="SelfAskWithSearchLoop.start-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">start</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">query</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="SelfAskWithSearchLoop.start-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SelfAskWithSearchLoop.start"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SelfAskWithSearchLoop.start-158"><a href="#SelfAskWithSearchLoop.start-158"><span class="linenos">158</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="SelfAskWithSearchLoop.start-159"><a href="#SelfAskWithSearchLoop.start-159"><span class="linenos">159</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Start the self-ask with search agentic loop.</span>
</span><span id="SelfAskWithSearchLoop.start-160"><a href="#SelfAskWithSearchLoop.start-160"><span class="linenos">160</span></a><span class="sd">        </span>
</span><span id="SelfAskWithSearchLoop.start-161"><a href="#SelfAskWithSearchLoop.start-161"><span class="linenos">161</span></a><span class="sd">        Parameters</span>
</span><span id="SelfAskWithSearchLoop.start-162"><a href="#SelfAskWithSearchLoop.start-162"><span class="linenos">162</span></a><span class="sd">        ----------</span>
</span><span id="SelfAskWithSearchLoop.start-163"><a href="#SelfAskWithSearchLoop.start-163"><span class="linenos">163</span></a><span class="sd">        query : str</span>
</span><span id="SelfAskWithSearchLoop.start-164"><a href="#SelfAskWithSearchLoop.start-164"><span class="linenos">164</span></a><span class="sd">            User query to process</span>
</span><span id="SelfAskWithSearchLoop.start-165"><a href="#SelfAskWithSearchLoop.start-165"><span class="linenos">165</span></a><span class="sd">        </span>
</span><span id="SelfAskWithSearchLoop.start-166"><a href="#SelfAskWithSearchLoop.start-166"><span class="linenos">166</span></a><span class="sd">        Returns</span>
</span><span id="SelfAskWithSearchLoop.start-167"><a href="#SelfAskWithSearchLoop.start-167"><span class="linenos">167</span></a><span class="sd">        -------</span>
</span><span id="SelfAskWithSearchLoop.start-168"><a href="#SelfAskWithSearchLoop.start-168"><span class="linenos">168</span></a><span class="sd">        Dict[str, Any]</span>
</span><span id="SelfAskWithSearchLoop.start-169"><a href="#SelfAskWithSearchLoop.start-169"><span class="linenos">169</span></a><span class="sd">            Agent response processed through the self-ask with search loop</span>
</span><span id="SelfAskWithSearchLoop.start-170"><a href="#SelfAskWithSearchLoop.start-170"><span class="linenos">170</span></a><span class="sd">        </span>
</span><span id="SelfAskWithSearchLoop.start-171"><a href="#SelfAskWithSearchLoop.start-171"><span class="linenos">171</span></a><span class="sd">        Notes</span>
</span><span id="SelfAskWithSearchLoop.start-172"><a href="#SelfAskWithSearchLoop.start-172"><span class="linenos">172</span></a><span class="sd">        -----</span>
</span><span id="SelfAskWithSearchLoop.start-173"><a href="#SelfAskWithSearchLoop.start-173"><span class="linenos">173</span></a><span class="sd">        This agent uses a custom handler for web search queries, allowing</span>
</span><span id="SelfAskWithSearchLoop.start-174"><a href="#SelfAskWithSearchLoop.start-174"><span class="linenos">174</span></a><span class="sd">        the model to obtain up-to-date information during the process.</span>
</span><span id="SelfAskWithSearchLoop.start-175"><a href="#SelfAskWithSearchLoop.start-175"><span class="linenos">175</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SelfAskWithSearchLoop.start-176"><a href="#SelfAskWithSearchLoop.start-176"><span class="linenos">176</span></a>        <span class="n">custom_handlers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;search_query&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_search_query</span><span class="p">}</span>
</span><span id="SelfAskWithSearchLoop.start-177"><a href="#SelfAskWithSearchLoop.start-177"><span class="linenos">177</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_react_loop</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="s2">&quot;self_ask_with_search&quot;</span><span class="p">,</span> <span class="n">custom_handlers</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Start the self-ask with search agentic loop.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>query</strong> (str):
User query to process</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>Dict[str, Any]</strong>: Agent response processed through the self-ask with search loop</li>
</ul>

<h6 id="notes">Notes</h6>

<p>This agent uses a custom handler for web search queries, allowing
the model to obtain up-to-date information during the process.</p>
</div>


                            </div>
                </section>
                <section id="Agent">
                            <input id="Agent-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Agent</span>:

                <label class="view-source-button" for="Agent-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Agent"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Agent-18"><a href="#Agent-18"><span class="linenos"> 18</span></a><span class="k">class</span><span class="w"> </span><span class="nc">Agent</span><span class="p">:</span>
</span><span id="Agent-19"><a href="#Agent-19"><span class="linenos"> 19</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Agent-20"><a href="#Agent-20"><span class="linenos"> 20</span></a><span class="sd">    AI Agent that implements different reasoning paradigms for autonomous task execution.</span>
</span><span id="Agent-21"><a href="#Agent-21"><span class="linenos"> 21</span></a><span class="sd">    </span>
</span><span id="Agent-22"><a href="#Agent-22"><span class="linenos"> 22</span></a><span class="sd">    The Agent class provides a unified interface for creating and using AI agents</span>
</span><span id="Agent-23"><a href="#Agent-23"><span class="linenos"> 23</span></a><span class="sd">    with various reasoning paradigms. It acts as a high-level wrapper around</span>
</span><span id="Agent-24"><a href="#Agent-24"><span class="linenos"> 24</span></a><span class="sd">    specific agentic loop implementations, offering a consistent API regardless</span>
</span><span id="Agent-25"><a href="#Agent-25"><span class="linenos"> 25</span></a><span class="sd">    of the underlying reasoning pattern.</span>
</span><span id="Agent-26"><a href="#Agent-26"><span class="linenos"> 26</span></a><span class="sd">    </span>
</span><span id="Agent-27"><a href="#Agent-27"><span class="linenos"> 27</span></a><span class="sd">    The agent can be configured with different reasoning approaches, tools,</span>
</span><span id="Agent-28"><a href="#Agent-28"><span class="linenos"> 28</span></a><span class="sd">    and execution parameters to handle complex tasks autonomously or with</span>
</span><span id="Agent-29"><a href="#Agent-29"><span class="linenos"> 29</span></a><span class="sd">    human oversight.</span>
</span><span id="Agent-30"><a href="#Agent-30"><span class="linenos"> 30</span></a><span class="sd">    </span>
</span><span id="Agent-31"><a href="#Agent-31"><span class="linenos"> 31</span></a><span class="sd">    Parameters</span>
</span><span id="Agent-32"><a href="#Agent-32"><span class="linenos"> 32</span></a><span class="sd">    ----------</span>
</span><span id="Agent-33"><a href="#Agent-33"><span class="linenos"> 33</span></a><span class="sd">    model : Model</span>
</span><span id="Agent-34"><a href="#Agent-34"><span class="linenos"> 34</span></a><span class="sd">        AI model instance to use for agent execution</span>
</span><span id="Agent-35"><a href="#Agent-35"><span class="linenos"> 35</span></a><span class="sd">    tools : list, optional</span>
</span><span id="Agent-36"><a href="#Agent-36"><span class="linenos"> 36</span></a><span class="sd">        List of available tools for the agent. Each tool should be a</span>
</span><span id="Agent-37"><a href="#Agent-37"><span class="linenos"> 37</span></a><span class="sd">        callable function. Default is None.</span>
</span><span id="Agent-38"><a href="#Agent-38"><span class="linenos"> 38</span></a><span class="sd">    paradigm : str or _AgenticLoop, optional</span>
</span><span id="Agent-39"><a href="#Agent-39"><span class="linenos"> 39</span></a><span class="sd">        Reasoning paradigm to use. Default is &quot;function_calling&quot;.</span>
</span><span id="Agent-40"><a href="#Agent-40"><span class="linenos"> 40</span></a><span class="sd">    agent_prompt : str, optional</span>
</span><span id="Agent-41"><a href="#Agent-41"><span class="linenos"> 41</span></a><span class="sd">        Custom prompt for the agent. If None, uses the default prompt</span>
</span><span id="Agent-42"><a href="#Agent-42"><span class="linenos"> 42</span></a><span class="sd">        for the chosen paradigm. Default is None.</span>
</span><span id="Agent-43"><a href="#Agent-43"><span class="linenos"> 43</span></a><span class="sd">    name : str, optional</span>
</span><span id="Agent-44"><a href="#Agent-44"><span class="linenos"> 44</span></a><span class="sd">        Name identifier for the agent. Default is empty string.</span>
</span><span id="Agent-45"><a href="#Agent-45"><span class="linenos"> 45</span></a><span class="sd">    mcp_servers : list, optional</span>
</span><span id="Agent-46"><a href="#Agent-46"><span class="linenos"> 46</span></a><span class="sd">        List of MCP (Model Context Protocol) servers to register.</span>
</span><span id="Agent-47"><a href="#Agent-47"><span class="linenos"> 47</span></a><span class="sd">        Default is None.</span>
</span><span id="Agent-48"><a href="#Agent-48"><span class="linenos"> 48</span></a><span class="sd">    debug : bool, optional</span>
</span><span id="Agent-49"><a href="#Agent-49"><span class="linenos"> 49</span></a><span class="sd">        Flag to enable debug output during execution. Default is False.</span>
</span><span id="Agent-50"><a href="#Agent-50"><span class="linenos"> 50</span></a><span class="sd">    max_iter : int, optional</span>
</span><span id="Agent-51"><a href="#Agent-51"><span class="linenos"> 51</span></a><span class="sd">        Maximum number of iterations allowed for the agent.</span>
</span><span id="Agent-52"><a href="#Agent-52"><span class="linenos"> 52</span></a><span class="sd">        If None, there are no limits. Default is None.</span>
</span><span id="Agent-53"><a href="#Agent-53"><span class="linenos"> 53</span></a><span class="sd">    native_web_search : str, optional</span>
</span><span id="Agent-54"><a href="#Agent-54"><span class="linenos"> 54</span></a><span class="sd">        Native web search capability level. Must be one of:</span>
</span><span id="Agent-55"><a href="#Agent-55"><span class="linenos"> 55</span></a><span class="sd">        &quot;low&quot;, &quot;medium&quot;, or &quot;high&quot;. Default is None.</span>
</span><span id="Agent-56"><a href="#Agent-56"><span class="linenos"> 56</span></a><span class="sd">    human_feedback : str, optional</span>
</span><span id="Agent-57"><a href="#Agent-57"><span class="linenos"> 57</span></a><span class="sd">        Human feedback mode for controlling agent execution. Can be:</span>
</span><span id="Agent-58"><a href="#Agent-58"><span class="linenos"> 58</span></a><span class="sd">        - None: No human feedback required (default)</span>
</span><span id="Agent-59"><a href="#Agent-59"><span class="linenos"> 59</span></a><span class="sd">        - &quot;actions&quot;: Pause and request confirmation before executing tool actions</span>
</span><span id="Agent-60"><a href="#Agent-60"><span class="linenos"> 60</span></a><span class="sd">        - &quot;all&quot;: Pause after every step for human review</span>
</span><span id="Agent-61"><a href="#Agent-61"><span class="linenos"> 61</span></a><span class="sd">        Default is None.</span>
</span><span id="Agent-62"><a href="#Agent-62"><span class="linenos"> 62</span></a><span class="sd">    </span>
</span><span id="Agent-63"><a href="#Agent-63"><span class="linenos"> 63</span></a><span class="sd">    Attributes</span>
</span><span id="Agent-64"><a href="#Agent-64"><span class="linenos"> 64</span></a><span class="sd">    ----------</span>
</span><span id="Agent-65"><a href="#Agent-65"><span class="linenos"> 65</span></a><span class="sd">    name : str</span>
</span><span id="Agent-66"><a href="#Agent-66"><span class="linenos"> 66</span></a><span class="sd">        Name identifier for the agent</span>
</span><span id="Agent-67"><a href="#Agent-67"><span class="linenos"> 67</span></a><span class="sd">    _model : Model</span>
</span><span id="Agent-68"><a href="#Agent-68"><span class="linenos"> 68</span></a><span class="sd">        The AI model instance used for execution</span>
</span><span id="Agent-69"><a href="#Agent-69"><span class="linenos"> 69</span></a><span class="sd">    _loop : _AgenticLoop</span>
</span><span id="Agent-70"><a href="#Agent-70"><span class="linenos"> 70</span></a><span class="sd">        The agentic loop implementation for the chosen paradigm</span>
</span><span id="Agent-71"><a href="#Agent-71"><span class="linenos"> 71</span></a><span class="sd">        </span>
</span><span id="Agent-72"><a href="#Agent-72"><span class="linenos"> 72</span></a><span class="sd">    Supported Paradigms</span>
</span><span id="Agent-73"><a href="#Agent-73"><span class="linenos"> 73</span></a><span class="sd">    -------------------</span>
</span><span id="Agent-74"><a href="#Agent-74"><span class="linenos"> 74</span></a><span class="sd">    - **function_calling**: Native OpenAI function calling with tool integration</span>
</span><span id="Agent-75"><a href="#Agent-75"><span class="linenos"> 75</span></a><span class="sd">    - **react**: Reasoning and Acting pattern with iterative problem solving</span>
</span><span id="Agent-76"><a href="#Agent-76"><span class="linenos"> 76</span></a><span class="sd">    - **react_with_function_calling**: Combines ReAct reasoning with function calling</span>
</span><span id="Agent-77"><a href="#Agent-77"><span class="linenos"> 77</span></a><span class="sd">    - **plan-and-execute**: Two-phase approach: planning then execution</span>
</span><span id="Agent-78"><a href="#Agent-78"><span class="linenos"> 78</span></a><span class="sd">    - **programmatic**: Code generation and execution for computational tasks</span>
</span><span id="Agent-79"><a href="#Agent-79"><span class="linenos"> 79</span></a><span class="sd">    - **reflexion**: Self-reflective reasoning with error correction</span>
</span><span id="Agent-80"><a href="#Agent-80"><span class="linenos"> 80</span></a><span class="sd">    - **self_ask**: Self-questioning approach for complex reasoning</span>
</span><span id="Agent-81"><a href="#Agent-81"><span class="linenos"> 81</span></a><span class="sd">    - **self_ask_with_search**: Self-ask with web search capabilities</span>
</span><span id="Agent-82"><a href="#Agent-82"><span class="linenos"> 82</span></a><span class="sd">    </span>
</span><span id="Agent-83"><a href="#Agent-83"><span class="linenos"> 83</span></a><span class="sd">    Examples</span>
</span><span id="Agent-84"><a href="#Agent-84"><span class="linenos"> 84</span></a><span class="sd">    --------</span>
</span><span id="Agent-85"><a href="#Agent-85"><span class="linenos"> 85</span></a><span class="sd">    Basic function calling agent:</span>
</span><span id="Agent-86"><a href="#Agent-86"><span class="linenos"> 86</span></a><span class="sd">    &gt;&gt;&gt; from monoai.models import Model</span>
</span><span id="Agent-87"><a href="#Agent-87"><span class="linenos"> 87</span></a><span class="sd">    &gt;&gt;&gt; from monoai.agents import Agent</span>
</span><span id="Agent-88"><a href="#Agent-88"><span class="linenos"> 88</span></a><span class="sd">    &gt;&gt;&gt; </span>
</span><span id="Agent-89"><a href="#Agent-89"><span class="linenos"> 89</span></a><span class="sd">    &gt;&gt;&gt; model = Model(provider=&quot;openai&quot;, model=&quot;gpt-4&quot;)</span>
</span><span id="Agent-90"><a href="#Agent-90"><span class="linenos"> 90</span></a><span class="sd">    &gt;&gt;&gt; agent = Agent(model=model, paradigm=&quot;function_calling&quot;)</span>
</span><span id="Agent-91"><a href="#Agent-91"><span class="linenos"> 91</span></a><span class="sd">    &gt;&gt;&gt; response = agent.run(&quot;What&#39;s the weather like today?&quot;)</span>
</span><span id="Agent-92"><a href="#Agent-92"><span class="linenos"> 92</span></a><span class="sd">    </span>
</span><span id="Agent-93"><a href="#Agent-93"><span class="linenos"> 93</span></a><span class="sd">    ReAct agent with custom tools:</span>
</span><span id="Agent-94"><a href="#Agent-94"><span class="linenos"> 94</span></a><span class="sd">    &gt;&gt;&gt; def calculator(expression: str) -&gt; str:</span>
</span><span id="Agent-95"><a href="#Agent-95"><span class="linenos"> 95</span></a><span class="sd">    ...     return str(eval(expression))</span>
</span><span id="Agent-96"><a href="#Agent-96"><span class="linenos"> 96</span></a><span class="sd">    &gt;&gt;&gt; </span>
</span><span id="Agent-97"><a href="#Agent-97"><span class="linenos"> 97</span></a><span class="sd">    &gt;&gt;&gt; agent = Agent(</span>
</span><span id="Agent-98"><a href="#Agent-98"><span class="linenos"> 98</span></a><span class="sd">    ...     model=model,</span>
</span><span id="Agent-99"><a href="#Agent-99"><span class="linenos"> 99</span></a><span class="sd">    ...     paradigm=&quot;react&quot;,</span>
</span><span id="Agent-100"><a href="#Agent-100"><span class="linenos">100</span></a><span class="sd">    ...     tools=[calculator],</span>
</span><span id="Agent-101"><a href="#Agent-101"><span class="linenos">101</span></a><span class="sd">    ...     name=&quot;MathAgent&quot;</span>
</span><span id="Agent-102"><a href="#Agent-102"><span class="linenos">102</span></a><span class="sd">    ... )</span>
</span><span id="Agent-103"><a href="#Agent-103"><span class="linenos">103</span></a><span class="sd">    &gt;&gt;&gt; response = agent.run(&quot;Calculate 15 * 23 + 7&quot;)</span>
</span><span id="Agent-104"><a href="#Agent-104"><span class="linenos">104</span></a><span class="sd">    </span>
</span><span id="Agent-105"><a href="#Agent-105"><span class="linenos">105</span></a><span class="sd">    Agent with human feedback:</span>
</span><span id="Agent-106"><a href="#Agent-106"><span class="linenos">106</span></a><span class="sd">    &gt;&gt;&gt; agent = Agent(</span>
</span><span id="Agent-107"><a href="#Agent-107"><span class="linenos">107</span></a><span class="sd">    ...     model=model,</span>
</span><span id="Agent-108"><a href="#Agent-108"><span class="linenos">108</span></a><span class="sd">    ...     paradigm=&quot;plan-and-execute&quot;,</span>
</span><span id="Agent-109"><a href="#Agent-109"><span class="linenos">109</span></a><span class="sd">    ...     human_feedback=&quot;actions&quot;,</span>
</span><span id="Agent-110"><a href="#Agent-110"><span class="linenos">110</span></a><span class="sd">    ...     debug=True</span>
</span><span id="Agent-111"><a href="#Agent-111"><span class="linenos">111</span></a><span class="sd">    ... )</span>
</span><span id="Agent-112"><a href="#Agent-112"><span class="linenos">112</span></a><span class="sd">    &gt;&gt;&gt; response = agent.run(&quot;Plan and execute a data analysis task&quot;)</span>
</span><span id="Agent-113"><a href="#Agent-113"><span class="linenos">113</span></a><span class="sd">    </span>
</span><span id="Agent-114"><a href="#Agent-114"><span class="linenos">114</span></a><span class="sd">    Agent with MCP servers:</span>
</span><span id="Agent-115"><a href="#Agent-115"><span class="linenos">115</span></a><span class="sd">    &gt;&gt;&gt; mcp_server = McpServer(&quot;coingecko&quot;, &quot;http&quot;, server_url=&quot;https://mcp.api.coingecko.com/sse&quot;)</span>
</span><span id="Agent-116"><a href="#Agent-116"><span class="linenos">116</span></a><span class="sd">    &gt;&gt;&gt; agent = Agent(</span>
</span><span id="Agent-117"><a href="#Agent-117"><span class="linenos">117</span></a><span class="sd">    ...     model=model,</span>
</span><span id="Agent-118"><a href="#Agent-118"><span class="linenos">118</span></a><span class="sd">    ...     paradigm=&quot;function_calling&quot;,</span>
</span><span id="Agent-119"><a href="#Agent-119"><span class="linenos">119</span></a><span class="sd">    ...     mcp_servers=[mcp_server]</span>
</span><span id="Agent-120"><a href="#Agent-120"><span class="linenos">120</span></a><span class="sd">    ... )</span>
</span><span id="Agent-121"><a href="#Agent-121"><span class="linenos">121</span></a><span class="sd">    &gt;&gt;&gt; response = agent.run(&quot;What&#39;s the price of Bitcoin?&quot;)</span>
</span><span id="Agent-122"><a href="#Agent-122"><span class="linenos">122</span></a>
</span><span id="Agent-123"><a href="#Agent-123"><span class="linenos">123</span></a><span class="sd">    Custom paradigm agent:</span>
</span><span id="Agent-124"><a href="#Agent-124"><span class="linenos">124</span></a><span class="sd">    &gt;&gt;&gt; class CustomLoop(_AgenticLoop):</span>
</span><span id="Agent-125"><a href="#Agent-125"><span class="linenos">125</span></a><span class="sd">    ...     def start(self, prompt):</span>
</span><span id="Agent-126"><a href="#Agent-126"><span class="linenos">126</span></a><span class="sd">    ...         # Custom implementation</span>
</span><span id="Agent-127"><a href="#Agent-127"><span class="linenos">127</span></a><span class="sd">    ...         return {&quot;response&quot;: &quot;Custom result&quot;}</span>
</span><span id="Agent-128"><a href="#Agent-128"><span class="linenos">128</span></a><span class="sd">    &gt;&gt;&gt; </span>
</span><span id="Agent-129"><a href="#Agent-129"><span class="linenos">129</span></a><span class="sd">    &gt;&gt;&gt; custom_loop = CustomLoop()</span>
</span><span id="Agent-130"><a href="#Agent-130"><span class="linenos">130</span></a><span class="sd">    &gt;&gt;&gt; agent = Agent(model=model, paradigm=custom_loop)</span>
</span><span id="Agent-131"><a href="#Agent-131"><span class="linenos">131</span></a><span class="sd">    &gt;&gt;&gt; response = agent.run(&quot;Test custom paradigm&quot;)</span>
</span><span id="Agent-132"><a href="#Agent-132"><span class="linenos">132</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Agent-133"><a href="#Agent-133"><span class="linenos">133</span></a>    
</span><span id="Agent-134"><a href="#Agent-134"><span class="linenos">134</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">Model</span><span class="p">,</span> <span class="n">tools</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">paradigm</span><span class="o">=</span><span class="s2">&quot;function_calling&quot;</span><span class="p">,</span> 
</span><span id="Agent-135"><a href="#Agent-135"><span class="linenos">135</span></a>                 <span class="n">agent_prompt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">mcp_servers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">native_web_search</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
</span><span id="Agent-136"><a href="#Agent-136"><span class="linenos">136</span></a>                 <span class="n">human_feedback</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Agent-137"><a href="#Agent-137"><span class="linenos">137</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Agent-138"><a href="#Agent-138"><span class="linenos">138</span></a><span class="sd">        Initialize the agent with the specified model and configuration.</span>
</span><span id="Agent-139"><a href="#Agent-139"><span class="linenos">139</span></a><span class="sd">        </span>
</span><span id="Agent-140"><a href="#Agent-140"><span class="linenos">140</span></a><span class="sd">        Sets up an AI agent with the chosen reasoning paradigm, registers</span>
</span><span id="Agent-141"><a href="#Agent-141"><span class="linenos">141</span></a><span class="sd">        any provided tools, and configures execution parameters.</span>
</span><span id="Agent-142"><a href="#Agent-142"><span class="linenos">142</span></a><span class="sd">        </span>
</span><span id="Agent-143"><a href="#Agent-143"><span class="linenos">143</span></a><span class="sd">        Raises</span>
</span><span id="Agent-144"><a href="#Agent-144"><span class="linenos">144</span></a><span class="sd">        ------</span>
</span><span id="Agent-145"><a href="#Agent-145"><span class="linenos">145</span></a><span class="sd">        ValueError</span>
</span><span id="Agent-146"><a href="#Agent-146"><span class="linenos">146</span></a><span class="sd">            If the specified paradigm is not supported or invalid</span>
</span><span id="Agent-147"><a href="#Agent-147"><span class="linenos">147</span></a><span class="sd">        TypeError</span>
</span><span id="Agent-148"><a href="#Agent-148"><span class="linenos">148</span></a><span class="sd">            If a custom object is passed that doesn&#39;t derive from _AgenticLoop</span>
</span><span id="Agent-149"><a href="#Agent-149"><span class="linenos">149</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Agent-150"><a href="#Agent-150"><span class="linenos">150</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="n">model</span>
</span><span id="Agent-151"><a href="#Agent-151"><span class="linenos">151</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="Agent-152"><a href="#Agent-152"><span class="linenos">152</span></a>
</span><span id="Agent-153"><a href="#Agent-153"><span class="linenos">153</span></a>        <span class="k">if</span> <span class="n">native_web_search</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">native_web_search</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;low&quot;</span><span class="p">,</span> <span class="s2">&quot;medium&quot;</span><span class="p">,</span> <span class="s2">&quot;high&quot;</span><span class="p">]:</span>
</span><span id="Agent-154"><a href="#Agent-154"><span class="linenos">154</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;native_web_search must be &#39;low&#39;, &#39;medium&#39; or &#39;high&#39;&quot;</span><span class="p">)</span>
</span><span id="Agent-155"><a href="#Agent-155"><span class="linenos">155</span></a>        
</span><span id="Agent-156"><a href="#Agent-156"><span class="linenos">156</span></a>        <span class="k">if</span> <span class="n">human_feedback</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">human_feedback</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;actions&quot;</span><span class="p">,</span> <span class="s2">&quot;all&quot;</span><span class="p">]:</span>
</span><span id="Agent-157"><a href="#Agent-157"><span class="linenos">157</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;human_feedback must be None, &#39;actions&#39;, or &#39;all&#39;&quot;</span><span class="p">)</span>
</span><span id="Agent-158"><a href="#Agent-158"><span class="linenos">158</span></a>        
</span><span id="Agent-159"><a href="#Agent-159"><span class="linenos">159</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">_web_search</span> <span class="o">=</span> <span class="n">native_web_search</span>
</span><span id="Agent-160"><a href="#Agent-160"><span class="linenos">160</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_human_feedback</span> <span class="o">=</span> <span class="n">human_feedback</span>
</span><span id="Agent-161"><a href="#Agent-161"><span class="linenos">161</span></a>
</span><span id="Agent-162"><a href="#Agent-162"><span class="linenos">162</span></a>        <span class="c1"># Handle custom paradigm</span>
</span><span id="Agent-163"><a href="#Agent-163"><span class="linenos">163</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">paradigm</span><span class="p">,</span> <span class="n">_AgenticLoop</span><span class="p">):</span>
</span><span id="Agent-164"><a href="#Agent-164"><span class="linenos">164</span></a>            <span class="c1"># Verify that the custom object is valid</span>
</span><span id="Agent-165"><a href="#Agent-165"><span class="linenos">165</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">paradigm</span><span class="p">,</span> <span class="s1">&#39;start&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">paradigm</span><span class="o">.</span><span class="n">start</span><span class="p">):</span>
</span><span id="Agent-166"><a href="#Agent-166"><span class="linenos">166</span></a>                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Custom paradigm must have a callable &#39;start&#39; method&quot;</span><span class="p">)</span>
</span><span id="Agent-167"><a href="#Agent-167"><span class="linenos">167</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_loop</span> <span class="o">=</span> <span class="n">paradigm</span>
</span><span id="Agent-168"><a href="#Agent-168"><span class="linenos">168</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Agent-169"><a href="#Agent-169"><span class="linenos">169</span></a>            <span class="c1"># Predefined paradigms</span>
</span><span id="Agent-170"><a href="#Agent-170"><span class="linenos">170</span></a>            <span class="n">loop_kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span> <span class="n">agent_prompt</span><span class="p">,</span> <span class="n">debug</span><span class="p">,</span> <span class="n">max_iter</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">human_feedback</span>
</span><span id="Agent-171"><a href="#Agent-171"><span class="linenos">171</span></a>            
</span><span id="Agent-172"><a href="#Agent-172"><span class="linenos">172</span></a>            <span class="k">if</span> <span class="n">paradigm</span> <span class="o">==</span> <span class="s2">&quot;function_calling&quot;</span><span class="p">:</span>
</span><span id="Agent-173"><a href="#Agent-173"><span class="linenos">173</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_loop</span> <span class="o">=</span> <span class="n">FunctionCallingAgenticLoop</span><span class="p">(</span><span class="o">*</span><span class="n">loop_kwargs</span><span class="p">)</span>
</span><span id="Agent-174"><a href="#Agent-174"><span class="linenos">174</span></a>            <span class="k">elif</span> <span class="n">paradigm</span> <span class="o">==</span> <span class="s2">&quot;react&quot;</span><span class="p">:</span>
</span><span id="Agent-175"><a href="#Agent-175"><span class="linenos">175</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_loop</span> <span class="o">=</span> <span class="n">ReactAgenticLoop</span><span class="p">(</span><span class="o">*</span><span class="n">loop_kwargs</span><span class="p">)</span>
</span><span id="Agent-176"><a href="#Agent-176"><span class="linenos">176</span></a>            <span class="k">elif</span> <span class="n">paradigm</span> <span class="o">==</span> <span class="s2">&quot;react_with_function_calling&quot;</span><span class="p">:</span>
</span><span id="Agent-177"><a href="#Agent-177"><span class="linenos">177</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_loop</span> <span class="o">=</span> <span class="n">ReactWithFCAgenticLoop</span><span class="p">(</span><span class="o">*</span><span class="n">loop_kwargs</span><span class="p">)</span>
</span><span id="Agent-178"><a href="#Agent-178"><span class="linenos">178</span></a>            <span class="k">elif</span> <span class="n">paradigm</span> <span class="o">==</span> <span class="s2">&quot;plan-and-execute&quot;</span><span class="p">:</span>
</span><span id="Agent-179"><a href="#Agent-179"><span class="linenos">179</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_loop</span> <span class="o">=</span> <span class="n">PlanAndExecuteAgenticLoop</span><span class="p">(</span><span class="o">*</span><span class="n">loop_kwargs</span><span class="p">)</span>
</span><span id="Agent-180"><a href="#Agent-180"><span class="linenos">180</span></a>            <span class="k">elif</span> <span class="n">paradigm</span> <span class="o">==</span> <span class="s2">&quot;programmatic&quot;</span><span class="p">:</span>
</span><span id="Agent-181"><a href="#Agent-181"><span class="linenos">181</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_loop</span> <span class="o">=</span> <span class="n">ProgrammaticAgenticLoop</span><span class="p">(</span><span class="o">*</span><span class="n">loop_kwargs</span><span class="p">)</span>
</span><span id="Agent-182"><a href="#Agent-182"><span class="linenos">182</span></a>            <span class="k">elif</span> <span class="n">paradigm</span> <span class="o">==</span> <span class="s2">&quot;reflexion&quot;</span><span class="p">:</span>
</span><span id="Agent-183"><a href="#Agent-183"><span class="linenos">183</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_loop</span> <span class="o">=</span> <span class="n">ReflexionAgenticLoop</span><span class="p">(</span><span class="o">*</span><span class="n">loop_kwargs</span><span class="p">)</span>
</span><span id="Agent-184"><a href="#Agent-184"><span class="linenos">184</span></a>            <span class="k">elif</span> <span class="n">paradigm</span> <span class="o">==</span> <span class="s2">&quot;self_ask&quot;</span><span class="p">:</span>
</span><span id="Agent-185"><a href="#Agent-185"><span class="linenos">185</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_loop</span> <span class="o">=</span> <span class="n">SelfAskAgenticLoop</span><span class="p">(</span><span class="o">*</span><span class="n">loop_kwargs</span><span class="p">)</span>
</span><span id="Agent-186"><a href="#Agent-186"><span class="linenos">186</span></a>            <span class="k">elif</span> <span class="n">paradigm</span> <span class="o">==</span> <span class="s2">&quot;self_ask_with_search&quot;</span><span class="p">:</span>
</span><span id="Agent-187"><a href="#Agent-187"><span class="linenos">187</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_loop</span> <span class="o">=</span> <span class="n">SelfAskWithSearchLoop</span><span class="p">(</span><span class="o">*</span><span class="n">loop_kwargs</span><span class="p">)</span>
</span><span id="Agent-188"><a href="#Agent-188"><span class="linenos">188</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Agent-189"><a href="#Agent-189"><span class="linenos">189</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Paradigm &#39;</span><span class="si">{</span><span class="n">paradigm</span><span class="si">}</span><span class="s2">&#39; not supported. &quot;</span>
</span><span id="Agent-190"><a href="#Agent-190"><span class="linenos">190</span></a>                               <span class="sa">f</span><span class="s2">&quot;Available paradigms: function_calling, react, &quot;</span>
</span><span id="Agent-191"><a href="#Agent-191"><span class="linenos">191</span></a>                               <span class="sa">f</span><span class="s2">&quot;react_with_function_calling, plan-and-execute, &quot;</span>
</span><span id="Agent-192"><a href="#Agent-192"><span class="linenos">192</span></a>                               <span class="sa">f</span><span class="s2">&quot;programmatic, reflexion, self_ask, self_ask_with_search, &quot;</span>
</span><span id="Agent-193"><a href="#Agent-193"><span class="linenos">193</span></a>                               <span class="sa">f</span><span class="s2">&quot;or a custom object derived from _AgenticLoop&quot;</span><span class="p">)</span>
</span><span id="Agent-194"><a href="#Agent-194"><span class="linenos">194</span></a>        
</span><span id="Agent-195"><a href="#Agent-195"><span class="linenos">195</span></a>        <span class="k">if</span> <span class="n">tools</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Agent-196"><a href="#Agent-196"><span class="linenos">196</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_loop</span><span class="o">.</span><span class="n">register_tools</span><span class="p">(</span><span class="n">tools</span><span class="p">)</span>
</span><span id="Agent-197"><a href="#Agent-197"><span class="linenos">197</span></a>        
</span><span id="Agent-198"><a href="#Agent-198"><span class="linenos">198</span></a>        <span class="k">if</span> <span class="n">mcp_servers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Agent-199"><a href="#Agent-199"><span class="linenos">199</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_loop</span><span class="o">.</span><span class="n">register_mcp_servers</span><span class="p">(</span><span class="n">mcp_servers</span><span class="p">)</span>
</span><span id="Agent-200"><a href="#Agent-200"><span class="linenos">200</span></a>        
</span><span id="Agent-201"><a href="#Agent-201"><span class="linenos">201</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Prompt</span><span class="p">):</span>
</span><span id="Agent-202"><a href="#Agent-202"><span class="linenos">202</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Agent-203"><a href="#Agent-203"><span class="linenos">203</span></a><span class="sd">        Execute the agent with the specified prompt.</span>
</span><span id="Agent-204"><a href="#Agent-204"><span class="linenos">204</span></a><span class="sd">        </span>
</span><span id="Agent-205"><a href="#Agent-205"><span class="linenos">205</span></a><span class="sd">        Processes a user prompt through the agent&#39;s reasoning paradigm,</span>
</span><span id="Agent-206"><a href="#Agent-206"><span class="linenos">206</span></a><span class="sd">        returning a structured response that includes the reasoning process</span>
</span><span id="Agent-207"><a href="#Agent-207"><span class="linenos">207</span></a><span class="sd">        and final answer.</span>
</span><span id="Agent-208"><a href="#Agent-208"><span class="linenos">208</span></a><span class="sd">        </span>
</span><span id="Agent-209"><a href="#Agent-209"><span class="linenos">209</span></a><span class="sd">        Parameters</span>
</span><span id="Agent-210"><a href="#Agent-210"><span class="linenos">210</span></a><span class="sd">        ----------</span>
</span><span id="Agent-211"><a href="#Agent-211"><span class="linenos">211</span></a><span class="sd">        prompt : str or Prompt</span>
</span><span id="Agent-212"><a href="#Agent-212"><span class="linenos">212</span></a><span class="sd">            User prompt or query to process. Can be a string or a Prompt object.</span>
</span><span id="Agent-213"><a href="#Agent-213"><span class="linenos">213</span></a><span class="sd">        </span>
</span><span id="Agent-214"><a href="#Agent-214"><span class="linenos">214</span></a><span class="sd">        Returns</span>
</span><span id="Agent-215"><a href="#Agent-215"><span class="linenos">215</span></a><span class="sd">        -------</span>
</span><span id="Agent-216"><a href="#Agent-216"><span class="linenos">216</span></a><span class="sd">        Dict[str, Any]</span>
</span><span id="Agent-217"><a href="#Agent-217"><span class="linenos">217</span></a><span class="sd">            Agent response containing:</span>
</span><span id="Agent-218"><a href="#Agent-218"><span class="linenos">218</span></a><span class="sd">            - prompt: Original user query</span>
</span><span id="Agent-219"><a href="#Agent-219"><span class="linenos">219</span></a><span class="sd">            - iterations: List of processed reasoning iterations</span>
</span><span id="Agent-220"><a href="#Agent-220"><span class="linenos">220</span></a><span class="sd">            - response: Final response (if available)</span>
</span><span id="Agent-221"><a href="#Agent-221"><span class="linenos">221</span></a><span class="sd">            - metadata: Additional execution metadata (paradigm-specific)</span>
</span><span id="Agent-222"><a href="#Agent-222"><span class="linenos">222</span></a><span class="sd">        </span>
</span><span id="Agent-223"><a href="#Agent-223"><span class="linenos">223</span></a><span class="sd">        Examples</span>
</span><span id="Agent-224"><a href="#Agent-224"><span class="linenos">224</span></a><span class="sd">        --------</span>
</span><span id="Agent-225"><a href="#Agent-225"><span class="linenos">225</span></a><span class="sd">        &gt;&gt;&gt; agent = Agent(model=model, paradigm=&quot;function_calling&quot;)</span>
</span><span id="Agent-226"><a href="#Agent-226"><span class="linenos">226</span></a><span class="sd">        &gt;&gt;&gt; response = agent.run(&quot;What&#39;s the weather in New York?&quot;)</span>
</span><span id="Agent-227"><a href="#Agent-227"><span class="linenos">227</span></a><span class="sd">        &gt;&gt;&gt; print(response[&#39;response&#39;])</span>
</span><span id="Agent-228"><a href="#Agent-228"><span class="linenos">228</span></a><span class="sd">        </span>
</span><span id="Agent-229"><a href="#Agent-229"><span class="linenos">229</span></a><span class="sd">        &gt;&gt;&gt; from monoai.prompts import Prompt</span>
</span><span id="Agent-230"><a href="#Agent-230"><span class="linenos">230</span></a><span class="sd">        &gt;&gt;&gt; prompt = Prompt(&quot;Analyze this data: [1, 2, 3, 4, 5]&quot;)</span>
</span><span id="Agent-231"><a href="#Agent-231"><span class="linenos">231</span></a><span class="sd">        &gt;&gt;&gt; response = agent.run(prompt)</span>
</span><span id="Agent-232"><a href="#Agent-232"><span class="linenos">232</span></a><span class="sd">        &gt;&gt;&gt; print(response[&#39;iterations&#39;])</span>
</span><span id="Agent-233"><a href="#Agent-233"><span class="linenos">233</span></a><span class="sd">        </span>
</span><span id="Agent-234"><a href="#Agent-234"><span class="linenos">234</span></a><span class="sd">        Notes</span>
</span><span id="Agent-235"><a href="#Agent-235"><span class="linenos">235</span></a><span class="sd">        -----</span>
</span><span id="Agent-236"><a href="#Agent-236"><span class="linenos">236</span></a><span class="sd">        The response structure varies by paradigm:</span>
</span><span id="Agent-237"><a href="#Agent-237"><span class="linenos">237</span></a><span class="sd">        - **Function calling**: Includes tool call details and function results</span>
</span><span id="Agent-238"><a href="#Agent-238"><span class="linenos">238</span></a><span class="sd">        - **ReAct**: Includes thought-action-observation cycles</span>
</span><span id="Agent-239"><a href="#Agent-239"><span class="linenos">239</span></a><span class="sd">        - **Plan-and-execute**: Includes planning and execution phases</span>
</span><span id="Agent-240"><a href="#Agent-240"><span class="linenos">240</span></a><span class="sd">        - **Programmatic**: Includes code generation and execution results</span>
</span><span id="Agent-241"><a href="#Agent-241"><span class="linenos">241</span></a><span class="sd">        - **Reflexion**: Includes self-reflection and error correction steps</span>
</span><span id="Agent-242"><a href="#Agent-242"><span class="linenos">242</span></a><span class="sd">        - **Self-ask**: Includes question-answer reasoning chains</span>
</span><span id="Agent-243"><a href="#Agent-243"><span class="linenos">243</span></a><span class="sd">        - **Self-ask with search**: Includes web search results and reasoning</span>
</span><span id="Agent-244"><a href="#Agent-244"><span class="linenos">244</span></a><span class="sd">        - **Custom paradigms**: May include paradigm-specific information</span>
</span><span id="Agent-245"><a href="#Agent-245"><span class="linenos">245</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Agent-246"><a href="#Agent-246"><span class="linenos">246</span></a>        
</span><span id="Agent-247"><a href="#Agent-247"><span class="linenos">247</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loop</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span>
</span><span id="Agent-248"><a href="#Agent-248"><span class="linenos">248</span></a>    
</span><span id="Agent-249"><a href="#Agent-249"><span class="linenos">249</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">enable_streaming</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_callback</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Agent-250"><a href="#Agent-250"><span class="linenos">250</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Agent-251"><a href="#Agent-251"><span class="linenos">251</span></a><span class="sd">        Enable streaming responses for this agent.</span>
</span><span id="Agent-252"><a href="#Agent-252"><span class="linenos">252</span></a><span class="sd">        </span>
</span><span id="Agent-253"><a href="#Agent-253"><span class="linenos">253</span></a><span class="sd">        When streaming is enabled, the agent will call the provided callback</span>
</span><span id="Agent-254"><a href="#Agent-254"><span class="linenos">254</span></a><span class="sd">        function with each content chunk as it&#39;s generated, allowing for</span>
</span><span id="Agent-255"><a href="#Agent-255"><span class="linenos">255</span></a><span class="sd">        real-time processing and display of the AI&#39;s response.</span>
</span><span id="Agent-256"><a href="#Agent-256"><span class="linenos">256</span></a><span class="sd">        </span>
</span><span id="Agent-257"><a href="#Agent-257"><span class="linenos">257</span></a><span class="sd">        Parameters</span>
</span><span id="Agent-258"><a href="#Agent-258"><span class="linenos">258</span></a><span class="sd">        ----------</span>
</span><span id="Agent-259"><a href="#Agent-259"><span class="linenos">259</span></a><span class="sd">        stream_callback : callable, optional</span>
</span><span id="Agent-260"><a href="#Agent-260"><span class="linenos">260</span></a><span class="sd">            Callback function to handle streaming content chunks.</span>
</span><span id="Agent-261"><a href="#Agent-261"><span class="linenos">261</span></a><span class="sd">            If None, uses a default callback that prints content to console.</span>
</span><span id="Agent-262"><a href="#Agent-262"><span class="linenos">262</span></a><span class="sd">            The callback receives plain text content strings.</span>
</span><span id="Agent-263"><a href="#Agent-263"><span class="linenos">263</span></a><span class="sd">            </span>
</span><span id="Agent-264"><a href="#Agent-264"><span class="linenos">264</span></a><span class="sd">            Callback signature: callback(content: str) -&gt; None</span>
</span><span id="Agent-265"><a href="#Agent-265"><span class="linenos">265</span></a><span class="sd">            where content is the streaming text chunk.</span>
</span><span id="Agent-266"><a href="#Agent-266"><span class="linenos">266</span></a><span class="sd">        </span>
</span><span id="Agent-267"><a href="#Agent-267"><span class="linenos">267</span></a><span class="sd">        Raises</span>
</span><span id="Agent-268"><a href="#Agent-268"><span class="linenos">268</span></a><span class="sd">        ------</span>
</span><span id="Agent-269"><a href="#Agent-269"><span class="linenos">269</span></a><span class="sd">        AttributeError</span>
</span><span id="Agent-270"><a href="#Agent-270"><span class="linenos">270</span></a><span class="sd">            If the current paradigm doesn&#39;t support streaming</span>
</span><span id="Agent-271"><a href="#Agent-271"><span class="linenos">271</span></a><span class="sd">            </span>
</span><span id="Agent-272"><a href="#Agent-272"><span class="linenos">272</span></a><span class="sd">        Examples</span>
</span><span id="Agent-273"><a href="#Agent-273"><span class="linenos">273</span></a><span class="sd">        --------</span>
</span><span id="Agent-274"><a href="#Agent-274"><span class="linenos">274</span></a><span class="sd">        &gt;&gt;&gt; def my_callback(content):</span>
</span><span id="Agent-275"><a href="#Agent-275"><span class="linenos">275</span></a><span class="sd">        ...     print(f&quot;Streaming: {content}&quot;)</span>
</span><span id="Agent-276"><a href="#Agent-276"><span class="linenos">276</span></a><span class="sd">        &gt;&gt;&gt; </span>
</span><span id="Agent-277"><a href="#Agent-277"><span class="linenos">277</span></a><span class="sd">        &gt;&gt;&gt; agent = Agent(model=model, paradigm=&quot;function_calling&quot;)</span>
</span><span id="Agent-278"><a href="#Agent-278"><span class="linenos">278</span></a><span class="sd">        &gt;&gt;&gt; agent.enable_streaming(my_callback)</span>
</span><span id="Agent-279"><a href="#Agent-279"><span class="linenos">279</span></a><span class="sd">        &gt;&gt;&gt; response = agent.run(&quot;Tell me a story&quot;)</span>
</span><span id="Agent-280"><a href="#Agent-280"><span class="linenos">280</span></a><span class="sd">        </span>
</span><span id="Agent-281"><a href="#Agent-281"><span class="linenos">281</span></a><span class="sd">        Notes</span>
</span><span id="Agent-282"><a href="#Agent-282"><span class="linenos">282</span></a><span class="sd">        -----</span>
</span><span id="Agent-283"><a href="#Agent-283"><span class="linenos">283</span></a><span class="sd">        Not all paradigms support streaming. Check the specific paradigm</span>
</span><span id="Agent-284"><a href="#Agent-284"><span class="linenos">284</span></a><span class="sd">        implementation to ensure streaming is available.</span>
</span><span id="Agent-285"><a href="#Agent-285"><span class="linenos">285</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Agent-286"><a href="#Agent-286"><span class="linenos">286</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_loop</span><span class="p">,</span> <span class="s1">&#39;enable_streaming&#39;</span><span class="p">):</span>
</span><span id="Agent-287"><a href="#Agent-287"><span class="linenos">287</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_loop</span><span class="o">.</span><span class="n">enable_streaming</span><span class="p">(</span><span class="n">stream_callback</span><span class="p">)</span>
</span><span id="Agent-288"><a href="#Agent-288"><span class="linenos">288</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Agent-289"><a href="#Agent-289"><span class="linenos">289</span></a>            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Paradigm &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_loop</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39; doesn&#39;t support streaming&quot;</span><span class="p">)</span>
</span><span id="Agent-290"><a href="#Agent-290"><span class="linenos">290</span></a>    
</span><span id="Agent-291"><a href="#Agent-291"><span class="linenos">291</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">disable_streaming</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Agent-292"><a href="#Agent-292"><span class="linenos">292</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Agent-293"><a href="#Agent-293"><span class="linenos">293</span></a><span class="sd">        Disable streaming responses for this agent.</span>
</span><span id="Agent-294"><a href="#Agent-294"><span class="linenos">294</span></a><span class="sd">        </span>
</span><span id="Agent-295"><a href="#Agent-295"><span class="linenos">295</span></a><span class="sd">        After calling this method, the agent will use standard (non-streaming)</span>
</span><span id="Agent-296"><a href="#Agent-296"><span class="linenos">296</span></a><span class="sd">        model execution for all subsequent requests.</span>
</span><span id="Agent-297"><a href="#Agent-297"><span class="linenos">297</span></a><span class="sd">        </span>
</span><span id="Agent-298"><a href="#Agent-298"><span class="linenos">298</span></a><span class="sd">        Raises</span>
</span><span id="Agent-299"><a href="#Agent-299"><span class="linenos">299</span></a><span class="sd">        ------</span>
</span><span id="Agent-300"><a href="#Agent-300"><span class="linenos">300</span></a><span class="sd">        AttributeError</span>
</span><span id="Agent-301"><a href="#Agent-301"><span class="linenos">301</span></a><span class="sd">            If the current paradigm doesn&#39;t support streaming</span>
</span><span id="Agent-302"><a href="#Agent-302"><span class="linenos">302</span></a><span class="sd">            </span>
</span><span id="Agent-303"><a href="#Agent-303"><span class="linenos">303</span></a><span class="sd">        Examples</span>
</span><span id="Agent-304"><a href="#Agent-304"><span class="linenos">304</span></a><span class="sd">        --------</span>
</span><span id="Agent-305"><a href="#Agent-305"><span class="linenos">305</span></a><span class="sd">        &gt;&gt;&gt; agent = Agent(model=model, paradigm=&quot;function_calling&quot;)</span>
</span><span id="Agent-306"><a href="#Agent-306"><span class="linenos">306</span></a><span class="sd">        &gt;&gt;&gt; agent.enable_streaming()</span>
</span><span id="Agent-307"><a href="#Agent-307"><span class="linenos">307</span></a><span class="sd">        &gt;&gt;&gt; # ... use streaming ...</span>
</span><span id="Agent-308"><a href="#Agent-308"><span class="linenos">308</span></a><span class="sd">        &gt;&gt;&gt; agent.disable_streaming()</span>
</span><span id="Agent-309"><a href="#Agent-309"><span class="linenos">309</span></a><span class="sd">        &gt;&gt;&gt; # Now using standard execution</span>
</span><span id="Agent-310"><a href="#Agent-310"><span class="linenos">310</span></a><span class="sd">        </span>
</span><span id="Agent-311"><a href="#Agent-311"><span class="linenos">311</span></a><span class="sd">        Notes</span>
</span><span id="Agent-312"><a href="#Agent-312"><span class="linenos">312</span></a><span class="sd">        -----</span>
</span><span id="Agent-313"><a href="#Agent-313"><span class="linenos">313</span></a><span class="sd">        Not all paradigms support streaming. Check the specific paradigm</span>
</span><span id="Agent-314"><a href="#Agent-314"><span class="linenos">314</span></a><span class="sd">        implementation to ensure streaming is available.</span>
</span><span id="Agent-315"><a href="#Agent-315"><span class="linenos">315</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Agent-316"><a href="#Agent-316"><span class="linenos">316</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_loop</span><span class="p">,</span> <span class="s1">&#39;disable_streaming&#39;</span><span class="p">):</span>
</span><span id="Agent-317"><a href="#Agent-317"><span class="linenos">317</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_loop</span><span class="o">.</span><span class="n">disable_streaming</span><span class="p">()</span>
</span><span id="Agent-318"><a href="#Agent-318"><span class="linenos">318</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Agent-319"><a href="#Agent-319"><span class="linenos">319</span></a>            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Paradigm &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_loop</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39; doesn&#39;t support streaming&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>AI Agent that implements different reasoning paradigms for autonomous task execution.</p>

<p>The Agent class provides a unified interface for creating and using AI agents
with various reasoning paradigms. It acts as a high-level wrapper around
specific agentic loop implementations, offering a consistent API regardless
of the underlying reasoning pattern.</p>

<p>The agent can be configured with different reasoning approaches, tools,
and execution parameters to handle complex tasks autonomously or with
human oversight.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>model</strong> (Model):
AI model instance to use for agent execution</li>
<li><strong>tools</strong> (list, optional):
List of available tools for the agent. Each tool should be a
callable function. Default is None.</li>
<li><strong>paradigm</strong> (str or _AgenticLoop, optional):
Reasoning paradigm to use. Default is "function_calling".</li>
<li><strong>agent_prompt</strong> (str, optional):
Custom prompt for the agent. If None, uses the default prompt
for the chosen paradigm. Default is None.</li>
<li><strong>name</strong> (str, optional):
Name identifier for the agent. Default is empty string.</li>
<li><strong>mcp_servers</strong> (list, optional):
List of MCP (Model Context Protocol) servers to register.
Default is None.</li>
<li><strong>debug</strong> (bool, optional):
Flag to enable debug output during execution. Default is False.</li>
<li><strong>max_iter</strong> (int, optional):
Maximum number of iterations allowed for the agent.
If None, there are no limits. Default is None.</li>
<li><strong>native_web_search</strong> (str, optional):
Native web search capability level. Must be one of:
"low", "medium", or "high". Default is None.</li>
<li><strong>human_feedback</strong> (str, optional):
Human feedback mode for controlling agent execution. Can be:
<ul>
<li>None: No human feedback required (default)</li>
<li>"actions": Pause and request confirmation before executing tool actions</li>
<li>"all": Pause after every step for human review
Default is None.</li>
</ul></li>
</ul>

<h6 id="attributes">Attributes</h6>

<ul>
<li><strong>name</strong> (str):
Name identifier for the agent</li>
<li><strong>_model</strong> (Model):
The AI model instance used for execution</li>
<li><strong>_loop</strong> (_AgenticLoop):
The agentic loop implementation for the chosen paradigm</li>
</ul>

<h6 id="supported-paradigms">Supported Paradigms</h6>

<ul>
<li><strong>function_calling</strong>: Native OpenAI function calling with tool integration</li>
<li><strong>react</strong>: Reasoning and Acting pattern with iterative problem solving</li>
<li><strong>react_with_function_calling</strong>: Combines ReAct reasoning with function calling</li>
<li><strong>plan-and-execute</strong>: Two-phase approach: planning then execution</li>
<li><strong>programmatic</strong>: Code generation and execution for computational tasks</li>
<li><strong>reflexion</strong>: Self-reflective reasoning with error correction</li>
<li><strong>self_ask</strong>: Self-questioning approach for complex reasoning</li>
<li><strong>self_ask_with_search</strong>: Self-ask with web search capabilities</li>
</ul>

<h6 id="examples">Examples</h6>

<p>Basic function calling agent:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn"><a href="models.html">monoai.models</a></span><span class="w"> </span><span class="kn">import</span> <span class="n">Model</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn"><a href="">monoai.agents</a></span><span class="w"> </span><span class="kn">import</span> <span class="n">Agent</span>
<span class="gp">&gt;&gt;&gt; </span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">provider</span><span class="o">=</span><span class="s2">&quot;openai&quot;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s2">&quot;gpt-4&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">agent</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">paradigm</span><span class="o">=</span><span class="s2">&quot;function_calling&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;What&#39;s the weather like today?&quot;</span><span class="p">)</span>
</code></pre>
</div>

<p>ReAct agent with custom tools:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span><span class="w"> </span><span class="nf">calculator</span><span class="p">(</span><span class="n">expression</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">expression</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">agent</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">paradigm</span><span class="o">=</span><span class="s2">&quot;react&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">calculator</span><span class="p">],</span>
<span class="gp">... </span>    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;MathAgent&quot;</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;Calculate 15 * 23 + 7&quot;</span><span class="p">)</span>
</code></pre>
</div>

<p>Agent with human feedback:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">agent</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">paradigm</span><span class="o">=</span><span class="s2">&quot;plan-and-execute&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">human_feedback</span><span class="o">=</span><span class="s2">&quot;actions&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">debug</span><span class="o">=</span><span class="kc">True</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;Plan and execute a data analysis task&quot;</span><span class="p">)</span>
</code></pre>
</div>

<p>Agent with MCP servers:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">mcp_server</span> <span class="o">=</span> <span class="n">McpServer</span><span class="p">(</span><span class="s2">&quot;coingecko&quot;</span><span class="p">,</span> <span class="s2">&quot;http&quot;</span><span class="p">,</span> <span class="n">server_url</span><span class="o">=</span><span class="s2">&quot;https://mcp.api.coingecko.com/sse&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">agent</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">paradigm</span><span class="o">=</span><span class="s2">&quot;function_calling&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">mcp_servers</span><span class="o">=</span><span class="p">[</span><span class="n">mcp_server</span><span class="p">]</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;What&#39;s the price of Bitcoin?&quot;</span><span class="p">)</span>
</code></pre>
</div>

<p>Custom paradigm agent:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span><span class="w"> </span><span class="nc">CustomLoop</span><span class="p">(</span><span class="n">_AgenticLoop</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span><span class="w"> </span><span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prompt</span><span class="p">):</span>
<span class="gp">... </span>        <span class="c1"># Custom implementation</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;response&quot;</span><span class="p">:</span> <span class="s2">&quot;Custom result&quot;</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">custom_loop</span> <span class="o">=</span> <span class="n">CustomLoop</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">agent</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">paradigm</span><span class="o">=</span><span class="n">custom_loop</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;Test custom paradigm&quot;</span><span class="p">)</span>
</code></pre>
</div>
</div>


                            <div id="Agent.__init__" class="classattr">
                                        <input id="Agent.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Agent</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">model</span><span class="p">:</span> <span class="n"><a href="models.html#Model">monoai.models.Model</a></span>,</span><span class="param">	<span class="n">tools</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">paradigm</span><span class="o">=</span><span class="s1">&#39;function_calling&#39;</span>,</span><span class="param">	<span class="n">agent_prompt</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">name</span><span class="o">=</span><span class="s1">&#39;&#39;</span>,</span><span class="param">	<span class="n">mcp_servers</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">debug</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">max_iter</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">native_web_search</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">human_feedback</span><span class="o">=</span><span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="Agent.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Agent.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Agent.__init__-134"><a href="#Agent.__init__-134"><span class="linenos">134</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">Model</span><span class="p">,</span> <span class="n">tools</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">paradigm</span><span class="o">=</span><span class="s2">&quot;function_calling&quot;</span><span class="p">,</span> 
</span><span id="Agent.__init__-135"><a href="#Agent.__init__-135"><span class="linenos">135</span></a>                 <span class="n">agent_prompt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">mcp_servers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">native_web_search</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
</span><span id="Agent.__init__-136"><a href="#Agent.__init__-136"><span class="linenos">136</span></a>                 <span class="n">human_feedback</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Agent.__init__-137"><a href="#Agent.__init__-137"><span class="linenos">137</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Agent.__init__-138"><a href="#Agent.__init__-138"><span class="linenos">138</span></a><span class="sd">        Initialize the agent with the specified model and configuration.</span>
</span><span id="Agent.__init__-139"><a href="#Agent.__init__-139"><span class="linenos">139</span></a><span class="sd">        </span>
</span><span id="Agent.__init__-140"><a href="#Agent.__init__-140"><span class="linenos">140</span></a><span class="sd">        Sets up an AI agent with the chosen reasoning paradigm, registers</span>
</span><span id="Agent.__init__-141"><a href="#Agent.__init__-141"><span class="linenos">141</span></a><span class="sd">        any provided tools, and configures execution parameters.</span>
</span><span id="Agent.__init__-142"><a href="#Agent.__init__-142"><span class="linenos">142</span></a><span class="sd">        </span>
</span><span id="Agent.__init__-143"><a href="#Agent.__init__-143"><span class="linenos">143</span></a><span class="sd">        Raises</span>
</span><span id="Agent.__init__-144"><a href="#Agent.__init__-144"><span class="linenos">144</span></a><span class="sd">        ------</span>
</span><span id="Agent.__init__-145"><a href="#Agent.__init__-145"><span class="linenos">145</span></a><span class="sd">        ValueError</span>
</span><span id="Agent.__init__-146"><a href="#Agent.__init__-146"><span class="linenos">146</span></a><span class="sd">            If the specified paradigm is not supported or invalid</span>
</span><span id="Agent.__init__-147"><a href="#Agent.__init__-147"><span class="linenos">147</span></a><span class="sd">        TypeError</span>
</span><span id="Agent.__init__-148"><a href="#Agent.__init__-148"><span class="linenos">148</span></a><span class="sd">            If a custom object is passed that doesn&#39;t derive from _AgenticLoop</span>
</span><span id="Agent.__init__-149"><a href="#Agent.__init__-149"><span class="linenos">149</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Agent.__init__-150"><a href="#Agent.__init__-150"><span class="linenos">150</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="n">model</span>
</span><span id="Agent.__init__-151"><a href="#Agent.__init__-151"><span class="linenos">151</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="Agent.__init__-152"><a href="#Agent.__init__-152"><span class="linenos">152</span></a>
</span><span id="Agent.__init__-153"><a href="#Agent.__init__-153"><span class="linenos">153</span></a>        <span class="k">if</span> <span class="n">native_web_search</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">native_web_search</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;low&quot;</span><span class="p">,</span> <span class="s2">&quot;medium&quot;</span><span class="p">,</span> <span class="s2">&quot;high&quot;</span><span class="p">]:</span>
</span><span id="Agent.__init__-154"><a href="#Agent.__init__-154"><span class="linenos">154</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;native_web_search must be &#39;low&#39;, &#39;medium&#39; or &#39;high&#39;&quot;</span><span class="p">)</span>
</span><span id="Agent.__init__-155"><a href="#Agent.__init__-155"><span class="linenos">155</span></a>        
</span><span id="Agent.__init__-156"><a href="#Agent.__init__-156"><span class="linenos">156</span></a>        <span class="k">if</span> <span class="n">human_feedback</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">human_feedback</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;actions&quot;</span><span class="p">,</span> <span class="s2">&quot;all&quot;</span><span class="p">]:</span>
</span><span id="Agent.__init__-157"><a href="#Agent.__init__-157"><span class="linenos">157</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;human_feedback must be None, &#39;actions&#39;, or &#39;all&#39;&quot;</span><span class="p">)</span>
</span><span id="Agent.__init__-158"><a href="#Agent.__init__-158"><span class="linenos">158</span></a>        
</span><span id="Agent.__init__-159"><a href="#Agent.__init__-159"><span class="linenos">159</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">_web_search</span> <span class="o">=</span> <span class="n">native_web_search</span>
</span><span id="Agent.__init__-160"><a href="#Agent.__init__-160"><span class="linenos">160</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_human_feedback</span> <span class="o">=</span> <span class="n">human_feedback</span>
</span><span id="Agent.__init__-161"><a href="#Agent.__init__-161"><span class="linenos">161</span></a>
</span><span id="Agent.__init__-162"><a href="#Agent.__init__-162"><span class="linenos">162</span></a>        <span class="c1"># Handle custom paradigm</span>
</span><span id="Agent.__init__-163"><a href="#Agent.__init__-163"><span class="linenos">163</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">paradigm</span><span class="p">,</span> <span class="n">_AgenticLoop</span><span class="p">):</span>
</span><span id="Agent.__init__-164"><a href="#Agent.__init__-164"><span class="linenos">164</span></a>            <span class="c1"># Verify that the custom object is valid</span>
</span><span id="Agent.__init__-165"><a href="#Agent.__init__-165"><span class="linenos">165</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">paradigm</span><span class="p">,</span> <span class="s1">&#39;start&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">paradigm</span><span class="o">.</span><span class="n">start</span><span class="p">):</span>
</span><span id="Agent.__init__-166"><a href="#Agent.__init__-166"><span class="linenos">166</span></a>                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Custom paradigm must have a callable &#39;start&#39; method&quot;</span><span class="p">)</span>
</span><span id="Agent.__init__-167"><a href="#Agent.__init__-167"><span class="linenos">167</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_loop</span> <span class="o">=</span> <span class="n">paradigm</span>
</span><span id="Agent.__init__-168"><a href="#Agent.__init__-168"><span class="linenos">168</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Agent.__init__-169"><a href="#Agent.__init__-169"><span class="linenos">169</span></a>            <span class="c1"># Predefined paradigms</span>
</span><span id="Agent.__init__-170"><a href="#Agent.__init__-170"><span class="linenos">170</span></a>            <span class="n">loop_kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span> <span class="n">agent_prompt</span><span class="p">,</span> <span class="n">debug</span><span class="p">,</span> <span class="n">max_iter</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">human_feedback</span>
</span><span id="Agent.__init__-171"><a href="#Agent.__init__-171"><span class="linenos">171</span></a>            
</span><span id="Agent.__init__-172"><a href="#Agent.__init__-172"><span class="linenos">172</span></a>            <span class="k">if</span> <span class="n">paradigm</span> <span class="o">==</span> <span class="s2">&quot;function_calling&quot;</span><span class="p">:</span>
</span><span id="Agent.__init__-173"><a href="#Agent.__init__-173"><span class="linenos">173</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_loop</span> <span class="o">=</span> <span class="n">FunctionCallingAgenticLoop</span><span class="p">(</span><span class="o">*</span><span class="n">loop_kwargs</span><span class="p">)</span>
</span><span id="Agent.__init__-174"><a href="#Agent.__init__-174"><span class="linenos">174</span></a>            <span class="k">elif</span> <span class="n">paradigm</span> <span class="o">==</span> <span class="s2">&quot;react&quot;</span><span class="p">:</span>
</span><span id="Agent.__init__-175"><a href="#Agent.__init__-175"><span class="linenos">175</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_loop</span> <span class="o">=</span> <span class="n">ReactAgenticLoop</span><span class="p">(</span><span class="o">*</span><span class="n">loop_kwargs</span><span class="p">)</span>
</span><span id="Agent.__init__-176"><a href="#Agent.__init__-176"><span class="linenos">176</span></a>            <span class="k">elif</span> <span class="n">paradigm</span> <span class="o">==</span> <span class="s2">&quot;react_with_function_calling&quot;</span><span class="p">:</span>
</span><span id="Agent.__init__-177"><a href="#Agent.__init__-177"><span class="linenos">177</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_loop</span> <span class="o">=</span> <span class="n">ReactWithFCAgenticLoop</span><span class="p">(</span><span class="o">*</span><span class="n">loop_kwargs</span><span class="p">)</span>
</span><span id="Agent.__init__-178"><a href="#Agent.__init__-178"><span class="linenos">178</span></a>            <span class="k">elif</span> <span class="n">paradigm</span> <span class="o">==</span> <span class="s2">&quot;plan-and-execute&quot;</span><span class="p">:</span>
</span><span id="Agent.__init__-179"><a href="#Agent.__init__-179"><span class="linenos">179</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_loop</span> <span class="o">=</span> <span class="n">PlanAndExecuteAgenticLoop</span><span class="p">(</span><span class="o">*</span><span class="n">loop_kwargs</span><span class="p">)</span>
</span><span id="Agent.__init__-180"><a href="#Agent.__init__-180"><span class="linenos">180</span></a>            <span class="k">elif</span> <span class="n">paradigm</span> <span class="o">==</span> <span class="s2">&quot;programmatic&quot;</span><span class="p">:</span>
</span><span id="Agent.__init__-181"><a href="#Agent.__init__-181"><span class="linenos">181</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_loop</span> <span class="o">=</span> <span class="n">ProgrammaticAgenticLoop</span><span class="p">(</span><span class="o">*</span><span class="n">loop_kwargs</span><span class="p">)</span>
</span><span id="Agent.__init__-182"><a href="#Agent.__init__-182"><span class="linenos">182</span></a>            <span class="k">elif</span> <span class="n">paradigm</span> <span class="o">==</span> <span class="s2">&quot;reflexion&quot;</span><span class="p">:</span>
</span><span id="Agent.__init__-183"><a href="#Agent.__init__-183"><span class="linenos">183</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_loop</span> <span class="o">=</span> <span class="n">ReflexionAgenticLoop</span><span class="p">(</span><span class="o">*</span><span class="n">loop_kwargs</span><span class="p">)</span>
</span><span id="Agent.__init__-184"><a href="#Agent.__init__-184"><span class="linenos">184</span></a>            <span class="k">elif</span> <span class="n">paradigm</span> <span class="o">==</span> <span class="s2">&quot;self_ask&quot;</span><span class="p">:</span>
</span><span id="Agent.__init__-185"><a href="#Agent.__init__-185"><span class="linenos">185</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_loop</span> <span class="o">=</span> <span class="n">SelfAskAgenticLoop</span><span class="p">(</span><span class="o">*</span><span class="n">loop_kwargs</span><span class="p">)</span>
</span><span id="Agent.__init__-186"><a href="#Agent.__init__-186"><span class="linenos">186</span></a>            <span class="k">elif</span> <span class="n">paradigm</span> <span class="o">==</span> <span class="s2">&quot;self_ask_with_search&quot;</span><span class="p">:</span>
</span><span id="Agent.__init__-187"><a href="#Agent.__init__-187"><span class="linenos">187</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_loop</span> <span class="o">=</span> <span class="n">SelfAskWithSearchLoop</span><span class="p">(</span><span class="o">*</span><span class="n">loop_kwargs</span><span class="p">)</span>
</span><span id="Agent.__init__-188"><a href="#Agent.__init__-188"><span class="linenos">188</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Agent.__init__-189"><a href="#Agent.__init__-189"><span class="linenos">189</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Paradigm &#39;</span><span class="si">{</span><span class="n">paradigm</span><span class="si">}</span><span class="s2">&#39; not supported. &quot;</span>
</span><span id="Agent.__init__-190"><a href="#Agent.__init__-190"><span class="linenos">190</span></a>                               <span class="sa">f</span><span class="s2">&quot;Available paradigms: function_calling, react, &quot;</span>
</span><span id="Agent.__init__-191"><a href="#Agent.__init__-191"><span class="linenos">191</span></a>                               <span class="sa">f</span><span class="s2">&quot;react_with_function_calling, plan-and-execute, &quot;</span>
</span><span id="Agent.__init__-192"><a href="#Agent.__init__-192"><span class="linenos">192</span></a>                               <span class="sa">f</span><span class="s2">&quot;programmatic, reflexion, self_ask, self_ask_with_search, &quot;</span>
</span><span id="Agent.__init__-193"><a href="#Agent.__init__-193"><span class="linenos">193</span></a>                               <span class="sa">f</span><span class="s2">&quot;or a custom object derived from _AgenticLoop&quot;</span><span class="p">)</span>
</span><span id="Agent.__init__-194"><a href="#Agent.__init__-194"><span class="linenos">194</span></a>        
</span><span id="Agent.__init__-195"><a href="#Agent.__init__-195"><span class="linenos">195</span></a>        <span class="k">if</span> <span class="n">tools</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Agent.__init__-196"><a href="#Agent.__init__-196"><span class="linenos">196</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_loop</span><span class="o">.</span><span class="n">register_tools</span><span class="p">(</span><span class="n">tools</span><span class="p">)</span>
</span><span id="Agent.__init__-197"><a href="#Agent.__init__-197"><span class="linenos">197</span></a>        
</span><span id="Agent.__init__-198"><a href="#Agent.__init__-198"><span class="linenos">198</span></a>        <span class="k">if</span> <span class="n">mcp_servers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Agent.__init__-199"><a href="#Agent.__init__-199"><span class="linenos">199</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_loop</span><span class="o">.</span><span class="n">register_mcp_servers</span><span class="p">(</span><span class="n">mcp_servers</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the agent with the specified model and configuration.</p>

<p>Sets up an AI agent with the chosen reasoning paradigm, registers
any provided tools, and configures execution parameters.</p>

<h6 id="raises">Raises</h6>

<ul>
<li><strong>ValueError</strong>: If the specified paradigm is not supported or invalid</li>
<li><strong>TypeError</strong>: If a custom object is passed that doesn't derive from _AgenticLoop</li>
</ul>
</div>


                            </div>
                            <div id="Agent.name" class="classattr">
                                <div class="attr variable">
            <span class="name">name</span>

        
    </div>
    <a class="headerlink" href="#Agent.name"></a>
    
    

                            </div>
                            <div id="Agent.run" class="classattr">
                                        <input id="Agent.run-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">run</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n"><a href="prompts.html#Prompt">monoai.prompts.Prompt</a></span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Agent.run-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Agent.run"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Agent.run-201"><a href="#Agent.run-201"><span class="linenos">201</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Prompt</span><span class="p">):</span>
</span><span id="Agent.run-202"><a href="#Agent.run-202"><span class="linenos">202</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Agent.run-203"><a href="#Agent.run-203"><span class="linenos">203</span></a><span class="sd">        Execute the agent with the specified prompt.</span>
</span><span id="Agent.run-204"><a href="#Agent.run-204"><span class="linenos">204</span></a><span class="sd">        </span>
</span><span id="Agent.run-205"><a href="#Agent.run-205"><span class="linenos">205</span></a><span class="sd">        Processes a user prompt through the agent&#39;s reasoning paradigm,</span>
</span><span id="Agent.run-206"><a href="#Agent.run-206"><span class="linenos">206</span></a><span class="sd">        returning a structured response that includes the reasoning process</span>
</span><span id="Agent.run-207"><a href="#Agent.run-207"><span class="linenos">207</span></a><span class="sd">        and final answer.</span>
</span><span id="Agent.run-208"><a href="#Agent.run-208"><span class="linenos">208</span></a><span class="sd">        </span>
</span><span id="Agent.run-209"><a href="#Agent.run-209"><span class="linenos">209</span></a><span class="sd">        Parameters</span>
</span><span id="Agent.run-210"><a href="#Agent.run-210"><span class="linenos">210</span></a><span class="sd">        ----------</span>
</span><span id="Agent.run-211"><a href="#Agent.run-211"><span class="linenos">211</span></a><span class="sd">        prompt : str or Prompt</span>
</span><span id="Agent.run-212"><a href="#Agent.run-212"><span class="linenos">212</span></a><span class="sd">            User prompt or query to process. Can be a string or a Prompt object.</span>
</span><span id="Agent.run-213"><a href="#Agent.run-213"><span class="linenos">213</span></a><span class="sd">        </span>
</span><span id="Agent.run-214"><a href="#Agent.run-214"><span class="linenos">214</span></a><span class="sd">        Returns</span>
</span><span id="Agent.run-215"><a href="#Agent.run-215"><span class="linenos">215</span></a><span class="sd">        -------</span>
</span><span id="Agent.run-216"><a href="#Agent.run-216"><span class="linenos">216</span></a><span class="sd">        Dict[str, Any]</span>
</span><span id="Agent.run-217"><a href="#Agent.run-217"><span class="linenos">217</span></a><span class="sd">            Agent response containing:</span>
</span><span id="Agent.run-218"><a href="#Agent.run-218"><span class="linenos">218</span></a><span class="sd">            - prompt: Original user query</span>
</span><span id="Agent.run-219"><a href="#Agent.run-219"><span class="linenos">219</span></a><span class="sd">            - iterations: List of processed reasoning iterations</span>
</span><span id="Agent.run-220"><a href="#Agent.run-220"><span class="linenos">220</span></a><span class="sd">            - response: Final response (if available)</span>
</span><span id="Agent.run-221"><a href="#Agent.run-221"><span class="linenos">221</span></a><span class="sd">            - metadata: Additional execution metadata (paradigm-specific)</span>
</span><span id="Agent.run-222"><a href="#Agent.run-222"><span class="linenos">222</span></a><span class="sd">        </span>
</span><span id="Agent.run-223"><a href="#Agent.run-223"><span class="linenos">223</span></a><span class="sd">        Examples</span>
</span><span id="Agent.run-224"><a href="#Agent.run-224"><span class="linenos">224</span></a><span class="sd">        --------</span>
</span><span id="Agent.run-225"><a href="#Agent.run-225"><span class="linenos">225</span></a><span class="sd">        &gt;&gt;&gt; agent = Agent(model=model, paradigm=&quot;function_calling&quot;)</span>
</span><span id="Agent.run-226"><a href="#Agent.run-226"><span class="linenos">226</span></a><span class="sd">        &gt;&gt;&gt; response = agent.run(&quot;What&#39;s the weather in New York?&quot;)</span>
</span><span id="Agent.run-227"><a href="#Agent.run-227"><span class="linenos">227</span></a><span class="sd">        &gt;&gt;&gt; print(response[&#39;response&#39;])</span>
</span><span id="Agent.run-228"><a href="#Agent.run-228"><span class="linenos">228</span></a><span class="sd">        </span>
</span><span id="Agent.run-229"><a href="#Agent.run-229"><span class="linenos">229</span></a><span class="sd">        &gt;&gt;&gt; from monoai.prompts import Prompt</span>
</span><span id="Agent.run-230"><a href="#Agent.run-230"><span class="linenos">230</span></a><span class="sd">        &gt;&gt;&gt; prompt = Prompt(&quot;Analyze this data: [1, 2, 3, 4, 5]&quot;)</span>
</span><span id="Agent.run-231"><a href="#Agent.run-231"><span class="linenos">231</span></a><span class="sd">        &gt;&gt;&gt; response = agent.run(prompt)</span>
</span><span id="Agent.run-232"><a href="#Agent.run-232"><span class="linenos">232</span></a><span class="sd">        &gt;&gt;&gt; print(response[&#39;iterations&#39;])</span>
</span><span id="Agent.run-233"><a href="#Agent.run-233"><span class="linenos">233</span></a><span class="sd">        </span>
</span><span id="Agent.run-234"><a href="#Agent.run-234"><span class="linenos">234</span></a><span class="sd">        Notes</span>
</span><span id="Agent.run-235"><a href="#Agent.run-235"><span class="linenos">235</span></a><span class="sd">        -----</span>
</span><span id="Agent.run-236"><a href="#Agent.run-236"><span class="linenos">236</span></a><span class="sd">        The response structure varies by paradigm:</span>
</span><span id="Agent.run-237"><a href="#Agent.run-237"><span class="linenos">237</span></a><span class="sd">        - **Function calling**: Includes tool call details and function results</span>
</span><span id="Agent.run-238"><a href="#Agent.run-238"><span class="linenos">238</span></a><span class="sd">        - **ReAct**: Includes thought-action-observation cycles</span>
</span><span id="Agent.run-239"><a href="#Agent.run-239"><span class="linenos">239</span></a><span class="sd">        - **Plan-and-execute**: Includes planning and execution phases</span>
</span><span id="Agent.run-240"><a href="#Agent.run-240"><span class="linenos">240</span></a><span class="sd">        - **Programmatic**: Includes code generation and execution results</span>
</span><span id="Agent.run-241"><a href="#Agent.run-241"><span class="linenos">241</span></a><span class="sd">        - **Reflexion**: Includes self-reflection and error correction steps</span>
</span><span id="Agent.run-242"><a href="#Agent.run-242"><span class="linenos">242</span></a><span class="sd">        - **Self-ask**: Includes question-answer reasoning chains</span>
</span><span id="Agent.run-243"><a href="#Agent.run-243"><span class="linenos">243</span></a><span class="sd">        - **Self-ask with search**: Includes web search results and reasoning</span>
</span><span id="Agent.run-244"><a href="#Agent.run-244"><span class="linenos">244</span></a><span class="sd">        - **Custom paradigms**: May include paradigm-specific information</span>
</span><span id="Agent.run-245"><a href="#Agent.run-245"><span class="linenos">245</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Agent.run-246"><a href="#Agent.run-246"><span class="linenos">246</span></a>        
</span><span id="Agent.run-247"><a href="#Agent.run-247"><span class="linenos">247</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loop</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Execute the agent with the specified prompt.</p>

<p>Processes a user prompt through the agent's reasoning paradigm,
returning a structured response that includes the reasoning process
and final answer.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>prompt</strong> (str or Prompt):
User prompt or query to process. Can be a string or a Prompt object.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>Dict[str, Any]</strong>: Agent response containing:
<ul>
<li>prompt: Original user query</li>
<li>iterations: List of processed reasoning iterations</li>
<li>response: Final response (if available)</li>
<li>metadata: Additional execution metadata (paradigm-specific)</li>
</ul></li>
</ul>

<h6 id="examples">Examples</h6>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">agent</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">paradigm</span><span class="o">=</span><span class="s2">&quot;function_calling&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;What&#39;s the weather in New York?&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;response&#39;</span><span class="p">])</span>
</code></pre>
</div>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn"><a href="prompts.html">monoai.prompts</a></span><span class="w"> </span><span class="kn">import</span> <span class="n">Prompt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">prompt</span> <span class="o">=</span> <span class="n">Prompt</span><span class="p">(</span><span class="s2">&quot;Analyze this data: [1, 2, 3, 4, 5]&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;iterations&#39;</span><span class="p">])</span>
</code></pre>
</div>

<h6 id="notes">Notes</h6>

<p>The response structure varies by paradigm:</p>

<ul>
<li><strong>Function calling</strong>: Includes tool call details and function results</li>
<li><strong>ReAct</strong>: Includes thought-action-observation cycles</li>
<li><strong>Plan-and-execute</strong>: Includes planning and execution phases</li>
<li><strong>Programmatic</strong>: Includes code generation and execution results</li>
<li><strong>Reflexion</strong>: Includes self-reflection and error correction steps</li>
<li><strong>Self-ask</strong>: Includes question-answer reasoning chains</li>
<li><strong>Self-ask with search</strong>: Includes web search results and reasoning</li>
<li><strong>Custom paradigms</strong>: May include paradigm-specific information</li>
</ul>
</div>


                            </div>
                            <div id="Agent.enable_streaming" class="classattr">
                                        <input id="Agent.enable_streaming-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">enable_streaming</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">stream_callback</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Agent.enable_streaming-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Agent.enable_streaming"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Agent.enable_streaming-249"><a href="#Agent.enable_streaming-249"><span class="linenos">249</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">enable_streaming</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_callback</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Agent.enable_streaming-250"><a href="#Agent.enable_streaming-250"><span class="linenos">250</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Agent.enable_streaming-251"><a href="#Agent.enable_streaming-251"><span class="linenos">251</span></a><span class="sd">        Enable streaming responses for this agent.</span>
</span><span id="Agent.enable_streaming-252"><a href="#Agent.enable_streaming-252"><span class="linenos">252</span></a><span class="sd">        </span>
</span><span id="Agent.enable_streaming-253"><a href="#Agent.enable_streaming-253"><span class="linenos">253</span></a><span class="sd">        When streaming is enabled, the agent will call the provided callback</span>
</span><span id="Agent.enable_streaming-254"><a href="#Agent.enable_streaming-254"><span class="linenos">254</span></a><span class="sd">        function with each content chunk as it&#39;s generated, allowing for</span>
</span><span id="Agent.enable_streaming-255"><a href="#Agent.enable_streaming-255"><span class="linenos">255</span></a><span class="sd">        real-time processing and display of the AI&#39;s response.</span>
</span><span id="Agent.enable_streaming-256"><a href="#Agent.enable_streaming-256"><span class="linenos">256</span></a><span class="sd">        </span>
</span><span id="Agent.enable_streaming-257"><a href="#Agent.enable_streaming-257"><span class="linenos">257</span></a><span class="sd">        Parameters</span>
</span><span id="Agent.enable_streaming-258"><a href="#Agent.enable_streaming-258"><span class="linenos">258</span></a><span class="sd">        ----------</span>
</span><span id="Agent.enable_streaming-259"><a href="#Agent.enable_streaming-259"><span class="linenos">259</span></a><span class="sd">        stream_callback : callable, optional</span>
</span><span id="Agent.enable_streaming-260"><a href="#Agent.enable_streaming-260"><span class="linenos">260</span></a><span class="sd">            Callback function to handle streaming content chunks.</span>
</span><span id="Agent.enable_streaming-261"><a href="#Agent.enable_streaming-261"><span class="linenos">261</span></a><span class="sd">            If None, uses a default callback that prints content to console.</span>
</span><span id="Agent.enable_streaming-262"><a href="#Agent.enable_streaming-262"><span class="linenos">262</span></a><span class="sd">            The callback receives plain text content strings.</span>
</span><span id="Agent.enable_streaming-263"><a href="#Agent.enable_streaming-263"><span class="linenos">263</span></a><span class="sd">            </span>
</span><span id="Agent.enable_streaming-264"><a href="#Agent.enable_streaming-264"><span class="linenos">264</span></a><span class="sd">            Callback signature: callback(content: str) -&gt; None</span>
</span><span id="Agent.enable_streaming-265"><a href="#Agent.enable_streaming-265"><span class="linenos">265</span></a><span class="sd">            where content is the streaming text chunk.</span>
</span><span id="Agent.enable_streaming-266"><a href="#Agent.enable_streaming-266"><span class="linenos">266</span></a><span class="sd">        </span>
</span><span id="Agent.enable_streaming-267"><a href="#Agent.enable_streaming-267"><span class="linenos">267</span></a><span class="sd">        Raises</span>
</span><span id="Agent.enable_streaming-268"><a href="#Agent.enable_streaming-268"><span class="linenos">268</span></a><span class="sd">        ------</span>
</span><span id="Agent.enable_streaming-269"><a href="#Agent.enable_streaming-269"><span class="linenos">269</span></a><span class="sd">        AttributeError</span>
</span><span id="Agent.enable_streaming-270"><a href="#Agent.enable_streaming-270"><span class="linenos">270</span></a><span class="sd">            If the current paradigm doesn&#39;t support streaming</span>
</span><span id="Agent.enable_streaming-271"><a href="#Agent.enable_streaming-271"><span class="linenos">271</span></a><span class="sd">            </span>
</span><span id="Agent.enable_streaming-272"><a href="#Agent.enable_streaming-272"><span class="linenos">272</span></a><span class="sd">        Examples</span>
</span><span id="Agent.enable_streaming-273"><a href="#Agent.enable_streaming-273"><span class="linenos">273</span></a><span class="sd">        --------</span>
</span><span id="Agent.enable_streaming-274"><a href="#Agent.enable_streaming-274"><span class="linenos">274</span></a><span class="sd">        &gt;&gt;&gt; def my_callback(content):</span>
</span><span id="Agent.enable_streaming-275"><a href="#Agent.enable_streaming-275"><span class="linenos">275</span></a><span class="sd">        ...     print(f&quot;Streaming: {content}&quot;)</span>
</span><span id="Agent.enable_streaming-276"><a href="#Agent.enable_streaming-276"><span class="linenos">276</span></a><span class="sd">        &gt;&gt;&gt; </span>
</span><span id="Agent.enable_streaming-277"><a href="#Agent.enable_streaming-277"><span class="linenos">277</span></a><span class="sd">        &gt;&gt;&gt; agent = Agent(model=model, paradigm=&quot;function_calling&quot;)</span>
</span><span id="Agent.enable_streaming-278"><a href="#Agent.enable_streaming-278"><span class="linenos">278</span></a><span class="sd">        &gt;&gt;&gt; agent.enable_streaming(my_callback)</span>
</span><span id="Agent.enable_streaming-279"><a href="#Agent.enable_streaming-279"><span class="linenos">279</span></a><span class="sd">        &gt;&gt;&gt; response = agent.run(&quot;Tell me a story&quot;)</span>
</span><span id="Agent.enable_streaming-280"><a href="#Agent.enable_streaming-280"><span class="linenos">280</span></a><span class="sd">        </span>
</span><span id="Agent.enable_streaming-281"><a href="#Agent.enable_streaming-281"><span class="linenos">281</span></a><span class="sd">        Notes</span>
</span><span id="Agent.enable_streaming-282"><a href="#Agent.enable_streaming-282"><span class="linenos">282</span></a><span class="sd">        -----</span>
</span><span id="Agent.enable_streaming-283"><a href="#Agent.enable_streaming-283"><span class="linenos">283</span></a><span class="sd">        Not all paradigms support streaming. Check the specific paradigm</span>
</span><span id="Agent.enable_streaming-284"><a href="#Agent.enable_streaming-284"><span class="linenos">284</span></a><span class="sd">        implementation to ensure streaming is available.</span>
</span><span id="Agent.enable_streaming-285"><a href="#Agent.enable_streaming-285"><span class="linenos">285</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Agent.enable_streaming-286"><a href="#Agent.enable_streaming-286"><span class="linenos">286</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_loop</span><span class="p">,</span> <span class="s1">&#39;enable_streaming&#39;</span><span class="p">):</span>
</span><span id="Agent.enable_streaming-287"><a href="#Agent.enable_streaming-287"><span class="linenos">287</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_loop</span><span class="o">.</span><span class="n">enable_streaming</span><span class="p">(</span><span class="n">stream_callback</span><span class="p">)</span>
</span><span id="Agent.enable_streaming-288"><a href="#Agent.enable_streaming-288"><span class="linenos">288</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Agent.enable_streaming-289"><a href="#Agent.enable_streaming-289"><span class="linenos">289</span></a>            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Paradigm &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_loop</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39; doesn&#39;t support streaming&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Enable streaming responses for this agent.</p>

<p>When streaming is enabled, the agent will call the provided callback
function with each content chunk as it's generated, allowing for
real-time processing and display of the AI's response.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><p><strong>stream_callback</strong> (callable, optional):
Callback function to handle streaming content chunks.
If None, uses a default callback that prints content to console.
The callback receives plain text content strings.</p>

<p>Callback signature: callback(content: str) -> None
where content is the streaming text chunk.</p></li>
</ul>

<h6 id="raises">Raises</h6>

<ul>
<li><strong>AttributeError</strong>: If the current paradigm doesn't support streaming</li>
</ul>

<h6 id="examples">Examples</h6>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span><span class="w"> </span><span class="nf">my_callback</span><span class="p">(</span><span class="n">content</span><span class="p">):</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Streaming: </span><span class="si">{</span><span class="n">content</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">agent</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">paradigm</span><span class="o">=</span><span class="s2">&quot;function_calling&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">agent</span><span class="o">.</span><span class="n">enable_streaming</span><span class="p">(</span><span class="n">my_callback</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;Tell me a story&quot;</span><span class="p">)</span>
</code></pre>
</div>

<h6 id="notes">Notes</h6>

<p>Not all paradigms support streaming. Check the specific paradigm
implementation to ensure streaming is available.</p>
</div>


                            </div>
                            <div id="Agent.disable_streaming" class="classattr">
                                        <input id="Agent.disable_streaming-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">disable_streaming</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Agent.disable_streaming-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Agent.disable_streaming"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Agent.disable_streaming-291"><a href="#Agent.disable_streaming-291"><span class="linenos">291</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">disable_streaming</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Agent.disable_streaming-292"><a href="#Agent.disable_streaming-292"><span class="linenos">292</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Agent.disable_streaming-293"><a href="#Agent.disable_streaming-293"><span class="linenos">293</span></a><span class="sd">        Disable streaming responses for this agent.</span>
</span><span id="Agent.disable_streaming-294"><a href="#Agent.disable_streaming-294"><span class="linenos">294</span></a><span class="sd">        </span>
</span><span id="Agent.disable_streaming-295"><a href="#Agent.disable_streaming-295"><span class="linenos">295</span></a><span class="sd">        After calling this method, the agent will use standard (non-streaming)</span>
</span><span id="Agent.disable_streaming-296"><a href="#Agent.disable_streaming-296"><span class="linenos">296</span></a><span class="sd">        model execution for all subsequent requests.</span>
</span><span id="Agent.disable_streaming-297"><a href="#Agent.disable_streaming-297"><span class="linenos">297</span></a><span class="sd">        </span>
</span><span id="Agent.disable_streaming-298"><a href="#Agent.disable_streaming-298"><span class="linenos">298</span></a><span class="sd">        Raises</span>
</span><span id="Agent.disable_streaming-299"><a href="#Agent.disable_streaming-299"><span class="linenos">299</span></a><span class="sd">        ------</span>
</span><span id="Agent.disable_streaming-300"><a href="#Agent.disable_streaming-300"><span class="linenos">300</span></a><span class="sd">        AttributeError</span>
</span><span id="Agent.disable_streaming-301"><a href="#Agent.disable_streaming-301"><span class="linenos">301</span></a><span class="sd">            If the current paradigm doesn&#39;t support streaming</span>
</span><span id="Agent.disable_streaming-302"><a href="#Agent.disable_streaming-302"><span class="linenos">302</span></a><span class="sd">            </span>
</span><span id="Agent.disable_streaming-303"><a href="#Agent.disable_streaming-303"><span class="linenos">303</span></a><span class="sd">        Examples</span>
</span><span id="Agent.disable_streaming-304"><a href="#Agent.disable_streaming-304"><span class="linenos">304</span></a><span class="sd">        --------</span>
</span><span id="Agent.disable_streaming-305"><a href="#Agent.disable_streaming-305"><span class="linenos">305</span></a><span class="sd">        &gt;&gt;&gt; agent = Agent(model=model, paradigm=&quot;function_calling&quot;)</span>
</span><span id="Agent.disable_streaming-306"><a href="#Agent.disable_streaming-306"><span class="linenos">306</span></a><span class="sd">        &gt;&gt;&gt; agent.enable_streaming()</span>
</span><span id="Agent.disable_streaming-307"><a href="#Agent.disable_streaming-307"><span class="linenos">307</span></a><span class="sd">        &gt;&gt;&gt; # ... use streaming ...</span>
</span><span id="Agent.disable_streaming-308"><a href="#Agent.disable_streaming-308"><span class="linenos">308</span></a><span class="sd">        &gt;&gt;&gt; agent.disable_streaming()</span>
</span><span id="Agent.disable_streaming-309"><a href="#Agent.disable_streaming-309"><span class="linenos">309</span></a><span class="sd">        &gt;&gt;&gt; # Now using standard execution</span>
</span><span id="Agent.disable_streaming-310"><a href="#Agent.disable_streaming-310"><span class="linenos">310</span></a><span class="sd">        </span>
</span><span id="Agent.disable_streaming-311"><a href="#Agent.disable_streaming-311"><span class="linenos">311</span></a><span class="sd">        Notes</span>
</span><span id="Agent.disable_streaming-312"><a href="#Agent.disable_streaming-312"><span class="linenos">312</span></a><span class="sd">        -----</span>
</span><span id="Agent.disable_streaming-313"><a href="#Agent.disable_streaming-313"><span class="linenos">313</span></a><span class="sd">        Not all paradigms support streaming. Check the specific paradigm</span>
</span><span id="Agent.disable_streaming-314"><a href="#Agent.disable_streaming-314"><span class="linenos">314</span></a><span class="sd">        implementation to ensure streaming is available.</span>
</span><span id="Agent.disable_streaming-315"><a href="#Agent.disable_streaming-315"><span class="linenos">315</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Agent.disable_streaming-316"><a href="#Agent.disable_streaming-316"><span class="linenos">316</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_loop</span><span class="p">,</span> <span class="s1">&#39;disable_streaming&#39;</span><span class="p">):</span>
</span><span id="Agent.disable_streaming-317"><a href="#Agent.disable_streaming-317"><span class="linenos">317</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_loop</span><span class="o">.</span><span class="n">disable_streaming</span><span class="p">()</span>
</span><span id="Agent.disable_streaming-318"><a href="#Agent.disable_streaming-318"><span class="linenos">318</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Agent.disable_streaming-319"><a href="#Agent.disable_streaming-319"><span class="linenos">319</span></a>            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Paradigm &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_loop</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39; doesn&#39;t support streaming&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Disable streaming responses for this agent.</p>

<p>After calling this method, the agent will use standard (non-streaming)
model execution for all subsequent requests.</p>

<h6 id="raises">Raises</h6>

<ul>
<li><strong>AttributeError</strong>: If the current paradigm doesn't support streaming</li>
</ul>

<h6 id="examples">Examples</h6>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">agent</span> <span class="o">=</span> <span class="n">Agent</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">paradigm</span><span class="o">=</span><span class="s2">&quot;function_calling&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">agent</span><span class="o">.</span><span class="n">enable_streaming</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># ... use streaming ...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">agent</span><span class="o">.</span><span class="n">disable_streaming</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Now using standard execution</span>
</code></pre>
</div>

<h6 id="notes">Notes</h6>

<p>Not all paradigms support streaming. Check the specific paradigm
implementation to ensure streaming is available.</p>
</div>


                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>